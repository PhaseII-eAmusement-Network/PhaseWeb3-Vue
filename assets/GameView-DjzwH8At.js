import{d as o,a as r,p as c,t as k,u as Z,l as tt,m as at,r as p,z as et,P as st,aa as rt,o as it,j as E,c as S,w as b,b as d,_ as ot,e as f,g as i,B as nt,f as M,n as q,F as H,h as N,x as lt,L as j,k as ut}from"./index-Cry8cBkD.js";import{g as z,_ as dt,I as ct}from"./danClass-Ck25djPV.js";import{F as mt}from"./PhUsersThree.vue-BQuOUeME.js";import{_ as ft}from"./GameHeader-C29wwlzl.js";import{_ as ht}from"./FormControl-9AmngU9p.js";import{_ as vt}from"./ProfileCard-D8nmUq4g.js";import{_ as _t}from"./GeneralTable-CZXeH_NE.js";import{a as pt,A as gt}from"./profile-BsDGrapW.js";import{a as yt}from"./music-Dtw5kS22.js";import{d as xt}from"./userData-DZYdegtD.js";import"./PhGear.vue-DuEAr60V.js";import"./PhHouse.vue-BLtqMtbp.js";import"./contentExport-DDc7cNh4.js";const wt={class:"flex mt-3"},Vt=["href"],A={__name:"SongCardSmall",props:{musicData:{type:Object,required:!0},gameId:{type:String,required:!0}},setup(g){return(h,L)=>(r(),o("div",wt,[c("a",{class:"bg-slate-700 p-2 rounded-xl hover:text-slate-300",href:`/games/${g.gameId}/song/${g.musicData.id}`},k(g.musicData.name)+" - "+k(g.musicData.artist),9,Vt)]))}},It={key:0,class:"w-full md:flex md:-mt-[75px] mb-4 place-content-end"},bt={class:"md:w-1/3 md:text-right"},kt={key:1,class:"w-full"},$t={key:0,class:"grid lg:grid-cols-2 items-stretch w-full gap-6 mb-6"},Dt={key:1},Pt={key:0,class:"grid gap-6"},St={key:0},At={key:0},Et={class:"text-xl font-bold"},Lt={class:"text-md font-light flex gap-2"},Gt={class:"font-normal"},Bt={class:"font-normal"},Rt={key:0,class:"flex gap-6 text-lg mt-3"},Ct={key:1,class:"flex mt-3"},Ft={class:"bg-white dark:bg-slate-900/95 rounded-2xl lg:flex lg:justify-between"},Mt={class:"w-full"},Zt={__name:"GameView",setup(g){const h=Z(),L=tt(),G=at();var l=null,n=null;const y=p(null),B=p(null),x=p([]),$=p(null),R=p([]),D=p([]),w=p(null),v=p(null),u=et({currentVersion:null});st(()=>u.currentVersion,()=>{h.continueLoad=!0,C(u.currentVersion,x.length!=0),F(),D.value=[],h.continueLoad=!1,h.isLoading=!1,h.activeRequests=0}),l=L.params.id,n=rt(l),n==null&&G.push({name:"ErrorPage",params:{catchAll:"404"}}),it(async()=>{h.continueLoad=!0,await F(),await C(null,x.length==0),h.continueLoad=!1,h.isLoading=!1,h.activeRequests=0}),n.versions||(u.currentVersion=1);async function C(e,a){try{const t=await pt(l,e,a);x.value.length===0&&!a&&(x.value=O(t.profiles)),$.value=t.hitchart,R.value=t.scheduledEvents,K(),D.value=U(t.hitchart).concat(W(t.scheduledEvents)),await Q(),$.value=Y(t.hitchart)}catch(t){console.error("Failed to fetch profile data:",t)}}async function F(){try{y.value=null;const e=await gt(l,u.currentVersion);if(!e)return;y.value=e.profile,B.value=e.versions,e&&!u.currentVersion&&(u.currentVersion=e.versions[e.versions.length-1])}catch(e){console.error("Failed to fetch user profile data:",e)}}const V=[];if(V.push({text:"Player",value:"username",sortable:!0,width:120}),n.noRivals||V.push({text:"Rival ID",value:"extid",sortable:!0,width:100}),V.push({text:"Last Play",value:"stats.last_play_timestamp",sortable:!0,width:150},{text:"Last Arcade",value:"stats.last_play_arcade",sortable:!0,width:150},{text:"Plays",value:"stats.total_plays",sortable:!0,width:50}),n.playerHeaders)for(var T of n.playerHeaders)V.push(T);function O(e){var a=[];for(var t of e)t.extid&&(t.extid=xt(t.extid)),t.stats&&(t.stats.last_play_timestamp&&(t.stats.last_play_timestamp=E(t.stats.last_play_timestamp)),t.sgrade&&(t.sgrade=z(t.sgrade).short),t.dgrade&&(t.dgrade=z(t.dgrade).short)),a.push(t);return a.sort((s,_)=>{const P=s.stats&&s.stats.total_plays||0;return(_.stats&&_.stats.total_plays||0)-P}),a}function X(e){var a=[];for(const t of n.versions)e.includes(t.id)&&a.push(t);return a}const J=e=>{const a=e.userId;G.push(`/games/${l}/profiles/${a}`)};function K(){return n.scheduledEvents?(v.value=n.scheduledEvents[u.currentVersion]??null,v.value):null}async function Q(){if(D.value.length){const e=await yt(l,u.currentVersion,D.value,!0);w.value=e}}function I(e){return w.value?w.value.find(a=>a.id==e):null}function m(e){return R.value.find(t=>t.id==e)}function U(e){var a=[];for(const t in e){const s=e[t][0];a.push(s)}return a}function W(e){if(v.value==null)return[];var a=[];for(const t of v.value){const s=e.find(_=>_.id==t.id);if(s?.data?.music)if(Array.isArray(s?.data.music))for(const _ of s.data.music)a.push(_);else a.push(s?.data.music);s?.data?.today&&a.push(s?.data.today),s?.data?.whim&&a.push(s?.data.whim)}return a}function Y(e){var a=[];for(const t in e){const s=e[t][0],_=e[t][1],P=I(s);a.push({songid:s,plays:_,name:P?.name,artist:P?.artist})}return a}return(e,a)=>(r(),S(ut,null,{default:b(()=>[d(ot,null,{default:b(()=>[d(ft,{game:i(n),version:u.currentVersion},{default:b(()=>[i(n).versions&&y.value?(r(),o("div",It,[c("div",bt,[a[1]||(a[1]=c("h2",{class:"text-md sm:text-lg md:text-xl font-bold p-2"}," Select Version ",-1)),d(ht,{modelValue:u.currentVersion,"onUpdate:modelValue":a[0]||(a[0]=t=>u.currentVersion=t),options:X(B.value)},null,8,["modelValue","options"])])])):f("",!0),y.value?(r(),o("div",kt,[d(vt,{game:i(l),version:u.currentVersion,profile:y.value},null,8,["game","version","profile"])])):f("",!0)]),_:1},8,["game","version"]),v.value||!i(n).noScores?(r(),o("div",$t,[!i(n).noScores&&$.value?(r(),o("div",{key:0,class:nt({"md:col-span-2":!v.value})},[d(dt,{"hitchart-data":$.value,"game-id":i(l)},null,8,["hitchart-data","game-id"])],2)):f("",!0),v.value!=null?(r(),o("div",Dt,[d(M,{icon:i(ct),color:"text-emerald-400",title:"Scheduled Events",main:""},null,8,["icon"]),d(q,null,{default:b(()=>[w.value?(r(),o("div",Pt,[(r(!0),o(H,null,N(v.value,t=>(r(),o("div",{key:t.id},[m(t.id)?(r(),o("div",St,[t.id?(r(),o("div",At,[d(lt,{color:"info",label:t.duration},null,8,["label"]),c("h1",Et,k(t.name),1),c("div",Lt,[c("h1",null,[a[2]||(a[2]=j(" Started ",-1)),c("span",Gt,k(i(E)(m(t.id)?.start_time)),1)]),a[4]||(a[4]=c("span",null,"|",-1)),c("h1",null,[a[3]||(a[3]=j(" Expires ",-1)),c("span",Bt,k(i(E)(m(t.id)?.end_time)),1)])]),Array.isArray(m(t.id)?.data?.music)&&w.value?(r(),o("div",Rt,[(r(!0),o(H,null,N(m(t.id).data.music,s=>(r(),S(A,{"game-id":i(l),"music-data":I(s)},null,8,["game-id","music-data"]))),256))])):m(t.id)?.data?.music?(r(),o("div",Ct,[d(A,{"game-id":i(l),"music-data":I(m(t.id)?.data?.music)},null,8,["game-id","music-data"])])):f("",!0),m(t.id)?.data?.today?(r(),S(A,{key:2,"game-id":i(l),"music-data":I(m(t.id)?.data?.today)},null,8,["game-id","music-data"])):f("",!0),m(t.id)?.data?.whim?(r(),S(A,{key:3,"game-id":i(l),"music-data":I(m(t.id)?.data?.whim)},null,8,["game-id","music-data"])):f("",!0)])):f("",!0)])):f("",!0)]))),128))])):f("",!0)]),_:1})])):f("",!0)])):f("",!0),d(M,{icon:i(mt),color:"text-blue-400",title:"All Players",main:""},null,8,["icon"]),d(q,{"has-table":""},{default:b(()=>[c("div",Ft,[c("div",Mt,[d(_t,{headers:V,items:x.value,onRowClicked:J},null,8,["items"])])])]),_:1})]),_:1})]),_:1}))}};export{Zt as default};
