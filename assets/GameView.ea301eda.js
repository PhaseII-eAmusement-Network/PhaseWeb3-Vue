import{u as S,a as B,s as D,M as C,ag as G,r as w,o as N,c as d,e as m,w as p,f as i,j as n,g as t,k as _,n as h,i as V,aY as F,aZ as L,aU as M,$ as j,a_ as E,_ as H,p as T,q as U}from"./index.130e9bc7.js";import{_ as q}from"./GameTitleLine.492759fd.js";import{_ as z}from"./FormControl.2ba80829.js";import{_ as O}from"./ProfileCard.11e4f932.js";import{_ as X}from"./GeneralTable.75c6d318.js";import{a as Y,A as Z}from"./profile.0f8a8b5b.js";import{g as J,a as K}from"./sources.0e8cabdf.js";import{d as Q}from"./userData.bcc92478.js";import{g as P}from"./danClass.233b0381.js";const W=["src"],ee={class:"bg-white dark:bg-slate-900/90 rounded-2xl pt-6 p-3 card-content"},se={class:"w-full"},te={class:"md:flex md:px-5 md:space-x-10 md:justify-between md:items-center"},ae={key:0,class:"md:w-1/3 md:text-right"},oe={key:0,class:"w-full pt-6 pb-10"},re={key:1,class:"md:w-1/2 grid grid-cols-1 md:grid-cols-2 gap-3"},le={class:"bg-white dark:bg-slate-900/95 rounded-2xl lg:flex lg:justify-between"},ne={class:"w-full"},ye={__name:"GameView",setup(ie){const $=S(),v=B();var l=null,a=null;const r=D({currentVersion:null});C(()=>r.currentVersion,()=>{y()}),l=$.params.id,a=G(l),a==null&&v.push({name:"ErrorPage",params:{catchAll:"404"}});const c=w(null),g=w([]);N(async()=>{try{const s=await Y(l);g.value=b(s)}catch(s){console.error("Failed to fetch profile data:",s)}y()}),a.versions||(r.currentVersion=1);async function y(){try{c.value=null;const s=await Z(l,r.currentVersion);c.value=s,s&&!r.currentVersion&&(r.currentVersion=s.versions[s.versions.length-1])}catch(s){console.error("Failed to fetch user profile data:",s)}}const u=[];if(u.push({text:"Player",value:"username",sortable:!0,width:120}),a.noRivals||u.push({text:"Rival ID",value:"extid",width:100}),u.push({text:"Last Play",value:"stats.last_play_timestamp",width:150},{text:"Last Arcade",value:"stats.last_play_arcade",width:150},{text:"Plays",value:"stats.total_plays",sortable:!0,width:50}),a.playerHeaders)for(var k of a.playerHeaders)u.push(k);function b(s){var o=[];for(var e of s){if(e.extid&&(e.extid=Q(e.extid)),e.stats){if(e.stats.last_play_timestamp){const f=new Date(e.stats.last_play_timestamp*1e3);e.stats.last_play_timestamp=f.toLocaleString()}e.sgrade&&(e.sgrade=P(e.sgrade).short),e.dgrade&&(e.dgrade=P(e.dgrade).short)}o.push(e)}return o.sort((f,x)=>{const R=f.stats&&f.stats.total_plays||0;return(x.stats&&x.stats.total_plays||0)-R}),o}function I(s){var o=[];for(const e of a.versions)s.includes(e.id)&&o.push(e);return o}const A=s=>{const o=s.userId;v.push(`/games/${l}/profiles/${o}`)};return(s,o)=>(d(),m(U,null,{default:p(()=>[i(T,null,{default:p(()=>[n("div",{style:M(t(K)(t(a),r.currentVersion)),class:"rounded-2xl mb-6 card-container"},[n("video",{autoplay:"",muted:"",loop:"",playsinline:"",src:t(J)(t(a),r.currentVersion),class:"background-video"},null,8,W),n("div",ee,[n("div",se,[n("div",te,[i(q,{path:t(a).icon,title:t(a).name},null,8,["path","title"]),t(a).versions&&c.value?(d(),_("div",ae,[o[1]||(o[1]=n("h2",{class:"text-md sm:text-lg md:text-xl font-bold p-2"}," Select Version ",-1)),i(z,{modelValue:r.currentVersion,"onUpdate:modelValue":o[0]||(o[0]=e=>r.currentVersion=e),options:I(c.value.versions)},null,8,["modelValue","options"])])):h("",!0)])]),c.value?(d(),_("div",oe,[i(O,{game:t(l),version:r.currentVersion,profile:c.value},null,8,["game","version","profile"])])):(d(),_("div",re,[t(a).noScores?h("",!0):(d(),m(V,{key:0,href:`/#/games/${t(l)}/scores`,icon:t(F),outline:!1,color:"info",label:"Network Scores"},null,8,["href","icon"])),t(a).noRecords?h("",!0):(d(),m(V,{key:1,href:`/#/games/${t(l)}/records`,icon:t(L),outline:!1,color:"info",label:"Network Records"},null,8,["href","icon"]))]))])],4),i(j,{icon:t(E),title:"All Players",main:""},null,8,["icon"]),i(H,{"has-table":""},{default:p(()=>[n("div",le,[n("div",ne,[i(X,{headers:u,items:g.value,path:`/#/${t(l)}/profiles/`,onRowClicked:A},null,8,["items","path"])])])]),_:1})]),_:1})]),_:1}))}};export{ye as default};
