import{r as w,o as P,c as D,d as u,w as m,e as n,_ as I,j as f,f as M,M as O,F as T,N as b,g as y,ad as U,h as k,i as s,H as B,t as r,P as F,l as G,ae as j,n as L,af as Y,a4 as E}from"./index-DxCfvdTP.js";import{_ as J}from"./GeneralTable-6criTM9z.js";import{A as R}from"./music-bFhKRc2e.js";const q={key:0,class:"grid grid-cols-1 md:grid-cols-2 gap-4"},H={controls:"",class:"mt-3 rounded-xl w-[640px] xl:w-[1280px]"},W=["src"],z={class:"text-center md:text-left grid grid-cols-1 place-content-start gap-6"},K={class:"space-y-2"},Q={class:"text-2xl xl:text-4xl font-bold"},X={class:"text-xl xl:text-3xl font-semibold"},Z={class:"text-xl xl:text-2xl font-light"},tt={key:1},et={class:"space-y-1 text-center"},at={class:"text-xl xl:text-xl"},st={class:"bg-white dark:bg-slate-900/95 rounded-2xl lg:flex lg:justify-between"},lt={class:"w-full"},ct={__name:"VideoView",setup(ot){const e=w([]),V=w(!1),S=[{text:"Timestamp",value:"timestamp",sortable:!0,width:120},{text:"Song",value:"name",sortable:!0,width:120},{text:"Artist",value:"artist",sortable:!0,width:120},{text:"Game",value:"game",sortable:!0,width:120},{text:"Version",value:"version",sortable:!0,width:120},{text:"Status",value:"data.status",sortable:!0,width:120}];async function $(){e.value=null;try{const a=await Y();e.value=N(JSON.parse(JSON.stringify(a)));const t=[...new Set(e.value.map(l=>l.musicid))];if(t.length>0){const l=await R("iidx",a[0].version,t,!0),o=Object.fromEntries(l.map(i=>[i.id,i]));e.value=e.value.map(i=>{var d,c;return{...i,name:((d=o[i.musicid])==null?void 0:d.name)||"Unknown Song",artist:((c=o[i.musicid])==null?void 0:c.artist)||"Unknown Artist"}})}}catch(a){console.error("Failed to fetch video data:",a)}V.value=!1}P(async()=>{await $()});function N(a){a.sort(function(t,l){return l.timestamp-t.timestamp});for(const t of a){const l=E(t.game);if(t.game=l.name,t.version=l.versions.find(o=>o.id==t.version).label??0,t.timestamp){const o=new Date(t.timestamp*1e3);t.timestamp=o.toLocaleString()}}return a}const A=a=>{var t,l;(t=a.data)!=null&&t.url&&(a=(l=a.data)==null?void 0:l.url),navigator.clipboard.writeText(a).then(()=>{alert("Copied URL to clipboard!")}).catch(()=>{alert("Failed to copy to clipboard!")})};function C(a){var t;window.open((t=a.data)==null?void 0:t.url,"_blank").focus()}return(a,t)=>(u(),D(L,null,{default:m(()=>[n(I,null,{default:m(()=>[n(O,{class:"mb-6","use-small":"","even-smaller":""}),e.value[0]?(u(),f(T,{key:0},[n(b,{icon:y(U),title:"Your Latest Upload",main:""},null,8,["icon"]),n(k,{class:"mb-6"},{default:m(()=>{var l,o,i,d,c,x,_,p,v;return[((o=(l=e.value[0])==null?void 0:l.data)==null?void 0:o.status)=="uploaded"?(u(),f("div",q,[s("video",H,[s("source",{src:(d=(i=e.value[0])==null?void 0:i.data)==null?void 0:d.url,type:"video/mp4"},null,8,W),t[1]||(t[1]=B(" Your browser does not support the video tag. "))]),s("div",z,[s("div",K,[s("div",null,[s("h1",Q,r((c=e.value[0])==null?void 0:c.name),1),s("h1",X,r((x=e.value[0])==null?void 0:x.artist),1)]),n(F,{class:"mx-1"}),s("h2",Z,r((_=e.value[0])==null?void 0:_.game)+" "+r((p=e.value[0])==null?void 0:p.version),1),s("p",null,r((v=e.value[0])==null?void 0:v.timestamp),1)]),s("div",null,[n(G,{color:"info",label:"Share",onClick:t[0]||(t[0]=it=>{var h,g;return A((g=(h=e.value[0])==null?void 0:h.data)==null?void 0:g.url)})})])])])):(u(),f("div",tt,[s("div",et,[t[2]||(t[2]=s("h1",{class:"text-2xl xl:text-4xl font-bold"}," Your video is still uploading! ",-1)),t[3]||(t[3]=s("h2",{class:"text-xl xl:text-2xl font-light"}," Please wait for the upload to complete. ",-1)),s("h2",at," Upload started at "+r(e.value[0].timestamp),1)])]))]}),_:1})],64)):M("",!0),n(b,{icon:y(j),title:"All Play Videos",main:""},null,8,["icon"]),n(k,{"has-table":""},{default:m(()=>[s("div",st,[s("div",lt,[n(J,{headers:S,items:e.value,onRowClicked:C},null,8,["items"])])])]),_:1})]),_:1})]),_:1}))}};export{ct as default};
