import{u as te,a as se,b as oe,r as h,o as ne,al as f,p as re,c as U,d as r,w as o,e as l,_ as ie,j as d,f as w,F as _,i as c,P,g as i,x as ue,O as de,am as ce,h as $,v as B,Q as A,an as me,z as pe,y as I,l as C,k as D,t as fe,ao as ve,ap as ge,aq as be,ab as ye,ar as we,as as _e,at as he,n as Pe,au as Se,a7 as xe,av as F,aw as S,ax as ke}from"./index-DpUG9nZw.js";import{_ as v}from"./FormField-CeDH4QRv.js";import{_ as x}from"./FormControl-DJSYTs7f.js";import{_ as N}from"./FormCheckRadio-ChcYDLKC.js";import{A as Ve,a as Ue}from"./admin-DW4V693b.js";const $e={class:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6"},Ce={class:"grid md:grid-cols-2 gap-x-4 mb-6"},Oe={key:0,class:"space-x-2 mt-6 mb-4"},Ae={class:"grid gap-4 md:grid-cols-2"},Ie={class:"md:flex w-full place-content-between"},De={class:"text-md md:text-lg"},Te={class:"flex align-middle mt-2 md:mt-0 max-h-12"},Ee={class:"grid grid-cols-2 sm:grid-cols-3 gap-6 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 3xl:grid-cols-5 mb-6"},Be={class:"grid grid-flow-row auto-rows-auto grid-cols-2 md:grid-cols-2 xl:grid-cols-3 2xl:grid-cols-3 3xl:grid-cols-4 4xl:grid-cols-6 gap-5 mb-5"},Fe={key:0},Je={__name:"PublicView",setup(Ne){const q=te(),M=se(),R=oe(),k=M.params.id,s=h(null),u=h(null),m=h(null),g=h(null);async function V(){try{u.value=null;var t=await Se(k);t.name||(t.name="Unclaimed Account"),u.value=t,s.value=JSON.parse(JSON.stringify(t))}catch(a){console.error("Failed to fetch user profile data:",a)}}ne(async()=>{await V(),m.value=u.value.profiles,g.value=u.value.userScoreStats});const j=f(()=>m.value?.reduce((t,a)=>t+a.data.total_plays,0)),G=f(()=>m.value?.length),J=f(()=>{const t=e=>{const n={};return e.forEach(b=>{const y=new Date(b*1e3).toISOString().split("T")[0];n[y]=(n[y]||0)+1}),n};var a=0;return m.value?.forEach(e=>{const n=e.data?.arcade_history?e.data?.arcade_history:{},b=[];Object.values(n).forEach(E=>{Object.values(E).forEach(le=>{b.push(...le)})});const y=t(b),O=Math.max(...Object.values(y));a=Math.max(a,O)}),a});function L(t){if(t){var a=[];for(const e of t){const n=xe(e.game);n&&!n.skip&&a.push(e)}return a.sort(function(e,n){return n.data.last_play_timestamp-e.data.last_play_timestamp}),a}}const T=new Date().toISOString().split("T")[0],H=f(()=>g.value?.attempts?.length||0),Q=f(()=>g.value?.records?.length||0),z=f(()=>g.value?.attempts?.filter(t=>new Date(t.timestamp*1e3).toISOString().split("T")[0]===T).length||0),K=f(()=>g.value?.records?.filter(t=>new Date(t.timestamp*1e3).toISOString().split("T")[0]===T).length||0),W=f(()=>{const t=new Date().toISOString().split("T")[0];let a=0;return m.value?.forEach(e=>{const n=e.data?.arcade_history||{};Object.values(n).forEach(b=>{Object.values(b).forEach(y=>{y.forEach(O=>{new Date(O*1e3).toISOString().split("T")[0]===t&&a++})})})}),a}),X=h([{label:"Cumulative Plays",icon:F,iconColor:"text-emerald-600",suffix:"play",number:j},{label:"Games Played",icon:S,iconColor:"text-sky-300",suffix:"game",number:G},{label:"Plays Today",icon:F,iconColor:"text-sky-300",suffix:"play",number:W},{label:"Longest Play Streak",icon:ke,iconColor:"text-red-500",suffix:"play",number:J},{label:"Total Records",icon:S,iconColor:"text-sky-300",suffix:"record",number:Q},{label:"Total Attempts",icon:S,iconColor:"text-sky-300",suffix:"attempt",number:H},{label:"Records Today",icon:S,iconColor:"text-sky-300",suffix:"record",number:K},{label:"Attempts Today",icon:S,iconColor:"text-sky-300",suffix:"attempt",number:z}]);function Y(t){t.target.value=t.target.value.replace(/\D/g,"")}async function Z(){(await Ve(k,s.value)).status!=="success"?window.alert("Failed to update user!"):V()}const p=re({newPassword:"",confirmPassword:""});async function ee(){(await Ue(k,p.newPassword,p.confirmPassword)).status=="success"?(alert("Password changed."),p.newPassword=null,p.confirmPassword=null,await V()):alert("Failed to update password. Check that both passwords match.")}const ae=t=>{const a=t.id;R.push(`/arcade/${a}`)};return(t,a)=>(r(),U(Pe,null,{default:o(()=>[l(ie,null,{default:o(()=>[u.value!==null?(r(),d(_,{key:0},[l(P,{icon:i(ue),title:`${u.value.name}'s Profile`,main:""},null,8,["icon","title"]),l(de,{class:"mb-6","override-profile":u.value,"use-small":""},null,8,["override-profile"]),i(q).userAdmin?(r(),d(_,{key:0},[l(P,{icon:i(ce),title:"User Administration",main:""},null,8,["icon"]),c("div",$e,[l($,{"is-form":"",class:"",onSubmit:B(Z,["prevent"])},{default:o(()=>[l(A,{color:"info",label:"General Information",icon:i(me),class:"mb-2"},null,8,["icon"]),c("div",Ce,[l(v,{label:"Username"},{default:o(()=>[l(x,{modelValue:s.value.name,"onUpdate:modelValue":a[0]||(a[0]=e=>s.value.name=e),"input-value":s.value.name,name:"username",required:""},null,8,["modelValue","input-value"])]),_:1}),l(v,{label:"E-mail",help:"Used for password resetting and 2FA"},{default:o(()=>[l(x,{modelValue:s.value.email,"onUpdate:modelValue":a[1]||(a[1]=e=>s.value.email=e),icon:i(pe),type:"email",name:"email",required:""},null,8,["modelValue","icon"])]),_:1}),l(v,{label:"PIN",help:"Used when logging into a game"},{default:o(()=>[l(x,{modelValue:s.value.pin,"onUpdate:modelValue":a[2]||(a[2]=e=>s.value.pin=e),icon:i(I),type:"password",name:"pin",minlength:4,maxlength:4,inputmode:"numeric",pattern:"\\d{4}",onInput:Y},null,8,["modelValue","icon"])]),_:1})]),l(v,{label:"Public Profile",help:"Show this profile publicly. If disabled, only game profiles and scores will be visible."},{default:o(()=>[l(N,{modelValue:s.value.public,"onUpdate:modelValue":a[3]||(a[3]=e=>s.value.public=e),name:"public","model-value":s.value.public,"input-value":s.value.public,type:"switch"},null,8,["modelValue","model-value","input-value"])]),_:1}),l(v,{label:"Ban Profile",help:"Ban this profile. Locks out all arcades that this user manages."},{default:o(()=>[l(N,{modelValue:s.value.banned,"onUpdate:modelValue":a[4]||(a[4]=e=>s.value.banned=e),name:"banned","model-value":s.value.banned,"input-value":s.value.banned,type:"switch"},null,8,["modelValue","model-value","input-value"])]),_:1}),JSON.stringify(u.value)!==JSON.stringify(s.value)?(r(),d("div",Oe,[l(C,{color:"success",label:"Save",type:"submit"}),l(C,{color:"warning",label:"Revert",onClick:a[5]||(a[5]=e=>V())})])):w("",!0)]),_:1}),l($,{"is-form":"",onSubmit:a[8]||(a[8]=B(e=>ee(),["prevent"]))},{footer:o(()=>[l(C,{type:"submit",color:"success",label:"Update"})]),default:o(()=>[l(A,{color:"info",label:"Change Password",class:"mb-2"}),l(v,{label:"New Password"},{default:o(()=>[l(x,{modelValue:p.newPassword,"onUpdate:modelValue":a[6]||(a[6]=e=>p.newPassword=e),icon:i(I),name:"newPassword",type:"password",required:""},null,8,["modelValue","icon"])]),_:1}),l(v,{label:"Confirm Password"},{default:o(()=>[l(x,{modelValue:p.confirmPassword,"onUpdate:modelValue":a[7]||(a[7]=e=>p.confirmPassword=e),icon:i(I),name:"confirmPassword",type:"password",required:""},null,8,["modelValue","icon"])]),_:1})]),_:1}),u.value?.arcades?.length?(r(),U($,{key:0,class:"mb-6"},{default:o(()=>[l(A,{color:"info",label:"Arcades",class:"mb-2"}),c("div",Ae,[(r(!0),d(_,null,D(u.value.arcades,e=>(r(),d("div",{key:e.id,class:"bg-slate-800 p-4 rounded-xl"},[c("div",Ie,[c("div",null,[c("h1",De,fe(e.name),1)]),c("div",Te,[l(C,{label:"Open Arcade",color:"info",onClick:n=>ae(e)},null,8,["onClick"])])])]))),128))])]),_:1})):w("",!0)])],64)):w("",!0),l(P,{icon:i(ve),title:"Quick Stats",main:""},null,8,["icon"]),c("div",Ee,[(r(!0),d(_,null,D(X.value,e=>(r(),d(_,{key:e.label},[e.number?(r(),U(ge,{key:0,icon:e.icon,number:e.number,label:e.label,suffix:`${e.suffix}${e.number==1?"":"s"}`,"icon-color":e.iconColor},null,8,["icon","number","label","suffix","icon-color"])):w("",!0)],64))),128))]),l(P,{icon:i(be),title:"Showcase",main:""},null,8,["icon"]),c("div",Be,[(r(!0),d(_,null,D(L(m.value),e=>(r(),U(ye,{key:e.game,game:e.game,value:e.data.total_plays,"user-id":i(k),"profile-name":e?.username,type:"plays"},null,8,["game","value","user-id","profile-name"]))),128))]),l(P,{icon:i(we),title:"Play Trends",main:""},null,8,["icon"]),l($,{class:"mb-6"},{default:o(()=>[m.value?(r(),d("div",Fe,[l(_e,{data:i(he)(m.value,g.value),class:"h-96"},null,8,["data"])])):w("",!0)]),_:1})],64)):w("",!0)]),_:1})]),_:1}))}};export{Je as default};
