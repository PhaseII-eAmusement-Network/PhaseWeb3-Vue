import{u as oa,a as ca,a6 as ua,r as ma,o as fa,s as _a,ak as Z,c as _,e as c,w as f,g as v,i as d,_ as pa,f as u,k as i,P as x,bP as ha,j as aa,t as p,l as h,F as g,m as ea,Q as ga,bQ as ba,am as ka,J as va,bR as xa,q as Ta}from"./index-BzYv6Vb0.js";import{_ as $a}from"./GeneralTable-Diu8r_Ya.js";import{_ as wa}from"./FormControl-Z8OoTgT_.js";import{_ as ya}from"./GameHeader-DZuryIp7.js";import{a as Sa}from"./music-DSlgoM3b.js";import"./sources-DGSaQcd-.js";const Ca={class:"grid gap-4 bg-slate-900/90 card-content"},Ia={class:"text-3xl font-bold"},Fa={class:"text-2xl"},Va={class:"text-xl font-light italic"},Ba={class:"grid grid-cols-3 sm:flex gap-2"},La={class:"grid grid-cols-2 lg:grid-cols-5 gap-4 mb-6"},Na={class:"flex place-content-between mb-2"},Pa={class:"md:w-1/3 md:text-right"},Ra={class:"bg-white dark:bg-slate-900/95 rounded-2xl lg:flex lg:justify-between"},Ea={class:"w-full"},Ma={__name:"SongView",setup(Aa){const T=oa(),$=ca();var b=T.params.game,ta=T.params.songId;const e=ua(b);var r=ma({});e||$.push({name:"ErrorPage",params:{catchAll:"404"}}),fa(async()=>{try{const s=await Sa(b,ta);r.value=s}catch(s){console.error("Failed to fetch score data:",s)}});const w=[{text:"Player",value:"username",width:120},{text:"Timestamp",value:"timestamp",width:140},{text:"Grade",value:"data.rank",width:80},{text:"Score",value:"points",width:120}];if(e.scoreHeaders)for(var sa of e.scoreHeaders)w.push(sa);const k=_a({currentChart:0}),la=Z(()=>r.value.charts?r.value.charts.filter(s=>{var l,t;return((l=s.data)==null?void 0:l.difficulty)!==0&&((t=s.data)==null?void 0:t.difficulty)!=null}).map((s,l)=>{var n;const t=`${e.chartTable[s.chart]} - ${((n=s.data)==null?void 0:n.difficulty)??"?"}`;return{id:s.chart,label:t}}):[]),ra=Z(()=>{if(!r.value.charts||r.value.charts.length===0)return[];const s=JSON.parse(JSON.stringify(r.value.charts[k.currentChart]));return da((s==null?void 0:s.records)??[])});function da(s){var n,o,m,y,S,C,I,F,V,B,L,N,P,R,E,A,D,G,O,J,j,H,M,Q,U,q,X,z,K,W,Y;var l=[];for(var t of s){const a={...t};if(a.timestamp){const na=new Date(a.timestamp*1e3);a.timestamp=na.toLocaleString()}a.points!=null&&(a.points=a.points.toString().replace(new RegExp("\\B(?<!\\.\\d*)(?=(\\d{3})+(?!\\d))","g"),",")),((o=(n=a.data)==null?void 0:n.stats)==null?void 0:o.score)!=null&&(a.exscore=a.points.toString(),a.points=(y=(m=a.data)==null?void 0:m.stats)==null?void 0:y.score.toString().replace(new RegExp("\\B(?<!\\.\\d*)(?=(\\d{3})+(?!\\d))","g"),",")),((S=a.song)==null?void 0:S.chart)!=null&&e.chartTable&&(a.song.chart=e.chartTable[(C=a.song)==null?void 0:C.chart]),((I=a.data)==null?void 0:I.halo)!=null&&e.haloTable&&(a.data.halo=e.haloTable[(F=a.data)==null?void 0:F.halo]),((V=a.data)==null?void 0:V.medal)!=null&&e.medalTable&&(a.data.medal=e.medalTable[(B=a.data)==null?void 0:B.medal]),((L=a.data)==null?void 0:L.clear_status)!=null&&e.medalTable&&(a.data.medal=e.medalTable[(N=a.data)==null?void 0:N.clear_status]),((P=a.data)==null?void 0:P.rank)!=null&&e.rankTable&&(a.data.rank=e.rankTable[(R=a.data)==null?void 0:R.rank]),((E=a.data)==null?void 0:E.result_rank)!=null&&e.rankTable&&(a.data.rank=e.rankTable[(A=a.data)==null?void 0:A.result_rank]),((D=a.data)==null?void 0:D.grade)!=null&&e.rankTable&&(a.data.rank=e.rankTable[(G=a.data)==null?void 0:G.grade]),((O=a.data)==null?void 0:O.skill_perc)>0?a.data.skill_perc=`${((J=a.data)==null?void 0:J.skill_perc)/100}%`:a.data.skill_perc="0%",(j=a.data)!=null&&j.skill_points&&(a.data.skill_points=((H=a.data)==null?void 0:H.skill_points)/10),((M=a.data)==null?void 0:M.perc)>0?a.data.perc=`${((Q=a.data)==null?void 0:Q.perc)/100}%`:a.data.perc="0%",(U=a.data)!=null&&U.new_skill&&(a.data.new_skill=((q=a.data)==null?void 0:q.new_skill)/10),(X=a.data)!=null&&X.music_rate&&(a.data.music_rate=((z=a.data)==null?void 0:z.music_rate)/10),(K=a.data)!=null&&K.excellent?a.medal="EX FC":(W=a.data)!=null&&W.fullcombo?a.medal="FC":(Y=a.data)!=null&&Y.clear?a.medal="CLEARED":a.medal="FAILED",l.push(a)}return l}const ia=s=>{const l=s.userId;$.push(`/games/${b}/profiles/${l}`)};return(s,l)=>(c(),_(Ta,null,{default:f(()=>[d(r)?(c(),_(pa,{key:0},{default:f(()=>[u(ya,{game:d(e)},null,8,["game"]),u(x,{icon:d(ha),title:"Song Overview",main:""},null,8,["icon"]),u(aa,{class:"mb-6","has-table":""},{default:f(()=>[i("div",Ca,[i("div",null,[i("h1",Ia,p(d(r).name),1),i("h2",Fa,p(d(r).artist),1),i("h2",Va,p(d(r).genre),1)]),i("div",Ba,[(c(!0),h(g,null,ea(d(r).charts,t=>{var n,o;return c(),h(g,{key:t.db_id},[((n=t.data)==null?void 0:n.difficulty)!=0?(c(),_(ga,{key:0,color:"info",label:`${d(e).chartTable[t.chart]} - ${(o=t.data)==null?void 0:o.difficulty}`},null,8,["label"])):v("",!0)],64)}),128))])])]),_:1}),u(x,{icon:d(ba),title:"Top Records",main:""},null,8,["icon"]),i("div",La,[(c(!0),h(g,null,ea(d(r).charts,t=>{var n;return c(),h(g,{key:t.db_id},[((n=t.data)==null?void 0:n.difficulty)!=0?(c(),_(ka,{key:0,label:`${d(e).chartTable[t.chart]}`,"small-content":""},{default:f(()=>{var o,m;return[va(p(t.records[0]?`${(o=t.records[0])==null?void 0:o.username} - ${(m=t.records[0].points)==null?void 0:m.toLocaleString()}`:"Unclaimed"),1)]}),_:2},1032,["label"])):v("",!0)],64)}),128))]),i("div",Na,[u(x,{icon:d(xa),title:"All Scores",main:""},null,8,["icon"]),i("div",Pa,[l[1]||(l[1]=i("h2",{class:"text-md sm:text-lg md:text-xl font-bold p-2"}," Select Chart ",-1)),u(wa,{modelValue:k.currentChart,"onUpdate:modelValue":l[0]||(l[0]=t=>k.currentChart=t),options:la.value},null,8,["modelValue","options"])])]),u(aa,{"has-table":""},{default:f(()=>[i("div",Ra,[i("div",Ea,[u($a,{headers:w,items:ra.value,onRowClicked:ia},null,8,["items"])])])]),_:1})]),_:1})):v("",!0)]),_:1}))}};export{Ma as default};
