import{a as L,b as N,a7 as E,r as P,o as R,p as A,al as T,c as u,d as n,w as c,f as g,g as r,_ as D,e as o,i as d,P as b,bW as G,h as $,t as m,j as f,F as _,k as w,Q as O,bX as j,ap as H,I as J,bY as M,n as U}from"./index-CnOij2ox.js";import{_ as X}from"./GeneralTable-By614xsU.js";import{_ as Q}from"./FormControl-uZTX6QPL.js";import{_ as W}from"./GameHeader-CBuPJHyD.js";import{a as Y}from"./music-BP9s9wCC.js";import"./sources-CICTvAn6.js";const q={class:"grid gap-4 bg-slate-900/90 card-content"},z={class:"text-3xl font-bold"},K={class:"text-2xl"},Z={class:"text-xl font-light italic"},aa={class:"grid grid-cols-3 sm:flex gap-2"},ea={class:"grid grid-cols-2 lg:grid-cols-5 gap-4 mb-6"},ta={class:"flex place-content-between mb-2"},sa={class:"md:w-1/3 md:text-right"},la={class:"bg-white dark:bg-slate-900/95 rounded-2xl lg:flex lg:justify-between"},ra={class:"w-full"},fa={__name:"SongView",setup(da){const k=L(),v=N();var p=k.params.game,y=k.params.songId;const e=E(p);var l=P({});e||v.push({name:"ErrorPage",params:{catchAll:"404"}}),R(async()=>{try{const t=await Y(p,y);l.value=t}catch(t){console.error("Failed to fetch score data:",t)}});const x=[{text:"Player",value:"username",width:120},{text:"Timestamp",value:"timestamp",width:140},{text:"Grade",value:"data.rank",width:80},{text:"Score",value:"points",width:120}];if(e.scoreHeaders)for(var S of e.scoreHeaders)x.push(S);const h=A({currentChart:0}),C=T(()=>l.value.charts?l.value.charts.filter(t=>t.data?.difficulty!==0&&t.data?.difficulty!=null).map((t,i)=>{const s=`${e.chartTable[t.chart]} - ${t.data?.difficulty??"?"}`;return{id:t.chart,label:s}}):[]),I=T(()=>{if(!l.value.charts||l.value.charts.length===0)return[];const t=JSON.parse(JSON.stringify(l.value.charts[h.currentChart]));return F(t?.records??[])});function F(t){var i=[];for(var s of t){const a={...s};if(a.timestamp){const B=new Date(a.timestamp*1e3);a.timestamp=B.toLocaleString()}a.points!=null&&(a.points=a.points.toString().replace(new RegExp("\\B(?<!\\.\\d*)(?=(\\d{3})+(?!\\d))","g"),",")),a.data?.stats?.score!=null&&(a.exscore=a.points.toString(),a.points=a.data?.stats?.score.toString().replace(new RegExp("\\B(?<!\\.\\d*)(?=(\\d{3})+(?!\\d))","g"),",")),a.song?.chart!=null&&e.chartTable&&(a.song.chart=e.chartTable[a.song?.chart]),a.data?.halo!=null&&e.haloTable&&(a.data.halo=e.haloTable[a.data?.halo]),a.data?.medal!=null&&e.medalTable&&(a.data.medal=e.medalTable[a.data?.medal]),a.data?.clear_status!=null&&e.medalTable&&(a.data.medal=e.medalTable[a.data?.clear_status]),a.data?.rank!=null&&e.rankTable&&(a.data.rank=e.rankTable[a.data?.rank]),a.data?.result_rank!=null&&e.rankTable&&(a.data.rank=e.rankTable[a.data?.result_rank]),a.data?.grade!=null&&e.rankTable&&(a.data.rank=e.rankTable[a.data?.grade]),a.data?.skill_perc>0?a.data.skill_perc=`${a.data?.skill_perc/100}%`:a.data.skill_perc="0%",a.data?.skill_points&&(a.data.skill_points=a.data?.skill_points/10),a.data?.perc>0?a.data.perc=`${a.data?.perc/100}%`:a.data.perc="0%",a.data?.new_skill&&(a.data.new_skill=a.data?.new_skill/10),a.data?.music_rate&&(a.data.music_rate=a.data?.music_rate/10),a.data?.excellent?a.medal="EX FC":a.data?.fullcombo?a.medal="FC":a.data?.clear?a.medal="CLEARED":a.medal="FAILED",i.push(a)}return i}const V=t=>{const i=t.userId;v.push(`/games/${p}/profiles/${i}`)};return(t,i)=>(n(),u(U,null,{default:c(()=>[r(l)?(n(),u(D,{key:0},{default:c(()=>[o(W,{game:r(e)},null,8,["game"]),o(b,{icon:r(G),title:"Song Overview",main:""},null,8,["icon"]),o($,{class:"mb-6","has-table":""},{default:c(()=>[d("div",q,[d("div",null,[d("h1",z,m(r(l).name),1),d("h2",K,m(r(l).artist),1),d("h2",Z,m(r(l).genre),1)]),d("div",aa,[(n(!0),f(_,null,w(r(l).charts,s=>(n(),f(_,{key:s.db_id},[s.data?.difficulty!=0?(n(),u(O,{key:0,color:"info",label:`${r(e).chartTable[s.chart]} - ${s.data?.difficulty}`},null,8,["label"])):g("",!0)],64))),128))])])]),_:1}),o(b,{icon:r(j),title:"Top Records",main:""},null,8,["icon"]),d("div",ea,[(n(!0),f(_,null,w(r(l).charts,s=>(n(),f(_,{key:s.db_id},[s.data?.difficulty!=0?(n(),u(H,{key:0,label:`${r(e).chartTable[s.chart]}`,"small-content":""},{default:c(()=>[J(m(s.records[0]?`${s.records[0]?.username} - ${s.records[0].points?.toLocaleString()}`:"Unclaimed"),1)]),_:2},1032,["label"])):g("",!0)],64))),128))]),d("div",ta,[o(b,{icon:r(M),title:"All Scores",main:""},null,8,["icon"]),d("div",sa,[i[1]||(i[1]=d("h2",{class:"text-md sm:text-lg md:text-xl font-bold p-2"}," Select Chart ",-1)),o(Q,{modelValue:h.currentChart,"onUpdate:modelValue":i[0]||(i[0]=s=>h.currentChart=s),options:C.value},null,8,["modelValue","options"])])]),o($,{"has-table":""},{default:c(()=>[d("div",la,[d("div",ra,[o(X,{headers:x,items:I.value,onRowClicked:V},null,8,["items"])])])]),_:1})]),_:1})):g("",!0)]),_:1}))}};export{fa as default};
