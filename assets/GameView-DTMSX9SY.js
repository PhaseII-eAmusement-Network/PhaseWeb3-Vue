import{d as o,a as r,p as c,t as k,u as Z,l as tt,m as at,r as g,z as et,P as st,aa as rt,o as it,j as E,c as S,w as b,b as d,_ as ot,e as f,g as i,B as lt,f as R,n as H,F as N,h as j,x as nt,L as q,k as ut}from"./index-DPhT8dOj.js";import{g as z,_ as dt,I as ct}from"./danClass-BdrkWprE.js";import{F as mt}from"./PhUsersThree.vue-SnvDNmNS.js";import{_ as ft}from"./GameHeader-Dxh5AvUe.js";import{_ as ht}from"./FormControl-D0oj1DyS.js";import{_ as _t}from"./ProfileCard-Z35DL9at.js";import{_ as vt}from"./GeneralTable-BZBkeQtl.js";import{a as gt,A as pt}from"./profile-8E3RiZ3E.js";import{a as yt}from"./music-CQgQ3XSA.js";import{d as xt}from"./userData-DZYdegtD.js";import"./PhGear.vue-CuA2krdU.js";import"./PhHouse.vue-DymxmeIb.js";import"./contentExport-CUpLLWZa.js";const wt={class:"flex mt-3"},Vt=["href"],A={__name:"SongCardSmall",props:{musicData:{type:Object,required:!0},gameId:{type:String,required:!0}},setup(p){return(h,L)=>(r(),o("div",wt,[c("a",{class:"bg-slate-700 p-2 rounded-xl hover:text-slate-300",href:`/games/${p.gameId}/song/${p.musicData.id}`},k(p.musicData.name)+" - "+k(p.musicData.artist),9,Vt)]))}},It={key:0,class:"w-full md:flex md:-mt-[75px] mb-4 place-content-end"},bt={class:"md:w-1/3 md:text-right"},kt={key:1,class:"w-full"},Pt={key:0,class:"grid lg:grid-cols-2 items-stretch w-full gap-6 mb-6"},$t={key:1},Dt={key:0,class:"grid gap-6"},St={key:0},At={key:0},Et={class:"text-xl font-bold"},Lt={class:"text-md font-light flex gap-2"},Gt={class:"font-normal"},Bt={class:"font-normal"},Ct={key:0,class:"flex gap-6 text-lg mt-3"},Ft={key:1,class:"flex mt-3"},Mt={class:"bg-white dark:bg-slate-900/95 rounded-2xl lg:flex lg:justify-between"},Rt={class:"w-full"},Zt={__name:"GameView",setup(p){const h=Z(),L=tt(),G=at();var n=null,l=null;const y=g(null),B=g(null),x=g([]),P=g(null),C=g([]),$=g([]),w=g(null),_=g(null),u=et({currentVersion:null});st(()=>u.currentVersion,()=>{h.continueLoad=!0,F(u.currentVersion,x.length!=0),M(),$.value=[],h.continueLoad=!1,h.isLoading=!1,h.loadingPool.length=0}),n=L.params.id,l=rt(n),l==null&&G.push({name:"ErrorPage",params:{catchAll:"404"}}),it(async()=>{h.continueLoad=!0,await M(),await F(null,x.length==0),h.continueLoad=!1,h.isLoading=!1,h.loadingPool.length=0}),l.versions||(u.currentVersion=1);async function F(e,a){try{const t=await gt(n,e,a);x.value.length===0&&!a&&(x.value=O(t.profiles)),P.value=t.hitchart,C.value=t.scheduledEvents,K(),$.value=U(t.hitchart).concat(W(t.scheduledEvents)),await Q(),P.value=Y(t.hitchart)}catch(t){console.error("Failed to fetch profile data:",t)}}async function M(){try{y.value=null;const e=await pt(n,u.currentVersion);if(!e)return;y.value=e.profile,B.value=e.versions,e&&!u.currentVersion&&(u.currentVersion=e.versions[e.versions.length-1])}catch(e){console.error("Failed to fetch user profile data:",e)}}const V=[];if(V.push({text:"Player",value:"username",sortable:!0,width:120}),l.noRivals||V.push({text:"Rival ID",value:"extid",sortable:!0,width:100}),V.push({text:"Last Play",value:"stats.last_play_timestamp",sortable:!0,width:150},{text:"Last Arcade",value:"stats.last_play_arcade",sortable:!0,width:150},{text:"Plays",value:"stats.total_plays",sortable:!0,width:50}),l.playerHeaders)for(var T of l.playerHeaders)V.push(T);function O(e){var a=[];for(var t of e)t.extid&&(t.extid=xt(t.extid)),t.stats&&(t.stats.last_play_timestamp&&(t.stats.last_play_timestamp=E(t.stats.last_play_timestamp)),t.sgrade&&(t.sgrade=z(t.sgrade).short),t.dgrade&&(t.dgrade=z(t.dgrade).short)),a.push(t);return a.sort((s,v)=>{const D=s.stats&&s.stats.total_plays||0;return(v.stats&&v.stats.total_plays||0)-D}),a}function X(e){var a=[];for(const t of l.versions)e.includes(t.id)&&a.push(t);return a}const J=e=>{const a=e.userId;G.push(`/games/${n}/profiles/${a}`)};function K(){return l.scheduledEvents?(_.value=l.scheduledEvents[u.currentVersion]??null,_.value):null}async function Q(){if($.value.length){const e=await yt(n,u.currentVersion,$.value,!0);w.value=e}}function I(e){return w.value?w.value.find(a=>a.id==e):null}function m(e){return C.value.find(t=>t.id==e)}function U(e){var a=[];for(const t in e){const s=e[t][0];a.push(s)}return a}function W(e){if(_.value==null)return[];var a=[];for(const t of _.value){const s=e.find(v=>v.id==t.id);if(s?.data?.music)if(Array.isArray(s?.data.music))for(const v of s.data.music)a.push(v);else a.push(s?.data.music);s?.data?.today&&a.push(s?.data.today),s?.data?.whim&&a.push(s?.data.whim)}return a}function Y(e){var a=[];for(const t in e){const s=e[t][0],v=e[t][1],D=I(s);a.push({songid:s,plays:v,name:D?.name,artist:D?.artist})}return a}return(e,a)=>(r(),S(ut,null,{default:b(()=>[d(ot,null,{default:b(()=>[d(ft,{game:i(l),version:u.currentVersion},{default:b(()=>[i(l).versions&&y.value?(r(),o("div",It,[c("div",bt,[a[1]||(a[1]=c("h2",{class:"text-md sm:text-lg md:text-xl font-bold p-2"}," Select Version ",-1)),d(ht,{modelValue:u.currentVersion,"onUpdate:modelValue":a[0]||(a[0]=t=>u.currentVersion=t),options:X(B.value)},null,8,["modelValue","options"])])])):f("",!0),y.value?(r(),o("div",kt,[d(_t,{game:i(n),version:u.currentVersion,profile:y.value},null,8,["game","version","profile"])])):f("",!0)]),_:1},8,["game","version"]),_.value||!i(l).noScores?(r(),o("div",Pt,[!i(l).noScores&&P.value?(r(),o("div",{key:0,class:lt({"md:col-span-2":!_.value})},[d(dt,{"hitchart-data":P.value,"game-id":i(n)},null,8,["hitchart-data","game-id"])],2)):f("",!0),_.value!=null?(r(),o("div",$t,[d(R,{icon:i(ct),color:"text-emerald-400",title:"Scheduled Events",main:""},null,8,["icon"]),d(H,null,{default:b(()=>[w.value?(r(),o("div",Dt,[(r(!0),o(N,null,j(_.value,t=>(r(),o("div",{key:t.id},[m(t.id)?(r(),o("div",St,[t.id?(r(),o("div",At,[d(nt,{color:"info",label:t.duration},null,8,["label"]),c("h1",Et,k(t.name),1),c("div",Lt,[c("h1",null,[a[2]||(a[2]=q(" Started ",-1)),c("span",Gt,k(i(E)(m(t.id)?.start_time)),1)]),a[4]||(a[4]=c("span",null,"|",-1)),c("h1",null,[a[3]||(a[3]=q(" Expires ",-1)),c("span",Bt,k(i(E)(m(t.id)?.end_time)),1)])]),Array.isArray(m(t.id)?.data?.music)&&w.value?(r(),o("div",Ct,[(r(!0),o(N,null,j(m(t.id).data.music,s=>(r(),S(A,{"game-id":i(n),"music-data":I(s)},null,8,["game-id","music-data"]))),256))])):m(t.id)?.data?.music?(r(),o("div",Ft,[d(A,{"game-id":i(n),"music-data":I(m(t.id)?.data?.music)},null,8,["game-id","music-data"])])):f("",!0),m(t.id)?.data?.today?(r(),S(A,{key:2,"game-id":i(n),"music-data":I(m(t.id)?.data?.today)},null,8,["game-id","music-data"])):f("",!0),m(t.id)?.data?.whim?(r(),S(A,{key:3,"game-id":i(n),"music-data":I(m(t.id)?.data?.whim)},null,8,["game-id","music-data"])):f("",!0)])):f("",!0)])):f("",!0)]))),128))])):f("",!0)]),_:1})])):f("",!0)])):f("",!0),d(R,{icon:i(mt),color:"text-blue-400",title:"All Players",main:""},null,8,["icon"]),d(H,{"has-table":""},{default:b(()=>[c("div",Mt,[c("div",Rt,[d(vt,{headers:V,items:x.value,onRowClicked:J},null,8,["items"])])])]),_:1})]),_:1})]),_:1}))}};export{Zt as default};
