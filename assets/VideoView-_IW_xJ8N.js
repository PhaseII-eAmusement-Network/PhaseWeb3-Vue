import{r as m,o as y,c as k,d,w as c,e as o,_ as V,j as u,f as S,O as $,F as N,P as f,g as x,ag as A,h as _,i as s,I as C,t as r,R as I,l as O,ah as P,n as D,ai as T,a7 as U}from"./index-DuDIkw19.js";import{_ as B}from"./GeneralTable-PIxTmObx.js";import{A as F}from"./music-BrL7wlqs.js";const G={key:0,class:"grid grid-cols-1 md:grid-cols-2 gap-4"},M={controls:"",class:"mt-3 rounded-xl w-[640px] xl:w-[1280px]"},j=["src"],L={class:"text-center md:text-left grid grid-cols-1 place-content-start gap-6"},R={class:"space-y-2"},Y={class:"text-2xl xl:text-4xl font-bold"},E={class:"text-xl xl:text-3xl font-semibold"},J={class:"text-xl xl:text-2xl font-light"},q={key:1},W={class:"space-y-1 text-center"},z={class:"text-xl xl:text-xl"},H={class:"bg-white dark:bg-slate-900/95 rounded-2xl lg:flex lg:justify-between"},K={class:"w-full"},et={__name:"VideoView",setup(Q){const e=m([]),p=m(!1),v=[{text:"Timestamp",value:"timestamp",sortable:!0,width:120},{text:"Song",value:"name",sortable:!0,width:120},{text:"Artist",value:"artist",sortable:!0,width:120},{text:"Game",value:"game",sortable:!0,width:120},{text:"Version",value:"version",sortable:!0,width:120},{text:"Status",value:"data.status",sortable:!0,width:120}];async function h(){e.value=null;try{const a=await T();e.value=g(JSON.parse(JSON.stringify(a)));const t=[...new Set(e.value.map(l=>l.musicid))];if(t.length>0){const l=await F("iidx",a[0].version,t,!0),i=Object.fromEntries(l.map(n=>[n.id,n]));e.value=e.value.map(n=>({...n,name:i[n.musicid]?.name||"Unknown Song",artist:i[n.musicid]?.artist||"Unknown Artist"}))}}catch(a){console.error("Failed to fetch video data:",a)}p.value=!1}y(async()=>{await h()});function g(a){a.sort(function(t,l){return l.timestamp-t.timestamp});for(const t of a){const l=U(t.game);if(t.game=l.name,t.version=l.versions.find(i=>i.id==t.version).label??0,t.timestamp){const i=new Date(t.timestamp*1e3);t.timestamp=i.toLocaleString()}}return a}const w=a=>{a.data?.url&&(a=a.data?.url),navigator.clipboard.writeText(a).then(()=>{alert("Copied URL to clipboard!")}).catch(()=>{alert("Failed to copy to clipboard!")})};function b(a){window.open(a.data?.url,"_blank").focus()}return(a,t)=>(d(),k(D,null,{default:c(()=>[o(V,null,{default:c(()=>[o($,{class:"mb-6","use-small":"","even-smaller":""}),e.value[0]?(d(),u(N,{key:0},[o(f,{icon:x(A),title:"Your Latest Upload",main:""},null,8,["icon"]),o(_,{class:"mb-6"},{default:c(()=>[e.value[0]?.data?.status=="uploaded"?(d(),u("div",G,[s("video",M,[s("source",{src:e.value[0]?.data?.url,type:"video/mp4"},null,8,j),t[1]||(t[1]=C(" Your browser does not support the video tag. ",-1))]),s("div",L,[s("div",R,[s("div",null,[s("h1",Y,r(e.value[0]?.name),1),s("h1",E,r(e.value[0]?.artist),1)]),o(I,{class:"mx-1"}),s("h2",J,r(e.value[0]?.game)+" "+r(e.value[0]?.version),1),s("p",null,r(e.value[0]?.timestamp),1)]),s("div",null,[o(O,{color:"info",label:"Share",onClick:t[0]||(t[0]=l=>w(e.value[0]?.data?.url))})])])])):(d(),u("div",q,[s("div",W,[t[2]||(t[2]=s("h1",{class:"text-2xl xl:text-4xl font-bold"}," Your video is still uploading! ",-1)),t[3]||(t[3]=s("h2",{class:"text-xl xl:text-2xl font-light"}," Please wait for the upload to complete. ",-1)),s("h2",z," Upload started at "+r(e.value[0].timestamp),1)])]))]),_:1})],64)):S("",!0),o(f,{icon:x(P),title:"All Play Videos",main:""},null,8,["icon"]),o(_,{"has-table":""},{default:c(()=>[s("div",H,[s("div",K,[o(B,{headers:v,items:e.value,onRowClicked:b},null,8,["items"])])])]),_:1})]),_:1})]),_:1}))}};export{et as default};
