import{b as W,r as c,u as X,N as Y,o as Z,c as _,e as i,w as r,f as a,_ as ee,l as g,g as y,F as w,k as o,i as d,P as $,aP as ae,j as A,y as C,Q as S,ax as R,n as m,D as L,ay as le,az as ne,R as te,m as F,aQ as se,t as oe,aR as ie,aA as re,aS as de,am as ue,q as ce}from"./index-DdOAy-ci.js";import{_ as me}from"./ArcadeCard-d76LysLh.js";import{_ as k}from"./FormField-2BkvaPEM.js";import{_ as D}from"./FormCheckRadio-B6ePYgKw.js";import{_ as O}from"./FormControl-DpgwkAiB.js";import{s as P,g as J}from"./values-CmNcmtTU.js";import{A as fe,a as pe,b as ve}from"./arcade-B3EIFpkV.js";import{i as be,l as _e,c as ge,m as ye,n as he}from"./admin-C7ngnmxT.js";const Ae={class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},ke={class:"mb-4 flex gap-2 items-stretch"},we={key:0,class:"space-x-2 mt-6"},Se={class:"mb-4"},Ve={class:"mb-4"},Ne={class:"grid gap-4"},xe={class:"flex justify-between items-center"},$e={class:"m-[-5px] md:flex items-center gap-2"},Ce={class:"w-8 md:w-12"},Oe={class:"text-lg lg:text-xl font-bold"},Pe={class:"grid grid-cols-1 w-full gap-2 md:gap-6 md:flex md:place-content-stretch"},Ue={key:0,class:"space-x-2 mt-6"},Ie={class:"grid grid-cols-1 gap-6 sm:grid-cols-2 md:grid-cols-3 mb-6"},qe={__name:"ArcadeView",setup(Me){const V=W(),v=c(null),N=c(null),u=c(null),U=c(!0),x=c(null),s=c(null),h=c(null),I=c(null),j=X(),b=parseInt(j.params.id);var M=[{id:"paseli_enabled",name:"PASELI Services",help:"Enable PASELI for this arcade.",type:"Boolean"},{id:"paseli_infinite",name:"Infinite PASELI",help:"Enable infinite PASELI for this arcade.",type:"Boolean"},{id:"maint",name:"Maintenance Mode",help:"Place this arcade under maintenance.",type:"Boolean"},{id:"hide_network",name:"Incognito Mode",help:"Hide the network and all ranking data.",type:"Boolean"}];async function f(){try{u.value={},v.value={},N.value={};const n=await fe(b);u.value=n,s.value=JSON.parse(JSON.stringify(n));for(const e of M){const t=J(u.value.data,e.id);P(v.value,e.id,t),P(N.value,e.id,t)}U.value=!1}catch(n){console.error("Failed to fetch arcade data:",n)}}async function B(){if(V.userAdmin)try{const n=await be(!0),e=[];for(const t of n)t.username!=null&&e.push({id:t.id,label:t.username});e.sort((t,p)=>t.label.localeCompare(p.label)),I.value=e}catch(n){console.error("Failed to fetch admin user data:",n)}}Y(()=>V.userAdmin,()=>{B()});async function q(){(await pe(b,v.value)).status!="error"&&await f()}Z(()=>{f(),B()});function z(n,e="NA_"){var t=[...n].map(p=>p.charCodeAt(0)<128?p:e).join("");return t=t.replace(/[!"#$%&'()*+,-./:;<=>?@[\\\]^_`{|}~]/g,""),t=t.replace(/\s+/g,"_"),t}async function G(){try{const n=await ve(b),e=new Blob([n],{type:"application/ovpn"}),t=document.createElement("a");t.href=URL.createObjectURL(e),t.download=`gradius-${z(u.value.name)}-phaseii-config.ovpn`,document.body.appendChild(t),t.click(),URL.revokeObjectURL(t.href),document.body.removeChild(t)}catch(n){console.log("Failed to fetch arcade data:",n)}}async function Q(){if(s.value.name){const n=await ge(s.value.name);n.unused!=null&&(x.value=n.unused)}}async function H(){(await _e(b,{name:s.value.name,description:s.value.description,beta:s.value.data.is_beta})).status!="error"&&await f()}async function K(){if(h.value==null)return;(await ye(b,h.value)).status!="error"&&(h.value=null,f())}async function T(n){if(!n)return;(await he(b,n)).status!="error"&&f()}return(n,e)=>(i(),_(ce,null,{default:r(()=>[a(ee,null,{default:r(()=>{var t,p;return[U.value?y("",!0):(i(),g(w,{key:0},[a(me,{class:"mb-6",arcade:u.value},null,8,["arcade"]),d(V).userAdmin?(i(),g(w,{key:0},[a($,{icon:d(ae),title:"Arcade Administration",main:""},null,8,["icon"]),o("div",Ae,[a(A,{"is-form":"",class:"lg:mb-6",onSubmit:C(H,["prevent"])},{default:r(()=>[a(S,{color:"info",label:"General Information",icon:d(R),class:"mb-2"},null,8,["icon"]),a(k,{label:"Arcade Name"},{default:r(()=>[a(O,{modelValue:s.value.name,"onUpdate:modelValue":e[0]||(e[0]=l=>s.value.name=l),"input-value":s.value.name,name:"arcadeName",required:""},null,8,["modelValue","input-value"])]),_:1}),o("div",ke,[a(m,{color:"info",label:"Check Name",onClick:e[1]||(e[1]=l=>Q())}),x.value==!0?(i(),_(L,{key:0,path:d(le),color:"text-green-400",size:"25"},null,8,["path"])):x.value==!1?(i(),_(L,{key:1,path:d(ne),color:"text-red-400",size:"25"},null,8,["path"])):y("",!0)]),a(k,{label:"Description"},{default:r(()=>[a(O,{modelValue:s.value.description,"onUpdate:modelValue":e[2]||(e[2]=l=>s.value.description=l),name:"description",required:""},null,8,["modelValue"])]),_:1}),a(k,{label:"Beta Enabled"},{default:r(()=>[a(D,{modelValue:s.value.data.is_beta,"onUpdate:modelValue":e[3]||(e[3]=l=>s.value.data.is_beta=l),name:"beta","model-value":s.value.data.is_beta,"input-value":s.value.data.is_beta,type:"switch"},null,8,["modelValue","model-value","input-value"])]),_:1}),JSON.stringify(u.value)!==JSON.stringify(s.value)?(i(),g("div",we,[a(m,{color:"success",label:"Save",type:"submit"}),a(m,{color:"danger",label:"Revert",onClick:e[4]||(e[4]=l=>f())})])):y("",!0)]),_:1}),a(A,{class:"mb-6"},{default:r(()=>[o("div",Se,[a(S,{color:"info",label:"Add Manager",icon:d(R),class:"mb-2"},null,8,["icon"]),o("form",{class:"h-full",onSubmit:C(K,["prevent"])},[a(k,{label:"Username"},{default:r(()=>[a(O,{modelValue:h.value,"onUpdate:modelValue":e[5]||(e[5]=l=>h.value=l),name:"username",options:I.value,required:""},null,8,["modelValue","options"])]),_:1}),a(m,{color:"success",type:"submit",label:"Add Manager"})],32)]),a(te),o("div",Ve,[a(S,{color:"warning",label:"Managers",class:"mb-4"}),o("div",Ne,[(i(!0),g(w,null,F(u.value.owners,l=>(i(),_(A,{key:l,"color-prop":"bg-slate-800 dark:bg-slate-800"},{default:r(()=>[o("div",xe,[o("div",$e,[o("div",Ce,[a(se,{username:l.username,avatar:l.avatar},null,8,["username","avatar"])]),o("h1",Oe,oe(l.username),1)]),a(m,{color:"danger",label:"Remove",onClick:E=>T(l.id)},null,8,["onClick"])])]),_:2},1024))),128))])])]),_:1})])],64)):y("",!0),a($,{icon:d(ie),title:"Arcade Management",main:""},null,8,["icon"]),a(A,{"is-form":"",class:"mb-6",onSubmit:C(q,["prevent"])},{default:r(()=>[a(S,{color:"info",label:"Settings",icon:d(re),class:"mb-2"},null,8,["icon"]),o("div",Pe,[(i(!0),g(w,null,F(d(M),l=>(i(),_(k,{key:l.id,label:l.name,help:l.help},{default:r(()=>[l.type=="Boolean"?(i(),_(D,{key:0,name:l.id,"model-value":!!(d(J)(v.value,l.id)??!1),"input-value":!0,type:"switch","onUpdate:modelValue":E=>d(P)(v.value,l.id,E??!1)},null,8,["name","model-value","onUpdate:modelValue"])):y("",!0)]),_:2},1032,["label","help"]))),128))]),JSON.stringify(v.value)!==JSON.stringify(N.value)?(i(),g("div",Ue,[a(m,{color:"success",label:"Save",type:"submit"}),a(m,{color:"danger",label:"Revert",onClick:e[6]||(e[6]=l=>f())})])):y("",!0)]),_:1}),a(A,{class:"w-full md:w-1/2 mb-6"},{default:r(()=>[e[8]||(e[8]=o("h1",{class:"text-lg md:text-xl"},"OpenVPN Configuration",-1)),e[9]||(e[9]=o("p",{class:"pb-1 dark:text-white/50"}," Use this to download your VPN config. ",-1)),a(m,{small:!1,color:"success",class:"my-2",label:"Export",onClick:e[7]||(e[7]=l=>G())})]),_:1}),a($,{icon:d(de),title:"Arcade Overview",main:""},null,8,["icon"]),o("div",Ie,[a(ue,{number:(p=(t=u.value)==null?void 0:t.machines)==null?void 0:p.length,label:"Active Machines"},null,8,["number"])])],64))]}),_:1})]),_:1}))}};export{qe as default};
