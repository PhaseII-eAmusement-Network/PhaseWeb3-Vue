import{a5 as P,r as p,o as J,g as d,c as r,e as b,w as i,f as a,_ as k,j as t,a6 as z,t as C,i as M,a7 as R,n as v,k as y,F as D,l as j,s as T,V as H,W as A,a8 as N,x as Q,H as W,Q as Y,a4 as Z,z as K,U,a9 as ee,A as ae,aa as te,ab as E,p as le,q as se}from"./index.c7a4379d.js";import{_ as O}from"./FormField.123204c5.js";import{_ as F}from"./FormControl.c18421be.js";import{_ as B}from"./FormCheckRadio.ccdc6b02.js";import{A as ne}from"./profile.0e06a01a.js";import{k as oe,l as re}from"./account.a5cf2818.js";const ie={class:"grid grid-cols-1 gap-3"},ue={class:"flex gap-4 items-center"},ce={class:"text-2xl"},de={class:"font-light text-xl"},me={class:"space-x-2 mt-6"},fe={__name:"MergeModal",props:{userId:{type:Number,default:null},game:{type:String,default:null},settings:{type:Object,default:null}},emits:["saveMerge","closeModal"],setup(w,{emit:h}){var m,_;const u=w,f=h,g=P(u.game),l=p({}),c=p((_=(m=u.settings)==null?void 0:m.scores)!=null?_:!1);J(async()=>{const x=await ne(u.game,null,u.userId);l.value=x});function n(){f("saveMerge",{game:u.game,scores:c.value})}return(x,$)=>d(g)&&l.value?(r(),b(R,{key:0,transparent:"",onOverlayClick:$[1]||($[1]=S=>f("closeModal"))},{default:i(()=>[a(k,{class:"shadow-lg max-h-modal w-11/12 md:w-3/5 lg:w-2/5 xl:w-4/12 z-50 text-white/90"},{default:i(()=>{var S,V;return[t("div",ie,[t("div",ue,[a(z,{path:d(g).icon},null,8,["path"]),t("h1",ce,C(d(g).name),1)]),t("div",null,[t("h2",de,C(l.value.name)+" - "+C((V=(S=l.value.stats)==null?void 0:S.total_plays)!=null?V:0)+" Plays ",1)]),a(O,{label:"Scores",help:"Transfer all scores from this account to yours. This will not erase your current scores."},{default:i(()=>[a(B,{modelValue:c.value,"onUpdate:modelValue":$[0]||($[0]=X=>c.value=X),name:"scores","input-value":c.value,type:"switch"},null,8,["modelValue","input-value"])]),_:1}),t("div",me,[a(M,{color:"success",label:"Save",onClick:n})])])]}),_:1})]),_:1})):v("",!0)}},ge={class:"grid grid-cols-1 gap-3"},pe={key:0,class:"flex gap-4 items-center"},ve={class:"text-2xl"},_e={class:"text-lg"},ye={class:"space-x-2 mt-6"},he={__name:"ConfirmMergeModal",props:{settings:{type:Object,default:null}},emits:["saveMerge","closeModal"],setup(w,{emit:h}){const u=h;function f(){u("saveMerge")}return(g,l)=>(r(),b(R,{transparent:"",onOverlayClick:l[0]||(l[0]=c=>u("closeModal"))},{default:i(()=>[a(k,{class:"shadow-lg max-h-modal w-11/12 md:w-3/5 lg:w-2/5 xl:w-4/12 z-50 text-white/90"},{default:i(()=>{var c;return[t("div",ge,[l[1]||(l[1]=t("h1",{class:"text-2xl font-bold"},"Merge Overview",-1)),(r(!0),y(D,null,j(Object.keys(w.settings),n=>{var m,_,x;return r(),y(D,{key:n},[n!=="card"?(r(),y("div",pe,[a(z,{path:(m=d(P)(n))==null?void 0:m.icon},null,8,["path"]),t("div",null,[t("h1",ve,C((_=d(P)(n))==null?void 0:_.name),1),t("h2",_e,C((x=w.settings[n])!=null&&x.scores?"\u2705":"\u274C")+" Transfer Scores ",1)])])):v("",!0)],64)}),128)),t("div",null,[t("span",null,C((c=w.settings)!=null&&c.card?"\u2705":"\u274C")+" Transfer Card",1)]),t("div",ye,[a(M,{color:"success",label:"Save",onClick:f})])])]}),_:1})]),_:1}))}},xe={key:1},be={class:"grid grid-cols-1 md:grid-cols-2 2xl:grid-cols-4 gap-4 mb-6"},Ce={class:"mt-4"},we={key:2},$e={class:"text-xl mb-6"},ke={class:"mt-4"},Me={key:3},Se={class:"mt-4"},De={__name:"ClaimView",setup(w){const h=p(!1),u=p(null),f=p(!1),g=p(!1),l=T({cardId:null,pin:null}),c=p({game:null,scores:!1}),n=T({card:!0}),m=p(null),_=p(0);function x(o){var e=o.target.value;e=e.replace(/[^A-Za-z0-9]/g,""),e=e.toUpperCase().replace(/(.{4})/g,"$1-").replace(/-$/,""),l.cardId=e}function $(o){o.target.value=o.target.value.replace(/\D/g,"")}async function S(){h.value=!0,u.value=await re(l.cardId,l.pin),h.value=!1}function V(o){f.value=!1,c.value.game=o,f.value=!0}function X(){g.value=!0}function L(o){var e=[];for(const s of o){const I=P(s.game);I&&!I.skip&&e.push(s)}return e.sort(function(s,I){return I.data.last_play_timestamp-s.data.last_play_timestamp}),e}function G({game:o,scores:e}){n[o]={scores:e},f.value=!1,c.value={game:null,scores:!1,data:!1}}async function q(){var e;const o=await oe(l.cardId,l.pin,n);g.value=!1,o||window.alert("Failed to merge!"),o.status==="success"?(m.value=!0,_.value=(e=o.count)!=null?e:0):m.value=!1}return(o,e)=>(r(),b(se,null,{default:i(()=>[a(le,null,{default:i(()=>[a(H,{class:"mb-6","use-small":"","even-smaller":""}),u.value?v("",!0):(r(),y(D,{key:0},[a(A,{icon:d(N),title:"Claim a Profile",main:""},null,8,["icon"]),a(k,{"is-form":"",class:"row-span-2 mb-6",onSubmit:e[2]||(e[2]=Q(s=>S(),["prevent"]))},{footer:i(()=>[a(M,{type:"submit",color:"success",label:"Start Claim"}),h.value?(r(),b(W,{key:0,path:d(Y),color:"text-yellow-500",class:"animate animate-spin"},null,8,["path"])):v("",!0)]),default:i(()=>[e[6]||(e[6]=t("h2",{class:"text-xl mb-6 lg:w-1/2"}," If you registered a card in game and need to claim it, you may do so here. Please note that the account cannot already be claimed! ",-1)),a(O,{label:"Card ID",help:"The 16 character ACCESS CODE. If your card is dated after 2016, you'll need to get the ACCESS CODE from a game."},{default:i(()=>[a(F,{modelValue:l.cardId,"onUpdate:modelValue":e[0]||(e[0]=s=>l.cardId=s),icon:d(Z),name:"cardId",type:"card",placeholder:"XXXX-XXXX-XXXX-XXXX",minlength:19,maxlength:19,required:"",onInput:x},null,8,["modelValue","icon"])]),_:1}),a(O,{label:"PIN",help:"Used when logging into a game"},{default:i(()=>[a(F,{modelValue:l.pin,"onUpdate:modelValue":e[1]||(e[1]=s=>l.pin=s),icon:d(K),type:"password",name:"pin",minlength:4,maxlength:4,inputmode:"numeric",pattern:"\\d{4}",autocomplete:"pin",onInput:$},null,8,["modelValue","icon"])]),_:1})]),_:1})],64)),u.value&&m.value==null?(r(),y("div",xe,[a(A,{icon:d(N),title:"Select Profiles to Merge",main:""},null,8,["icon"]),a(k,null,{default:i(()=>[e[7]||(e[7]=t("h2",{class:"text-xl mb-6"},[U(" Click a game to view merge options. "),t("br"),U(" Please note that this cannot be undone once complete. ")],-1)),t("div",be,[(r(!0),y(D,null,j(L(u.value.profiles),s=>(r(),b(ee,{key:s.game,game:s.game,value:s.data.total_plays,"profile-name":"",type:"plays",class:ae(n[s.game]?"border-green-800 border-[3px]":null),"disable-local-click":"",onClick:I=>V(s.game)},null,8,["game","value","class","onClick"]))),128))]),a(O,{label:"Transfer Card",help:"Moves the card to your account."},{default:i(()=>[a(B,{modelValue:n.card,"onUpdate:modelValue":e[3]||(e[3]=s=>n.card=s),"input-value":n.card,icon:d(te),type:"switch",name:"card"},null,8,["modelValue","input-value","icon"])]),_:1}),t("div",Ce,[a(M,{color:"success",label:"Start Merge",disabled:JSON.stringify(n)==JSON.stringify({}),onClick:X},null,8,["disabled"])])]),_:1})])):v("",!0),m.value==!0?(r(),y("div",we,[a(A,{icon:d(E),title:"Merge Results",main:""},null,8,["icon"]),a(k,null,{default:i(()=>[t("h2",$e," \u2705 Successfully merged "+C(_.value)+" records. Yippie! ",1),t("div",ke,[a(M,{color:"success",label:"Return to Dashboard",href:"#/"})])]),_:1})])):v("",!0),m.value==!1?(r(),y("div",Me,[a(A,{icon:d(E),title:"Merge Results",main:""},null,8,["icon"]),a(k,null,{default:i(()=>[e[8]||(e[8]=t("h2",{class:"text-xl mb-6"},"\u274C Failed to merge. Please try again.",-1)),t("div",Se,[a(M,{color:"warning",label:"Retry",onClick:X})])]),_:1})])):v("",!0),f.value?(r(),b(fe,{key:4,game:c.value.game,"user-id":u.value.userId,settings:n[c.value.game],onSaveMerge:G,onCloseModal:e[4]||(e[4]=s=>f.value=!1)},null,8,["game","user-id","settings"])):v("",!0),g.value?(r(),b(he,{key:5,game:c.value.game,settings:n,onSaveMerge:q,onCloseModal:e[5]||(e[5]=s=>g.value=!1)},null,8,["game","settings"])):v("",!0)]),_:1})]),_:1}))}};export{De as default};
