import{u as se,r as q,o as H,a as l,i as f,j as L,c,w as m,g as r,b as d,Y as G,k as i,t as _,_ as B,F as v,av as re,s as ne,N as ie,l as oe,e as n,m as ue,f as E,aE as ce,X as F,ay as de,az as me,at as _e,ab as b,z as pe,V as k,aF as be,aG as fe,aH as ye,n as ve,p as ge,q as he}from"./index.051d038d.js";import{_ as ke,g as z,a as J}from"./ProfileCard.623f8e71.js";import{_ as we}from"./FormControl.bac59ab6.js";import{a as xe}from"./profile.77bcb10d.js";import{A as Se}from"./arcade.536cdb68.js";import{g as M}from"./danClass.233b0381.js";import"./userData.bcc92478.js";const Ve={class:"flex space-x-2 mb-2"},$e={class:"flex justify-between items-center"},De={class:"grid"},Pe={class:"text-lg font-bold"},je={class:"text-md"},Ne={class:"text-lg"},Ae={class:"text-lg"},U={__name:"JubilityTable",props:{jubilityData:{type:Array,required:!0},version:{type:Number,required:!0}},setup(R){const $=R,N=se(),w=q(null),y={0:{label:"Basic",color:"info"},1:{label:"Advanced",color:"warning"},2:{label:"Extreme",color:"danger"}};return H(async()=>{try{w.value=null;const u=$.jubilityData.map(a=>a.song_id),D=await N.getMusicData("jubeat",$.version,u),s=$.jubilityData.map(a=>{const g=D.find(A=>A.id===a.song_id&&A.chart===a.chart);return{...a,...g?{songData:g}:{}}});s.sort((a,g)=>g.rate-a.rate),w.value=s}catch(u){console.error("Failed to fetch music data:",u)}}),(u,D)=>w.value?(l(!0),f(v,{key:0},L(w.value,s=>(l(),c(B,{key:s.id,"color-prop":"bg-slate-800 dark:bg-slate-800",class:"my-3 p-5","has-table":""},{default:m(()=>[r("div",Ve,[d(G,{label:y[s.chart].label,color:y[s.chart].color},null,8,["label","color"]),s.hard?(l(),c(G,{key:0,label:"Hard Mode",color:"danger"})):i("",!0)]),r("div",$e,[r("div",De,[r("h1",Pe,_(s.songData.name),1),r("h2",je,_(s.songData.artist),1)]),r("div",null,[r("h2",Ne,"Jubility: "+_(s.value/10),1),r("h2",Ae,"Rate: "+_(s.rate/10),1)])])]),_:2},1024))),128)):i("",!0)}},Ce={class:"md:flex pb-6 md:justify-between md:items-center"},Ie={key:0,class:"mt-2 md:mt-0 md:w-1/3 md:text-right"},Te=r("h2",{class:"text-md sm:text-lg md:text-xl font-bold p-2"}," Select Version ",-1),Fe=["src"],Je={class:"bg-white dark:bg-slate-900/90 rounded-2xl pt-6 p-3 card-content"},Le={class:"w-full"},Be={class:"md:w-1/3 grid grid-cols-1 md:grid-cols-2 gap-3"},Ge={class:"my-6 grid grid-cols-1 md:grid-cols-4 gap-6"},Oe={class:"my-6 grid grid-cols-2 md:grid-cols-5 xl:grid-cols-6 gap-6"},Ee={class:"my-6 grid grid-cols-1 md:grid-cols-2 gap-6"},Me={class:"my-6"},Re={class:"border-s border-neutral-300 md:flex md:justify-start md:gap-10 md:border-s-0 md:border-t md:overflow-x-auto overflow-y-visible md:whitespace-nowrap scrollbar"},ze={class:"flex-start flex items-center pt-2 md:block md:pt-4"},Ue=r("div",{class:"-ms-[6px] me-3 h-[12px] w-[12px] md:w-0.5 md:h-4 rounded-full md:rounded-none bg-gray-300 md:-mt-6 md:me-0 md:ms-0"},null,-1),qe={class:"mt-2 text-sm font-light"},He={class:"ms-4 pb-6 md:ms-0"},Xe={class:"text-lg font-semibold"},ta={__name:"PlayerView",setup(R){const $="https://cdn.phaseii.network/file/PhaseII/web-assets",N=ge(),w=he();var y=null,u=null,D=null;y=N.params.game,D=N.params.userId,u=re(y),u||w.push({name:"ErrorPage",params:{catchAll:"404"}});const s=ne({currentVersion:null});ie(()=>s.currentVersion,()=>{g()});const a=q(null);H(async()=>{g()}),u.versions||(s.currentVersion=1);async function g(){try{a.value=null;var t=await xe(y,s.currentVersion,D);t.timeline=await le(t),a.value=ae(t),t&&!s.currentVersion&&(s.currentVersion=t.versions[t.versions.length-1])}catch(e){console.error("Failed to fetch user profile data:",e)}}async function A(t){try{const e=await Se(t);return console.log(e),e}catch(e){console.error("Failed to fetch arcade data:",e)}}var X=[{label:"Register Date",type:String,span:"md:col-span-2",key:"first_play_timestamp"},{label:"Last Play",type:String,span:"md:col-span-2",key:"last_play_timestamp"},{label:"First Arcade",type:String,span:"md:col-span-2",key:"first_play_arcade"},{label:"Last Arcade",type:String,span:"md:col-span-2",key:"last_play_arcade"},{label:"Total Plays",type:Number,key:"total_plays"},{label:"EXP",type:Number,key:"exp"},{label:"SP Plays",type:Number,key:"single_plays"},{label:"DP Plays",type:Number,key:"double_plays"},{label:"SP DJPOINT",type:Number,key:"single_dj_points"},{label:"DP DJPOINT",type:Number,key:"double_dj_points"}];function Y(){return s.currentVersion?`${$}/games/${u.id}/card/${s.currentVersion}.webp`:u.cardBG}function K(){var t;return s.currentVersion&&((t=u.videoTable)==null?void 0:t.includes(s.currentVersion))?`https://web3.phaseii.network/gameassets/video/${u.id}/${s.currentVersion}.mp4`:null}function Q(){var t;return(t=u.videoTable)!=null&&t.includes(s.currentVersion)?null:`
      background-image: url('${Y()}');
      background-size: cover;
      background-repeat: no-repeat;
    `}function W(t,e){if(e){if(t.isSkill&&e.jubility)return z(e.jubility);if(t.isJubility&&e.records.skill)return J(e.records.skill)}return""}function Z(t){var e=[];for(const p of u.versions)t.includes(p.id)&&e.push(p);return e}function ee(t,e){return t.isSkill?e.stats[t.key]/100:t.isJubility?e.stats[t.key]/10:e.stats[t.key]}function ae(t){if(t.stats){if(t.stats.first_play_timestamp){const e=new Date(t.stats.first_play_timestamp*1e3);t.stats.first_play_timestamp=e.toLocaleString()}if(t.stats.last_play_timestamp){const e=new Date(t.stats.last_play_timestamp*1e3);t.stats.last_play_timestamp=e.toLocaleString()}t.dp&&t.dp.dan!==void 0&&(t.dp.dan=M(t.dp.dan).short)}return t}function te(t){var p;const e=(p=t.stats)==null?void 0:p.count;return e?[e.mfc!=null?{label:"MFCs",value:e.mfc}:0,e.pfc!=null?{label:"PFCs",value:e.pfc}:0,e.fc!=null?{label:"GFCs",value:e.fc}:0,e.gfc!=null?{label:"FCs",value:e.gfc}:0,e.life4!=null?{label:"Life-4 Clears",value:e.life4}:0]:[]}async function le(t){const e=t==null?void 0:t.stats,p=e==null?void 0:e.first_play_timestamp,x=e==null?void 0:e.last_play_timestamp,P=e==null?void 0:e.arcade_history,h=[];if(p&&h.push({timestamp:new Date(p*1e3).toLocaleString(),arcade:e==null?void 0:e.first_play_arcade,first_play:!0}),P)for(const[S,V]of Object.entries(P)){const C=await A(S);for(const[I,T]of Object.entries(V))for(const j of T){const o=new Date(j*1e3);[p,x].includes(j)||h.push({timestamp:o.toLocaleString(),arcade:C.name,machineId:I,first_play:!1})}}return x&&h.push({timestamp:new Date(x*1e3).toLocaleString(),arcade:e==null?void 0:e.last_play_arcade,first_play:!1}),h.sort((S,V)=>S.timestamp-V.timestamp)}return(t,e)=>(l(),c(ve,null,{default:m(()=>[a.value?(l(),c(oe,{key:0},{default:m(()=>{var p,x,P,h,S,V,C,I,T,j;return[r("div",Ce,[d(E,{icon:n(ue),href:`/#/games/${n(y)}`,class:"w-full md:w-auto",color:"info",label:`${n(u).shortName?n(u).shortName:n(u).name} Home`},null,8,["icon","href","label"]),n(u).versions&&a.value?(l(),f("div",Ie,[Te,d(we,{modelValue:s.currentVersion,"onUpdate:modelValue":e[0]||(e[0]=o=>s.currentVersion=o),options:Z(a.value.versions)},null,8,["modelValue","options"])])):i("",!0)]),d(F,{icon:n(ce),title:"View Profile",main:""},null,8,["icon"]),s.currentVersion&&a.value?(l(),f("div",{key:0,style:_e(Q()),class:"rounded-2xl mb-6 card-container"},[r("video",{autoplay:"",muted:"",loop:"",playsinline:"",src:K(),class:"background-video"},null,8,Fe),r("div",Je,[r("div",Le,[d(ke,{"use-small":"",game:n(y),version:s.currentVersion,profile:a.value},{default:m(()=>[r("div",Be,[d(E,{href:`/#/games/${n(y)}/scores/${a.value.userId}`,icon:n(de),class:"w-full md:w-auto",color:"info",label:"View Scores"},null,8,["href","icon"]),d(E,{href:`/#/games/${n(y)}/records/${a.value.userId}`,icon:n(me),class:"w-full md:w-auto",color:"info",label:"View Records"},null,8,["href","icon"])])]),_:1},8,["game","version","profile"])])])],4)):i("",!0),r("div",Ge,[(l(!0),f(v,null,L(n(X),o=>(l(),f(v,{key:o},[a.value.stats[o.key]?(l(),c(b,{key:0,class:pe(o.span),label:o.label,number:o.type==Number?ee(o,a.value):null,"num-color":W(o)},{default:m(()=>[k(_(o.type==String?a.value.stats[o.key]:null)+" ",1)]),_:2},1032,["class","label","number","num-color"])):i("",!0)],64))),128)),(x=(p=a.value.stats)==null?void 0:p.count)!=null&&x.records?(l(),c(b,{key:0,label:"Records",number:(h=(P=a.value.stats)==null?void 0:P.count)==null?void 0:h.records},null,8,["number"])):i("",!0),(V=(S=a.value.stats)==null?void 0:S.count)!=null&&V.attempts?(l(),c(b,{key:1,label:"Attempts",number:(I=(C=a.value.stats)==null?void 0:C.count)==null?void 0:I.attempts},null,8,["number"])):i("",!0),a.value.skill?(l(),c(b,{key:2,label:"Skill Points",number:a.value.skill/100,"num-color":n(z)(a.value.skill)},null,8,["number","num-color"])):i("",!0),a.value.profile_skill?(l(),c(b,{key:3,label:"Skill Level"},{default:m(()=>[k(_(a.value.profile_skill/100),1)]),_:1})):i("",!0),a.value.jubility?(l(),c(b,{key:4,label:"Jubility","num-color":n(J)(a.value.jubility)},{default:m(()=>[k(_(a.value.jubility/10),1)]),_:1},8,["num-color"])):i("",!0),a.value.pick_up_jubility?(l(),c(b,{key:5,label:"Pick-Up Jubility","num-color":n(J)(a.value.pick_up_jubility)},{default:m(()=>[k(_(a.value.pick_up_jubility/10),1)]),_:1},8,["num-color"])):i("",!0),a.value.common_jubility?(l(),c(b,{key:6,label:"Common Jubility","num-color":n(J)(a.value.common_jubility)},{default:m(()=>[k(_(a.value.common_jubility/10),1)]),_:1},8,["num-color"])):i("",!0),a.value.deller?(l(),c(b,{key:7,label:"Deller",number:a.value.deller},null,8,["number"])):i("",!0),a.value.sgrade?(l(),c(b,{key:8,label:"SP DAN"},{default:m(()=>[k(_(n(M)(a.value.sgrade).label),1)]),_:1})):i("",!0),a.value.dgrade?(l(),c(b,{key:9,label:"DP DAN"},{default:m(()=>[k(_(n(M)(a.value.dgrade).label),1)]),_:1})):i("",!0)]),(T=a.value.stats)!=null&&T.count?(l(),f(v,{key:1},[d(F,{icon:n(be),title:"Stats",main:""},null,8,["icon"]),r("div",Oe,[(l(!0),f(v,null,L(te(a.value),o=>(l(),f(v,{key:o},[o.value?(l(),c(b,{key:0,label:o.label,number:o.value},null,8,["label","number"])):i("",!0)],64))),128))])],64)):i("",!0),a.value.jubility?(l(),f(v,{key:2},[d(F,{icon:n(fe),title:"Jubility Breakdown",main:""},null,8,["icon"]),r("div",Ee,[a.value.pick_up_breakdown?(l(),c(B,{key:0},{default:m(()=>[d(G,{label:"Pick-Up",color:"info"}),d(U,{"jubility-data":a.value.pick_up_breakdown,",":"",version:s.currentVersion},null,8,["jubility-data","version"])]),_:1})):i("",!0),a.value.other_breakdown?(l(),c(B,{key:1},{default:m(()=>[d(G,{label:"Common",color:"info"}),d(U,{"jubility-data":a.value.other_breakdown,",":"",version:s.currentVersion},null,8,["jubility-data","version"])]),_:1})):i("",!0)])],64)):i("",!0),(j=a.value)!=null&&j.timeline?(l(),f(v,{key:3},[d(F,{icon:n(ye),title:"Timeline",main:""},null,8,["icon"]),r("div",Me,[d(B,null,{default:m(()=>{var o;return[r("ol",Re,[(l(!0),f(v,null,L(JSON.parse(JSON.stringify((o=a.value)==null?void 0:o.timeline)).reverse(),O=>(l(),f("li",{key:O.timestamp,class:"md:inline-block flex-shrink-0"},[r("div",ze,[Ue,r("p",qe,_(O.timestamp),1)]),r("div",He,[r("h4",Xe,_(O.arcade),1)])]))),128))])]}),_:1})])],64)):i("",!0)]}),_:1})):i("",!0)]),_:1}))}};export{ta as default};
