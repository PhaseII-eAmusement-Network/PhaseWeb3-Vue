import{u as G,b as M,n as P,r as S,D as _,o as h,E as B,c,d as p,w as r,e as s,_ as F,i as u,I as T,J as K,g as t,G as I,h as v,s as N,K as V,f as J,l as U,v as x,L as R,t as Y,y as k,m as j,M as z,N as H}from"./index-DrhAnfmx.js";import{I as Q}from"./PhAt.vue-CG0fuvmz.js";import{G as w}from"./PhPassword.vue-BopMKK0f.js";import{I as C}from"./PhSpinnerBall.vue-CoraMPmg.js";import{_ as m}from"./FormField-BMxZ_1j7.js";import{_ as d}from"./FormControl-H_hSOdva.js";import{_ as W}from"./FormCheckRadio-DSCRzbDp.js";const X={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},Z={class:"my-4"},ee={class:"text-xl"},ue={__name:"ProfileView",setup(se){const l=G(),O=M(),f=P({username:JSON.parse(JSON.stringify(l.userName)),email:JSON.parse(JSON.stringify(l.userEmail)),pin:null,public:l.userPublic??!1}),n=P({username:JSON.parse(JSON.stringify(l.userName)),email:JSON.parse(JSON.stringify(l.userEmail)),pin:null,public:l.userPublic??!1}),i=P({currentPassword:"",newPassword:"",confirmPassword:""}),b=S(!1),y=S(!1),g=S(null);_(()=>l.userName,a=>{n.username=JSON.parse(JSON.stringify(a)),f.username=JSON.parse(JSON.stringify(a))}),_(()=>l.userEmail,a=>{n.email=JSON.parse(JSON.stringify(a)),f.email=JSON.parse(JSON.stringify(a))}),_(()=>l.userPublic,a=>{n.public=a,f.public=a}),h(()=>{L()});async function D(){b.value=!0,(await l.putUser(n)).status=="success"&&(b.value=!1,l.userLoaded=!1,await l.loadUser(),O.go())}async function $(){y.value=!0,(await z(i.currentPassword,i.newPassword,i.confirmPassword)).status=="success"&&(alert("Password changed."),y.value=!1,await l.loadUser(),O.go())}async function L(){const a=await B();g.value=a}async function q(){if(window.confirm(`Are you really?
This will log out every session.`)){const e=await H();g.value=e,l.userLoaded=!1,l.loadUser()}}function A(a){a.target.value=a.target.value.replace(/\D/g,"")}function E(a,e){return JSON.stringify(a)!==JSON.stringify(e)}return(a,e)=>(p(),c(j,null,{default:r(()=>[s(F,null,{default:r(()=>[s(T,{class:"mb-6","use-small":"","even-smaller":""}),s(K,{icon:t(I),title:"Profile Settings",main:""},null,8,["icon"]),u("div",X,[s(v,{"is-form":"",class:"row-span-1",onSubmit:N(D,["prevent"])},{footer:r(()=>[E(f,n)?(p(),c(U,{key:0,color:"success",type:"submit",label:"Update"})):J("",!0),b.value?(p(),c(x,{key:1,icon:t(C),color:"text-yellow-500",class:"animate animate-spin"},null,8,["icon"])):J("",!0)]),default:r(()=>[s(V,{color:"info",label:"General",class:"mb-2"}),s(m,{label:"Username"},{default:r(()=>[s(d,{modelValue:n.username,"onUpdate:modelValue":e[0]||(e[0]=o=>n.username=o),icon:t(I),name:"username",required:"",autocomplete:"username"},null,8,["modelValue","icon"])]),_:1}),s(m,{label:"E-mail",help:"Used for password resetting and 2FA"},{default:r(()=>[s(d,{modelValue:n.email,"onUpdate:modelValue":e[1]||(e[1]=o=>n.email=o),icon:t(Q),type:"email",name:"email",required:"",autocomplete:"email"},null,8,["modelValue","icon"])]),_:1}),s(m,{label:"PIN",help:"Used when logging into a game"},{default:r(()=>[s(d,{modelValue:n.pin,"onUpdate:modelValue":e[2]||(e[2]=o=>n.pin=o),icon:t(w),type:"password",name:"pin",minlength:4,maxlength:4,inputmode:"numeric",pattern:"\\d{4}",autocomplete:"pin",onInput:A},null,8,["modelValue","icon"])]),_:1}),s(m,{label:"Public Profile",help:"Show my profile publicly. If disabled, only game profiles and scores will be visible."},{default:r(()=>[s(W,{modelValue:n.public,"onUpdate:modelValue":e[3]||(e[3]=o=>n.public=o),name:"public","model-value":n.public,"input-value":n.public,type:"switch"},null,8,["modelValue","model-value","input-value"])]),_:1})]),_:1}),s(v,{"is-form":"",class:"row-span-1",onSubmit:e[7]||(e[7]=N(o=>$(),["prevent"]))},{footer:r(()=>[s(U,{type:"submit",color:"success",label:"Update"}),y.value?(p(),c(x,{key:0,icon:t(C),color:"text-yellow-500",class:"animate animate-spin"},null,8,["icon"])):J("",!0)]),default:r(()=>[s(V,{color:"info",label:"Change Password",class:"mb-2"}),s(m,{label:"Current Password"},{default:r(()=>[s(d,{modelValue:i.currentPassword,"onUpdate:modelValue":e[4]||(e[4]=o=>i.currentPassword=o),icon:t(w),name:"currentPassword",type:"password",required:""},null,8,["modelValue","icon"])]),_:1}),s(R),s(m,{label:"New Password"},{default:r(()=>[s(d,{modelValue:i.newPassword,"onUpdate:modelValue":e[5]||(e[5]=o=>i.newPassword=o),icon:t(w),name:"newPassword",type:"password",required:""},null,8,["modelValue","icon"])]),_:1}),s(m,{label:"Confirm Password"},{default:r(()=>[s(d,{modelValue:i.confirmPassword,"onUpdate:modelValue":e[6]||(e[6]=o=>i.confirmPassword=o),icon:t(w),name:"confirmPassword",type:"password",required:""},null,8,["modelValue","icon"])]),_:1})]),_:1}),s(v,{"is-form":"",class:"row-span-1",onSubmit:e[9]||(e[9]=N(o=>$(),["prevent"]))},{default:r(()=>[s(V,{color:"info",label:"Sessions",class:"mb-2"}),u("div",Z,[u("h1",ee," You currently have "+Y(g.value?.length)+" saved session(s). ",1),e[10]||(e[10]=u("p",null,[k(" Most of them are likely expired."),u("br"),k(" Sadly, due to the fact that PhaseII stores no information on your Session ID for location or IP, we cannot provide select deletion. ")],-1))]),e[11]||(e[11]=u("h1",{class:"text-xl mb-2"},"Log out of all sessions",-1)),u("div",null,[s(U,{color:"danger",label:"Delete Sessions",onClick:e[8]||(e[8]=o=>q())})])]),_:1,__:[11]})])]),_:1})]),_:1}))}};export{ue as default};
