import{u as q,b as E,p as P,r as S,M as v,o as B,N as F,c as f,d as c,w as r,e as s,_ as G,i as u,O as R,P as T,g as t,x,h as _,v as N,Q as V,z,y as w,f as U,l as O,C as I,D as h,R as Q,t as Y,I as k,n as j,S as H,U as K}from"./index-BqLzkjKg.js";import{_ as d}from"./FormField-Ch4Nz22U.js";import{_ as m}from"./FormControl-Dpk-YKzT.js";import{_ as W}from"./FormCheckRadio-grVtCJ-v.js";const X={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},Z={class:"my-4"},ee={class:"text-xl"},ie={__name:"ProfileView",setup(se){const o=q(),J=E(),p=P({username:JSON.parse(JSON.stringify(o.userName)),email:JSON.parse(JSON.stringify(o.userEmail)),pin:null,public:o.userPublic??!1}),n=P({username:JSON.parse(JSON.stringify(o.userName)),email:JSON.parse(JSON.stringify(o.userEmail)),pin:null,public:o.userPublic??!1}),i=P({currentPassword:"",newPassword:"",confirmPassword:""}),b=S(!1),g=S(!1),y=S(null);v(()=>o.userName,a=>{n.username=JSON.parse(JSON.stringify(a)),p.username=JSON.parse(JSON.stringify(a))}),v(()=>o.userEmail,a=>{n.email=JSON.parse(JSON.stringify(a)),p.email=JSON.parse(JSON.stringify(a))}),v(()=>o.userPublic,a=>{n.public=a,p.public=a}),B(()=>{A()});async function C(){b.value=!0,(await o.putUser(n)).status=="success"&&(b.value=!1,o.userLoaded=!1,await o.loadUser(),J.go())}async function $(){g.value=!0,(await H(i.currentPassword,i.newPassword,i.confirmPassword)).status=="success"&&(alert("Password changed."),g.value=!1,await o.loadUser(),J.go())}async function A(){const a=await F();y.value=a}async function D(){if(window.confirm(`Are you really?
This will log out every session.`)){const e=await K();y.value=e,o.userLoaded=!1,o.loadUser()}}function L(a){a.target.value=a.target.value.replace(/\D/g,"")}function M(a,e){return JSON.stringify(a)!==JSON.stringify(e)}return(a,e)=>(c(),f(j,null,{default:r(()=>[s(G,null,{default:r(()=>[s(R,{class:"mb-6","use-small":"","even-smaller":""}),s(T,{icon:t(x),title:"Profile Settings",main:""},null,8,["icon"]),u("div",X,[s(_,{"is-form":"",class:"row-span-1",onSubmit:N(C,["prevent"])},{footer:r(()=>[M(p,n)?(c(),f(O,{key:0,color:"success",type:"submit",label:"Update"})):U("",!0),b.value?(c(),f(I,{key:1,path:t(h),color:"text-yellow-500",class:"animate animate-spin"},null,8,["path"])):U("",!0)]),default:r(()=>[s(V,{color:"info",label:"General",class:"mb-2"}),s(d,{label:"Username"},{default:r(()=>[s(m,{modelValue:n.username,"onUpdate:modelValue":e[0]||(e[0]=l=>n.username=l),icon:t(x),name:"username",required:"",autocomplete:"username"},null,8,["modelValue","icon"])]),_:1}),s(d,{label:"E-mail",help:"Used for password resetting and 2FA"},{default:r(()=>[s(m,{modelValue:n.email,"onUpdate:modelValue":e[1]||(e[1]=l=>n.email=l),icon:t(z),type:"email",name:"email",required:"",autocomplete:"email"},null,8,["modelValue","icon"])]),_:1}),s(d,{label:"PIN",help:"Used when logging into a game"},{default:r(()=>[s(m,{modelValue:n.pin,"onUpdate:modelValue":e[2]||(e[2]=l=>n.pin=l),icon:t(w),type:"password",name:"pin",minlength:4,maxlength:4,inputmode:"numeric",pattern:"\\d{4}",autocomplete:"pin",onInput:L},null,8,["modelValue","icon"])]),_:1}),s(d,{label:"Public Profile",help:"Show my profile publicly. If disabled, only game profiles and scores will be visible."},{default:r(()=>[s(W,{modelValue:n.public,"onUpdate:modelValue":e[3]||(e[3]=l=>n.public=l),name:"public","model-value":n.public,"input-value":n.public,type:"switch"},null,8,["modelValue","model-value","input-value"])]),_:1})]),_:1}),s(_,{"is-form":"",class:"row-span-1",onSubmit:e[7]||(e[7]=N(l=>$(),["prevent"]))},{footer:r(()=>[s(O,{type:"submit",color:"success",label:"Update"}),g.value?(c(),f(I,{key:0,path:t(h),color:"text-yellow-500",class:"animate animate-spin"},null,8,["path"])):U("",!0)]),default:r(()=>[s(V,{color:"info",label:"Change Password",class:"mb-2"}),s(d,{label:"Current Password"},{default:r(()=>[s(m,{modelValue:i.currentPassword,"onUpdate:modelValue":e[4]||(e[4]=l=>i.currentPassword=l),icon:t(w),name:"currentPassword",type:"password",required:""},null,8,["modelValue","icon"])]),_:1}),s(Q),s(d,{label:"New Password"},{default:r(()=>[s(m,{modelValue:i.newPassword,"onUpdate:modelValue":e[5]||(e[5]=l=>i.newPassword=l),icon:t(w),name:"newPassword",type:"password",required:""},null,8,["modelValue","icon"])]),_:1}),s(d,{label:"Confirm Password"},{default:r(()=>[s(m,{modelValue:i.confirmPassword,"onUpdate:modelValue":e[6]||(e[6]=l=>i.confirmPassword=l),icon:t(w),name:"confirmPassword",type:"password",required:""},null,8,["modelValue","icon"])]),_:1})]),_:1}),s(_,{"is-form":"",class:"row-span-1",onSubmit:e[9]||(e[9]=N(l=>$(),["prevent"]))},{default:r(()=>{var l;return[s(V,{color:"info",label:"Sessions",class:"mb-2"}),u("div",Z,[u("h1",ee," You currently have "+Y((l=y.value)==null?void 0:l.length)+" saved session(s). ",1),e[10]||(e[10]=u("p",null,[k(" Most of them are likely expired."),u("br"),k(" Sadly, due to the fact that PhaseII stores no information on your Session ID for location or IP, we cannot provide select deletion. ")],-1))]),e[11]||(e[11]=u("h1",{class:"text-xl mb-2"},"Log out of all sessions",-1)),u("div",null,[s(O,{color:"danger",label:"Delete Sessions",onClick:e[8]||(e[8]=ae=>D())})])]}),_:1})])]),_:1})]),_:1}))}};export{ie as default};
