import{b as ge,r as N,o as ee,c as r,k as x,l as Z,e as y,w as v,j as u,f as m,X as U,n as c,t as w,_ as I,F as V,d as pe,aQ as fe,aR as he,M as oe,aS as re,aT as ke,h as ne,aU as be,aV as ie,aW as we,aX as xe,aY as Se,aZ as De,a_ as Pe,a$ as Ce,b0 as $e,b1 as Ve,B as ue,g as i,u as Te,a as je,a5 as Ae,s as Ne,p as Ie,m as Le,i as le,b2 as Oe,W as G,aJ as Be,aK as Re,aF as Fe,am as C,A as Je,U as R,b3 as Ee,b4 as Ge,b5 as Me,ak as Ue,b6 as He,b7 as ze,q as qe}from"./index.c7a4379d.js";import{_ as Xe,g as ce,a as Y}from"./ProfileCard.92347781.js";import{_ as Ke}from"./FormControl.c18421be.js";import{_ as We}from"./UserSticker.7bc9287b.js";import{b as Qe,A as Ye}from"./profile.0e06a01a.js";import{A as Ze}from"./arcade.bbb632fa.js";import{g as se}from"./danClass.233b0381.js";import"./userData.bcc92478.js";const ea={class:"flex space-x-2 mb-2"},aa={class:"flex justify-between items-center"},ta={class:"grid"},la={class:"text-lg font-bold"},sa={class:"text-md"},ra={class:"text-lg"},na={class:"text-lg"},de={__name:"JubilityTable",props:{jubilityData:{type:Array,required:!0},version:{type:Number,required:!0}},setup(s){const o=ge(),d=N(null),h=s,p={0:{label:"Basic",color:"info"},1:{label:"Advanced",color:"warning"},2:{label:"Extreme",color:"danger"}};return ee(async()=>{try{d.value=null;const l=h.jubilityData.map(n=>n.song_id),b=await o.getMusicData("jubeat",h.version,l),f=h.jubilityData.map(n=>{const e=b.find(S=>S.id===n.song_id&&S.chart===n.chart);return{...n,...e?{songData:e}:{}}});f.sort((n,e)=>e.rate-n.rate),d.value=f}catch(l){console.error("Failed to fetch music data:",l)}}),(l,b)=>d.value?(r(!0),x(V,{key:0},Z(d.value,f=>(r(),y(I,{key:f.id,"color-prop":"bg-slate-800 dark:bg-slate-800",class:"my-3 p-5","has-table":""},{default:v(()=>[u("div",ea,[m(U,{label:p[f.chart].label,color:p[f.chart].color},null,8,["label","color"]),f.hard?(r(),y(U,{key:0,label:"Hard Mode",color:"danger"})):c("",!0)]),u("div",aa,[u("div",ta,[u("h1",la,w(f.songData.name),1),u("h2",sa,w(f.songData.artist),1)]),u("div",null,[u("h2",ra,"Jubility: "+w(f.value/10),1),u("h2",na,"Rate: "+w(f.rate/10),1)])])]),_:2},1024))),128)):c("",!0)}},ye={data:{type:Object,required:!0},options:{type:Object,default:()=>({})},plugins:{type:Array,default:()=>[]},datasetIdKey:{type:String,default:"label"},updateMode:{type:String,default:void 0}},oa={ariaLabel:{type:String},ariaDescribedby:{type:String}},ia={type:{type:String,required:!0},destroyDelay:{type:Number,default:0},...ye,...oa},ua=xe[0]==="2"?(s,o)=>Object.assign(s,{attrs:o}):(s,o)=>Object.assign(s,o);function M(s){return be(s)?re(s):s}function ca(s){let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:s;return be(o)?new Proxy(s,{}):s}function da(s,o){const d=s.options;d&&o&&Object.assign(d,o)}function _e(s,o){s.labels=o}function ve(s,o,d){const h=[];s.datasets=o.map(p=>{const l=s.datasets.find(b=>b[d]===p[d]);return!l||!p.data||h.includes(l)?{...p}:(h.push(l),Object.assign(l,p),l)})}function ma(s,o){const d={labels:[],datasets:[]};return _e(d,s.labels),ve(d,s.datasets,o),d}const pa=pe({props:ia,setup(s,o){let{expose:d,slots:h}=o;const p=N(null),l=fe(null);d({chart:l});const b=()=>{if(!p.value)return;const{type:e,data:S,options:g,plugins:k,datasetIdKey:D}=s,j=ma(S,D),$=ca(j,S);l.value=new ie(p.value,{type:e,data:$,options:{...g},plugins:k})},f=()=>{const e=re(l.value);e&&(s.destroyDelay>0?setTimeout(()=>{e.destroy(),l.value=null},s.destroyDelay):(e.destroy(),l.value=null))},n=e=>{e.update(s.updateMode)};return ee(b),he(f),oe([()=>s.options,()=>s.data],(e,S)=>{let[g,k]=e,[D,j]=S;const $=re(l.value);if(!$)return;let A=!1;if(g){const T=M(g),L=M(D);T&&T!==L&&(da($,T),A=!0)}if(k){const T=M(k.labels),L=M(j.labels),O=M(k.datasets),H=M(j.datasets);T!==L&&(_e($.config.data,T),A=!0),O&&O!==H&&(ve($.config.data,O,s.datasetIdKey),A=!0)}A&&ke(()=>{n($)})},{deep:!0}),()=>ne("canvas",{role:"img",ariaLabel:s.ariaLabel,ariaDescribedby:s.ariaDescribedby,ref:p},[ne("p",{},[h.default?h.default():""])])}});function fa(s,o){return ie.register(o),pe({props:ye,setup(d,h){let{expose:p}=h;const l=fe(null),b=f=>{l.value=f==null?void 0:f.chart};return p({chart:l}),()=>ne(pa,ua({ref:b},{type:s,...d}))}})}const me=fa("radar",we),ba={class:"grid lg:grid-cols-2 gap-4"},ya={class:"w-full grid place-content-center text-center"},_a={class:"text-lg"},va={class:"w-full grid place-content-center text-center"},ga={class:"text-lg"},ha={__name:"UserNotesRadar",props:{profile:{type:Number,default:null},game:{type:String,default:null},version:{type:Number,default:9}},setup(s){ie.register(Se,De,Pe,Ce,$e,Ve);const o=s,d=N(o.profile),h=N(o.version),p=N(!0),l=N(0),b=N({labels:["Notes","Peak","Scratch","Sof-Lan","Charge","Chord"],datasets:[{label:"SP",backgroundColor:"rgba(22, 95, 250, 0.2)",borderColor:"rgba(22, 95, 250, 1)",pointBackgroundColor:"rgba(22, 95, 250, 1)",pointBorderColor:"#fff",pointHoverBackgroundColor:"#fff",pointHoverBorderColor:"rgba(22, 95, 250, 1)",data:[]},{label:"DP",backgroundColor:"rgba(250, 170, 22, 0.2)",borderColor:"rgba(250, 170, 22, 1)",pointBackgroundColor:"rgba(250, 170, 22, 1)",pointBorderColor:"#fff",pointHoverBackgroundColor:"#fff",pointHoverBorderColor:"rgba(250, 170, 22, 1)",data:[]}]});oe(()=>o.version,()=>{d.value=o.profile,h.value=o.version,f()});async function f(){var g,k;try{const D=await Qe(o.game,o.version,d.value,[["notes_radar",0],["notes_radar",1]]),j=$=>{const[A,T,L,O,H,ae]=$;return[A/100,T/100,L/100,O/100,H/100,ae/100]};((g=D[0])==null?void 0:g.achievementId)===0&&(b.value.datasets[0].data=j(D[0].data.radar_score)),((k=D[1])==null?void 0:k.achievementId)===1&&(b.value.datasets[1].data=j(D[1].data.radar_score)),p.value=!1,l.value+=1}catch(D){console.error("Failed to fetch arcade data:",D)}}ee(async()=>{f()});const n={responsive:!1,maintainAspectRatio:!0,scales:{r:{ticks:{stepSize:30,callback:function(g){return g}},pointLabels:{font:{size:15}}}}},e=ue(()=>b.value.datasets[0].data.reduce((g,k)=>g+k,0).toFixed(2)),S=ue(()=>b.value.datasets[1].data.reduce((g,k)=>g+k,0).toFixed(2));return(g,k)=>b.value.datasets[0]?(r(),y(I,{key:0,class:"my-6"},{default:v(()=>[u("div",ba,[m(I,{"color-prop":"bg-slate-800 dark:bg-slate-800"},{default:v(()=>[m(U,{color:"info",label:"SP Radar",class:"mb-2"}),u("div",ya,[(r(),y(i(me),{key:l.value,class:"bg-slate-100 p-2 rounded-lg",data:{labels:b.value.labels,datasets:[b.value.datasets[0]]},options:n},null,8,["data"])),u("span",_a,"Total score: "+w(e.value),1)])]),_:1}),m(I,{"color-prop":"bg-slate-800 dark:bg-slate-800"},{default:v(()=>[m(U,{color:"info",label:"DP Radar",class:"mb-2"}),u("div",va,[(r(),y(i(me),{key:l.value,class:"bg-slate-100 p-2 rounded-lg",data:{labels:b.value.labels,datasets:[b.value.datasets[1]]},options:n},null,8,["data"])),u("span",ga,"Total score: "+w(S.value),1)])]),_:1})])]),_:1})):c("",!0)}},ka={class:"md:flex pb-6 md:justify-between md:items-center"},wa={key:0,class:"mt-2 md:mt-0 md:w-1/3 md:text-right"},xa=["src"],Sa={class:"bg-white dark:bg-slate-900/90 rounded-2xl pt-6 p-3 card-content"},Da={class:"w-full"},Pa={class:"md:w-1/3 grid grid-cols-1 md:grid-cols-2 gap-3"},Ca={class:"my-6 grid grid-cols-1 md:grid-cols-4 gap-6"},$a={class:"my-6 grid grid-cols-2 md:grid-cols-5 xl:grid-cols-6 gap-6"},Va={class:"my-6 grid grid-cols-1 md:grid-cols-2 gap-6"},Ta={class:"my-6"},ja={class:"my-6"},Aa={class:"border-s border-neutral-300 md:flex md:justify-start md:gap-10 md:border-s-0 md:border-t md:overflow-x-auto overflow-y-visible md:whitespace-nowrap scrollbar"},Na={class:"flex-start flex items-center pt-2 md:block md:pt-4"},Ia={class:"mt-2 text-sm font-light"},La={class:"ms-4 pb-6 md:ms-0"},Oa={class:"text-lg font-semibold"},Ha={__name:"PlayerView",setup(s){const o="https://cdn.phaseii.network/file/PhaseII/web-assets",d=Te(),h=je();var p=null,l=null,b=null,f=!0;p=d.params.game,b=d.params.userId,l=Ae(p),l||h.push({name:"ErrorPage",params:{catchAll:"404"}});const n=Ne({currentVersion:null});oe(()=>n.currentVersion,()=>{f?f=!1:S()});const e=N(null);ee(async()=>{S()}),l.versions||(n.currentVersion=1);async function S(){try{e.value=null;var t=await Ye(p,n.currentVersion,b);t.timeline=await ae(t),e.value=O(t),t&&!n.currentVersion&&(n.currentVersion=t.versions[t.versions.length-1])}catch(a){console.error("Failed to fetch user profile data:",a)}}async function g(t){try{return await Ze(t)}catch(a){console.error("Failed to fetch arcade data:",a)}}var k=[{label:"Register Date",type:String,span:"md:col-span-2",key:"first_play_timestamp"},{label:"Last Play",type:String,span:"md:col-span-2",key:"last_play_timestamp"},{label:"First Arcade",type:String,span:"md:col-span-2",key:"first_play_arcade"},{label:"Last Arcade",type:String,span:"md:col-span-2",key:"last_play_arcade"},{label:"Total Plays",type:Number,key:"total_plays"},{label:"EXP",type:Number,key:"exp"},{label:"SP Plays",type:Number,key:"single_plays"},{label:"DP Plays",type:Number,key:"double_plays"},{label:"SP DJPOINT",type:Number,key:"single_dj_points"},{label:"DP DJPOINT",type:Number,key:"double_dj_points"}];function D(){return n.currentVersion?`${o}/games/${l.id}/card/${n.currentVersion}.webp`:l.cardBG}function j(){var t;return n.currentVersion&&((t=l.videoTable)==null?void 0:t.includes(n.currentVersion))?`https://cdn.phaseii.network/file/PhaseII/game-assets/video/${l.id}/${n.currentVersion}.mp4`:null}function $(){var t;return(t=l.videoTable)!=null&&t.includes(n.currentVersion)?null:`
      background-image: url('${D()}');
      background-size: cover;
      background-repeat: no-repeat;
    `}function A(t,a){if(a){if(t.isSkill&&a.jubility)return ce(a.jubility);if(t.isJubility&&a.records.skill)return Y(a.records.skill)}return""}function T(t){var a=[];for(const P of l.versions)t.includes(P.id)&&a.push(P);return a}function L(t,a){return t.isSkill?a.stats[t.key]/100:t.isJubility?a.stats[t.key]/10:a.stats[t.key]}function O(t){if(t.stats){if(t.stats.first_play_timestamp){const a=new Date(t.stats.first_play_timestamp*1e3);t.stats.first_play_timestamp=a.toLocaleString()}if(t.stats.last_play_timestamp){const a=new Date(t.stats.last_play_timestamp*1e3);t.stats.last_play_timestamp=a.toLocaleString()}t.dp&&t.dp.dan!==void 0&&(t.dp.dan=se(t.dp.dan).short)}return t}function H(t){var P;const a=(P=t.stats)==null?void 0:P.count;return a?[a.mfc!=null?{label:"MFCs",value:a.mfc}:0,a.pfc!=null?{label:"PFCs",value:a.pfc}:0,a.fc!=null?{label:"GFCs",value:a.fc}:0,a.gfc!=null?{label:"FCs",value:a.gfc}:0,a.life4!=null?{label:"Life-4 Clears",value:a.life4}:0]:[]}async function ae(t){const a=t==null?void 0:t.stats,P=a==null?void 0:a.first_play_timestamp,F=a==null?void 0:a.last_play_timestamp,z=a==null?void 0:a.arcade_history,B=[];if(P&&B.push({timestamp:new Date(P*1e3).toLocaleString(),arcade:a==null?void 0:a.first_play_arcade,first_play:!0}),z)for(const[J,E]of Object.entries(z)){const X=await g(J);for(const[K,W]of Object.entries(E))for(const q of W){const Q=new Date(q*1e3);[P,F].includes(q)||B.push({timestamp:Q.toLocaleString(),arcade:X.name,machineId:K,first_play:!1})}}return F&&B.push({timestamp:new Date(F*1e3).toLocaleString(),arcade:a==null?void 0:a.last_play_arcade,first_play:!1}),B.sort((J,E)=>new Date(J.timestamp).getTime()-new Date(E.timestamp).getTime())}return(t,a)=>(r(),y(qe,null,{default:v(()=>[e.value?(r(),y(Ie,{key:0},{default:v(()=>{var P,F,z,B,J,E,X,K,W,q,Q;return[u("div",ka,[m(le,{icon:i(Le),href:`/#/games/${i(p)}`,class:"w-full md:w-auto",color:"info",label:`${i(l).shortName?i(l).shortName:i(l).name} Home`},null,8,["icon","href","label"]),i(l).versions&&e.value?(r(),x("div",wa,[a[1]||(a[1]=u("h2",{class:"text-md sm:text-lg md:text-xl font-bold p-2"}," Select Version ",-1)),m(Ke,{modelValue:n.currentVersion,"onUpdate:modelValue":a[0]||(a[0]=_=>n.currentVersion=_),options:T(e.value.versions)},null,8,["modelValue","options"])])):c("",!0)]),m(G,{icon:i(Oe),title:"View Profile",main:""},null,8,["icon"]),n.currentVersion&&e.value?(r(),x("div",{key:0,style:Fe($()),class:"rounded-2xl mb-6 card-container"},[u("video",{autoplay:"",muted:"",loop:"",playsinline:"",src:j(),class:"background-video"},null,8,xa),u("div",Sa,[u("div",Da,[m(Xe,{"use-small":"",game:i(p),version:n.currentVersion,profile:e.value},{default:v(()=>[u("div",Pa,[m(le,{href:`/#/games/${i(p)}/scores/${e.value.userId}`,icon:i(Be),class:"w-full md:w-auto",color:"info",label:"View Scores"},null,8,["href","icon"]),m(le,{href:`/#/games/${i(p)}/records/${e.value.userId}`,icon:i(Re),class:"w-full md:w-auto",color:"info",label:"View Records"},null,8,["href","icon"])])]),_:1},8,["game","version","profile"])])])],4)):c("",!0),u("div",Ca,[(r(!0),x(V,null,Z(i(k),_=>(r(),x(V,{key:_},[e.value.stats[_.key]?(r(),y(C,{key:0,class:Je(_.span),label:_.label,number:_.type==Number?L(_,e.value):null,"num-color":A(_)},{default:v(()=>[R(w(_.type==String?e.value.stats[_.key]:null),1)]),_:2},1032,["class","label","number","num-color"])):c("",!0)],64))),128)),(F=(P=e.value.stats)==null?void 0:P.count)!=null&&F.records?(r(),y(C,{key:0,label:"Records",number:(B=(z=e.value.stats)==null?void 0:z.count)==null?void 0:B.records},null,8,["number"])):c("",!0),(E=(J=e.value.stats)==null?void 0:J.count)!=null&&E.attempts?(r(),y(C,{key:1,label:"Attempts",number:(K=(X=e.value.stats)==null?void 0:X.count)==null?void 0:K.attempts},null,8,["number"])):c("",!0),e.value.skill?(r(),y(C,{key:2,label:"Skill Points",number:e.value.skill/100,"num-color":i(ce)(e.value.skill)},null,8,["number","num-color"])):c("",!0),e.value.profile_skill?(r(),y(C,{key:3,label:"Skill Level"},{default:v(()=>[R(w(e.value.profile_skill/100),1)]),_:1})):c("",!0),e.value.jubility?(r(),y(C,{key:4,label:"Jubility","num-color":i(Y)(e.value.jubility)},{default:v(()=>[R(w(e.value.jubility/10),1)]),_:1},8,["num-color"])):c("",!0),e.value.pick_up_jubility?(r(),y(C,{key:5,label:"Pick-Up Jubility","num-color":i(Y)(e.value.pick_up_jubility)},{default:v(()=>[R(w(e.value.pick_up_jubility/10),1)]),_:1},8,["num-color"])):c("",!0),e.value.common_jubility?(r(),y(C,{key:6,label:"Common Jubility","num-color":i(Y)(e.value.common_jubility)},{default:v(()=>[R(w(e.value.common_jubility/10),1)]),_:1},8,["num-color"])):c("",!0),e.value.deller?(r(),y(C,{key:7,label:"Deller",number:e.value.deller},null,8,["number"])):c("",!0),e.value.sgrade?(r(),y(C,{key:8,label:"SP DAN"},{default:v(()=>[R(w(i(se)(e.value.sgrade).label),1)]),_:1})):c("",!0),e.value.dgrade?(r(),y(C,{key:9,label:"DP DAN"},{default:v(()=>[R(w(i(se)(e.value.dgrade).label),1)]),_:1})):c("",!0)]),(W=e.value.stats)!=null&&W.count?(r(),x(V,{key:1},[m(G,{icon:i(Ee),title:"Stats",main:""},null,8,["icon"]),u("div",$a,[(r(!0),x(V,null,Z(H(e.value),_=>(r(),x(V,{key:_},[_?(r(),y(C,{key:0,label:_.label,number:_},null,8,["label","number"])):c("",!0)],64))),128))])],64)):c("",!0),e.value.jubility?(r(),x(V,{key:2},[m(G,{icon:i(Ge),title:"Jubility Breakdown",main:""},null,8,["icon"]),u("div",Va,[e.value.pick_up_breakdown?(r(),y(I,{key:0},{default:v(()=>[m(U,{label:"Pick-Up",color:"info"}),m(de,{"jubility-data":e.value.pick_up_breakdown,",":"",version:n.currentVersion},null,8,["jubility-data","version"])]),_:1})):c("",!0),e.value.other_breakdown?(r(),y(I,{key:1},{default:v(()=>[m(U,{label:"Common",color:"info"}),m(de,{"jubility-data":e.value.other_breakdown,",":"",version:n.currentVersion},null,8,["jubility-data","version"])]),_:1})):c("",!0)])],64)):c("",!0),(q=e.value)!=null&&q.trbitem?(r(),x(V,{key:3},[m(G,{icon:i(Me),title:"Sticker Board",main:""},null,8,["icon"]),u("div",Ta,[m(I,{class:"w-full grid place-content-center"},{default:v(()=>[m(We,{version:n.currentVersion,profile:e.value,size:290},null,8,["version","profile"])]),_:1})])],64)):c("",!0),i(l).id==i(Ue).IIDX&&n.currentVersion>=29?(r(),x(V,{key:4},[m(G,{icon:i(He),title:"Notes Radar",main:""},null,8,["icon"]),m(ha,{game:i(l).id,version:n.currentVersion,profile:i(b)},null,8,["game","version","profile"])],64)):c("",!0),(Q=e.value)!=null&&Q.timeline?(r(),x(V,{key:5},[m(G,{icon:i(ze),title:"Timeline",main:""},null,8,["icon"]),u("div",ja,[m(I,null,{default:v(()=>{var _;return[u("ol",Aa,[(r(!0),x(V,null,Z(JSON.parse(JSON.stringify((_=e.value)==null?void 0:_.timeline)).reverse(),te=>(r(),x("li",{key:te.timestamp,class:"md:inline-block flex-shrink-0"},[u("div",Na,[a[2]||(a[2]=u("div",{class:"-ms-[6px] me-3 h-[12px] w-[12px] md:w-0.5 md:h-4 rounded-full md:rounded-none bg-gray-300 md:-mt-6 md:me-0 md:ms-0"},null,-1)),u("p",Ia,w(te.timestamp),1)]),u("div",La,[u("h4",Oa,w(te.arcade),1)])]))),128))])]}),_:1})])],64)):c("",!0)]}),_:1})):c("",!0)]),_:1}))}};export{Ha as default};
