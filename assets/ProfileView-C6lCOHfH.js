import{b as q,a as I,p as g,r as N,L as P,c as p,d as c,w as n,e,_ as L,i as A,M as B,N as E,g as t,x as S,h as V,v,O,z as M,y as f,f as _,l as J,B as U,C as $,P as F,n as z,Q as D}from"./index-DxCfvdTP.js";import{_ as u}from"./FormField-6QLSYEs8.js";import{_ as m}from"./FormControl-Duix1c6v.js";import{_ as G}from"./FormCheckRadio-B8K8iYm3.js";const Q={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},W={__name:"ProfileView",setup(R){const r=q(),y=I(),d=g({username:JSON.parse(JSON.stringify(r.userName)),email:JSON.parse(JSON.stringify(r.userEmail)),pin:null,public:r.userPublic??!1}),l=g({username:JSON.parse(JSON.stringify(r.userName)),email:JSON.parse(JSON.stringify(r.userEmail)),pin:null,public:r.userPublic??!1}),i=g({currentPassword:"",newPassword:"",confirmPassword:""}),w=N(!1),b=N(!1);P(()=>r.userName,s=>{l.username=JSON.parse(JSON.stringify(s)),d.username=JSON.parse(JSON.stringify(s))}),P(()=>r.userEmail,s=>{l.email=JSON.parse(JSON.stringify(s)),d.email=JSON.parse(JSON.stringify(s))}),P(()=>r.userPublic,s=>{l.public=s,d.public=s});async function x(){w.value=!0,(await r.putUser(l)).status=="success"&&(w.value=!1,r.userLoaded=!1,await r.loadUser(),y.go())}async function C(){b.value=!0,(await D(i.currentPassword,i.newPassword,i.confirmPassword)).status=="success"&&(alert("Password changed."),b.value=!1,await r.loadUser(),y.go())}function k(s){s.target.value=s.target.value.replace(/\D/g,"")}function h(s,a){return JSON.stringify(s)!==JSON.stringify(a)}return(s,a)=>(c(),p(z,null,{default:n(()=>[e(L,null,{default:n(()=>[e(B,{class:"mb-6","use-small":"","even-smaller":""}),e(E,{icon:t(S),title:"Profile Settings",main:""},null,8,["icon"]),A("div",Q,[e(V,{"is-form":"",class:"row-span-1",onSubmit:v(x,["prevent"])},{footer:n(()=>[h(d,l)?(c(),p(J,{key:0,color:"success",type:"submit",label:"Update"})):_("",!0),w.value?(c(),p(U,{key:1,path:t($),color:"text-yellow-500",class:"animate animate-spin"},null,8,["path"])):_("",!0)]),default:n(()=>[e(O,{color:"info",label:"General",class:"mb-2"}),e(u,{label:"Username"},{default:n(()=>[e(m,{modelValue:l.username,"onUpdate:modelValue":a[0]||(a[0]=o=>l.username=o),icon:t(S),name:"username",required:"",autocomplete:"username"},null,8,["modelValue","icon"])]),_:1}),e(u,{label:"E-mail",help:"Used for password resetting and 2FA"},{default:n(()=>[e(m,{modelValue:l.email,"onUpdate:modelValue":a[1]||(a[1]=o=>l.email=o),icon:t(M),type:"email",name:"email",required:"",autocomplete:"email"},null,8,["modelValue","icon"])]),_:1}),e(u,{label:"PIN",help:"Used when logging into a game"},{default:n(()=>[e(m,{modelValue:l.pin,"onUpdate:modelValue":a[2]||(a[2]=o=>l.pin=o),icon:t(f),type:"password",name:"pin",minlength:4,maxlength:4,inputmode:"numeric",pattern:"\\d{4}",autocomplete:"pin",onInput:k},null,8,["modelValue","icon"])]),_:1}),e(u,{label:"Public Profile",help:"Show my profile publicly. If disabled, only game profiles and scores will be visible."},{default:n(()=>[e(G,{modelValue:l.public,"onUpdate:modelValue":a[3]||(a[3]=o=>l.public=o),name:"public","model-value":l.public,"input-value":l.public,type:"switch"},null,8,["modelValue","model-value","input-value"])]),_:1})]),_:1}),e(V,{"is-form":"",class:"row-span-2",onSubmit:a[7]||(a[7]=v(o=>C(),["prevent"]))},{footer:n(()=>[e(J,{type:"submit",color:"success",label:"Update"}),b.value?(c(),p(U,{key:0,path:t($),color:"text-yellow-500",class:"animate animate-spin"},null,8,["path"])):_("",!0)]),default:n(()=>[e(O,{color:"info",label:"Change Password",class:"mb-2"}),e(u,{label:"Current Password"},{default:n(()=>[e(m,{modelValue:i.currentPassword,"onUpdate:modelValue":a[4]||(a[4]=o=>i.currentPassword=o),icon:t(f),name:"currentPassword",type:"password",required:""},null,8,["modelValue","icon"])]),_:1}),e(F),e(u,{label:"New Password"},{default:n(()=>[e(m,{modelValue:i.newPassword,"onUpdate:modelValue":a[5]||(a[5]=o=>i.newPassword=o),icon:t(f),name:"newPassword",type:"password",required:""},null,8,["modelValue","icon"])]),_:1}),e(u,{label:"Confirm Password"},{default:n(()=>[e(m,{modelValue:i.confirmPassword,"onUpdate:modelValue":a[6]||(a[6]=o=>i.confirmPassword=o),icon:t(f),name:"confirmPassword",type:"password",required:""},null,8,["modelValue","icon"])]),_:1})]),_:1})])]),_:1})]),_:1}))}};export{W as default};
