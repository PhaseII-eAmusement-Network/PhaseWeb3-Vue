import{a as P,s as k,c as o,e as u,w as r,j as t,f as a,v as S,k as m,g as i,R as v,i as c,H as w,Q as y,n,x as h,S as $,U as K,t as A,z as x,_ as R}from"./index.185e5f3b.js";import{_ as f}from"./FormField.2cf34664.js";import{_ as p}from"./FormControl.0c660c12.js";import{_ as C}from"./LayoutGuest.80fa50c7.js";import{a as I,b as U,c as E}from"./account.64a34b02.js";const N={class:"flex md:min-h-screen md:items-center md:justify-center"},B={class:"p-4 flex flex-col md:flex-row w-full space-y-2 md:space-y-0 md:space-x-4"},q={class:"grid grid-cols-1 gap-2"},L={class:"mb-4"},j={class:"text-xl"},O={class:"font-bold"},z={key:3,class:"border-t border-1 mt-3 w-full"},D={key:4,class:"flex flex-col gap-2 my-1"},G={__name:"ResetView",setup(H){const b=P(),e=k({email:"",loading:!1,emailSent:!1,authKey:null,authValid:!1,username:null,newPassword:"",confirmPassword:""});async function g(){e.loading=!0,(await I(e.email)).status=="success"&&(e.emailSent=!0,e.loading=!1)}async function _(){e.loading=!0;const d=await U(e.authKey);d.status=="success"&&(e.authValid=!0,e.loading=!1,e.username=d.username)}async function V(){if(e.newPassword!=e.confirmPassword){alert("Passwords don't match!");return}e.loading=!0,(await E(e.authKey,e.newPassword,e.confirmPassword)).status=="success"&&(alert("Password changed!"),b.push("/auth/login"))}return(d,s)=>(o(),u(C,null,{default:r(()=>[t("div",N,[a(R,{class:"w-full md:w-auto rounded-none md:rounded-xl md:drop-shadow-xl","has-table":"","is-auth":""},{default:r(()=>[t("div",B,[s[10]||(s[10]=t("div",{class:"flex flex-col items-center text-wrap h-full md:mt-5"},[t("img",{src:S,class:"rounded-full shadow-lg mb-2"}),t("h1",{class:"text-xl"},[t("samp",null,"PhaseII")]),t("p",{class:"text-sm text-gray-700 dark:text-white/75"}," Spinnin' since 2021 "),t("hr",{class:"border-t border-1 my-1 w-full"}),t("p",{class:"text-lg relative bottom-0"},"Password Reset")],-1)),s[11]||(s[11]=t("div",{class:"md:border-r md:border-1"},null,-1)),t("div",q,[e.emailSent?n("",!0):(o(),m("form",{key:0,onSubmit:s[1]||(s[1]=h(l=>g(),["prevent"]))},[a(f,{label:"Email Address"},{default:r(()=>[a(p,{modelValue:e.email,"onUpdate:modelValue":s[0]||(s[0]=l=>e.email=l),icon:i(v),type:"email",autocomplete:"email",required:""},null,8,["modelValue","icon"])]),_:1}),a(c,{label:"Check",type:"submit",color:"info"}),e.loading?(o(),u(w,{key:0,path:i(y),color:"text-yellow-500",class:"animate animate-spin"},null,8,["path"])):n("",!0)],32)),e.emailSent&&!e.authValid?(o(),m("form",{key:1,onSubmit:s[3]||(s[3]=h(l=>_(),["prevent"]))},[a(f,{label:"Auth Key"},{default:r(()=>[a(p,{modelValue:e.authKey,"onUpdate:modelValue":s[2]||(s[2]=l=>e.authKey=l),icon:i($),type:"text",name:"token",inputmode:"numeric",pattern:"[0-9]*",autocomplete:"one-time-code",maxlength:6},null,8,["modelValue","icon"])]),_:1}),a(c,{label:"Unlock",type:"submit",color:"info"}),e.loading?(o(),u(w,{key:0,path:i(y),color:"text-yellow-500",class:"animate animate-spin"},null,8,["path"])):n("",!0)],32)):n("",!0),e.emailSent&&e.authValid?(o(),m("form",{key:2,onSubmit:s[6]||(s[6]=h(l=>V(),["prevent"]))},[t("div",L,[t("h1",j,[s[7]||(s[7]=K(" Welcome, ")),t("span",O,A(e.username),1)]),s[8]||(s[8]=t("p",{class:"text-sm text-gray-400"}," Look who forgot their password ",-1))]),a(f,{label:"New Password"},{default:r(()=>[a(p,{modelValue:e.newPassword,"onUpdate:modelValue":s[4]||(s[4]=l=>e.newPassword=l),icon:i(x),type:"password",required:"",minlength:"8"},null,8,["modelValue","icon"])]),_:1}),a(f,{label:"Confirm Password"},{default:r(()=>[a(p,{modelValue:e.confirmPassword,"onUpdate:modelValue":s[5]||(s[5]=l=>e.confirmPassword=l),icon:i(x),type:"password",required:"",minlength:"8"},null,8,["modelValue","icon"])]),_:1}),a(c,{label:"Reset Password",type:"submit",color:"success"}),e.loading?(o(),u(w,{key:0,path:i(y),color:"text-yellow-500",class:"animate animate-spin"},null,8,["path"])):n("",!0)],32)):n("",!0),e.authValid?n("",!0):(o(),m("hr",z)),e.authValid?n("",!0):(o(),m("div",D,[s[9]||(s[9]=t("h2",null,"Remember it?",-1)),a(c,{label:"Log In",color:"success",href:"/#/auth/login"})]))])])]),_:1})])]),_:1}))}};export{G as default};
