import{b as re,r as q,o as z,c as l,k as y,l as F,e as c,w as _,j as r,f as d,X as B,n as i,t as f,_ as L,F as g,u as ne,a as ie,a3 as oe,s as ue,M as ce,p as de,g as n,m as me,i as G,aO as _e,W as C,aI as fe,aJ as pe,aD as be,ak as b,A as ye,U as w,aP as ve,aQ as ge,aR as ke,q as he}from"./index.2703a086.js";import{_ as we,g as U,a as J}from"./ProfileCard.8c41235e.js";import{_ as Se}from"./FormControl.7e4eeeb0.js";import{A as xe}from"./profile.24de0733.js";import{A as Ve}from"./arcade.467dceba.js";import{g as M}from"./danClass.233b0381.js";import"./userData.bcc92478.js";const $e={class:"flex space-x-2 mb-2"},De={class:"flex justify-between items-center"},Pe={class:"grid"},je={class:"text-lg font-bold"},Ae={class:"text-md"},Ne={class:"text-lg"},Te={class:"text-lg"},H={__name:"JubilityTable",props:{jubilityData:{type:Array,required:!0},version:{type:Number,required:!0}},setup(R){const O=re(),k=q(null),$=R,v={0:{label:"Basic",color:"info"},1:{label:"Advanced",color:"warning"},2:{label:"Extreme",color:"danger"}};return z(async()=>{try{k.value=null;const u=$.jubilityData.map(s=>s.song_id),D=await O.getMusicData("jubeat",$.version,u),m=$.jubilityData.map(s=>{const a=D.find(P=>P.id===s.song_id&&P.chart===s.chart);return{...s,...a?{songData:a}:{}}});m.sort((s,a)=>a.rate-s.rate),k.value=m}catch(u){console.error("Failed to fetch music data:",u)}}),(u,D)=>k.value?(l(!0),y(g,{key:0},F(k.value,m=>(l(),c(L,{key:m.id,"color-prop":"bg-slate-800 dark:bg-slate-800",class:"my-3 p-5","has-table":""},{default:_(()=>[r("div",$e,[d(B,{label:v[m.chart].label,color:v[m.chart].color},null,8,["label","color"]),m.hard?(l(),c(B,{key:0,label:"Hard Mode",color:"danger"})):i("",!0)]),r("div",De,[r("div",Pe,[r("h1",je,f(m.songData.name),1),r("h2",Ae,f(m.songData.artist),1)]),r("div",null,[r("h2",Ne,"Jubility: "+f(m.value/10),1),r("h2",Te,"Rate: "+f(m.rate/10),1)])])]),_:2},1024))),128)):i("",!0)}},Ie={class:"md:flex pb-6 md:justify-between md:items-center"},Ce={key:0,class:"mt-2 md:mt-0 md:w-1/3 md:text-right"},Je=["src"],Fe={class:"bg-white dark:bg-slate-900/90 rounded-2xl pt-6 p-3 card-content"},Le={class:"w-full"},Be={class:"md:w-1/3 grid grid-cols-1 md:grid-cols-2 gap-3"},Oe={class:"my-6 grid grid-cols-1 md:grid-cols-4 gap-6"},Ee={class:"my-6 grid grid-cols-2 md:grid-cols-5 xl:grid-cols-6 gap-6"},Ge={class:"my-6 grid grid-cols-1 md:grid-cols-2 gap-6"},Me={class:"my-6"},Re={class:"border-s border-neutral-300 md:flex md:justify-start md:gap-10 md:border-s-0 md:border-t md:overflow-x-auto overflow-y-visible md:whitespace-nowrap scrollbar"},Ue={class:"flex-start flex items-center pt-2 md:block md:pt-4"},He={class:"mt-2 text-sm font-light"},qe={class:"ms-4 pb-6 md:ms-0"},ze={class:"text-lg font-semibold"},aa={__name:"PlayerView",setup(R){const O="https://cdn.phaseii.network/file/PhaseII/web-assets",k=ne(),$=ie();var v=null,u=null,D=null,m=!0;v=k.params.game,D=k.params.userId,u=oe(v),u||$.push({name:"ErrorPage",params:{catchAll:"404"}});const s=ue({currentVersion:null});ce(()=>s.currentVersion,()=>{m?m=!1:P()});const a=q(null);z(async()=>{P()}),u.versions||(s.currentVersion=1);async function P(){try{a.value=null;var t=await xe(v,s.currentVersion,D);t.timeline=await se(t),a.value=te(t),t&&!s.currentVersion&&(s.currentVersion=t.versions[t.versions.length-1])}catch(e){console.error("Failed to fetch user profile data:",e)}}async function X(t){try{return await Ve(t)}catch(e){console.error("Failed to fetch arcade data:",e)}}var Q=[{label:"Register Date",type:String,span:"md:col-span-2",key:"first_play_timestamp"},{label:"Last Play",type:String,span:"md:col-span-2",key:"last_play_timestamp"},{label:"First Arcade",type:String,span:"md:col-span-2",key:"first_play_arcade"},{label:"Last Arcade",type:String,span:"md:col-span-2",key:"last_play_arcade"},{label:"Total Plays",type:Number,key:"total_plays"},{label:"EXP",type:Number,key:"exp"},{label:"SP Plays",type:Number,key:"single_plays"},{label:"DP Plays",type:Number,key:"double_plays"},{label:"SP DJPOINT",type:Number,key:"single_dj_points"},{label:"DP DJPOINT",type:Number,key:"double_dj_points"}];function W(){return s.currentVersion?`${O}/games/${u.id}/card/${s.currentVersion}.webp`:u.cardBG}function K(){var t;return s.currentVersion&&((t=u.videoTable)==null?void 0:t.includes(s.currentVersion))?`https://cdn.phaseii.network/file/PhaseII/game-assets/video/${u.id}/${s.currentVersion}.mp4`:null}function Y(){var t;return(t=u.videoTable)!=null&&t.includes(s.currentVersion)?null:`
      background-image: url('${W()}');
      background-size: cover;
      background-repeat: no-repeat;
    `}function Z(t,e){if(e){if(t.isSkill&&e.jubility)return U(e.jubility);if(t.isJubility&&e.records.skill)return J(e.records.skill)}return""}function ee(t){var e=[];for(const p of u.versions)t.includes(p.id)&&e.push(p);return e}function ae(t,e){return t.isSkill?e.stats[t.key]/100:t.isJubility?e.stats[t.key]/10:e.stats[t.key]}function te(t){if(t.stats){if(t.stats.first_play_timestamp){const e=new Date(t.stats.first_play_timestamp*1e3);t.stats.first_play_timestamp=e.toLocaleString()}if(t.stats.last_play_timestamp){const e=new Date(t.stats.last_play_timestamp*1e3);t.stats.last_play_timestamp=e.toLocaleString()}t.dp&&t.dp.dan!==void 0&&(t.dp.dan=M(t.dp.dan).short)}return t}function le(t){var p;const e=(p=t.stats)==null?void 0:p.count;return e?[e.mfc!=null?{label:"MFCs",value:e.mfc}:0,e.pfc!=null?{label:"PFCs",value:e.pfc}:0,e.fc!=null?{label:"GFCs",value:e.fc}:0,e.gfc!=null?{label:"FCs",value:e.gfc}:0,e.life4!=null?{label:"Life-4 Clears",value:e.life4}:0]:[]}async function se(t){const e=t==null?void 0:t.stats,p=e==null?void 0:e.first_play_timestamp,S=e==null?void 0:e.last_play_timestamp,j=e==null?void 0:e.arcade_history,h=[];if(p&&h.push({timestamp:new Date(p*1e3).toLocaleString(),arcade:e==null?void 0:e.first_play_arcade,first_play:!0}),j)for(const[x,V]of Object.entries(j)){const N=await X(x);for(const[T,I]of Object.entries(V))for(const A of I){const o=new Date(A*1e3);[p,S].includes(A)||h.push({timestamp:o.toLocaleString(),arcade:N.name,machineId:T,first_play:!1})}}return S&&h.push({timestamp:new Date(S*1e3).toLocaleString(),arcade:e==null?void 0:e.last_play_arcade,first_play:!1}),h.sort((x,V)=>new Date(x.timestamp).getTime()-new Date(V.timestamp).getTime())}return(t,e)=>(l(),c(he,null,{default:_(()=>[a.value?(l(),c(de,{key:0},{default:_(()=>{var p,S,j,h,x,V,N,T,I,A;return[r("div",Ie,[d(G,{icon:n(me),href:`/#/games/${n(v)}`,class:"w-full md:w-auto",color:"info",label:`${n(u).shortName?n(u).shortName:n(u).name} Home`},null,8,["icon","href","label"]),n(u).versions&&a.value?(l(),y("div",Ce,[e[1]||(e[1]=r("h2",{class:"text-md sm:text-lg md:text-xl font-bold p-2"}," Select Version ",-1)),d(Se,{modelValue:s.currentVersion,"onUpdate:modelValue":e[0]||(e[0]=o=>s.currentVersion=o),options:ee(a.value.versions)},null,8,["modelValue","options"])])):i("",!0)]),d(C,{icon:n(_e),title:"View Profile",main:""},null,8,["icon"]),s.currentVersion&&a.value?(l(),y("div",{key:0,style:be(Y()),class:"rounded-2xl mb-6 card-container"},[r("video",{autoplay:"",muted:"",loop:"",playsinline:"",src:K(),class:"background-video"},null,8,Je),r("div",Fe,[r("div",Le,[d(we,{"use-small":"",game:n(v),version:s.currentVersion,profile:a.value},{default:_(()=>[r("div",Be,[d(G,{href:`/#/games/${n(v)}/scores/${a.value.userId}`,icon:n(fe),class:"w-full md:w-auto",color:"info",label:"View Scores"},null,8,["href","icon"]),d(G,{href:`/#/games/${n(v)}/records/${a.value.userId}`,icon:n(pe),class:"w-full md:w-auto",color:"info",label:"View Records"},null,8,["href","icon"])])]),_:1},8,["game","version","profile"])])])],4)):i("",!0),r("div",Oe,[(l(!0),y(g,null,F(n(Q),o=>(l(),y(g,{key:o},[a.value.stats[o.key]?(l(),c(b,{key:0,class:ye(o.span),label:o.label,number:o.type==Number?ae(o,a.value):null,"num-color":Z(o)},{default:_(()=>[w(f(o.type==String?a.value.stats[o.key]:null),1)]),_:2},1032,["class","label","number","num-color"])):i("",!0)],64))),128)),(S=(p=a.value.stats)==null?void 0:p.count)!=null&&S.records?(l(),c(b,{key:0,label:"Records",number:(h=(j=a.value.stats)==null?void 0:j.count)==null?void 0:h.records},null,8,["number"])):i("",!0),(V=(x=a.value.stats)==null?void 0:x.count)!=null&&V.attempts?(l(),c(b,{key:1,label:"Attempts",number:(T=(N=a.value.stats)==null?void 0:N.count)==null?void 0:T.attempts},null,8,["number"])):i("",!0),a.value.skill?(l(),c(b,{key:2,label:"Skill Points",number:a.value.skill/100,"num-color":n(U)(a.value.skill)},null,8,["number","num-color"])):i("",!0),a.value.profile_skill?(l(),c(b,{key:3,label:"Skill Level"},{default:_(()=>[w(f(a.value.profile_skill/100),1)]),_:1})):i("",!0),a.value.jubility?(l(),c(b,{key:4,label:"Jubility","num-color":n(J)(a.value.jubility)},{default:_(()=>[w(f(a.value.jubility/10),1)]),_:1},8,["num-color"])):i("",!0),a.value.pick_up_jubility?(l(),c(b,{key:5,label:"Pick-Up Jubility","num-color":n(J)(a.value.pick_up_jubility)},{default:_(()=>[w(f(a.value.pick_up_jubility/10),1)]),_:1},8,["num-color"])):i("",!0),a.value.common_jubility?(l(),c(b,{key:6,label:"Common Jubility","num-color":n(J)(a.value.common_jubility)},{default:_(()=>[w(f(a.value.common_jubility/10),1)]),_:1},8,["num-color"])):i("",!0),a.value.deller?(l(),c(b,{key:7,label:"Deller",number:a.value.deller},null,8,["number"])):i("",!0),a.value.sgrade?(l(),c(b,{key:8,label:"SP DAN"},{default:_(()=>[w(f(n(M)(a.value.sgrade).label),1)]),_:1})):i("",!0),a.value.dgrade?(l(),c(b,{key:9,label:"DP DAN"},{default:_(()=>[w(f(n(M)(a.value.dgrade).label),1)]),_:1})):i("",!0)]),(I=a.value.stats)!=null&&I.count?(l(),y(g,{key:1},[d(C,{icon:n(ve),title:"Stats",main:""},null,8,["icon"]),r("div",Ee,[(l(!0),y(g,null,F(le(a.value),o=>(l(),y(g,{key:o},[o.value?(l(),c(b,{key:0,label:o.label,number:o.value},null,8,["label","number"])):i("",!0)],64))),128))])],64)):i("",!0),a.value.jubility?(l(),y(g,{key:2},[d(C,{icon:n(ge),title:"Jubility Breakdown",main:""},null,8,["icon"]),r("div",Ge,[a.value.pick_up_breakdown?(l(),c(L,{key:0},{default:_(()=>[d(B,{label:"Pick-Up",color:"info"}),d(H,{"jubility-data":a.value.pick_up_breakdown,",":"",version:s.currentVersion},null,8,["jubility-data","version"])]),_:1})):i("",!0),a.value.other_breakdown?(l(),c(L,{key:1},{default:_(()=>[d(B,{label:"Common",color:"info"}),d(H,{"jubility-data":a.value.other_breakdown,",":"",version:s.currentVersion},null,8,["jubility-data","version"])]),_:1})):i("",!0)])],64)):i("",!0),(A=a.value)!=null&&A.timeline?(l(),y(g,{key:3},[d(C,{icon:n(ke),title:"Timeline",main:""},null,8,["icon"]),r("div",Me,[d(L,null,{default:_(()=>{var o;return[r("ol",Re,[(l(!0),y(g,null,F(JSON.parse(JSON.stringify((o=a.value)==null?void 0:o.timeline)).reverse(),E=>(l(),y("li",{key:E.timestamp,class:"md:inline-block flex-shrink-0"},[r("div",Ue,[e[2]||(e[2]=r("div",{class:"-ms-[6px] me-3 h-[12px] w-[12px] md:w-0.5 md:h-4 rounded-full md:rounded-none bg-gray-300 md:-mt-6 md:me-0 md:ms-0"},null,-1)),r("p",He,f(E.timestamp),1)]),r("div",qe,[r("h4",ze,f(E.arcade),1)])]))),128))])]}),_:1})])],64)):i("",!0)]}),_:1})):i("",!0)]),_:1}))}};export{aa as default};
