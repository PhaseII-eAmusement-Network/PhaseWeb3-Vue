import{u as x,s as A,r as R,a as m,c as p,w as i,b as t,X as j,e as g,ae as q,g as o,_ as C,Y as V,af as k,f as w,I as U,ag as F,ah as G,k as P,ai as T,v as z,i as H,j as Q,t as _,F as X,l as Y,n as J,q as K}from"./index.26ff47d4.js";import{_ as s}from"./FormField.3920cd23.js";import{_ as u}from"./FormCheckRadio.c2c9f311.js";import{_ as D}from"./FormControl.e7078065.js";import{c as W,a as Z,b as ee}from"./admin.79b196c7.js";const M=x();async function ae(f,c){try{return await M.callApi(`/discord/exportVPN/${f}?discordId=${c}`)}catch(d){throw console.log("Error exporting vpn:",d),d}}async function ne(f,c){try{return await M.callApi(`/discord/onboardArcade/${f}?discordId=${c}`)}catch(d){throw console.log("Error onboarding arcade:",d),d}}function $(){const f="01201000000000",c="0123456789ABCDEF";let d="";for(let h=0;h<6;h++)d+=c[Math.floor(Math.random()*c.length)];return f+d}const te={class:"grid grid-cols-1 gap-6"},le={class:"mb-4 flex gap-2 items-stretch"},ie={class:"grid grid-cols-1 w-full gap-2 md:gap-6 md:flex md:place-content-stretch"},oe={class:"grid md:grid-cols-2 gap-6"},se={class:"grid grid-cols-1 w-full gap-2 md:gap-6 md:flex md:place-content-stretch pb-4 md:pb-0"},de={class:"grid gap-4"},re={class:"flex justify-between items-center"},ue={class:"m-[-5px]"},ce={class:"text-md font-bold"},me={class:"text-sm"},pe={class:"text-sm font-mono"},fe={class:"grid md:flex gap-4"},we={__name:"OnboardingView",setup(f){const c=K(),d=x(),I={name:"",useDiscord:!0,discordId:"",description:"",paseli:!0,infinitePaseli:!0,maintenance:!1,betas:!1,incognito:!1,machineList:[]},h={name:"",cabinet:!1,ota:!1,generatePCBID:!0,PCBID:""},n=A({...I}),l=A({...h}),B=R(void 0);async function E(){for(l.generatePCBID&&(l.PCBID=$());!await ee(l.PCBID);)if(l.generatePCBID)l.PCBID=$();else{window.alert("PCBID already in use!");return}n.machineList.push({name:l.name,cabinet:l.cabinet,ota:l.ota,PCBID:l.PCBID.toUpperCase()}),Object.assign(l,h)}function N(r){n.machineList=n.machineList.filter(e=>e.PCBID!==r)}async function L(){if(n.name){const r=await W(n.name);r.unused!=null&&(B.value=r.unused)}}function O(r,e="NA_"){var a=[...r].map(v=>v.charCodeAt(0)<128?v:e).join("");return a=a.replace(/[!"#$%&'()*+,-./:;<=>?@[\\\]^_`{|}~]/g,""),a=a.replace(/\s+/g,"_"),a}async function S(r,e){try{const a=await d.getArcadeVPN(r),v=new Blob([a],{type:"application/ovpn"}),b=document.createElement("a");b.href=URL.createObjectURL(v),b.download=`gradius-${O(e.name)}-phaseii-config.ovpn`,document.body.appendChild(b),b.click(),URL.revokeObjectURL(b.href),document.body.removeChild(b)}catch(a){console.log("Failed to fetch arcade data:",a)}}async function y(r){if(n.name==I.name){window.alert("Please input a name.");return}if(n.discordId==I.discordId&&n.useDiscord&&r){window.alert("Please input a Discord ID.");return}if(n.description==I.description&&!n.useDiscord){window.alert("Please input a description.");return}const e=await Z(n);r&&e.arcadeId&&(n.useDiscord?(await ne(e.arcadeId,n.discordId),await ae(e.arcadeId,n.discordId)):await S(e.arcadeId,n)),e.arcadeId?(window.alert("Onboarding complete!"),c.push({name:"arcade",params:{id:e.arcadeId}})):window.alert("Failed to onboard!")}return(r,e)=>(m(),p(J,null,{default:i(()=>[t(Y,null,{default:i(()=>[t(j,{icon:g(q),title:"Arcade Onboarding",color:"text-green-400",main:""},null,8,["icon"]),o("div",te,[t(C,{"is-form":"",class:"row-span-1"},{default:i(()=>[t(V,{color:"info",label:"General Information",icon:g(k),class:"mb-2"},null,8,["icon"]),t(s,{label:"Arcade Name"},{default:i(()=>[t(D,{modelValue:n.name,"onUpdate:modelValue":e[0]||(e[0]=a=>n.name=a),"input-value":n.name,name:"arcadeName",required:""},null,8,["modelValue","input-value"])]),_:1}),o("div",le,[t(w,{color:"info",label:"Check Name",onClick:e[1]||(e[1]=a=>L())}),B.value==!0?(m(),p(U,{key:0,path:g(F),color:"text-green-400",size:"25"},null,8,["path"])):B.value==!1?(m(),p(U,{key:1,path:g(G),color:"text-red-400",size:"25"},null,8,["path"])):P("",!0)]),t(s,{label:"Use Discord",help:"Automated provisioning rather than manual. BadManiac will DM the user via Discord."},{default:i(()=>[t(u,{modelValue:n.useDiscord,"onUpdate:modelValue":e[2]||(e[2]=a=>n.useDiscord=a),"input-value":n.useDiscord,name:"useDiscord",type:"switch"},null,8,["modelValue","input-value"])]),_:1}),n.useDiscord?(m(),p(s,{key:0,label:"Discord ID",help:"Owner's Discord User ID."},{default:i(()=>[t(D,{modelValue:n.discordId,"onUpdate:modelValue":e[3]||(e[3]=a=>n.discordId=a),"input-value":n.discordId,name:"discordId",required:""},null,8,["modelValue","input-value"])]),_:1})):P("",!0),n.useDiscord?P("",!0):(m(),p(s,{key:1,label:"Description",help:"Manual description rather than automated."},{default:i(()=>[t(D,{modelValue:n.description,"onUpdate:modelValue":e[4]||(e[4]=a=>n.description=a),name:"description",required:""},null,8,["modelValue"])]),_:1}))]),_:1}),t(C,{"is-form":"",class:"row-span-1"},{default:i(()=>[t(V,{color:"info",label:"Settings",icon:g(T),class:"mb-2"},null,8,["icon"]),o("div",ie,[t(s,{label:"PASELI Enabled",help:"Enable or disable PASELI services."},{default:i(()=>[t(u,{modelValue:n.paseli,"onUpdate:modelValue":e[5]||(e[5]=a=>n.paseli=a),"input-value":n.paseli,name:"paseli",type:"switch"},null,8,["modelValue","input-value"])]),_:1}),t(s,{label:"Infinite PASELI",help:"Enable or disable infinite PASELI."},{default:i(()=>[t(u,{modelValue:n.infinitePaseli,"onUpdate:modelValue":e[6]||(e[6]=a=>n.infinitePaseli=a),"input-value":n.infinitePaseli,name:"infinitePaseli",type:"switch"},null,8,["modelValue","input-value"])]),_:1}),t(s,{label:"Maintenance Mode",help:"Place this arcade under Maintenance."},{default:i(()=>[t(u,{modelValue:n.maintenance,"onUpdate:modelValue":e[7]||(e[7]=a=>n.maintenance=a),"input-value":n.maintenance,name:"maintenance",type:"switch"},null,8,["modelValue","input-value"])]),_:1}),t(s,{label:"Incognito Mode",help:"Hide the eAmusement network and ranking data."},{default:i(()=>[t(u,{modelValue:n.incognito,"onUpdate:modelValue":e[8]||(e[8]=a=>n.incognito=a),"input-value":n.incognito,name:"incognito",type:"switch"},null,8,["modelValue","input-value"])]),_:1}),t(s,{label:"Beta Testing",help:"Enable or disable beta testing."},{default:i(()=>[t(u,{modelValue:n.betas,"onUpdate:modelValue":e[9]||(e[9]=a=>n.betas=a),"input-value":n.betas,name:"betas",type:"switch"},null,8,["modelValue","input-value"])]),_:1})])]),_:1}),t(C,{class:"row-span-1"},{default:i(()=>[t(V,{color:"info",label:"Machines",icon:g(k),class:"mb-2"},null,8,["icon"]),o("div",oe,[o("form",{class:"h-full",onSubmit:e[15]||(e[15]=z(a=>E(),["prevent"]))},[t(s,{label:"Generate PCBID",help:"Generate a PCBID rather than supply one."},{default:i(()=>[t(u,{modelValue:l.generatePCBID,"onUpdate:modelValue":e[10]||(e[10]=a=>l.generatePCBID=a),"input-value":l.generatePCBID,name:"generatePCBID",type:"switch"},null,8,["modelValue","input-value"])]),_:1}),l.generatePCBID?P("",!0):(m(),p(s,{key:0,label:"PCBID"},{default:i(()=>[t(D,{modelValue:l.PCBID,"onUpdate:modelValue":e[11]||(e[11]=a=>l.PCBID=a),name:"pcbid",required:"",minlength:"20",maxlength:"20"},null,8,["modelValue"])]),_:1})),t(s,{label:"Name"},{default:i(()=>[t(D,{modelValue:l.name,"onUpdate:modelValue":e[12]||(e[12]=a=>l.name=a),name:"name",required:""},null,8,["modelValue"])]),_:1}),o("div",se,[t(s,{label:"Arcade Cabinet",help:"If this is a real cabinet, enable this."},{default:i(()=>[t(u,{modelValue:l.cabinet,"onUpdate:modelValue":e[13]||(e[13]=a=>l.cabinet=a),"input-value":l.cabinet,name:"cabinet",type:"switch"},null,8,["modelValue","input-value"])]),_:1}),t(s,{label:"Enable Updates",help:"Enables or disables OTA updates."},{default:i(()=>[t(u,{modelValue:l.ota,"onUpdate:modelValue":e[14]||(e[14]=a=>l.ota=a),"input-value":l.ota,name:"ota",type:"switch"},null,8,["modelValue","input-value"])]),_:1})]),t(w,{color:"success",type:"submit",label:"Add Machine"})],32),o("div",null,[t(V,{color:"warning",label:"Queue",class:"mb-4"}),o("div",de,[(m(!0),H(X,null,Q(n.machineList,a=>(m(),p(C,{key:a.name,"color-prop":"bg-slate-800 dark:bg-slate-800"},{default:i(()=>[o("div",re,[o("div",ue,[o("h1",ce,_(a.name),1),o("h2",me,_(a.cabinet?"Cabinet":"Setup")+_(a.ota?" - OTA Enabled":null),1),o("h2",pe,_(a.PCBID!=""?a.PCBID:"not generated"),1)]),t(w,{color:"danger",label:"Remove",onClick:v=>N(a.PCBID)},null,8,["onClick"])])]),_:2},1024))),128))])])])]),_:1}),o("div",fe,[t(w,{type:"submit",color:"success",label:n.useDiscord?"Create Arcade with Discord":"Create Arcade and VPN",small:!1,onClick:e[16]||(e[16]=a=>y(!0))},null,8,["label"]),t(w,{type:"submit",color:"info",label:"Create Arcade",small:!1,onClick:e[17]||(e[17]=a=>y(!1))})])])]),_:1})]),_:1}))}};export{we as default};
