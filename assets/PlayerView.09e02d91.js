import{b as ge,r as N,o as ee,c as r,k as x,l as W,e as y,w as v,j as u,f as m,a0 as H,n as c,t as w,_ as I,F as V,d as pe,b5 as fe,b6 as he,M as oe,b7 as re,b8 as ke,h as ne,b9 as be,ba as ie,bb as we,bc as xe,bd as Se,be as De,bf as Pe,bg as Ce,bh as $e,bi as Ve,B as ue,g as i,u as je,a as Ae,ag as Te,s as Ne,p as Ie,m as Le,i as le,bj as Be,$ as G,aY as Oe,aZ as Re,aU as Fe,aB as C,A as Je,V as R,bk as Ee,bl as Ge,bm as Me,az as He,bn as Ue,bo as ze,q as qe}from"./index.3980ed35.js";import{_ as Ke,g as ce,a as Q}from"./ProfileCard.1ddd69f3.js";import{_ as Xe}from"./FormControl.34f83b60.js";import{_ as Ye}from"./UserSticker.bcec04b4.js";import{b as Ze,A as Qe}from"./profile.29c7dc13.js";import{A as We}from"./arcade.c1767834.js";import{g as se}from"./danClass.233b0381.js";import"./userData.bcc92478.js";const et={class:"flex space-x-2 mb-2"},tt={class:"flex justify-between items-center"},at={class:"grid"},lt={class:"text-lg font-bold"},st={class:"text-md"},rt={class:"text-lg"},nt={class:"text-lg"},de={__name:"JubilityTable",props:{jubilityData:{type:Array,required:!0},version:{type:Number,required:!0}},setup(s){const o=ge(),d=N(null),h=s,p={0:{label:"Basic",color:"info"},1:{label:"Advanced",color:"warning"},2:{label:"Extreme",color:"danger"}};return ee(async()=>{try{d.value=null;const l=h.jubilityData.map(n=>n.song_id),b=await o.getMusicData("jubeat",h.version,l),f=h.jubilityData.map(n=>{const e=b.find(S=>S.id===n.song_id&&S.chart===n.chart);return{...n,...e?{songData:e}:{}}});f.sort((n,e)=>e.rate-n.rate),d.value=f}catch(l){console.error("Failed to fetch music data:",l)}}),(l,b)=>d.value?(r(!0),x(V,{key:0},W(d.value,f=>(r(),y(I,{key:f.id,"color-prop":"bg-slate-800 dark:bg-slate-800",class:"my-3 p-5","has-table":""},{default:v(()=>[u("div",et,[m(H,{label:p[f.chart].label,color:p[f.chart].color},null,8,["label","color"]),f.hard?(r(),y(H,{key:0,label:"Hard Mode",color:"danger"})):c("",!0)]),u("div",tt,[u("div",at,[u("h1",lt,w(f.songData.name),1),u("h2",st,w(f.songData.artist),1)]),u("div",null,[u("h2",rt,"Jubility: "+w(f.value/10),1),u("h2",nt,"Rate: "+w(f.rate/10),1)])])]),_:2},1024))),128)):c("",!0)}},ye={data:{type:Object,required:!0},options:{type:Object,default:()=>({})},plugins:{type:Array,default:()=>[]},datasetIdKey:{type:String,default:"label"},updateMode:{type:String,default:void 0}},ot={ariaLabel:{type:String},ariaDescribedby:{type:String}},it={type:{type:String,required:!0},destroyDelay:{type:Number,default:0},...ye,...ot},ut=xe[0]==="2"?(s,o)=>Object.assign(s,{attrs:o}):(s,o)=>Object.assign(s,o);function M(s){return be(s)?re(s):s}function ct(s){let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:s;return be(o)?new Proxy(s,{}):s}function dt(s,o){const d=s.options;d&&o&&Object.assign(d,o)}function _e(s,o){s.labels=o}function ve(s,o,d){const h=[];s.datasets=o.map(p=>{const l=s.datasets.find(b=>b[d]===p[d]);return!l||!p.data||h.includes(l)?{...p}:(h.push(l),Object.assign(l,p),l)})}function mt(s,o){const d={labels:[],datasets:[]};return _e(d,s.labels),ve(d,s.datasets,o),d}const pt=pe({props:it,setup(s,o){let{expose:d,slots:h}=o;const p=N(null),l=fe(null);d({chart:l});const b=()=>{if(!p.value)return;const{type:e,data:S,options:g,plugins:k,datasetIdKey:D}=s,A=mt(S,D),$=ct(A,S);l.value=new ie(p.value,{type:e,data:$,options:{...g},plugins:k})},f=()=>{const e=re(l.value);e&&(s.destroyDelay>0?setTimeout(()=>{e.destroy(),l.value=null},s.destroyDelay):(e.destroy(),l.value=null))},n=e=>{e.update(s.updateMode)};return ee(b),he(f),oe([()=>s.options,()=>s.data],(e,S)=>{let[g,k]=e,[D,A]=S;const $=re(l.value);if(!$)return;let T=!1;if(g){const j=M(g),L=M(D);j&&j!==L&&(dt($,j),T=!0)}if(k){const j=M(k.labels),L=M(A.labels),B=M(k.datasets),U=M(A.datasets);j!==L&&(_e($.config.data,j),T=!0),B&&B!==U&&(ve($.config.data,B,s.datasetIdKey),T=!0)}T&&ke(()=>{n($)})},{deep:!0}),()=>ne("canvas",{role:"img",ariaLabel:s.ariaLabel,ariaDescribedby:s.ariaDescribedby,ref:p},[ne("p",{},[h.default?h.default():""])])}});function ft(s,o){return ie.register(o),pe({props:ye,setup(d,h){let{expose:p}=h;const l=fe(null),b=f=>{l.value=f==null?void 0:f.chart};return p({chart:l}),()=>ne(pt,ut({ref:b},{type:s,...d}))}})}const me=ft("radar",we),bt={class:"grid lg:grid-cols-2 gap-4"},yt={class:"w-full grid place-content-center text-center"},_t={class:"text-lg"},vt={class:"w-full grid place-content-center text-center"},gt={class:"text-lg"},ht={__name:"UserNotesRadar",props:{profile:{type:Number,default:null},game:{type:String,default:null},version:{type:Number,default:9}},setup(s){ie.register(Se,De,Pe,Ce,$e,Ve);const o=s,d=N(o.profile),h=N(o.version),p=N(!0),l=N(0),b=N({labels:["Notes","Peak","Scratch","Sof-Lan","Charge","Chord"],datasets:[{label:"SP",backgroundColor:"rgba(22, 95, 250, 0.2)",borderColor:"rgba(22, 95, 250, 1)",pointBackgroundColor:"rgba(22, 95, 250, 1)",pointBorderColor:"#fff",pointHoverBackgroundColor:"#fff",pointHoverBorderColor:"rgba(22, 95, 250, 1)",data:[]},{label:"DP",backgroundColor:"rgba(250, 170, 22, 0.2)",borderColor:"rgba(250, 170, 22, 1)",pointBackgroundColor:"rgba(250, 170, 22, 1)",pointBorderColor:"#fff",pointHoverBackgroundColor:"#fff",pointHoverBorderColor:"rgba(250, 170, 22, 1)",data:[]}]});oe(()=>o.version,()=>{d.value=o.profile,h.value=o.version,f()});async function f(){var g,k;try{const D=await Ze(o.game,o.version,d.value,[["notes_radar",0],["notes_radar",1]]),A=$=>{const[T,j,L,B,U,te]=$;return[T/100,j/100,L/100,B/100,U/100,te/100]};((g=D[0])==null?void 0:g.achievementId)===0&&(b.value.datasets[0].data=A(D[0].data.radar_score)),((k=D[1])==null?void 0:k.achievementId)===1&&(b.value.datasets[1].data=A(D[1].data.radar_score)),p.value=!1,l.value+=1}catch(D){console.error("Failed to fetch arcade data:",D)}}ee(async()=>{f()});const n={responsive:!1,maintainAspectRatio:!0,scales:{r:{ticks:{stepSize:30,callback:function(g){return g}},pointLabels:{font:{size:15}}}}},e=ue(()=>b.value.datasets[0].data.reduce((g,k)=>g+k,0).toFixed(2)),S=ue(()=>b.value.datasets[1].data.reduce((g,k)=>g+k,0).toFixed(2));return(g,k)=>b.value.datasets[0]?(r(),y(I,{key:0,class:"my-6"},{default:v(()=>[u("div",bt,[m(I,{"color-prop":"bg-slate-800 dark:bg-slate-800"},{default:v(()=>[m(H,{color:"info",label:"SP Radar",class:"mb-2"}),u("div",yt,[(r(),y(i(me),{key:l.value,class:"bg-slate-100 p-2 rounded-lg",data:{labels:b.value.labels,datasets:[b.value.datasets[0]]},options:n},null,8,["data"])),u("span",_t,"Total score: "+w(e.value),1)])]),_:1}),m(I,{"color-prop":"bg-slate-800 dark:bg-slate-800"},{default:v(()=>[m(H,{color:"info",label:"DP Radar",class:"mb-2"}),u("div",vt,[(r(),y(i(me),{key:l.value,class:"bg-slate-100 p-2 rounded-lg",data:{labels:b.value.labels,datasets:[b.value.datasets[1]]},options:n},null,8,["data"])),u("span",gt,"Total score: "+w(S.value),1)])]),_:1})])]),_:1})):c("",!0)}},kt={class:"md:flex pb-6 md:justify-between md:items-center"},wt={key:0,class:"mt-2 md:mt-0 md:w-1/3 md:text-right"},xt=["src"],St={class:"bg-white dark:bg-slate-900/90 rounded-2xl pt-6 p-3 card-content"},Dt={class:"w-full"},Pt={class:"md:w-1/3 grid grid-cols-1 md:grid-cols-2 gap-3"},Ct={class:"my-6 grid grid-cols-1 md:grid-cols-4 gap-6"},$t={class:"my-6 grid grid-cols-2 md:grid-cols-5 xl:grid-cols-6 gap-6"},Vt={class:"my-6 grid grid-cols-1 md:grid-cols-2 gap-6"},jt={class:"my-6"},At={class:"my-6"},Tt={class:"border-s border-neutral-300 md:flex md:justify-start md:gap-10 md:border-s-0 md:border-t md:overflow-x-auto overflow-y-visible md:whitespace-nowrap scrollbar"},Nt={class:"flex-start flex items-center pt-2 md:block md:pt-4"},It={class:"mt-2 text-sm font-light"},Lt={class:"ms-4 pb-6 md:ms-0"},Bt={class:"text-lg font-semibold"},Ut={__name:"PlayerView",setup(s){const o="https://cdn.phaseii.network/file/PhaseII/web-assets",d=je(),h=Ae();var p=null,l=null,b=null,f=!0;p=d.params.game,b=d.params.userId,l=Te(p),l||h.push({name:"ErrorPage",params:{catchAll:"404"}});const n=Ne({currentVersion:null});oe(()=>n.currentVersion,()=>{f?f=!1:S()});const e=N(null);ee(async()=>{S()}),l.versions||(n.currentVersion=1);async function S(){try{e.value=null;var a=await Qe(p,n.currentVersion,b);a.timeline=await te(a),e.value=B(a),a&&!n.currentVersion&&(n.currentVersion=a.versions[a.versions.length-1])}catch(t){console.error("Failed to fetch user profile data:",t)}}async function g(a){try{return await We(a)}catch(t){console.error("Failed to fetch arcade data:",t)}}var k=[{label:"Register Date",type:String,span:"md:col-span-2",key:"first_play_timestamp"},{label:"Last Play",type:String,span:"md:col-span-2",key:"last_play_timestamp"},{label:"First Arcade",type:String,span:"md:col-span-2",key:"first_play_arcade"},{label:"Last Arcade",type:String,span:"md:col-span-2",key:"last_play_arcade"},{label:"Total Plays",type:Number,key:"total_plays"},{label:"EXP",type:Number,key:"exp"},{label:"SP Plays",type:Number,key:"single_plays"},{label:"DP Plays",type:Number,key:"double_plays"},{label:"SP DJPOINT",type:Number,key:"single_dj_points"},{label:"DP DJPOINT",type:Number,key:"double_dj_points"}];function D(){return n.currentVersion?`${o}/games/${l.id}/card/${n.currentVersion}.webp`:l.cardBG}function A(){var a;return n.currentVersion&&((a=l.videoTable)==null?void 0:a.includes(n.currentVersion))?`https://cdn.phaseii.network/file/PhaseII/game-assets/video/${l.id}/${n.currentVersion}.mp4`:null}function $(){var a;return(a=l.videoTable)!=null&&a.includes(n.currentVersion)?null:`
      background-image: url('${D()}');
      background-size: cover;
      background-repeat: no-repeat;
    `}function T(a,t){if(t){if(a.isSkill&&t.jubility)return ce(t.jubility);if(a.isJubility&&t.records.skill)return Q(t.records.skill)}return""}function j(a){var t=[];for(const P of l.versions)a.includes(P.id)&&t.push(P);return t}function L(a,t){return a.isSkill?t.stats[a.key]/100:a.isJubility?t.stats[a.key]/10:t.stats[a.key]}function B(a){if(a.stats){if(a.stats.first_play_timestamp){const t=new Date(a.stats.first_play_timestamp*1e3);a.stats.first_play_timestamp=t.toLocaleString()}if(a.stats.last_play_timestamp){const t=new Date(a.stats.last_play_timestamp*1e3);a.stats.last_play_timestamp=t.toLocaleString()}a.dp&&a.dp.dan!==void 0&&(a.dp.dan=se(a.dp.dan).short)}return a}function U(a){var P;const t=(P=a.stats)==null?void 0:P.count;return t?[t.mfc!=null?{label:"MFCs",value:t.mfc}:0,t.pfc!=null?{label:"PFCs",value:t.pfc}:0,t.fc!=null?{label:"GFCs",value:t.fc}:0,t.gfc!=null?{label:"FCs",value:t.gfc}:0,t.life4!=null?{label:"Life-4 Clears",value:t.life4}:0]:[]}async function te(a){const t=a==null?void 0:a.stats,P=t==null?void 0:t.first_play_timestamp,F=t==null?void 0:t.last_play_timestamp,z=t==null?void 0:t.arcade_history,O=[];if(P&&O.push({timestamp:new Date(P*1e3).toLocaleString(),arcade:t==null?void 0:t.first_play_arcade,first_play:!0}),z)for(const[J,E]of Object.entries(z)){const K=await g(J);for(const[X,Y]of Object.entries(E))for(const q of Y){const Z=new Date(q*1e3);[P,F].includes(q)||O.push({timestamp:Z.toLocaleString(),arcade:K.name,machineId:X,first_play:!1})}}return F&&O.push({timestamp:new Date(F*1e3).toLocaleString(),arcade:t==null?void 0:t.last_play_arcade,first_play:!1}),O.sort((J,E)=>new Date(J.timestamp).getTime()-new Date(E.timestamp).getTime())}return(a,t)=>(r(),y(qe,null,{default:v(()=>[e.value?(r(),y(Ie,{key:0},{default:v(()=>{var P,F,z,O,J,E,K,X,Y,q,Z;return[u("div",kt,[m(le,{icon:i(Le),href:`/#/games/${i(p)}`,class:"w-full md:w-auto",color:"info",label:`${i(l).shortName?i(l).shortName:i(l).name} Home`},null,8,["icon","href","label"]),i(l).versions&&e.value?(r(),x("div",wt,[t[1]||(t[1]=u("h2",{class:"text-md sm:text-lg md:text-xl font-bold p-2"}," Select Version ",-1)),m(Xe,{modelValue:n.currentVersion,"onUpdate:modelValue":t[0]||(t[0]=_=>n.currentVersion=_),options:j(e.value.versions)},null,8,["modelValue","options"])])):c("",!0)]),m(G,{icon:i(Be),title:"View Profile",main:""},null,8,["icon"]),n.currentVersion&&e.value?(r(),x("div",{key:0,style:Fe($()),class:"rounded-2xl mb-6 card-container"},[u("video",{autoplay:"",muted:"",loop:"",playsinline:"",src:A(),class:"background-video"},null,8,xt),u("div",St,[u("div",Dt,[m(Ke,{"use-small":"",game:i(p),version:n.currentVersion,profile:e.value},{default:v(()=>[u("div",Pt,[m(le,{href:`/#/games/${i(p)}/scores/${e.value.userId}`,icon:i(Oe),class:"w-full md:w-auto",color:"info",label:"View Scores"},null,8,["href","icon"]),m(le,{href:`/#/games/${i(p)}/records/${e.value.userId}`,icon:i(Re),class:"w-full md:w-auto",color:"info",label:"View Records"},null,8,["href","icon"])])]),_:1},8,["game","version","profile"])])])],4)):c("",!0),u("div",Ct,[(r(!0),x(V,null,W(i(k),_=>(r(),x(V,{key:_},[e.value.stats[_.key]?(r(),y(C,{key:0,class:Je(_.span),label:_.label,number:_.type==Number?L(_,e.value):null,"num-color":T(_)},{default:v(()=>[R(w(_.type==String?e.value.stats[_.key]:null),1)]),_:2},1032,["class","label","number","num-color"])):c("",!0)],64))),128)),(F=(P=e.value.stats)==null?void 0:P.count)!=null&&F.records?(r(),y(C,{key:0,label:"Records",number:(O=(z=e.value.stats)==null?void 0:z.count)==null?void 0:O.records},null,8,["number"])):c("",!0),(E=(J=e.value.stats)==null?void 0:J.count)!=null&&E.attempts?(r(),y(C,{key:1,label:"Attempts",number:(X=(K=e.value.stats)==null?void 0:K.count)==null?void 0:X.attempts},null,8,["number"])):c("",!0),e.value.skill?(r(),y(C,{key:2,label:"Skill Points",number:e.value.skill/100,"num-color":i(ce)(e.value.skill)},null,8,["number","num-color"])):c("",!0),e.value.profile_skill?(r(),y(C,{key:3,label:"Skill Level"},{default:v(()=>[R(w(e.value.profile_skill/100),1)]),_:1})):c("",!0),e.value.jubility?(r(),y(C,{key:4,label:"Jubility","num-color":i(Q)(e.value.jubility)},{default:v(()=>[R(w(e.value.jubility/10),1)]),_:1},8,["num-color"])):c("",!0),e.value.pick_up_jubility?(r(),y(C,{key:5,label:"Pick-Up Jubility","num-color":i(Q)(e.value.pick_up_jubility)},{default:v(()=>[R(w(e.value.pick_up_jubility/10),1)]),_:1},8,["num-color"])):c("",!0),e.value.common_jubility?(r(),y(C,{key:6,label:"Common Jubility","num-color":i(Q)(e.value.common_jubility)},{default:v(()=>[R(w(e.value.common_jubility/10),1)]),_:1},8,["num-color"])):c("",!0),e.value.deller?(r(),y(C,{key:7,label:"Deller",number:e.value.deller},null,8,["number"])):c("",!0),e.value.sgrade?(r(),y(C,{key:8,label:"SP DAN"},{default:v(()=>[R(w(i(se)(e.value.sgrade).label),1)]),_:1})):c("",!0),e.value.dgrade?(r(),y(C,{key:9,label:"DP DAN"},{default:v(()=>[R(w(i(se)(e.value.dgrade).label),1)]),_:1})):c("",!0)]),(Y=e.value.stats)!=null&&Y.count?(r(),x(V,{key:1},[m(G,{icon:i(Ee),title:"Stats",main:""},null,8,["icon"]),u("div",$t,[(r(!0),x(V,null,W(U(e.value),_=>(r(),x(V,{key:_},[_?(r(),y(C,{key:0,label:_.label,number:_},null,8,["label","number"])):c("",!0)],64))),128))])],64)):c("",!0),e.value.jubility?(r(),x(V,{key:2},[m(G,{icon:i(Ge),title:"Jubility Breakdown",main:""},null,8,["icon"]),u("div",Vt,[e.value.pick_up_breakdown?(r(),y(I,{key:0},{default:v(()=>[m(H,{label:"Pick-Up",color:"info"}),m(de,{"jubility-data":e.value.pick_up_breakdown,",":"",version:n.currentVersion},null,8,["jubility-data","version"])]),_:1})):c("",!0),e.value.other_breakdown?(r(),y(I,{key:1},{default:v(()=>[m(H,{label:"Common",color:"info"}),m(de,{"jubility-data":e.value.other_breakdown,",":"",version:n.currentVersion},null,8,["jubility-data","version"])]),_:1})):c("",!0)])],64)):c("",!0),(q=e.value)!=null&&q.trbitem?(r(),x(V,{key:3},[m(G,{icon:i(Me),title:"Sticker Board",main:""},null,8,["icon"]),u("div",jt,[m(I,{class:"w-full grid place-content-center"},{default:v(()=>[m(Ye,{version:n.currentVersion,profile:e.value,size:290},null,8,["version","profile"])]),_:1})])],64)):c("",!0),i(l).id==i(He).IIDX&&n.currentVersion>=29?(r(),x(V,{key:4},[m(G,{icon:i(Ue),title:"Notes Radar",main:""},null,8,["icon"]),m(ht,{game:i(l).id,version:n.currentVersion,profile:i(b)},null,8,["game","version","profile"])],64)):c("",!0),(Z=e.value)!=null&&Z.timeline?(r(),x(V,{key:5},[m(G,{icon:i(ze),title:"Timeline",main:""},null,8,["icon"]),u("div",At,[m(I,null,{default:v(()=>{var _;return[u("ol",Tt,[(r(!0),x(V,null,W(JSON.parse(JSON.stringify((_=e.value)==null?void 0:_.timeline)).reverse(),ae=>(r(),x("li",{key:ae.timestamp,class:"md:inline-block flex-shrink-0"},[u("div",Nt,[t[2]||(t[2]=u("div",{class:"-ms-[6px] me-3 h-[12px] w-[12px] md:w-0.5 md:h-4 rounded-full md:rounded-none bg-gray-300 md:-mt-6 md:me-0 md:ms-0"},null,-1)),u("p",It,w(ae.timestamp),1)]),u("div",Lt,[u("h4",Bt,w(ae.arcade),1)])]))),128))])]}),_:1})])],64)):c("",!0)]}),_:1})):c("",!0)]),_:1}))}};export{Ut as default};
