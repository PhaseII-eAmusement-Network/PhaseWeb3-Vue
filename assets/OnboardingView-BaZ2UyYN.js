import{b as x,a as R,s as k,r as j,c as m,e as c,w as i,f as l,_ as q,k as o,P as F,i as f,ar as G,j as V,g as h,Q as C,as as A,n as I,D as U,at as T,au as z,av as Q,y as H,l as J,F as K,m as W,t as P,q as X}from"./index-BLNUJ2NM.js";import{_ as s}from"./FormField-DvuyRx6-.js";import{_ as u}from"./FormCheckRadio-DYx8yVAH.js";import{_ as v}from"./FormControl-C432udtk.js";import{c as Y,a as Z,b as ee}from"./admin-BOwxU-p3.js";import{g as $}from"./pcbid-CIkJuo1f.js";const N=x();async function ae(w,b){try{return await N.callApi(`/discord/exportVPN/${w}?discordId=${b}`)}catch(r){throw console.log("Error exporting vpn:",r),r}}async function ne(w,b){try{return await N.callApi(`/discord/onboardArcade/${w}?discordId=${b}`)}catch(r){throw console.log("Error onboarding arcade:",r),r}}const le={class:"grid grid-cols-1 gap-6"},te={class:"mb-4 flex gap-2 items-stretch"},ie={class:"grid grid-cols-1 w-full gap-2 md:gap-6 md:flex md:place-content-stretch"},oe={class:"grid md:grid-cols-2 gap-6"},se={class:"grid grid-cols-1 w-full gap-2 md:gap-6 md:flex md:place-content-stretch pb-4 md:pb-0"},de={class:"grid gap-4"},re={class:"flex justify-between items-center"},ue={class:"m-[-5px]"},ce={class:"text-md font-bold"},me={class:"text-sm"},pe={class:"text-sm font-mono"},fe={class:"grid md:flex gap-4"},Ve={__name:"OnboardingView",setup(w){const b=R(),r=x(),D={name:"",useDiscord:!0,discordId:"",description:"",paseli:!0,infinitePaseli:!0,maintenance:!1,betas:!1,incognito:!1,machineList:[]},y={name:"",cabinet:!1,ota:!1,generatePCBID:!0,PCBID:""},n=k({...D}),t=k({...y}),_=j(void 0);async function E(){for(t.generatePCBID&&(t.PCBID=$());!await Z(t.PCBID);)if(t.generatePCBID)t.PCBID=$();else{window.alert("PCBID already in use!");return}n.machineList.push({name:t.name,cabinet:t.cabinet,ota:t.ota,PCBID:t.PCBID.toUpperCase()}),Object.assign(t,y)}function M(d){n.machineList=n.machineList.filter(e=>e.PCBID!==d)}async function L(){if(n.name){const d=await Y(n.name);d.unused!=null&&(_.value=d.unused)}}function O(d,e="NA_"){var a=[...d].map(g=>g.charCodeAt(0)<128?g:e).join("");return a=a.replace(/[!"#$%&'()*+,-./:;<=>?@[\\\]^_`{|}~]/g,""),a=a.replace(/\s+/g,"_"),a}async function S(d,e){try{const a=await r.getArcadeVPN(d),g=new Blob([a],{type:"application/ovpn"}),p=document.createElement("a");p.href=URL.createObjectURL(g),p.download=`gradius-${O(e.name)}-phaseii-config.ovpn`,document.body.appendChild(p),p.click(),URL.revokeObjectURL(p.href),document.body.removeChild(p)}catch(a){console.log("Failed to fetch arcade data:",a)}}async function B(d){if(n.name==D.name){window.alert("Please input a name.");return}if(n.discordId==D.discordId&&n.useDiscord&&d){window.alert("Please input a Discord ID.");return}if(n.description==D.description&&!n.useDiscord){window.alert("Please input a description.");return}const e=await ee(n);d&&e.arcadeId&&(n.useDiscord?(await ne(e.arcadeId,n.discordId),await ae(e.arcadeId,n.discordId)):await S(e.arcadeId,n)),e.arcadeId?(window.alert("Onboarding complete!"),b.push({name:"arcade",params:{id:e.arcadeId}})):window.alert("Failed to onboard!")}return(d,e)=>(c(),m(X,null,{default:i(()=>[l(q,null,{default:i(()=>[l(F,{icon:f(G),title:"Arcade Onboarding",color:"text-green-400",main:""},null,8,["icon"]),o("div",le,[l(V,{"is-form":"",class:"row-span-1"},{default:i(()=>[l(C,{color:"info",label:"General Information",icon:f(A),class:"mb-2"},null,8,["icon"]),l(s,{label:"Arcade Name"},{default:i(()=>[l(v,{modelValue:n.name,"onUpdate:modelValue":e[0]||(e[0]=a=>n.name=a),"input-value":n.name,name:"arcadeName",required:""},null,8,["modelValue","input-value"])]),_:1}),o("div",te,[l(I,{color:"info",label:"Check Name",onClick:e[1]||(e[1]=a=>L())}),_.value==!0?(c(),m(U,{key:0,path:f(T),color:"text-green-400",size:"25"},null,8,["path"])):_.value==!1?(c(),m(U,{key:1,path:f(z),color:"text-red-400",size:"25"},null,8,["path"])):h("",!0)]),l(s,{label:"Use Discord",help:"Automated provisioning rather than manual. BadManiac will DM the user via Discord."},{default:i(()=>[l(u,{modelValue:n.useDiscord,"onUpdate:modelValue":e[2]||(e[2]=a=>n.useDiscord=a),"input-value":n.useDiscord,name:"useDiscord",type:"switch"},null,8,["modelValue","input-value"])]),_:1}),n.useDiscord?(c(),m(s,{key:0,label:"Discord ID",help:"Owner's Discord User ID."},{default:i(()=>[l(v,{modelValue:n.discordId,"onUpdate:modelValue":e[3]||(e[3]=a=>n.discordId=a),"input-value":n.discordId,name:"discordId",required:""},null,8,["modelValue","input-value"])]),_:1})):h("",!0),n.useDiscord?h("",!0):(c(),m(s,{key:1,label:"Description",help:"Manual description rather than automated."},{default:i(()=>[l(v,{modelValue:n.description,"onUpdate:modelValue":e[4]||(e[4]=a=>n.description=a),name:"description",required:""},null,8,["modelValue"])]),_:1}))]),_:1}),l(V,{"is-form":"",class:"row-span-1"},{default:i(()=>[l(C,{color:"info",label:"Settings",icon:f(Q),class:"mb-2"},null,8,["icon"]),o("div",ie,[l(s,{label:"PASELI Enabled",help:"Enable or disable PASELI services."},{default:i(()=>[l(u,{modelValue:n.paseli,"onUpdate:modelValue":e[5]||(e[5]=a=>n.paseli=a),"input-value":n.paseli,name:"paseli",type:"switch"},null,8,["modelValue","input-value"])]),_:1}),l(s,{label:"Infinite PASELI",help:"Enable or disable infinite PASELI."},{default:i(()=>[l(u,{modelValue:n.infinitePaseli,"onUpdate:modelValue":e[6]||(e[6]=a=>n.infinitePaseli=a),"input-value":n.infinitePaseli,name:"infinitePaseli",type:"switch"},null,8,["modelValue","input-value"])]),_:1}),l(s,{label:"Maintenance Mode",help:"Place this arcade under Maintenance."},{default:i(()=>[l(u,{modelValue:n.maintenance,"onUpdate:modelValue":e[7]||(e[7]=a=>n.maintenance=a),"input-value":n.maintenance,name:"maintenance",type:"switch"},null,8,["modelValue","input-value"])]),_:1}),l(s,{label:"Incognito Mode",help:"Hide the eAmusement network and ranking data."},{default:i(()=>[l(u,{modelValue:n.incognito,"onUpdate:modelValue":e[8]||(e[8]=a=>n.incognito=a),"input-value":n.incognito,name:"incognito",type:"switch"},null,8,["modelValue","input-value"])]),_:1}),l(s,{label:"Beta Testing",help:"Enable or disable beta testing."},{default:i(()=>[l(u,{modelValue:n.betas,"onUpdate:modelValue":e[9]||(e[9]=a=>n.betas=a),"input-value":n.betas,name:"betas",type:"switch"},null,8,["modelValue","input-value"])]),_:1})])]),_:1}),l(V,{class:"row-span-1"},{default:i(()=>[l(C,{color:"info",label:"Machines",icon:f(A),class:"mb-2"},null,8,["icon"]),o("div",oe,[o("form",{class:"h-full",onSubmit:e[15]||(e[15]=H(a=>E(),["prevent"]))},[l(s,{label:"Generate PCBID",help:"Generate a PCBID rather than supply one."},{default:i(()=>[l(u,{modelValue:t.generatePCBID,"onUpdate:modelValue":e[10]||(e[10]=a=>t.generatePCBID=a),"input-value":t.generatePCBID,name:"generatePCBID",type:"switch"},null,8,["modelValue","input-value"])]),_:1}),t.generatePCBID?h("",!0):(c(),m(s,{key:0,label:"PCBID"},{default:i(()=>[l(v,{modelValue:t.PCBID,"onUpdate:modelValue":e[11]||(e[11]=a=>t.PCBID=a),name:"pcbid",required:"",minlength:"20",maxlength:"20"},null,8,["modelValue"])]),_:1})),l(s,{label:"Name"},{default:i(()=>[l(v,{modelValue:t.name,"onUpdate:modelValue":e[12]||(e[12]=a=>t.name=a),name:"name",required:""},null,8,["modelValue"])]),_:1}),o("div",se,[l(s,{label:"Arcade Cabinet",help:"If this is a real cabinet, enable this."},{default:i(()=>[l(u,{modelValue:t.cabinet,"onUpdate:modelValue":e[13]||(e[13]=a=>t.cabinet=a),"input-value":t.cabinet,name:"cabinet",type:"switch"},null,8,["modelValue","input-value"])]),_:1}),l(s,{label:"Enable Updates",help:"Enables or disables OTA updates."},{default:i(()=>[l(u,{modelValue:t.ota,"onUpdate:modelValue":e[14]||(e[14]=a=>t.ota=a),"input-value":t.ota,name:"ota",type:"switch"},null,8,["modelValue","input-value"])]),_:1})]),l(I,{color:"success",type:"submit",label:"Add Machine"})],32),o("div",null,[l(C,{color:"warning",label:"Queue",class:"mb-4"}),o("div",de,[(c(!0),J(K,null,W(n.machineList,a=>(c(),m(V,{key:a.name,"color-prop":"bg-slate-800 dark:bg-slate-800"},{default:i(()=>[o("div",re,[o("div",ue,[o("h1",ce,P(a.name),1),o("h2",me,P(a.cabinet?"Cabinet":"Setup")+P(a.ota?" - OTA Enabled":null),1),o("h2",pe,P(a.PCBID!=""?a.PCBID:"not generated"),1)]),l(I,{color:"danger",label:"Remove",onClick:g=>M(a.PCBID)},null,8,["onClick"])])]),_:2},1024))),128))])])])]),_:1}),o("div",fe,[l(I,{type:"submit",color:"success",label:n.useDiscord?"Create Arcade with Discord":"Create Arcade and VPN",small:!1,onClick:e[16]||(e[16]=a=>B(!0))},null,8,["label"]),l(I,{type:"submit",color:"info",label:"Create Arcade",small:!1,onClick:e[17]||(e[17]=a=>B(!1))})])])]),_:1})]),_:1}))}};export{Ve as default};
