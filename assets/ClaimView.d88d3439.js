import{a3 as E,r as f,o as T,g as m,c as d,e as y,w as i,f as a,_ as S,j as o,a4 as F,t as $,i as X,a5 as z,n as h,s as A,V as B,k as I,W as P,a6 as N,x as L,H as j,Q as G,a2 as q,z as J,F as O,U as D,l as R,a7 as H,A as Q,p as W,q as Z}from"./index.6f72409c.js";import{_ as V}from"./FormField.07b75ccb.js";import{_ as U}from"./FormControl.0af86766.js";import{_ as K}from"./FormCheckRadio.e8eca3e4.js";import{A as Y}from"./profile.029d9e92.js";import{j as ee,k as ae}from"./account.71083498.js";const te={class:"grid grid-cols-1 gap-3"},le={class:"flex gap-4 items-center"},se={class:"text-2xl"},ne={class:"font-light text-xl"},oe={class:"space-x-2 mt-6"},re={__name:"MergeModal",props:{userId:{type:Number,default:null},game:{type:String,default:null},settings:{type:Object,default:null}},emits:["saveMerge","closeModal"],setup(M,{emit:g}){var b,w;const n=M,c=g,s=E(n.game),u=f({}),r=f((w=(b=n.settings)==null?void 0:b.scores)!=null?w:!1);T(async()=>{const x=await Y(n.game,null,n.userId);u.value=x});function k(){c("saveMerge",{game:n.game,scores:r.value})}return(x,p)=>m(s)&&u.value?(d(),y(z,{key:0,transparent:"",onOverlayClick:p[1]||(p[1]=v=>c("closeModal"))},{default:i(()=>[a(S,{class:"shadow-lg max-h-modal w-11/12 md:w-3/5 lg:w-2/5 xl:w-4/12 z-50 text-white/90"},{default:i(()=>{var v,C;return[o("div",te,[o("div",le,[a(F,{path:m(s).icon},null,8,["path"]),o("h1",se,$(m(s).name),1)]),o("div",null,[o("h2",ne,$(u.value.name)+" - "+$((C=(v=u.value.stats)==null?void 0:v.total_plays)!=null?C:0)+" Plays ",1)]),a(V,{label:"Scores",help:"Transfer all scores from this account to yours. This will not erase your current scores."},{default:i(()=>[a(K,{modelValue:r.value,"onUpdate:modelValue":p[0]||(p[0]=l=>r.value=l),name:"scores","input-value":r.value,type:"switch"},null,8,["modelValue","input-value"])]),_:1}),o("div",oe,[a(X,{color:"success",label:"Save",onClick:k})])])]}),_:1})]),_:1})):h("",!0)}},ie={key:1},ue={class:"grid grid-cols-1 md:grid-cols-2 2xl:grid-cols-4 gap-4"},ce={class:"mt-4"},_e={__name:"ClaimView",setup(M){const g=f(!1),n=f(null),c=f(!1),s=A({cardId:null,pin:null}),u=f({game:null,scores:!1}),r=A({});function k(l){var e=l.target.value;e=e.replace(/[^A-Za-z0-9]/g,""),e=e.toUpperCase().replace(/(.{4})/g,"$1-").replace(/-$/,""),s.cardId=e}function b(l){l.target.value=l.target.value.replace(/\D/g,"")}async function w(){g.value=!0,n.value=await ae(s.cardId,s.pin),g.value=!1}function x(l){c.value=!1,u.value.game=l,c.value=!0}function p(l){var e=[];for(const t of l){const _=E(t.game);_&&!_.skip&&e.push(t)}return e.sort(function(t,_){return _.data.last_play_timestamp-t.data.last_play_timestamp}),e}function v({game:l,scores:e}){r[l]={scores:e},c.value=!1,u.value={game:null,scores:!1,data:!1}}async function C(){await ee(s.cardId,s.pin,r)||window.alert("Failed to merge!")}return(l,e)=>(d(),y(Z,null,{default:i(()=>[a(W,null,{default:i(()=>[a(B,{class:"mb-6","use-small":"","even-smaller":""}),n.value?h("",!0):(d(),I(O,{key:0},[a(P,{icon:m(N),title:"Claim a Profile",main:""},null,8,["icon"]),a(S,{"is-form":"",class:"row-span-2 mb-6",onSubmit:e[2]||(e[2]=L(t=>w(),["prevent"]))},{footer:i(()=>[a(X,{type:"submit",color:"success",label:"Start Claim"}),g.value?(d(),y(j,{key:0,path:m(G),color:"text-yellow-500",class:"animate animate-spin"},null,8,["path"])):h("",!0)]),default:i(()=>[e[4]||(e[4]=o("h2",{class:"text-xl mb-6 lg:w-1/2"}," If you registered a card in game and need to claim it, you may do so here. Please note that the account cannot already be claimed! ",-1)),a(V,{label:"Card ID",help:"The 16 character ACCESS CODE. If your card is dated after 2016, you'll need to get the ACCESS CODE from a game."},{default:i(()=>[a(U,{modelValue:s.cardId,"onUpdate:modelValue":e[0]||(e[0]=t=>s.cardId=t),icon:m(q),name:"cardId",type:"card",placeholder:"XXXX-XXXX-XXXX-XXXX",minlength:19,maxlength:19,required:"",onInput:k},null,8,["modelValue","icon"])]),_:1}),a(V,{label:"PIN",help:"Used when logging into a game"},{default:i(()=>[a(U,{modelValue:s.pin,"onUpdate:modelValue":e[1]||(e[1]=t=>s.pin=t),icon:m(J),type:"password",name:"pin",minlength:4,maxlength:4,inputmode:"numeric",pattern:"\\d{4}",autocomplete:"pin",onInput:b},null,8,["modelValue","icon"])]),_:1})]),_:1})],64)),n.value?(d(),I("div",ie,[a(P,{icon:m(N),title:"Select Profiles to Merge",main:""},null,8,["icon"]),a(S,null,{default:i(()=>[e[5]||(e[5]=o("h2",{class:"text-xl mb-6"},[D(" Click a game to view merge options. "),o("br"),D(" Please note that this cannot be undone once complete. ")],-1)),o("div",ue,[(d(!0),I(O,null,R(p(n.value.profiles),t=>(d(),y(H,{key:t.game,game:t.game,value:t.data.total_plays,"profile-name":"",type:"plays",class:Q(r[t.game]?"border-green-800 border-[3px]":null),"disable-local-click":"",onClick:_=>x(t.game)},null,8,["game","value","class","onClick"]))),128))]),o("div",ce,[a(X,{color:"success",label:"Start Merge",disabled:JSON.stringify(r)==JSON.stringify({}),onClick:C},null,8,["disabled"])])]),_:1})])):h("",!0),c.value?(d(),y(re,{key:2,game:u.value.game,"user-id":n.value.userId,settings:r[u.value.game],onSaveMerge:v,onCloseModal:e[3]||(e[3]=t=>c.value=!1)},null,8,["game","user-id","settings"])):h("",!0)]),_:1})]),_:1}))}};export{_e as default};
