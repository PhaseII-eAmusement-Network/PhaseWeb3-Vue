import{a as k,b as B,p as D,M as G,a7 as R,r as g,o as C,c as F,d as m,w as c,e as o,_ as L,g as d,j as y,f as x,i as f,P as M,b6 as N,h as j,n as E}from"./index-CHivKhhP.js";import{_ as H}from"./GameHeader-CbS6z4E_.js";import{_ as S}from"./FormControl-BLuW9GWW.js";import{_ as T}from"./ProfileCard-D5atgNuu.js";import{_ as U}from"./GeneralTable-Dm8yzA2j.js";import{a as X,A as q}from"./profile-LMvWxmH8.js";import{d as z}from"./userData-DZYdegtD.js";import{g as w}from"./danClass-NuRM5DAU.js";import"./sources-0lyug9Pk.js";const J={key:0,class:"w-full md:flex md:-mt-[75px] mb-4 place-content-end"},K={class:"md:w-1/3 md:text-right"},O={key:1,class:"w-full"},Q={class:"bg-white dark:bg-slate-900/95 rounded-2xl lg:flex lg:justify-between"},W={class:"w-full"},ue={__name:"GameView",setup(Y){const V=k(),p=B();var l=null,a=null;const r=D({currentVersion:null});G(()=>r.currentVersion,()=>{v()}),l=V.params.id,a=R(l),a==null&&p.push({name:"ErrorPage",params:{catchAll:"404"}});const n=g(null),_=g([]);C(async()=>{try{const s=await X(l);_.value=$(s)}catch(s){console.error("Failed to fetch profile data:",s)}v()}),a.versions||(r.currentVersion=1);async function v(){try{n.value=null;const s=await q(l,r.currentVersion);n.value=s,s&&!r.currentVersion&&(r.currentVersion=s.versions[s.versions.length-1])}catch(s){console.error("Failed to fetch user profile data:",s)}}const i=[];if(i.push({text:"Player",value:"username",sortable:!0,width:120}),a.noRivals||i.push({text:"Rival ID",value:"extid",width:100}),i.push({text:"Last Play",value:"stats.last_play_timestamp",width:150},{text:"Last Arcade",value:"stats.last_play_arcade",width:150},{text:"Plays",value:"stats.total_plays",sortable:!0,width:50}),a.playerHeaders)for(var P of a.playerHeaders)i.push(P);function $(s){var t=[];for(var e of s){if(e.extid&&(e.extid=z(e.extid)),e.stats){if(e.stats.last_play_timestamp){const u=new Date(e.stats.last_play_timestamp*1e3);e.stats.last_play_timestamp=u.toLocaleString()}e.sgrade&&(e.sgrade=w(e.sgrade).short),e.dgrade&&(e.dgrade=w(e.dgrade).short)}t.push(e)}return t.sort((u,h)=>{const A=u.stats&&u.stats.total_plays||0;return(h.stats&&h.stats.total_plays||0)-A}),t}function I(s){var t=[];for(const e of a.versions)s.includes(e.id)&&t.push(e);return t}const b=s=>{const t=s.userId;p.push(`/games/${l}/profiles/${t}`)};return(s,t)=>(m(),F(E,null,{default:c(()=>[o(L,null,{default:c(()=>[o(H,{game:d(a),version:r.currentVersion},{default:c(()=>[d(a).versions&&n.value?(m(),y("div",J,[f("div",K,[t[1]||(t[1]=f("h2",{class:"text-md sm:text-lg md:text-xl font-bold p-2"}," Select Version ",-1)),o(S,{modelValue:r.currentVersion,"onUpdate:modelValue":t[0]||(t[0]=e=>r.currentVersion=e),options:I(n.value.versions)},null,8,["modelValue","options"])])])):x("",!0),n.value?(m(),y("div",O,[o(T,{game:d(l),version:r.currentVersion,profile:n.value,"use-small":""},null,8,["game","version","profile"])])):x("",!0)]),_:1},8,["game","version"]),o(M,{icon:d(N),title:"All Players",main:""},null,8,["icon"]),o(j,{"has-table":""},{default:c(()=>[f("div",Q,[f("div",W,[o(U,{headers:i,items:_.value,onRowClicked:b},null,8,["items"])])])]),_:1})]),_:1})]),_:1}))}};export{ue as default};
