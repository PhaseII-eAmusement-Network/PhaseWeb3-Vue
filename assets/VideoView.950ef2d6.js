import{b as T,r as S,o as U,c as m,e as D,w as f,f as n,V as G,k as _,W as V,g as $,ac as M,_ as C,j as o,U as O,t as r,Y as P,i as B,F as E,n as F,ad as Y,p as j,q as L,a5 as q}from"./index.da95f725.js";import{_ as J}from"./GeneralTable.c1828ee6.js";import{m as R}from"./account.c1a42644.js";const W=T();async function z(v,a,p=null,x=!1){try{return(await W.callApi(`/music?game=${v}&version=${a}`+(x?"&oneChart=true":""),"GET",null,{songIds:p.toString()})).data}catch(d){throw console.log("Error fetching music data:",d),d}}const H={key:0,class:"grid grid-cols-1 md:grid-cols-2 gap-4"},K={controls:"",class:"mt-3 rounded-xl w-[640px] xl:w-[1280px]"},Q=["src"],X={class:"text-center md:text-left grid grid-cols-1 place-content-start gap-6"},Z={class:"space-y-2"},tt={class:"text-2xl xl:text-4xl font-bold"},et={class:"text-xl xl:text-3xl font-semibold"},at={class:"text-xl xl:text-2xl font-light"},st={key:1},ot={class:"space-y-1 text-center"},lt={class:"text-xl xl:text-xl"},it={class:"bg-white dark:bg-slate-900/95 rounded-2xl lg:flex lg:justify-between"},nt={class:"w-full"},mt={__name:"VideoView",setup(v){const a=S([]),p=S(!1),x=[{text:"Timestamp",value:"timestamp",sortable:!0,width:120},{text:"Song",value:"name",sortable:!0,width:120},{text:"Artist",value:"artist",sortable:!0,width:120},{text:"Game",value:"game",sortable:!0,width:120},{text:"Version",value:"version",sortable:!0,width:120},{text:"Status",value:"data.status",sortable:!0,width:120}];async function d(){a.value=null;try{const s=await R();a.value=N(JSON.parse(JSON.stringify(s)));const t=[...new Set(a.value.map(e=>e.musicid))];if(t.length>0){const e=await z("iidx",s[0].version,t,!0),i=Object.fromEntries(e.map(l=>[l.id,l]));a.value=a.value.map(l=>{var c,u;return{...l,name:((c=i[l.musicid])==null?void 0:c.name)||"Unknown Song",artist:((u=i[l.musicid])==null?void 0:u.artist)||"Unknown Artist"}})}}catch(s){console.error("Failed to fetch video data:",s)}p.value=!1}U(async()=>{await d()});function N(s){var t;s.sort(function(e,i){return i.timestamp-e.timestamp});for(const e of s){const i=q(e.game);if(e.game=i.name,e.version=(t=i.versions.find(l=>l.id==e.version).label)!=null?t:0,e.timestamp){const l=new Date(e.timestamp*1e3);e.timestamp=l.toLocaleString()}}return s}const A=s=>{var t,e;(t=s.data)!=null&&t.url&&(s=(e=s.data)==null?void 0:e.url),navigator.clipboard.writeText(s).then(()=>{alert("Copied URL to clipboard!")}).catch(()=>{alert("Failed to copy to clipboard!")})};function I(s){var t;window.open((t=s.data)==null?void 0:t.url,"_blank").focus()}return(s,t)=>(m(),D(L,null,{default:f(()=>[n(j,null,{default:f(()=>[n(G,{class:"mb-6","use-small":"","even-smaller":""}),a.value[0]?(m(),_(E,{key:0},[n(V,{icon:$(M),title:"Your Latest Upload",main:""},null,8,["icon"]),n(C,{class:"mb-6"},{default:f(()=>{var e,i,l,c,u,g,h,w,b;return[((i=(e=a.value[0])==null?void 0:e.data)==null?void 0:i.status)=="uploaded"?(m(),_("div",H,[o("video",K,[o("source",{src:(c=(l=a.value[0])==null?void 0:l.data)==null?void 0:c.url,type:"video/mp4"},null,8,Q),t[1]||(t[1]=O(" Your browser does not support the video tag. "))]),o("div",X,[o("div",Z,[o("div",null,[o("h1",tt,r((u=a.value[0])==null?void 0:u.name),1),o("h1",et,r((g=a.value[0])==null?void 0:g.artist),1)]),n(P,{class:"mx-1"}),o("h2",at,r((h=a.value[0])==null?void 0:h.game)+" "+r((w=a.value[0])==null?void 0:w.version),1),o("p",null,r((b=a.value[0])==null?void 0:b.timestamp),1)]),o("div",null,[n(B,{color:"info",label:"Share",onClick:t[0]||(t[0]=rt=>{var y,k;return A((k=(y=a.value[0])==null?void 0:y.data)==null?void 0:k.url)})})])])])):(m(),_("div",st,[o("div",ot,[t[2]||(t[2]=o("h1",{class:"text-2xl xl:text-4xl font-bold"}," Your video is still uploading! ",-1)),t[3]||(t[3]=o("h2",{class:"text-xl xl:text-2xl font-light"}," Please wait for the upload to complete. ",-1)),o("h2",lt," Upload started at "+r(a.value[0].timestamp),1)])]))]}),_:1})],64)):F("",!0),n(V,{icon:$(Y),title:"All Play Videos",main:""},null,8,["icon"]),n(C,{"has-table":""},{default:f(()=>[o("div",it,[o("div",nt,[n(J,{headers:x,items:a.value,onRowClicked:I},null,8,["items"])])])]),_:1})]),_:1})]),_:1}))}};export{mt as default};
