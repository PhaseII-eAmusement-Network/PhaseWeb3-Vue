import{u as k,a as B,s as D,N as G,a6 as R,r as g,o as C,c as N,e as m,w as c,f as o,_ as F,i as d,l as y,g as x,k as f,P as L,b1 as j,j as E,q as H}from"./index-Y79vkHsf.js";import{_ as M}from"./GameHeader-cINe5pij.js";import{_ as S}from"./FormControl-jpMBu3sT.js";import{_ as q}from"./ProfileCard-C4yZwlRj.js";import{_ as T}from"./GeneralTable-B25ZjUz3.js";import{a as U,A as X}from"./profile-9qYjrL9A.js";import{d as z}from"./userData-DZYdegtD.js";import{g as w}from"./danClass-NuRM5DAU.js";import"./sources-DH4ucPCT.js";const J={key:0,class:"w-full md:flex md:-mt-[75px] mb-4 place-content-end"},K={class:"md:w-1/3 md:text-right"},O={key:1,class:"w-full"},Q={class:"bg-white dark:bg-slate-900/95 rounded-2xl lg:flex lg:justify-between"},W={class:"w-full"},ue={__name:"GameView",setup(Y){const V=k(),_=B();var l=null,a=null;const r=D({currentVersion:null});G(()=>r.currentVersion,()=>{v()}),l=V.params.id,a=R(l),a==null&&_.push({name:"ErrorPage",params:{catchAll:"404"}});const n=g(null),p=g([]);C(async()=>{try{const s=await U(l);p.value=$(s)}catch(s){console.error("Failed to fetch profile data:",s)}v()}),a.versions||(r.currentVersion=1);async function v(){try{n.value=null;const s=await X(l,r.currentVersion);n.value=s,s&&!r.currentVersion&&(r.currentVersion=s.versions[s.versions.length-1])}catch(s){console.error("Failed to fetch user profile data:",s)}}const i=[];if(i.push({text:"Player",value:"username",sortable:!0,width:120}),a.noRivals||i.push({text:"Rival ID",value:"extid",width:100}),i.push({text:"Last Play",value:"stats.last_play_timestamp",width:150},{text:"Last Arcade",value:"stats.last_play_arcade",width:150},{text:"Plays",value:"stats.total_plays",sortable:!0,width:50}),a.playerHeaders)for(var P of a.playerHeaders)i.push(P);function $(s){var t=[];for(var e of s){if(e.extid&&(e.extid=z(e.extid)),e.stats){if(e.stats.last_play_timestamp){const u=new Date(e.stats.last_play_timestamp*1e3);e.stats.last_play_timestamp=u.toLocaleString()}e.sgrade&&(e.sgrade=w(e.sgrade).short),e.dgrade&&(e.dgrade=w(e.dgrade).short)}t.push(e)}return t.sort((u,h)=>{const b=u.stats&&u.stats.total_plays||0;return(h.stats&&h.stats.total_plays||0)-b}),t}function I(s){var t=[];for(const e of a.versions)s.includes(e.id)&&t.push(e);return t}const A=s=>{const t=s.userId;_.push(`/games/${l}/profiles/${t}`)};return(s,t)=>(m(),N(H,null,{default:c(()=>[o(F,null,{default:c(()=>[o(M,{game:d(a),version:r.currentVersion},{default:c(()=>[d(a).versions&&n.value?(m(),y("div",J,[f("div",K,[t[1]||(t[1]=f("h2",{class:"text-md sm:text-lg md:text-xl font-bold p-2"}," Select Version ",-1)),o(S,{modelValue:r.currentVersion,"onUpdate:modelValue":t[0]||(t[0]=e=>r.currentVersion=e),options:I(n.value.versions)},null,8,["modelValue","options"])])])):x("",!0),n.value?(m(),y("div",O,[o(q,{game:d(l),version:r.currentVersion,profile:n.value,"use-small":""},null,8,["game","version","profile"])])):x("",!0)]),_:1},8,["game","version"]),o(L,{icon:d(j),title:"All Players",main:""},null,8,["icon"]),o(E,{"has-table":""},{default:c(()=>[f("div",Q,[f("div",W,[o(T,{headers:i,items:p.value,onRowClicked:A},null,8,["items"])])])]),_:1})]),_:1})]),_:1}))}};export{ue as default};
