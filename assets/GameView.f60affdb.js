import{B as C,G as L,a as i,i as f,g as n,b as c,ao as N,t as T,e as r,H as F,k as p,u as M,s as q,O as H,aj as z,r as b,o as E,c as y,w as x,f as k,ap as O,aq as U,ai as Q,Q as X,ar as J,_ as K,l as W,n as Y,p as Z,q as ee}from"./index.ed9ac360.js";import{_ as te}from"./FormControl.e1d7a7ed.js";import{_ as se}from"./ProfileCard.48fa8062.js";import{_ as ae}from"./GeneralTable.2a0e300e.js";import{d as re}from"./userData.bcc92478.js";import{g as S}from"./danClass.233b0381.js";const oe={class:"pt-6 mb-6 flex items-center justify-between"},le={class:"flex items-center justify-start space-x-2"},ne={class:"text-2xl md:text-3xl leading-tight"},ie={__name:"GameTitleLine",props:{path:{type:String,default:null},title:{type:String,required:!0}},setup(h){const v=C(()=>L().default);return(m,g)=>(i(),f("section",oe,[n("div",le,[c(N,{path:h.path,class:"w-12 h-12 p-1 drop-shadow-md"},null,8,["path"]),n("h1",ne,T(h.title),1)]),r(v)?F(m.$slots,"default",{key:0}):p("",!0)]))}},ce=["src"],ue={class:"bg-white dark:bg-slate-900/90 rounded-2xl pt-6 p-3 card-content"},de={class:"w-full"},fe={class:"md:flex md:px-5 md:space-x-10 md:justify-between md:items-center"},pe={key:0,class:"md:w-1/3 md:text-right"},me=n("h2",{class:"text-md sm:text-lg md:text-xl font-bold p-2"}," Select Version ",-1),_e={key:0,class:"w-full pt-6 pb-10"},he={key:1,class:"md:w-1/2 grid grid-cols-1 md:grid-cols-2 gap-3"},ve={class:"bg-white dark:bg-slate-900/95 rounded-2xl lg:flex lg:justify-between"},ge={class:"w-full"},Se={__name:"GameView",setup(h){const v=Z(),m=ee(),g=M();var l=null,s=null;const a=q({currentVersion:null});H(()=>a.currentVersion,()=>{V()}),l=v.params.id,s=z(l),s==null&&m.push({name:"ErrorPage",params:{catchAll:"404"}});const u=b(null),w=b([]);E(async()=>{try{const e=await g.getGameProfiles(l);w.value=G(e)}catch(e){console.error("Failed to fetch profile data:",e)}V()}),s.versions||(a.currentVersion=1);async function V(){try{u.value=null;const e=await g.getUserProfile(l,a.currentVersion);u.value=e,e&&!a.currentVersion&&(a.currentVersion=e.versions[e.versions.length-1])}catch(e){console.error("Failed to fetch user profile data:",e)}}function P(){return a.currentVersion?`/assets/games/${s.id}/card/${a.currentVersion}.webp`:s.cardBG}function B(){var e;return a.currentVersion&&((e=s.videoTable)==null?void 0:e.includes(a.currentVersion))?`https://web3.phaseii.network/gameassets/video/${s.id}/${a.currentVersion}.mp4`:null}function I(){var e;return(e=s.videoTable)!=null&&e.includes(a.currentVersion)?null:`
      background-image: url('${P()}');
      background-size: cover;
      background-repeat: no-repeat;
    `}const d=[];if(d.push({text:"Player",value:"username",sortable:!0,width:120}),s.noRivals||d.push({text:"Rival ID",value:"extid",width:100}),d.push({text:"Last Play",value:"stats.last_play_timestamp",width:150},{text:"Last Arcade",value:"stats.last_play_arcade",width:150},{text:"Plays",value:"stats.total_plays",sortable:!0,width:50}),s.playerHeaders)for(var D of s.playerHeaders)d.push(D);function G(e){var o=[];for(var t of e){if(t.extid&&(t.extid=re(t.extid)),t.stats){if(t.stats.last_play_timestamp){const _=new Date(t.stats.last_play_timestamp*1e3);t.stats.last_play_timestamp=_.toLocaleString()}t.sgrade&&(t.sgrade=S(t.sgrade).short),t.dgrade&&(t.dgrade=S(t.dgrade).short)}o.push(t)}return o.sort((_,$)=>{const A=_.stats&&_.stats.total_plays||0;return($.stats&&$.stats.total_plays||0)-A}),o}function R(e){var o=[];for(const t of s.versions)e.includes(t.id)&&o.push(t);return o}const j=e=>{const o=e.userId;m.push(`/games/${l}/profiles/${o}`)};return(e,o)=>(i(),y(Y,null,{default:x(()=>[c(W,null,{default:x(()=>[a.currentVersion&&u.value?(i(),f("div",{key:0,style:Q(I()),class:"rounded-2xl mb-6 card-container"},[n("video",{autoplay:"",muted:"",loop:"",playsinline:"",src:B(),class:"background-video"},null,8,ce),n("div",ue,[n("div",de,[n("div",fe,[c(ie,{path:r(s).icon,title:r(s).name},null,8,["path","title"]),r(s).versions&&u.value?(i(),f("div",pe,[me,c(te,{modelValue:a.currentVersion,"onUpdate:modelValue":o[0]||(o[0]=t=>a.currentVersion=t),options:R(u.value.versions)},null,8,["modelValue","options"])])):p("",!0)])]),u.value?(i(),f("div",_e,[c(se,{game:r(l),version:a.currentVersion,profile:u.value},null,8,["game","version","profile"])])):(i(),f("div",he,[r(s).noScores?p("",!0):(i(),y(k,{key:0,href:`/#/games/${r(l)}/scores`,icon:r(O),outline:!1,color:"info",label:"Network Scores"},null,8,["href","icon"])),r(s).noRecords?p("",!0):(i(),y(k,{key:1,href:`/#/games/${r(l)}/records`,icon:r(U),outline:!1,color:"info",label:"Network Records"},null,8,["href","icon"]))]))])],4)):p("",!0),c(X,{icon:r(J),title:"All Players",main:""},null,8,["icon"]),c(K,{"has-table":""},{default:x(()=>[n("div",ve,[n("div",ge,[c(ae,{headers:d,items:w.value,path:`/#/${r(l)}/profiles/`,onRowClicked:j},null,8,["items","path"])])])]),_:1})]),_:1})]),_:1}))}};export{Se as default};
