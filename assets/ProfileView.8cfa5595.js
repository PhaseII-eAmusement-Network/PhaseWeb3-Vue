import{u as I,s as _,r as y,N as S,a as d,c as p,w as o,b as e,W as A,X as E,e as i,x as b,g as h,_ as V,v as J,f as O,k as P,I as U,R as v,Y as $,P as B,y as f,Z as F,l as L,n as M,q as R}from"./index.051d038d.js";import{d as D}from"./account.cb592211.js";import{_ as u}from"./FormField.a436ceea.js";import{_ as m}from"./FormControl.bac59ab6.js";const G={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},z={__name:"ProfileView",setup(W){const l=I(),N=R(),c=_({username:JSON.parse(JSON.stringify(l.userName)),email:JSON.parse(JSON.stringify(l.userEmail)),pin:null}),n=_({username:JSON.parse(JSON.stringify(l.userName)),email:JSON.parse(JSON.stringify(l.userEmail)),pin:null}),t=_({currentPassword:"",newPassword:"",confirmPassword:""}),w=y(!1),g=y(!1);S(()=>l.userName,s=>{n.username=JSON.parse(JSON.stringify(s)),c.username=JSON.parse(JSON.stringify(s))}),S(()=>l.userEmail,s=>{n.email=JSON.parse(JSON.stringify(s)),c.email=JSON.parse(JSON.stringify(s))});async function k(){w.value=!0,(await l.putUser(n)).status=="success"&&(w.value=!1,await l.loadUser(),N.go())}async function x(){g.value=!0,(await D(t.currentPassword,t.newPassword,t.confirmPassword)).status=="success"&&(alert("Password changed."),g.value=!1,await l.loadUser(),N.go())}function q(s){s.target.value=s.target.value.replace(/\D/g,"")}function C(s,a){return JSON.stringify(s)!==JSON.stringify(a)}return(s,a)=>(d(),p(M,null,{default:o(()=>[e(L,null,{default:o(()=>[e(A,{class:"mb-6","use-small":"","even-smaller":""}),e(E,{icon:i(b),title:"Profile Settings",main:""},null,8,["icon"]),h("div",G,[e(V,{"is-form":"",class:"row-span-1",onSubmit:J(k,["prevent"])},{footer:o(()=>[C(c,n)?(d(),p(O,{key:0,color:"success",type:"submit",label:"Update"})):P("",!0),w.value?(d(),p(U,{key:1,path:i(v),color:"text-yellow-500",class:"animate animate-spin"},null,8,["path"])):P("",!0)]),default:o(()=>[e($,{color:"info",label:"General",class:"mb-2"}),e(u,{label:"Username"},{default:o(()=>[e(m,{modelValue:n.username,"onUpdate:modelValue":a[0]||(a[0]=r=>n.username=r),icon:i(b),name:"username",required:"",autocomplete:"username"},null,8,["modelValue","icon"])]),_:1}),e(u,{label:"E-mail",help:"Used for password resetting and 2FA"},{default:o(()=>[e(m,{modelValue:n.email,"onUpdate:modelValue":a[1]||(a[1]=r=>n.email=r),icon:i(B),type:"email",name:"email",required:"",autocomplete:"email"},null,8,["modelValue","icon"])]),_:1}),e(u,{label:"PIN",help:"Used when logging into a game"},{default:o(()=>[e(m,{modelValue:n.pin,"onUpdate:modelValue":a[2]||(a[2]=r=>n.pin=r),icon:i(f),type:"password",name:"pin",minlength:4,maxlength:4,inputmode:"numeric",pattern:"\\d{4}",autocomplete:"pin",onInput:q},null,8,["modelValue","icon"])]),_:1})]),_:1},8,["onSubmit"]),e(V,{"is-form":"",class:"row-span-2",onSubmit:a[6]||(a[6]=J(r=>x(),["prevent"]))},{footer:o(()=>[e(O,{type:"submit",color:"success",label:"Update"}),g.value?(d(),p(U,{key:0,path:i(v),color:"text-yellow-500",class:"animate animate-spin"},null,8,["path"])):P("",!0)]),default:o(()=>[e($,{color:"info",label:"Change Password",class:"mb-2"}),e(u,{label:"Current Password"},{default:o(()=>[e(m,{modelValue:t.currentPassword,"onUpdate:modelValue":a[3]||(a[3]=r=>t.currentPassword=r),icon:i(f),name:"currentPassword",type:"password",required:""},null,8,["modelValue","icon"])]),_:1}),e(F),e(u,{label:"New Password"},{default:o(()=>[e(m,{modelValue:t.newPassword,"onUpdate:modelValue":a[4]||(a[4]=r=>t.newPassword=r),icon:i(f),name:"newPassword",type:"password",required:""},null,8,["modelValue","icon"])]),_:1}),e(u,{label:"Confirm Password"},{default:o(()=>[e(m,{modelValue:t.confirmPassword,"onUpdate:modelValue":a[5]||(a[5]=r=>t.confirmPassword=r),icon:i(f),name:"confirmPassword",type:"password",required:""},null,8,["modelValue","icon"])]),_:1})]),_:1})])]),_:1})]),_:1}))}};export{z as default};
