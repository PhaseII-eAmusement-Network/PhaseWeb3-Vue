import{d as l,a as r,p as o,t as $,u as U,l as tt,m as at,r as g,z as et,P as st,aa as rt,o as it,j as E,c as S,w as k,b as d,_ as lt,e as h,g as i,B as ot,f as M,n as H,F as L,h as N,x as nt,L as j,k as ut}from"./index-CI044EBi.js";import{g as z,_ as dt,I as ct}from"./danClass-Ceum559Z.js";import{F as mt}from"./PhUsersThree.vue-BqVY0w1C.js";import{_ as ft}from"./GameHeader-0XH44gFt.js";import{_ as ht}from"./FormControl-E3QYYjbd.js";import{_ as vt}from"./ProfileCard-9pi7Bp4A.js";import{_ as _t}from"./GeneralTable-E8bErCk_.js";import{a as gt,A as pt}from"./profile-CX1WhA3b.js";import{a as yt}from"./music-BMeJ5xvi.js";import{d as xt}from"./userData-DZYdegtD.js";import"./PhGear.vue-CXs__-vb.js";import"./PhHouse.vue-BmdsZNTJ.js";import"./contentExport-D7LQ-4O3.js";const wt={class:"flex mt-3"},Vt=["href"],A={__name:"SongCardSmall",props:{musicData:{type:Object,required:!0},gameId:{type:String,required:!0}},setup(y){return(c,G)=>(r(),l("div",wt,[o("a",{class:"bg-slate-700 p-2 rounded-xl hover:text-slate-300",href:`/games/${y.gameId}/song/${y.musicData.id}`},$(y.musicData.name)+" - "+$(y.musicData.artist),9,Vt)]))}},It={key:0,class:"w-full md:flex md:-mt-[75px] mb-4 place-content-end"},bt={class:"md:w-1/3 md:text-right"},kt={key:1,class:"w-full"},$t={key:0,class:"grid lg:grid-cols-2 items-stretch w-full gap-6 mb-6"},Dt={key:1},Pt={key:0},St={class:"text-xl font-bold"},At={class:"text-md font-light flex gap-2"},Et={class:"font-normal"},Lt={class:"font-normal"},Gt={key:0},Rt={class:"flex gap-6 text-lg mt-3"},Bt={key:1,class:"flex mt-3"},Ct={class:"bg-white dark:bg-slate-900/95 rounded-2xl lg:flex lg:justify-between"},Ft={class:"w-full"},Zt={__name:"GameView",setup(y){const c=U(),G=tt(),R=at();var n=null,u=null;const x=g(null),B=g(null),w=g([]),V=g(null),C=g([]),D=g([]),p=g(null),v=g(null),m=et({currentVersion:null});st(()=>m.currentVersion,()=>{c.continueLoad=!0,c.isLoading=!0,c.activeRequests=1,F(m.currentVersion,w.length!=0),q(),D.value=[],c.continueLoad=!1,c.isLoading=!1,c.activeRequests=0}),n=G.params.id,u=rt(n),u==null&&R.push({name:"ErrorPage",params:{catchAll:"404"}}),it(async()=>{c.continueLoad=!0,await q(),await F(null,w.length==0),c.continueLoad=!1,c.isLoading=!1,c.activeRequests=0});async function F(e,a){try{const t=await gt(n,e,a);w.value.length===0&&!a&&(w.value=O(t.profiles)),V.value=t.hitchart,a&&(C.value=t.scheduledEvents,K()),D.value=W(t.hitchart).concat(Y(t.scheduledEvents)),await Q(),V.value=Z(t.hitchart)}catch(t){console.error("Failed to fetch profile data:",t)}}async function q(){try{x.value=null;const e=await pt(n,m.currentVersion);if(!e)return;x.value=e.profile,B.value=e.versions,e&&!m.currentVersion&&(m.currentVersion=e.versions[e.versions.length-1])}catch(e){console.error("Failed to fetch user profile data:",e)}}const I=[];if(I.push({text:"Player",value:"username",sortable:!0,width:120}),u.noRivals||I.push({text:"Rival ID",value:"extid",sortable:!0,width:100}),I.push({text:"Last Play",value:"stats.last_play_timestamp",sortable:!0,width:150},{text:"Last Arcade",value:"stats.last_play_arcade",sortable:!0,width:150},{text:"Plays",value:"stats.total_plays",sortable:!0,width:50}),u.playerHeaders)for(var T of u.playerHeaders)I.push(T);function O(e){var a=[];for(var t of e)t.extid&&(t.extid=xt(t.extid)),t.stats&&(t.stats.last_play_timestamp&&(t.stats.last_play_timestamp=E(t.stats.last_play_timestamp)),t.sgrade&&(t.sgrade=z(t.sgrade).short),t.dgrade&&(t.dgrade=z(t.dgrade).short)),a.push(t);return a.sort((s,_)=>{const P=s.stats&&s.stats.total_plays||0;return(_.stats&&_.stats.total_plays||0)-P}),a}function X(e){var a=[];for(const t of u.versions)e.includes(t.id)&&a.push(t);return a}const J=e=>{const a=e.userId;R.push(`/games/${n}/profiles/${a}`)};function K(){return u.scheduledEvents?(v.value=u.scheduledEvents[m.currentVersion]??null,v.value):null}async function Q(){if(D.value.length){const e=await yt(n,m.currentVersion,D.value,!0);p.value=e}}function b(e){return p.value?p.value.find(a=>a.id==e)||{}:{}}function f(e){return C.value.find(t=>t.id==e)}function W(e){var a=[];for(const t in e){const s=e[t][0];a.push(s)}return a}function Y(e){if(v.value==null)return[];var a=[];for(const t of v.value){const s=e.find(_=>_.id==t.id);if(s?.data?.music)if(Array.isArray(s?.data.music))for(const _ of s.data.music)a.push(_);else a.push(s?.data.music);s?.data?.today&&a.push(s?.data.today),s?.data?.whim&&a.push(s?.data.whim)}return a}function Z(e){var a=[];for(const t in e){const s=e[t][0],_=e[t][1],P=b(s);a.push({songid:s,plays:_,name:P?.name,artist:P?.artist})}return a}return(e,a)=>(r(),S(ut,null,{default:k(()=>[d(lt,null,{default:k(()=>[d(ft,{game:i(u),version:m.currentVersion},{default:k(()=>[i(u).versions&&x.value?(r(),l("div",It,[o("div",bt,[a[1]||(a[1]=o("h2",{class:"text-md sm:text-lg md:text-xl font-bold p-2"}," Select Version ",-1)),d(ht,{modelValue:m.currentVersion,"onUpdate:modelValue":a[0]||(a[0]=t=>m.currentVersion=t),options:X(B.value)},null,8,["modelValue","options"])])])):h("",!0),x.value?(r(),l("div",kt,[d(vt,{game:i(n),version:m.currentVersion,profile:x.value},null,8,["game","version","profile"])])):h("",!0)]),_:1},8,["game","version"]),v.value||!i(u).noScores&&V.value?.length?(r(),l("div",$t,[!i(u).noScores&&V.value?.length?(r(),l("div",{key:0,class:ot({"md:col-span-2":!v.value})},[d(dt,{"hitchart-data":V.value,"game-id":i(n)},null,8,["hitchart-data","game-id"])],2)):h("",!0),v.value!=null?(r(),l("div",Dt,[d(M,{icon:i(ct),color:"text-emerald-400",title:"Scheduled Events",main:""},null,8,["icon"]),d(H,null,{default:k(()=>[p.value&&p.value?.length?(r(!0),l(L,{key:0},N(v.value,t=>(r(),l("div",{key:t.id},[f(t.id)?(r(),l(L,{key:0},[t.id?(r(),l("div",Pt,[d(nt,{color:"info",label:t.duration},null,8,["label"]),o("h1",St,$(t.name),1),o("div",At,[o("h1",null,[a[2]||(a[2]=j(" Started ",-1)),o("span",Et,$(i(E)(f(t.id)?.start_time)),1)]),a[4]||(a[4]=o("span",null,"|",-1)),o("h1",null,[a[3]||(a[3]=j(" Expires ",-1)),o("span",Lt,$(i(E)(f(t.id)?.end_time)),1)])]),Array.isArray(f(t.id)?.data?.music)&&p.value?(r(),l("div",Gt,[o("div",Rt,[(r(!0),l(L,null,N(f(t.id).data.music,s=>(r(),S(A,{"game-id":i(n),"music-data":b(s)},null,8,["game-id","music-data"]))),256))])])):f(t.id)?.data?.music?(r(),l("div",Bt,[d(A,{"game-id":i(n),"music-data":b(f(t.id)?.data?.music)},null,8,["game-id","music-data"])])):h("",!0),f(t.id)?.data?.today?(r(),S(A,{key:2,"game-id":i(n),"music-data":b(f(t.id)?.data?.today)},null,8,["game-id","music-data"])):h("",!0),f(t.id)?.data?.whim?(r(),S(A,{key:3,"game-id":i(n),"music-data":b(f(t.id)?.data?.whim)},null,8,["game-id","music-data"])):h("",!0)])):h("",!0)],64)):h("",!0)]))),128)):h("",!0)]),_:1})])):h("",!0)])):h("",!0),d(M,{icon:i(mt),color:"text-blue-400",title:"All Players",main:""},null,8,["icon"]),d(H,{"has-table":""},{default:k(()=>[o("div",Ct,[o("div",Ft,[d(_t,{headers:I,items:w.value,onRowClicked:J},null,8,["items"])])])]),_:1})]),_:1})]),_:1}))}};export{Zt as default};
