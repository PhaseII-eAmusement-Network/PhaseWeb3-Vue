import{u as Z,a as aa,b as ea,a6 as ra,r as X,o as sa,c as la,e as z,w as d,f as t,_ as ta,l as na,g as oa,F as da,i as l,P as ca,bL as ua,n as fa,bB as ia,j as pa,q as _a}from"./index-BLNUJ2NM.js";import{_ as ha}from"./GeneralTable-J-7uFbEf.js";import{_ as ga}from"./GameHeader-BIZyaPtb.js";import{A as ka}from"./profile-BrJszsS2.js";import"./sources-CaFLxZU6.js";const xa={__name:"PersonalScores",setup(va){const u=Z(),f=aa(),J=ea();var n=null,e=null,c=null;n=u.params.game,c=u.params.userId,e=ra(n),e||f.push({name:"ErrorPage",params:{catchAll:"404"}});const s=X(null),i=X([]),p=[{text:"Timestamp",value:"timestamp",width:140},{text:"New PB",value:"newRecord",width:100},{text:"Song",value:"song.name",width:180},{text:"Artist",value:"song.artist",width:180},{text:"Chart",value:"song.chart",width:100},{text:"Grade",value:"data.rank",width:80},{text:"Score",value:"points",width:120}];if(e.scoreHeaders)for(var K of e.scoreHeaders)p.push(K);sa(async()=>{try{const r=await J.getAttemptData(n,c);i.value=Q(r)}catch(r){console.error("Failed to fetch score data:",r)}O()});async function O(){try{s.value=null;const r=await ka(n,null,c);s.value=r}catch(r){console.error("Failed to fetch user profile data:",r)}}function Q(r){var _,h,g,k,v,b,w,m,$,T,x,S,I,P,A,C,R,B,F,y,D,E,N,G,L,H,M,V,j,q,U;var o=[];for(var a of r){if(a.newRecord?a.newRecord="âœ…":a.newRecord="",a.timestamp){const Y=new Date(a.timestamp*1e3);a.timestamp=Y.toLocaleString()}a.points!=null&&(a.points=a.points.toString().replace(new RegExp("\\B(?<!\\.\\d*)(?=(\\d{3})+(?!\\d))","g"),",")),((h=(_=a.data)==null?void 0:_.stats)==null?void 0:h.score)!=null&&(a.exscore=a.points.toString(),a.points=(k=(g=a.data)==null?void 0:g.stats)==null?void 0:k.score.toString().replace(new RegExp("\\B(?<!\\.\\d*)(?=(\\d{3})+(?!\\d))","g"),",")),((v=a.song)==null?void 0:v.chart)!=null&&e.chartTable&&(a.song.chart=e.chartTable[(b=a.song)==null?void 0:b.chart]),((w=a.data)==null?void 0:w.halo)!=null&&e.haloTable&&(a.data.halo=e.haloTable[(m=a.data)==null?void 0:m.halo]),(($=a.data)==null?void 0:$.medal)!=null&&e.medalTable&&(a.data.medal=e.medalTable[(T=a.data)==null?void 0:T.medal]),((x=a.data)==null?void 0:x.clear_status)!=null&&e.medalTable&&(a.data.medal=e.medalTable[(S=a.data)==null?void 0:S.clear_status]),((I=a.data)==null?void 0:I.rank)!=null&&e.rankTable&&(a.data.rank=e.rankTable[(P=a.data)==null?void 0:P.rank]),((A=a.data)==null?void 0:A.result_rank)!=null&&e.rankTable&&(a.data.rank=e.rankTable[(C=a.data)==null?void 0:C.result_rank]),((R=a.data)==null?void 0:R.grade)!=null&&e.rankTable&&(a.data.rank=e.rankTable[(B=a.data)==null?void 0:B.grade]),((F=a.data)==null?void 0:F.skill_perc)>0?a.data.skill_perc=`${((y=a.data)==null?void 0:y.skill_perc)/100}%`:a.data.skill_perc="0%",(D=a.data)!=null&&D.skill_points&&(a.data.skill_points=((E=a.data)==null?void 0:E.skill_points)/10),((N=a.data)==null?void 0:N.perc)>0?a.data.perc=`${((G=a.data)==null?void 0:G.perc)/100}%`:a.data.perc="0%",(L=a.data)!=null&&L.new_skill&&(a.data.new_skill=((H=a.data)==null?void 0:H.new_skill)/10),(M=a.data)!=null&&M.music_rate&&(a.data.music_rate=((V=a.data)==null?void 0:V.music_rate)/10),(j=a.data)!=null&&j.excellent?a.medal="EX FC":(q=a.data)!=null&&q.fullcombo?a.medal="FC":(U=a.data)!=null&&U.clear?a.medal="CLEARED":a.medal="FAILED",o.push(a)}return o}const W=r=>{const o=r.song.id;f.push(`/games/${n}/song/${o}`)};return(r,o)=>(z(),la(_a,null,{default:d(()=>[t(ta,null,{default:d(()=>[s.value?(z(),na(da,{key:0},[t(ga,{game:l(e),profile:s.value},null,8,["game","profile"]),t(ca,{icon:l(ua),title:`${s.value.username}'s ${l(e).shortName?l(e).shortName:l(e).name} Scores`,main:""},{default:d(()=>[t(fa,{icon:l(ia),href:`/#/games/${l(e).id}/profiles/${s.value.userId}`,outline:!1,color:"info",label:`${s.value.username}'s Profile`},null,8,["icon","href","label"])]),_:1},8,["icon","title"]),t(pa,{"has-table":""},{default:d(()=>[t(ha,{headers:p,items:i.value,onRowClicked:W},null,8,["items"])]),_:1})],64)):oa("",!0)]),_:1})]),_:1}))}};export{xa as default};
