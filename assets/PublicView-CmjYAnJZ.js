import{u as ne,a as re,b as ie,r as h,o as ue,U as f,n as de,c as $,d as r,w as o,e as l,_ as ce,j as d,f as w,F as _,i as c,J as P,g as i,G as me,I as pe,h as V,s as E,K as I,l as U,k as A,t as fe,ad as B,ae as ve,af as G,a8 as ge,ag as be,ah as ye,m as we,ai as _e,a4 as he,aj as N,ak as Pe,Z as F,al as j}from"./index-0qLJ2-KK.js";import{I as Se}from"./PhAt.vue-CNHrC6tk.js";import{H as xe}from"./PhInfo.vue-DvgpiA15.js";import{G as D}from"./PhPassword.vue-D_EMrZ1G.js";import{D as ke}from"./PhUserGear.vue-CTvMnaPY.js";import{_ as v}from"./FormField-C2hIlabr.js";import{_ as S}from"./FormControl-n-2BZaUK.js";import{_ as R}from"./FormCheckRadio-BbD3aODr.js";import{A as $e,a as Ve}from"./admin-Dam631Sm.js";const Ue={class:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6"},Ce={class:"grid md:grid-cols-2 gap-x-4 mb-6"},Ie={key:0,class:"space-x-2 mt-6 mb-4"},Ae={class:"grid gap-4 md:grid-cols-2"},De={class:"grid grid-cols-1 gap-4 xl:flex w-full place-content-between"},Oe={class:"text-md md:text-lg"},Te={class:"flex align-middle mt-2 md:mt-0 max-h-12"},Ee={class:"grid grid-cols-2 sm:grid-cols-3 gap-6 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 3xl:grid-cols-5 mb-6"},Be={class:"grid grid-flow-row auto-rows-auto grid-cols-2 md:grid-cols-2 xl:grid-cols-3 2xl:grid-cols-3 3xl:grid-cols-4 4xl:grid-cols-6 gap-5 mb-5"},Ge={key:0},Qe={__name:"PublicView",setup(Ne){const q=ne(),H=re(),M=ie(),x=H.params.id,s=h(null),u=h(null),m=h(null),g=h(null);async function k(){try{u.value=null;var t=await _e(x);t.name||(t.name="Unclaimed Account"),u.value=t,s.value=JSON.parse(JSON.stringify(t))}catch(a){console.error("Failed to fetch user profile data:",a)}}ue(async()=>{await k(),m.value=u.value.profiles,g.value=u.value.userScoreStats});const J=f(()=>m.value?.reduce((t,a)=>t+a.data.total_plays,0)),L=f(()=>m.value?.length),K=f(()=>{const t=e=>{const n={};return e.forEach(b=>{const y=new Date(b*1e3).toISOString().split("T")[0];n[y]=(n[y]||0)+1}),n};var a=0;return m.value?.forEach(e=>{const n=e.data?.arcade_history?e.data?.arcade_history:{},b=[];Object.values(n).forEach(T=>{Object.values(T).forEach(oe=>{b.push(...oe)})});const y=t(b),C=Math.max(...Object.values(y));a=Math.max(a,C)}),a});function Q(t){if(t){var a=[];for(const e of t){const n=he(e.game);n&&!n.skip&&a.push(e)}return a.sort(function(e,n){return n.data.last_play_timestamp-e.data.last_play_timestamp}),a}}const O=new Date().toISOString().split("T")[0],Z=f(()=>g.value?.attempts?.length||0),z=f(()=>g.value?.records?.length||0),W=f(()=>g.value?.attempts?.filter(t=>new Date(t.timestamp*1e3).toISOString().split("T")[0]===O).length||0),X=f(()=>g.value?.records?.filter(t=>new Date(t.timestamp*1e3).toISOString().split("T")[0]===O).length||0),Y=f(()=>{const t=new Date().toISOString().split("T")[0];let a=0;return m.value?.forEach(e=>{const n=e.data?.arcade_history||{};Object.values(n).forEach(b=>{Object.values(b).forEach(y=>{y.forEach(C=>{new Date(C*1e3).toISOString().split("T")[0]===t&&a++})})})}),a}),ee=h([{label:"Cumulative Plays",icon:N,iconColor:"text-emerald-600",suffix:"play",number:J},{label:"Games Played",icon:G,iconColor:"text-sky-300",suffix:"game",number:L},{label:"Plays Today",icon:N,iconColor:"text-sky-300",suffix:"play",number:Y},{label:"Longest Play Streak",icon:Pe,iconColor:"text-red-500",suffix:"play",number:K},{label:"Total Records",icon:F,iconColor:"text-amber-400",suffix:"record",number:z},{label:"Total Attempts",icon:j,iconColor:"text-pink-300",suffix:"attempt",number:Z},{label:"Records Today",icon:F,iconColor:"text-amber-400",suffix:"record",number:X},{label:"Attempts Today",icon:j,iconColor:"text-sky-300",suffix:"attempt",number:W}]);function ae(t){t.target.value=t.target.value.replace(/\D/g,"")}async function le(){(await $e(x,s.value)).status!=="success"?window.alert("Failed to update user!"):k()}const p=de({newPassword:"",confirmPassword:""});async function te(){(await Ve(x,p.newPassword,p.confirmPassword)).status=="success"?(alert("Password changed."),p.newPassword=null,p.confirmPassword=null,await k()):alert("Failed to update password. Check that both passwords match.")}const se=t=>{const a=t.id;M.push(`/arcade/${a}`)};return(t,a)=>(r(),$(we,null,{default:o(()=>[l(ce,null,{default:o(()=>[u.value!==null?(r(),d(_,{key:0},[l(P,{icon:i(me),title:`${u.value.name}'s Profile`,main:""},null,8,["icon","title"]),l(pe,{class:"mb-6","override-profile":u.value,"use-small":""},null,8,["override-profile"]),i(q).userAdmin?(r(),d(_,{key:0},[l(P,{icon:i(ke),title:"User Administration",main:""},null,8,["icon"]),c("div",Ue,[l(V,{"is-form":"",class:"",onSubmit:E(le,["prevent"])},{default:o(()=>[l(I,{color:"info",label:"General Information",icon:i(xe),class:"mb-2"},null,8,["icon"]),c("div",Ce,[l(v,{label:"Username"},{default:o(()=>[l(S,{modelValue:s.value.name,"onUpdate:modelValue":a[0]||(a[0]=e=>s.value.name=e),"input-value":s.value.name,name:"username",required:""},null,8,["modelValue","input-value"])]),_:1}),l(v,{label:"E-mail",help:"Used for password resetting and 2FA"},{default:o(()=>[l(S,{modelValue:s.value.email,"onUpdate:modelValue":a[1]||(a[1]=e=>s.value.email=e),icon:i(Se),type:"email",name:"email",required:""},null,8,["modelValue","icon"])]),_:1}),l(v,{label:"PIN",help:"Used when logging into a game"},{default:o(()=>[l(S,{modelValue:s.value.pin,"onUpdate:modelValue":a[2]||(a[2]=e=>s.value.pin=e),icon:i(D),type:"password",name:"pin",minlength:4,maxlength:4,inputmode:"numeric",pattern:"\\d{4}",onInput:ae},null,8,["modelValue","icon"])]),_:1})]),l(v,{label:"Public Profile",help:"Show this profile publicly. If disabled, only game profiles and scores will be visible."},{default:o(()=>[l(R,{modelValue:s.value.public,"onUpdate:modelValue":a[3]||(a[3]=e=>s.value.public=e),name:"public","model-value":s.value.public,"input-value":s.value.public,type:"switch"},null,8,["modelValue","model-value","input-value"])]),_:1}),l(v,{label:"Ban Profile",help:"Ban this profile. Locks out all arcades that this user manages."},{default:o(()=>[l(R,{modelValue:s.value.banned,"onUpdate:modelValue":a[4]||(a[4]=e=>s.value.banned=e),name:"banned","model-value":s.value.banned,"input-value":s.value.banned,type:"switch"},null,8,["modelValue","model-value","input-value"])]),_:1}),JSON.stringify(u.value)!==JSON.stringify(s.value)?(r(),d("div",Ie,[l(U,{color:"success",label:"Save",type:"submit"}),l(U,{color:"warning",label:"Revert",onClick:a[5]||(a[5]=e=>k())})])):w("",!0)]),_:1}),l(V,{"is-form":"",onSubmit:a[8]||(a[8]=E(e=>te(),["prevent"]))},{footer:o(()=>[l(U,{type:"submit",color:"success",label:"Update"})]),default:o(()=>[l(I,{color:"info",label:"Change Password",class:"mb-2"}),l(v,{label:"New Password"},{default:o(()=>[l(S,{modelValue:p.newPassword,"onUpdate:modelValue":a[6]||(a[6]=e=>p.newPassword=e),icon:i(D),name:"newPassword",type:"password",required:""},null,8,["modelValue","icon"])]),_:1}),l(v,{label:"Confirm Password"},{default:o(()=>[l(S,{modelValue:p.confirmPassword,"onUpdate:modelValue":a[7]||(a[7]=e=>p.confirmPassword=e),icon:i(D),name:"confirmPassword",type:"password",required:""},null,8,["modelValue","icon"])]),_:1})]),_:1}),u.value?.arcades?.length?(r(),$(V,{key:0,class:"mb-6"},{default:o(()=>[l(I,{color:"info",label:"Arcades",class:"mb-2"}),c("div",Ae,[(r(!0),d(_,null,A(u.value.arcades,e=>(r(),d("div",{key:e.id,class:"bg-slate-800 p-4 rounded-xl"},[c("div",De,[c("div",null,[c("h1",Oe,fe(e.name),1)]),c("div",Te,[l(U,{label:"Open Arcade",color:"info",onClick:n=>se(e)},null,8,["onClick"])])])]))),128))])]),_:1})):w("",!0)])],64)):w("",!0),l(P,{icon:i(B),title:"Quick Stats",main:""},null,8,["icon"]),c("div",Ee,[(r(!0),d(_,null,A(ee.value,e=>(r(),d(_,{key:e.label},[e.number?(r(),$(ve,{key:0,icon:e.icon,number:e.number,label:e.label,suffix:`${e.suffix}${e.number==1?"":"s"}`,"icon-color":e.iconColor},null,8,["icon","number","label","suffix","icon-color"])):w("",!0)],64))),128))]),l(P,{icon:i(G),title:"Showcase",main:""},null,8,["icon"]),c("div",Be,[(r(!0),d(_,null,A(Q(m.value),e=>(r(),$(ge,{key:e.game,game:e.game,value:e.data.total_plays,"user-id":i(x),"profile-name":e?.username,type:"plays"},null,8,["game","value","user-id","profile-name"]))),128))]),l(P,{icon:i(B),title:"Play Trends",main:""},null,8,["icon"]),l(V,{class:"mb-6"},{default:o(()=>[m.value?(r(),d("div",Ge,[l(be,{data:i(ye)(m.value,g.value),class:"h-96"},null,8,["data"])])):w("",!0)]),_:1})],64)):w("",!0)]),_:1})]),_:1}))}};export{Qe as default};
