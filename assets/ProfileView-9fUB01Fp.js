import{b as A,a as E,s as g,r as N,N as P,c as p,e as c,w as n,f as e,_ as I,k as h,O as B,P as L,i as t,z as S,j as V,y as O,Q as v,B as F,A as f,g as _,n as J,D as U,E as $,R as M,q as D,S as R}from"./index-DdOAy-ci.js";import{_ as u}from"./FormField-2BkvaPEM.js";import{_ as m}from"./FormControl-DpgwkAiB.js";import{_ as j}from"./FormCheckRadio-B6ePYgKw.js";const z={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},W={__name:"ProfileView",setup(G){const r=A(),y=E(),d=g({username:JSON.parse(JSON.stringify(r.userName)),email:JSON.parse(JSON.stringify(r.userEmail)),pin:null,public:r.userPublic??!1}),l=g({username:JSON.parse(JSON.stringify(r.userName)),email:JSON.parse(JSON.stringify(r.userEmail)),pin:null,public:r.userPublic??!1}),i=g({currentPassword:"",newPassword:"",confirmPassword:""}),w=N(!1),b=N(!1);P(()=>r.userName,s=>{l.username=JSON.parse(JSON.stringify(s)),d.username=JSON.parse(JSON.stringify(s))}),P(()=>r.userEmail,s=>{l.email=JSON.parse(JSON.stringify(s)),d.email=JSON.parse(JSON.stringify(s))}),P(()=>r.userPublic,s=>{l.public=s,d.public=s});async function k(){w.value=!0,(await r.putUser(l)).status=="success"&&(w.value=!1,r.userLoaded=!1,await r.loadUser(),y.go())}async function q(){b.value=!0,(await R(i.currentPassword,i.newPassword,i.confirmPassword)).status=="success"&&(alert("Password changed."),b.value=!1,await r.loadUser(),y.go())}function x(s){s.target.value=s.target.value.replace(/\D/g,"")}function C(s,a){return JSON.stringify(s)!==JSON.stringify(a)}return(s,a)=>(c(),p(D,null,{default:n(()=>[e(I,null,{default:n(()=>[e(B,{class:"mb-6","use-small":"","even-smaller":""}),e(L,{icon:t(S),title:"Profile Settings",main:""},null,8,["icon"]),h("div",z,[e(V,{"is-form":"",class:"row-span-1",onSubmit:O(k,["prevent"])},{footer:n(()=>[C(d,l)?(c(),p(J,{key:0,color:"success",type:"submit",label:"Update"})):_("",!0),w.value?(c(),p(U,{key:1,path:t($),color:"text-yellow-500",class:"animate animate-spin"},null,8,["path"])):_("",!0)]),default:n(()=>[e(v,{color:"info",label:"General",class:"mb-2"}),e(u,{label:"Username"},{default:n(()=>[e(m,{modelValue:l.username,"onUpdate:modelValue":a[0]||(a[0]=o=>l.username=o),icon:t(S),name:"username",required:"",autocomplete:"username"},null,8,["modelValue","icon"])]),_:1}),e(u,{label:"E-mail",help:"Used for password resetting and 2FA"},{default:n(()=>[e(m,{modelValue:l.email,"onUpdate:modelValue":a[1]||(a[1]=o=>l.email=o),icon:t(F),type:"email",name:"email",required:"",autocomplete:"email"},null,8,["modelValue","icon"])]),_:1}),e(u,{label:"PIN",help:"Used when logging into a game"},{default:n(()=>[e(m,{modelValue:l.pin,"onUpdate:modelValue":a[2]||(a[2]=o=>l.pin=o),icon:t(f),type:"password",name:"pin",minlength:4,maxlength:4,inputmode:"numeric",pattern:"\\d{4}",autocomplete:"pin",onInput:x},null,8,["modelValue","icon"])]),_:1}),e(u,{label:"Public Profile",help:"Show my profile publicly. If disabled, only game profiles and scores will be visible."},{default:n(()=>[e(j,{modelValue:l.public,"onUpdate:modelValue":a[3]||(a[3]=o=>l.public=o),name:"public","model-value":l.public,"input-value":l.public,type:"switch"},null,8,["modelValue","model-value","input-value"])]),_:1})]),_:1}),e(V,{"is-form":"",class:"row-span-2",onSubmit:a[7]||(a[7]=O(o=>q(),["prevent"]))},{footer:n(()=>[e(J,{type:"submit",color:"success",label:"Update"}),b.value?(c(),p(U,{key:0,path:t($),color:"text-yellow-500",class:"animate animate-spin"},null,8,["path"])):_("",!0)]),default:n(()=>[e(v,{color:"info",label:"Change Password",class:"mb-2"}),e(u,{label:"Current Password"},{default:n(()=>[e(m,{modelValue:i.currentPassword,"onUpdate:modelValue":a[4]||(a[4]=o=>i.currentPassword=o),icon:t(f),name:"currentPassword",type:"password",required:""},null,8,["modelValue","icon"])]),_:1}),e(M),e(u,{label:"New Password"},{default:n(()=>[e(m,{modelValue:i.newPassword,"onUpdate:modelValue":a[5]||(a[5]=o=>i.newPassword=o),icon:t(f),name:"newPassword",type:"password",required:""},null,8,["modelValue","icon"])]),_:1}),e(u,{label:"Confirm Password"},{default:n(()=>[e(m,{modelValue:i.confirmPassword,"onUpdate:modelValue":a[6]||(a[6]=o=>i.confirmPassword=o),icon:t(f),name:"confirmPassword",type:"password",required:""},null,8,["modelValue","icon"])]),_:1})]),_:1})])]),_:1})]),_:1}))}};export{W as default};
