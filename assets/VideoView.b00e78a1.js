import{r as w,o as D,c as u,e as I,w as m,f as n,Z as O,k as p,$ as b,g as y,ap as P,_ as k,j as l,V as T,t as r,a1 as U,i as B,F,n as G,aq as M,p as j,q,ar as L,ag as Y}from"./index.0899d6d1.js";import{_ as E}from"./GeneralTable.e74dd68c.js";import{A as J}from"./music.3dbc4d04.js";const R={key:0,class:"grid grid-cols-1 md:grid-cols-2 gap-4"},W={controls:"",class:"mt-3 rounded-xl w-[640px] xl:w-[1280px]"},Z=["src"],z={class:"text-center md:text-left grid grid-cols-1 place-content-start gap-6"},H={class:"space-y-2"},K={class:"text-2xl xl:text-4xl font-bold"},Q={class:"text-xl xl:text-3xl font-semibold"},X={class:"text-xl xl:text-2xl font-light"},tt={key:1},et={class:"space-y-1 text-center"},at={class:"text-xl xl:text-xl"},st={class:"bg-white dark:bg-slate-900/95 rounded-2xl lg:flex lg:justify-between"},lt={class:"w-full"},ct={__name:"VideoView",setup(ot){const a=w([]),V=w(!1),$=[{text:"Timestamp",value:"timestamp",sortable:!0,width:120},{text:"Song",value:"name",sortable:!0,width:120},{text:"Artist",value:"artist",sortable:!0,width:120},{text:"Game",value:"game",sortable:!0,width:120},{text:"Version",value:"version",sortable:!0,width:120},{text:"Status",value:"data.status",sortable:!0,width:120}];async function S(){a.value=null;try{const s=await L();a.value=N(JSON.parse(JSON.stringify(s)));const t=[...new Set(a.value.map(e=>e.musicid))];if(t.length>0){const e=await J("iidx",s[0].version,t,!0),i=Object.fromEntries(e.map(o=>[o.id,o]));a.value=a.value.map(o=>{var d,c;return{...o,name:((d=i[o.musicid])==null?void 0:d.name)||"Unknown Song",artist:((c=i[o.musicid])==null?void 0:c.artist)||"Unknown Artist"}})}}catch(s){console.error("Failed to fetch video data:",s)}V.value=!1}D(async()=>{await S()});function N(s){var t;s.sort(function(e,i){return i.timestamp-e.timestamp});for(const e of s){const i=Y(e.game);if(e.game=i.name,e.version=(t=i.versions.find(o=>o.id==e.version).label)!=null?t:0,e.timestamp){const o=new Date(e.timestamp*1e3);e.timestamp=o.toLocaleString()}}return s}const A=s=>{var t,e;(t=s.data)!=null&&t.url&&(s=(e=s.data)==null?void 0:e.url),navigator.clipboard.writeText(s).then(()=>{alert("Copied URL to clipboard!")}).catch(()=>{alert("Failed to copy to clipboard!")})};function C(s){var t;window.open((t=s.data)==null?void 0:t.url,"_blank").focus()}return(s,t)=>(u(),I(q,null,{default:m(()=>[n(j,null,{default:m(()=>[n(O,{class:"mb-6","use-small":"","even-smaller":""}),a.value[0]?(u(),p(F,{key:0},[n(b,{icon:y(P),title:"Your Latest Upload",main:""},null,8,["icon"]),n(k,{class:"mb-6"},{default:m(()=>{var e,i,o,d,c,f,x,_,v;return[((i=(e=a.value[0])==null?void 0:e.data)==null?void 0:i.status)=="uploaded"?(u(),p("div",R,[l("video",W,[l("source",{src:(d=(o=a.value[0])==null?void 0:o.data)==null?void 0:d.url,type:"video/mp4"},null,8,Z),t[1]||(t[1]=T(" Your browser does not support the video tag. "))]),l("div",z,[l("div",H,[l("div",null,[l("h1",K,r((c=a.value[0])==null?void 0:c.name),1),l("h1",Q,r((f=a.value[0])==null?void 0:f.artist),1)]),n(U,{class:"mx-1"}),l("h2",X,r((x=a.value[0])==null?void 0:x.game)+" "+r((_=a.value[0])==null?void 0:_.version),1),l("p",null,r((v=a.value[0])==null?void 0:v.timestamp),1)]),l("div",null,[n(B,{color:"info",label:"Share",onClick:t[0]||(t[0]=it=>{var g,h;return A((h=(g=a.value[0])==null?void 0:g.data)==null?void 0:h.url)})})])])])):(u(),p("div",tt,[l("div",et,[t[2]||(t[2]=l("h1",{class:"text-2xl xl:text-4xl font-bold"}," Your video is still uploading! ",-1)),t[3]||(t[3]=l("h2",{class:"text-xl xl:text-2xl font-light"}," Please wait for the upload to complete. ",-1)),l("h2",at," Upload started at "+r(a.value[0].timestamp),1)])]))]}),_:1})],64)):G("",!0),n(b,{icon:y(M),title:"All Play Videos",main:""},null,8,["icon"]),n(k,{"has-table":""},{default:m(()=>[l("div",st,[l("div",lt,[n(E,{headers:$,items:a.value,onRowClicked:C},null,8,["items"])])])]),_:1})]),_:1})]),_:1}))}};export{ct as default};
