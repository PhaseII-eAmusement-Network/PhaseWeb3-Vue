import{W as st,X as D,Y as M,d as r,a as s,Z as rt,e as h,p as l,$ as lt,t as H,u as ot,l as it,m as nt,r as w,s as ut,L as dt,a8 as ct,o as mt,j as B,c as Z,w as k,b as d,_ as ft,g as c,v as ht,f as G,n as R,F as E,h as j,O as gt,D as z,k as vt}from"./index-DCK4r-vv.js";import{g as T,I as pt}from"./danClass-BTqP9H-Q.js";import{F as _t}from"./PhUsersThree.vue-DUdxc12W.js";import{_ as yt}from"./GameHeader-SRSS-PWH.js";import{_ as wt}from"./FormControl-Dq-fuGQK.js";import{_ as xt}from"./ProfileCard-WfLC1Z-d.js";import{_ as U}from"./GeneralTable-COOcDwjN.js";import{a as Vt,A as kt}from"./profile-BOylDjXr.js";import{a as bt}from"./music-8jw2PoxD.js";import{d as At}from"./userData-DZYdegtD.js";import"./PhGear.vue-CQfM7599.js";import"./PhHouse.vue-CUY1sBFI.js";import"./contentExport-DNtJFeL9.js";const Lt=["width","height","fill","transform"],$t={key:0},Ht=l("path",{d:"M228,216a12,12,0,0,1-12,12H40a12,12,0,0,1,0-24H216A12,12,0,0,1,228,216ZM80,180a12,12,0,0,0,8.49-3.51L180,85v67a12,12,0,0,0,24,0V56a12,12,0,0,0-12-12H96a12,12,0,0,0,0,24h67L71.51,159.51A12,12,0,0,0,80,180Z"},null,-1),It=[Ht],Pt={key:1},St=l("path",{d:"M192,56v96L96,56Z",opacity:"0.2"},null,-1),Dt=l("path",{d:"M224,216a8,8,0,0,1-8,8H40a8,8,0,0,1,0-16H216A8,8,0,0,1,224,216ZM74.34,173.66a8,8,0,0,1,0-11.32L132.69,104,90.34,61.66A8,8,0,0,1,96,48h96a8,8,0,0,1,8,8v96a8,8,0,0,1-13.66,5.66L144,115.31,85.66,173.66a8,8,0,0,1-11.32,0ZM115.31,64l34.35,34.34h0L184,132.69V64Z"},null,-1),Mt=[St,Dt],Zt={key:2},Et=l("path",{d:"M74.34,173.66a8,8,0,0,1,0-11.32L132.69,104,90.34,61.66A8,8,0,0,1,96,48h96a8,8,0,0,1,8,8v96a8,8,0,0,1-13.66,5.66L144,115.31,85.66,173.66a8,8,0,0,1-11.32,0ZM216,208H40a8,8,0,0,0,0,16H216a8,8,0,0,0,0-16Z"},null,-1),Ct=[Et],Bt={key:3},Gt=l("path",{d:"M222,216a6,6,0,0,1-6,6H40a6,6,0,0,1,0-12H216A6,6,0,0,1,222,216ZM80,174a6,6,0,0,0,4.24-1.76L186,70.49V152a6,6,0,0,0,12,0V56a6,6,0,0,0-6-6H96a6,6,0,0,0,0,12h81.51L75.76,163.76A6,6,0,0,0,80,174Z"},null,-1),Rt=[Gt],Ft={key:4},Nt=l("path",{d:"M224,216a8,8,0,0,1-8,8H40a8,8,0,0,1,0-16H216A8,8,0,0,1,224,216ZM80,176a8,8,0,0,0,5.66-2.34L184,75.31V152a8,8,0,0,0,16,0V56a8,8,0,0,0-8-8H96a8,8,0,0,0,0,16h76.69L74.34,162.34A8,8,0,0,0,80,176Z"},null,-1),jt=[Nt],zt={key:5},Tt=l("path",{d:"M220,216a4,4,0,0,1-4,4H40a4,4,0,0,1,0-8H216A4,4,0,0,1,220,216ZM80,172a4,4,0,0,0,2.83-1.17L188,65.66V152a4,4,0,0,0,8,0V56a4,4,0,0,0-4-4H96a4,4,0,0,0,0,8h86.34L77.17,165.17A4,4,0,0,0,80,172Z"},null,-1),Ut=[Tt],qt={name:"PhArrowLineUpRight"},Ot=st({...qt,props:{weight:{type:String},size:{type:[String,Number]},color:{type:String},mirrored:{type:Boolean}},setup(_){const i=_,I=D("weight","regular"),b=D("size","1em"),u=D("color","currentColor"),n=D("mirrored",!1),m=M(()=>i.weight??I),A=M(()=>i.size??b),x=M(()=>i.color??u),P=M(()=>i.mirrored!==void 0?i.mirrored?"scale(-1, 1)":void 0:n?"scale(-1, 1)":void 0);return(y,V)=>(s(),r("svg",lt({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 256 256",width:A.value,height:A.value,fill:x.value,transform:P.value},y.$attrs),[rt(y.$slots,"default"),m.value==="bold"?(s(),r("g",$t,It)):m.value==="duotone"?(s(),r("g",Pt,Mt)):m.value==="fill"?(s(),r("g",Zt,Ct)):m.value==="light"?(s(),r("g",Bt,Rt)):m.value==="regular"?(s(),r("g",Ft,jt)):m.value==="thin"?(s(),r("g",zt,Ut)):h("",!0)],16,Lt))}}),Wt={class:"flex mt-3"},Xt=["href"],C={__name:"SongCardSmall",props:{musicData:{type:Object,required:!0},gameId:{type:String,required:!0}},setup(_){return(i,I)=>(s(),r("div",Wt,[l("a",{class:"bg-slate-700 p-2 rounded-xl hover:text-slate-300",href:`/games/${_.gameId}/song/${_.musicData.id}`},H(_.musicData.name)+" - "+H(_.musicData.artist),9,Xt)]))}},Yt={key:0,class:"w-full md:flex md:-mt-[75px] mb-4 place-content-end"},Jt={class:"md:w-1/3 md:text-right"},Kt={key:1,class:"w-full"},Qt={key:0,class:"grid lg:grid-cols-2 items-stretch w-full gap-6 mb-6"},ta={key:1},aa={key:0,class:"grid gap-6"},ea={key:0},sa={class:"text-xl font-bold"},ra={class:"text-md font-light flex gap-2"},la={class:"font-normal"},oa={class:"font-normal"},ia={key:0,class:"flex gap-6 text-lg mt-3"},na={key:1,class:"flex mt-3"},ua={class:"bg-white dark:bg-slate-900/95 rounded-2xl lg:flex lg:justify-between"},da={class:"w-full"},Aa={__name:"GameView",setup(_){const i=ot(),I=it(),b=nt();var u=null,n=null;const m=w(null),A=w([]),x=w(null),P=w([]),y=w([]),V=w(null),v=w(null),f=ut({currentVersion:null});dt(()=>f.currentVersion,()=>{i.continueLoad=!0,F(f.currentVersion),N(),y.value=[],i.continueLoad=!1,i.isLoading=!1,i.loadingPool.length=0}),u=I.params.id,n=ct(u),n==null&&b.push({name:"ErrorPage",params:{catchAll:"404"}}),mt(async()=>{i.continueLoad=!0,await N(),await F(),i.continueLoad=!1,i.isLoading=!1,i.loadingPool.length=0}),n.versions||(f.currentVersion=1);async function F(e){try{const t=await Vt(u,e);A.value=O(t.profiles),x.value=t.hitchart,P.value=t.scheduledEvents,J(),y.value=tt(t.hitchart).concat(at(t.scheduledEvents)),await K(),x.value=et(t.hitchart)}catch(t){console.error("Failed to fetch profile data:",t)}}async function N(){try{m.value=null;const e=await kt(u,f.currentVersion);m.value=e,e&&!f.currentVersion&&(f.currentVersion=e.versions[e.versions.length-1])}catch(e){console.error("Failed to fetch user profile data:",e)}}const L=[];if(L.push({text:"Player",value:"username",sortable:!0,width:120}),n.noRivals||L.push({text:"Rival ID",value:"extid",sortable:!0,width:100}),L.push({text:"Last Play",value:"stats.last_play_timestamp",sortable:!0,width:150},{text:"Last Arcade",value:"stats.last_play_arcade",sortable:!0,width:150},{text:"Plays",value:"stats.total_plays",sortable:!0,width:50}),n.playerHeaders)for(var q of n.playerHeaders)L.push(q);function O(e){var t=[];for(var a of e)a.extid&&(a.extid=At(a.extid)),a.stats&&(a.stats.last_play_timestamp&&(a.stats.last_play_timestamp=B(a.stats.last_play_timestamp)),a.sgrade&&(a.sgrade=T(a.sgrade).short),a.dgrade&&(a.dgrade=T(a.dgrade).short)),t.push(a);return t.sort((o,p)=>{const S=o.stats&&o.stats.total_plays||0;return(p.stats&&p.stats.total_plays||0)-S}),t}function W(e){var t=[];for(const a of n.versions)e.includes(a.id)&&t.push(a);return t}const X=e=>{const t=e.userId;b.push(`/games/${u}/profiles/${t}`)},Y=e=>{const t=e.songid;b.push(`/games/${u}/song/${t}`)};function J(){return n.scheduledEvents?(v.value=n.scheduledEvents[f.currentVersion]??null,v.value):null}async function K(){if(y.value.length){const e=await bt(u,f.currentVersion,y.value,!0);V.value=e}}function $(e){return V.value?V.value.find(t=>t.id==e):null}function g(e){return P.value.find(a=>a.id==e)}const Q=[{text:"Song",value:"name",width:140,sortable:!0},{text:"Artist",value:"artist",width:140,sortable:!0},{text:"Plays",value:"plays",width:100,sortable:!0}];function tt(e){var t=[];for(const a in e){const o=e[a][0];t.push(o)}return t}function at(e){if(v.value==null)return[];var t=[];for(const a of v.value){const o=e.find(p=>p.id==a.id);if(o?.data?.music)if(Array.isArray(o?.data.music))for(const p of o.data.music)t.push(p);else t.push(o?.data.music);o?.data?.today&&t.push(o?.data.today),o?.data?.whim&&t.push(o?.data.whim)}return t}function et(e){var t=[];for(const a in e){const o=e[a][0],p=e[a][1],S=$(o);t.push({songid:o,plays:p,name:S?.name,artist:S?.artist})}return t}return(e,t)=>(s(),Z(vt,null,{default:k(()=>[d(ft,null,{default:k(()=>[d(yt,{game:c(n),version:f.currentVersion},{default:k(()=>[c(n).versions&&m.value?(s(),r("div",Yt,[l("div",Jt,[t[1]||(t[1]=l("h2",{class:"text-md sm:text-lg md:text-xl font-bold p-2"}," Select Version ",-1)),d(wt,{modelValue:f.currentVersion,"onUpdate:modelValue":t[0]||(t[0]=a=>f.currentVersion=a),options:W(m.value.versions)},null,8,["modelValue","options"])])])):h("",!0),m.value?(s(),r("div",Kt,[d(xt,{game:c(u),version:f.currentVersion,profile:m.value},null,8,["game","version","profile"])])):h("",!0)]),_:1},8,["game","version"]),v.value||!c(n).noScores?(s(),r("div",Qt,[!c(n).noScores&&x.value?(s(),r("div",{key:0,class:ht({"md:col-span-2":!v.value})},[d(G,{icon:c(Ot),color:"text-yellow-400",title:"Hitchart",main:""},null,8,["icon"]),d(R,{"has-table":""},{default:k(()=>[d(U,{headers:Q,items:x.value,"rows-per-page":5,onRowClicked:Y},null,8,["items"])]),_:1})],2)):h("",!0),v.value!=null?(s(),r("div",ta,[d(G,{icon:c(pt),color:"text-emerald-400",title:"Scheduled Events",main:""},null,8,["icon"]),d(R,null,{default:k(()=>[V.value?(s(),r("div",aa,[(s(!0),r(E,null,j(v.value,a=>(s(),r(E,{key:a.id},[g(a.id)?(s(),r(E,{key:0},[a.id?(s(),r("div",ea,[d(gt,{color:"info",label:a.duration},null,8,["label"]),l("h1",sa,H(a.name),1),l("div",ra,[l("h1",null,[t[2]||(t[2]=z(" Started ",-1)),l("span",la,H(c(B)(g(a.id)?.start_time)),1)]),t[4]||(t[4]=l("span",null,"|",-1)),l("h1",null,[t[3]||(t[3]=z(" Expires ",-1)),l("span",oa,H(c(B)(g(a.id)?.end_time)),1)])]),Array.isArray(g(a.id)?.data?.music)&&V.value?(s(),r("div",ia,[(s(!0),r(E,null,j(g(a.id).data.music,o=>(s(),Z(C,{"game-id":c(u),"music-data":$(o)},null,8,["game-id","music-data"]))),256))])):g(a.id)?.data?.music?(s(),r("div",na,[d(C,{"game-id":c(u),"music-data":$(g(a.id)?.data?.music)},null,8,["game-id","music-data"])])):h("",!0),g(a.id)?.data?.today?(s(),Z(C,{key:2,"game-id":c(u),"music-data":$(g(a.id)?.data?.today)},null,8,["game-id","music-data"])):h("",!0),g(a.id)?.data?.whim?(s(),Z(C,{key:3,"game-id":c(u),"music-data":$(g(a.id)?.data?.whim)},null,8,["game-id","music-data"])):h("",!0)])):h("",!0)],64)):h("",!0)],64))),128))])):h("",!0)]),_:1})])):h("",!0)])):h("",!0),d(G,{icon:c(_t),color:"text-blue-400",title:"All Players",main:""},null,8,["icon"]),d(R,{"has-table":""},{default:k(()=>[l("div",ua,[l("div",da,[d(U,{headers:L,items:A.value,onRowClicked:X},null,8,["items"])])])]),_:1})]),_:1})]),_:1}))}};export{Aa as default};
