import{a6 as X,r as p,o as q,c as b,g as _,i as d,e as r,w as i,f as a,j as $,k as t,a7 as F,t as C,n as k,a8 as R,l as h,F as A,m as j,s as D,_ as Y,O as Z,P as I,a9 as T,y as H,a2 as K,A as Q,D as W,E as ee,J as N,aa as ae,v as te,ab as le,ac as E,q as se,ad as ne,ae as oe}from"./index-CXK2Nwmi.js";import{_ as V}from"./FormField-CRvXSUZc.js";import{_ as U}from"./FormControl-DYmThZec.js";import{_ as z}from"./FormCheckRadio-B0BQFNeR.js";import{A as re}from"./profile-D5w4SXBZ.js";const ie={class:"grid grid-cols-1 gap-3"},ue={class:"flex gap-4 items-center"},ce={class:"text-2xl"},de={class:"font-light text-xl"},me={class:"space-x-2 mt-6"},fe={__name:"MergeModal",props:{userId:{type:Number,default:null},game:{type:String,default:null},settings:{type:Object,default:null}},emits:["saveMerge","closeModal"],setup(w,{emit:x}){var m;const u=w,f=x,g=X(u.game),l=p({}),c=p(((m=u.settings)==null?void 0:m.scores)??!1);q(async()=>{const y=await re(u.game,null,u.userId);l.value=y});function n(){f("saveMerge",{game:u.game,scores:c.value})}return(y,v)=>d(g)&&l.value?(r(),b(R,{key:0,transparent:"",onOverlayClick:v[1]||(v[1]=M=>f("closeModal"))},{default:i(()=>[a($,{class:"shadow-lg max-h-modal w-11/12 md:w-3/5 lg:w-2/5 xl:w-4/12 z-50 text-white/90"},{default:i(()=>{var M;return[t("div",ie,[t("div",ue,[a(F,{path:d(g).icon},null,8,["path"]),t("h1",ce,C(d(g).name),1)]),t("div",null,[t("h2",de,C(l.value.name)+" - "+C(((M=l.value.stats)==null?void 0:M.total_plays)??0)+" Plays ",1)]),a(V,{label:"Scores",help:"Transfer all scores from this account to yours. This will not erase your current scores."},{default:i(()=>[a(z,{modelValue:c.value,"onUpdate:modelValue":v[0]||(v[0]=O=>c.value=O),name:"scores","input-value":c.value,type:"switch"},null,8,["modelValue","input-value"])]),_:1}),t("div",me,[a(k,{color:"success",label:"Save",onClick:n})])])]}),_:1})]),_:1})):_("",!0)}},ge={class:"grid grid-cols-1 gap-3"},ve={key:0,class:"flex gap-4 items-center"},pe={class:"text-2xl"},_e={class:"text-lg"},ye={class:"space-x-2 mt-6"},he={__name:"ConfirmMergeModal",props:{settings:{type:Object,default:null}},emits:["saveMerge","closeModal"],setup(w,{emit:x}){const u=x;function f(){u("saveMerge")}return(g,l)=>(r(),b(R,{transparent:"",onOverlayClick:l[0]||(l[0]=c=>u("closeModal"))},{default:i(()=>[a($,{class:"shadow-lg max-h-modal w-11/12 md:w-3/5 lg:w-2/5 xl:w-4/12 z-50 text-white/90"},{default:i(()=>{var c;return[t("div",ge,[l[1]||(l[1]=t("h1",{class:"text-2xl font-bold"},"Merge Overview",-1)),(r(!0),h(A,null,j(Object.keys(w.settings),n=>{var m,y,v;return r(),h(A,{key:n},[n!=="card"?(r(),h("div",ve,[a(F,{path:(m=d(X)(n))==null?void 0:m.icon},null,8,["path"]),t("div",null,[t("h1",pe,C((y=d(X)(n))==null?void 0:y.name),1),t("h2",_e,C((v=w.settings[n])!=null&&v.scores?"✅":"❌")+" Transfer Scores ",1)])])):_("",!0)],64)}),128)),t("div",null,[t("span",null,C((c=w.settings)!=null&&c.card?"✅":"❌")+" Transfer Card",1)]),t("div",ye,[a(k,{color:"success",label:"Save",onClick:f})])])]}),_:1})]),_:1}))}},xe={key:1},be={class:"grid grid-cols-1 md:grid-cols-2 2xl:grid-cols-4 gap-4 mb-6"},Ce={class:"mt-4"},we={key:2},$e={class:"text-xl mb-6"},ke={class:"mt-4"},Me={key:3},Se={class:"mt-4"},Pe={__name:"ClaimView",setup(w){const x=p(!1),u=p(null),f=p(!1),g=p(!1),l=D({cardId:null,pin:null}),c=p({game:null,scores:!1}),n=D({card:!0}),m=p(null),y=p(0);function v(o){var e=o.target.value;e=e.replace(/[^A-Za-z0-9]/g,""),e=e.toUpperCase().replace(/(.{4})/g,"$1-").replace(/-$/,""),l.cardId=e}function M(o){o.target.value=o.target.value.replace(/\D/g,"")}async function O(){x.value=!0,u.value=await ne(l.cardId,l.pin),x.value=!1}function B(o){f.value=!1,c.value.game=o,f.value=!0}function P(){g.value=!0}function L(o){var e=[];for(const s of o){const S=X(s.game);S&&!S.skip&&e.push(s)}return e.sort(function(s,S){return S.data.last_play_timestamp-s.data.last_play_timestamp}),e}function G({game:o,scores:e}){n[o]={scores:e},f.value=!1,c.value={game:null,scores:!1,data:!1}}async function J(){const o=await oe(l.cardId,l.pin,n);g.value=!1,o||window.alert("Failed to merge!"),o.status==="success"?(m.value=!0,y.value=o.count??0):m.value=!1}return(o,e)=>(r(),b(se,null,{default:i(()=>[a(Y,null,{default:i(()=>[a(Z,{class:"mb-6","use-small":"","even-smaller":""}),u.value?_("",!0):(r(),h(A,{key:0},[a(I,{icon:d(T),title:"Claim a Profile",main:""},null,8,["icon"]),a($,{"is-form":"",class:"row-span-2 mb-6",onSubmit:e[2]||(e[2]=H(s=>O(),["prevent"]))},{footer:i(()=>[a(k,{type:"submit",color:"success",label:"Start Claim"}),x.value?(r(),b(W,{key:0,path:d(ee),color:"text-yellow-500",class:"animate animate-spin"},null,8,["path"])):_("",!0)]),default:i(()=>[e[6]||(e[6]=t("h2",{class:"text-xl mb-6 lg:w-1/2"}," If you registered a card in game and need to claim it, you may do so here. Please note that the account cannot already be claimed! ",-1)),a(V,{label:"Card ID",help:"The 16 character ACCESS CODE. If your card is dated after 2016, you'll need to get the ACCESS CODE from a game."},{default:i(()=>[a(U,{modelValue:l.cardId,"onUpdate:modelValue":e[0]||(e[0]=s=>l.cardId=s),icon:d(K),name:"cardId",type:"card",placeholder:"XXXX-XXXX-XXXX-XXXX",minlength:19,maxlength:19,required:"",onInput:v},null,8,["modelValue","icon"])]),_:1}),a(V,{label:"PIN",help:"Used when logging into a game"},{default:i(()=>[a(U,{modelValue:l.pin,"onUpdate:modelValue":e[1]||(e[1]=s=>l.pin=s),icon:d(Q),type:"password",name:"pin",minlength:4,maxlength:4,inputmode:"numeric",pattern:"\\d{4}",autocomplete:"pin",onInput:M},null,8,["modelValue","icon"])]),_:1})]),_:1})],64)),u.value&&m.value==null?(r(),h("div",xe,[a(I,{icon:d(T),title:"Select Profiles to Merge",main:""},null,8,["icon"]),a($,null,{default:i(()=>[e[7]||(e[7]=t("h2",{class:"text-xl mb-6"},[N(" Click a game to view merge options. "),t("br"),N(" Please note that this cannot be undone once complete. ")],-1)),t("div",be,[(r(!0),h(A,null,j(L(u.value.profiles),s=>(r(),b(ae,{key:s.game,game:s.game,value:s.data.total_plays,"profile-name":"",type:"plays",class:te(n[s.game]?"border-green-800 border-[3px]":null),"disable-local-click":"",onClick:S=>B(s.game)},null,8,["game","value","class","onClick"]))),128))]),a(V,{label:"Transfer Card",help:"Moves the card to your account."},{default:i(()=>[a(z,{modelValue:n.card,"onUpdate:modelValue":e[3]||(e[3]=s=>n.card=s),"input-value":n.card,icon:d(le),type:"switch",name:"card"},null,8,["modelValue","input-value","icon"])]),_:1}),t("div",Ce,[a(k,{color:"success",label:"Start Merge",disabled:JSON.stringify(n)==JSON.stringify({}),onClick:P},null,8,["disabled"])])]),_:1})])):_("",!0),m.value==!0?(r(),h("div",we,[a(I,{icon:d(E),title:"Merge Results",main:""},null,8,["icon"]),a($,null,{default:i(()=>[t("h2",$e," ✅ Successfully merged "+C(y.value)+" records. Yippie! ",1),t("div",ke,[a(k,{color:"success",label:"Return to Dashboard",href:"#/"})])]),_:1})])):_("",!0),m.value==!1?(r(),h("div",Me,[a(I,{icon:d(E),title:"Merge Results",main:""},null,8,["icon"]),a($,null,{default:i(()=>[e[8]||(e[8]=t("h2",{class:"text-xl mb-6"},"❌ Failed to merge. Please try again.",-1)),t("div",Se,[a(k,{color:"warning",label:"Retry",onClick:P})])]),_:1})])):_("",!0),f.value?(r(),b(fe,{key:4,game:c.value.game,"user-id":u.value.userId,settings:n[c.value.game],onSaveMerge:G,onCloseModal:e[4]||(e[4]=s=>f.value=!1)},null,8,["game","user-id","settings"])):_("",!0),g.value?(r(),b(he,{key:5,game:c.value.game,settings:n,onSaveMerge:J,onCloseModal:e[5]||(e[5]=s=>g.value=!1)},null,8,["game","settings"])):_("",!0)]),_:1})]),_:1}))}};export{Pe as default};
