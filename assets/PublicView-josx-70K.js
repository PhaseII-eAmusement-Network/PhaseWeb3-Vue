import{u as ne,a as re,b as ie,r as P,o as ue,al as g,p as de,c as C,d as i,w as r,e as t,_ as ce,j as c,f as _,F as h,i as m,P as S,g as u,x as me,O as pe,am as fe,h as O,v as N,Q as T,an as ve,z as ge,y as E,l as A,k as B,t as be,ao as ye,ap as we,aq as _e,ab as he,ar as Pe,as as Se,at as xe,n as ke,au as Ve,a7 as Ue,av as q,aw as x,ax as $e}from"./index-D0hKoGh3.js";import{_ as b}from"./FormField-CdaWEeMy.js";import{_ as k}from"./FormControl-dmBiWM7h.js";import{_ as M}from"./FormCheckRadio-DJ3otjdO.js";import{A as Ce,a as Oe}from"./admin-D9keMNBw.js";const Ae={class:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6"},Ie={class:"grid md:grid-cols-2 gap-x-4 mb-6"},De={key:0,class:"space-x-2 mt-6 mb-4"},Te={class:"grid gap-4 md:grid-cols-2"},Ee={class:"md:flex w-full place-content-between"},Be={class:"text-md md:text-lg"},Fe={class:"flex align-middle mt-2 md:mt-0 max-h-12"},Ne={class:"grid grid-cols-2 sm:grid-cols-3 gap-6 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 3xl:grid-cols-5 mb-6"},qe={class:"grid grid-flow-row auto-rows-auto grid-cols-2 md:grid-cols-2 xl:grid-cols-3 2xl:grid-cols-3 3xl:grid-cols-4 4xl:grid-cols-6 gap-5 mb-5"},Me={key:0},Qe={__name:"PublicView",setup(Re){const R=ne(),j=re(),G=ie(),V=j.params.id,o=P(null),d=P(null),p=P(null),y=P(null);async function U(){try{d.value=null;var l=await Ve(V);l.name||(l.name="Unclaimed Account"),d.value=l,o.value=JSON.parse(JSON.stringify(l))}catch(e){console.error("Failed to fetch user profile data:",e)}}ue(async()=>{await U(),p.value=d.value.profiles,y.value=d.value.userScoreStats});const J=g(()=>{var l;return(l=p.value)==null?void 0:l.reduce((e,s)=>e+s.data.total_plays,0)}),L=g(()=>{var l;return(l=p.value)==null?void 0:l.length}),H=g(()=>{var s;const l=n=>{const a={};return n.forEach(v=>{const w=new Date(v*1e3).toISOString().split("T")[0];a[w]=(a[w]||0)+1}),a};var e=0;return(s=p.value)==null||s.forEach(n=>{var $,D;const a=($=n.data)!=null&&$.arcade_history?(D=n.data)==null?void 0:D.arcade_history:{},v=[];Object.values(a).forEach(se=>{Object.values(se).forEach(oe=>{v.push(...oe)})});const w=l(v),I=Math.max(...Object.values(w));e=Math.max(e,I)}),e});function Q(l){if(l){var e=[];for(const s of l){const n=Ue(s.game);n&&!n.skip&&e.push(s)}return e.sort(function(s,n){return n.data.last_play_timestamp-s.data.last_play_timestamp}),e}}const F=new Date().toISOString().split("T")[0],z=g(()=>{var l,e;return((e=(l=y.value)==null?void 0:l.attempts)==null?void 0:e.length)||0}),K=g(()=>{var l,e;return((e=(l=y.value)==null?void 0:l.records)==null?void 0:e.length)||0}),W=g(()=>{var l,e;return((e=(l=y.value)==null?void 0:l.attempts)==null?void 0:e.filter(s=>new Date(s.timestamp*1e3).toISOString().split("T")[0]===F).length)||0}),X=g(()=>{var l,e;return((e=(l=y.value)==null?void 0:l.records)==null?void 0:e.filter(s=>new Date(s.timestamp*1e3).toISOString().split("T")[0]===F).length)||0}),Y=g(()=>{var s;const l=new Date().toISOString().split("T")[0];let e=0;return(s=p.value)==null||s.forEach(n=>{var v;const a=((v=n.data)==null?void 0:v.arcade_history)||{};Object.values(a).forEach(w=>{Object.values(w).forEach(I=>{I.forEach($=>{new Date($*1e3).toISOString().split("T")[0]===l&&e++})})})}),e}),Z=P([{label:"Cumulative Plays",icon:q,iconColor:"text-emerald-600",suffix:"play",number:J},{label:"Games Played",icon:x,iconColor:"text-sky-300",suffix:"game",number:L},{label:"Plays Today",icon:q,iconColor:"text-sky-300",suffix:"play",number:Y},{label:"Longest Play Streak",icon:$e,iconColor:"text-red-500",suffix:"play",number:H},{label:"Total Records",icon:x,iconColor:"text-sky-300",suffix:"record",number:K},{label:"Total Attempts",icon:x,iconColor:"text-sky-300",suffix:"attempt",number:z},{label:"Records Today",icon:x,iconColor:"text-sky-300",suffix:"record",number:X},{label:"Attempts Today",icon:x,iconColor:"text-sky-300",suffix:"attempt",number:W}]);function ee(l){l.target.value=l.target.value.replace(/\D/g,"")}async function ae(){(await Ce(V,o.value)).status!=="success"?window.alert("Failed to update user!"):U()}const f=de({newPassword:"",confirmPassword:""});async function le(){(await Oe(V,f.newPassword,f.confirmPassword)).status=="success"?(alert("Password changed."),f.newPassword=null,f.confirmPassword=null,await U()):alert("Failed to update password. Check that both passwords match.")}const te=l=>{const e=l.id;G.push(`/arcade/${e}`)};return(l,e)=>(i(),C(ke,null,{default:r(()=>[t(ce,null,{default:r(()=>{var s,n;return[d.value!==null?(i(),c(h,{key:0},[t(S,{icon:u(me),title:`${d.value.name}'s Profile`,main:""},null,8,["icon","title"]),t(pe,{class:"mb-6","override-profile":d.value,"use-small":""},null,8,["override-profile"]),u(R).userAdmin?(i(),c(h,{key:0},[t(S,{icon:u(fe),title:"User Administration",main:""},null,8,["icon"]),m("div",Ae,[t(O,{"is-form":"",class:"",onSubmit:N(ae,["prevent"])},{default:r(()=>[t(T,{color:"info",label:"General Information",icon:u(ve),class:"mb-2"},null,8,["icon"]),m("div",Ie,[t(b,{label:"Username"},{default:r(()=>[t(k,{modelValue:o.value.name,"onUpdate:modelValue":e[0]||(e[0]=a=>o.value.name=a),"input-value":o.value.name,name:"username",required:""},null,8,["modelValue","input-value"])]),_:1}),t(b,{label:"E-mail",help:"Used for password resetting and 2FA"},{default:r(()=>[t(k,{modelValue:o.value.email,"onUpdate:modelValue":e[1]||(e[1]=a=>o.value.email=a),icon:u(ge),type:"email",name:"email",required:""},null,8,["modelValue","icon"])]),_:1}),t(b,{label:"PIN",help:"Used when logging into a game"},{default:r(()=>[t(k,{modelValue:o.value.pin,"onUpdate:modelValue":e[2]||(e[2]=a=>o.value.pin=a),icon:u(E),type:"password",name:"pin",minlength:4,maxlength:4,inputmode:"numeric",pattern:"\\d{4}",onInput:ee},null,8,["modelValue","icon"])]),_:1})]),t(b,{label:"Public Profile",help:"Show this profile publicly. If disabled, only game profiles and scores will be visible."},{default:r(()=>[t(M,{modelValue:o.value.public,"onUpdate:modelValue":e[3]||(e[3]=a=>o.value.public=a),name:"public","model-value":o.value.public,"input-value":o.value.public,type:"switch"},null,8,["modelValue","model-value","input-value"])]),_:1}),t(b,{label:"Ban Profile",help:"Ban this profile. Locks out all arcades that this user manages."},{default:r(()=>[t(M,{modelValue:o.value.banned,"onUpdate:modelValue":e[4]||(e[4]=a=>o.value.banned=a),name:"banned","model-value":o.value.banned,"input-value":o.value.banned,type:"switch"},null,8,["modelValue","model-value","input-value"])]),_:1}),JSON.stringify(d.value)!==JSON.stringify(o.value)?(i(),c("div",De,[t(A,{color:"success",label:"Save",type:"submit"}),t(A,{color:"warning",label:"Revert",onClick:e[5]||(e[5]=a=>U())})])):_("",!0)]),_:1}),t(O,{"is-form":"",onSubmit:e[8]||(e[8]=N(a=>le(),["prevent"]))},{footer:r(()=>[t(A,{type:"submit",color:"success",label:"Update"})]),default:r(()=>[t(T,{color:"info",label:"Change Password",class:"mb-2"}),t(b,{label:"New Password"},{default:r(()=>[t(k,{modelValue:f.newPassword,"onUpdate:modelValue":e[6]||(e[6]=a=>f.newPassword=a),icon:u(E),name:"newPassword",type:"password",required:""},null,8,["modelValue","icon"])]),_:1}),t(b,{label:"Confirm Password"},{default:r(()=>[t(k,{modelValue:f.confirmPassword,"onUpdate:modelValue":e[7]||(e[7]=a=>f.confirmPassword=a),icon:u(E),name:"confirmPassword",type:"password",required:""},null,8,["modelValue","icon"])]),_:1})]),_:1}),(n=(s=d.value)==null?void 0:s.arcades)!=null&&n.length?(i(),C(O,{key:0,class:"mb-6"},{default:r(()=>[t(T,{color:"info",label:"Arcades",class:"mb-2"}),m("div",Te,[(i(!0),c(h,null,B(d.value.arcades,a=>(i(),c("div",{key:a.id,class:"bg-slate-800 p-4 rounded-xl"},[m("div",Ee,[m("div",null,[m("h1",Be,be(a.name),1)]),m("div",Fe,[t(A,{label:"Open Arcade",color:"info",onClick:v=>te(a)},null,8,["onClick"])])])]))),128))])]),_:1})):_("",!0)])],64)):_("",!0),t(S,{icon:u(ye),title:"Quick Stats",main:""},null,8,["icon"]),m("div",Ne,[(i(!0),c(h,null,B(Z.value,a=>(i(),c(h,{key:a.label},[a.number?(i(),C(we,{key:0,icon:a.icon,number:a.number,label:a.label,suffix:`${a.suffix}${a.number==1?"":"s"}`,"icon-color":a.iconColor},null,8,["icon","number","label","suffix","icon-color"])):_("",!0)],64))),128))]),t(S,{icon:u(_e),title:"Showcase",main:""},null,8,["icon"]),m("div",qe,[(i(!0),c(h,null,B(Q(p.value),a=>(i(),C(he,{key:a.game,game:a.game,value:a.data.total_plays,"user-id":u(V),"profile-name":a==null?void 0:a.username,type:"plays"},null,8,["game","value","user-id","profile-name"]))),128))]),t(S,{icon:u(Pe),title:"Play Trends",main:""},null,8,["icon"]),t(O,{class:"mb-6"},{default:r(()=>[p.value?(i(),c("div",Me,[t(Se,{data:u(xe)(p.value,y.value),class:"h-96"},null,8,["data"])])):_("",!0)]),_:1})],64)):_("",!0)]}),_:1})]),_:1}))}};export{Qe as default};
