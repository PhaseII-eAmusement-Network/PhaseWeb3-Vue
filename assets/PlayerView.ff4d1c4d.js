import{b as ie,r as q,o as X,c as l,k as f,l as B,e as d,w as m,j as r,f as c,X as O,n,t as p,_ as N,F as g,u as ne,a as oe,a5 as ue,s as ce,M as de,p as me,g as i,m as _e,i as M,aQ as fe,W as T,aJ as pe,aK as be,aF as ye,am as y,A as ve,U as w,aR as ge,aS as ke,aT as he,aU as we,q as Se}from"./index.50d624cf.js";import{_ as xe,g as z,a as L}from"./ProfileCard.75eed2e7.js";import{_ as Ve}from"./FormControl.72f8cf1c.js";import{_ as $e}from"./UserSticker.35490213.js";import{A as De}from"./profile.664336c0.js";import{A as Pe}from"./arcade.e13c8430.js";import{g as R}from"./danClass.233b0381.js";import"./userData.bcc92478.js";const je={class:"flex space-x-2 mb-2"},Ae={class:"flex justify-between items-center"},Te={class:"grid"},Ne={class:"text-lg font-bold"},Ie={class:"text-md"},Ce={class:"text-lg"},Je={class:"text-lg"},H={__name:"JubilityTable",props:{jubilityData:{type:Array,required:!0},version:{type:Number,required:!0}},setup(U){const E=ie(),k=q(null),$=U,v={0:{label:"Basic",color:"info"},1:{label:"Advanced",color:"warning"},2:{label:"Extreme",color:"danger"}};return X(async()=>{try{k.value=null;const u=$.jubilityData.map(s=>s.song_id),D=await E.getMusicData("jubeat",$.version,u),_=$.jubilityData.map(s=>{const t=D.find(P=>P.id===s.song_id&&P.chart===s.chart);return{...s,...t?{songData:t}:{}}});_.sort((s,t)=>t.rate-s.rate),k.value=_}catch(u){console.error("Failed to fetch music data:",u)}}),(u,D)=>k.value?(l(!0),f(g,{key:0},B(k.value,_=>(l(),d(N,{key:_.id,"color-prop":"bg-slate-800 dark:bg-slate-800",class:"my-3 p-5","has-table":""},{default:m(()=>[r("div",je,[c(O,{label:v[_.chart].label,color:v[_.chart].color},null,8,["label","color"]),_.hard?(l(),d(O,{key:0,label:"Hard Mode",color:"danger"})):n("",!0)]),r("div",Ae,[r("div",Te,[r("h1",Ne,p(_.songData.name),1),r("h2",Ie,p(_.songData.artist),1)]),r("div",null,[r("h2",Ce,"Jubility: "+p(_.value/10),1),r("h2",Je,"Rate: "+p(_.rate/10),1)])])]),_:2},1024))),128)):n("",!0)}},Fe={class:"md:flex pb-6 md:justify-between md:items-center"},Le={key:0,class:"mt-2 md:mt-0 md:w-1/3 md:text-right"},Be=["src"],Oe={class:"bg-white dark:bg-slate-900/90 rounded-2xl pt-6 p-3 card-content"},Ee={class:"w-full"},Ge={class:"md:w-1/3 grid grid-cols-1 md:grid-cols-2 gap-3"},Me={class:"my-6 grid grid-cols-1 md:grid-cols-4 gap-6"},Re={class:"my-6 grid grid-cols-2 md:grid-cols-5 xl:grid-cols-6 gap-6"},Ue={class:"my-6 grid grid-cols-1 md:grid-cols-2 gap-6"},ze={class:"my-6"},He={class:"my-6"},qe={class:"border-s border-neutral-300 md:flex md:justify-start md:gap-10 md:border-s-0 md:border-t md:overflow-x-auto overflow-y-visible md:whitespace-nowrap scrollbar"},Xe={class:"flex-start flex items-center pt-2 md:block md:pt-4"},Ke={class:"mt-2 text-sm font-light"},Qe={class:"ms-4 pb-6 md:ms-0"},We={class:"text-lg font-semibold"},it={__name:"PlayerView",setup(U){const E="https://cdn.phaseii.network/file/PhaseII/web-assets",k=ne(),$=oe();var v=null,u=null,D=null,_=!0;v=k.params.game,D=k.params.userId,u=ue(v),u||$.push({name:"ErrorPage",params:{catchAll:"404"}});const s=ce({currentVersion:null});de(()=>s.currentVersion,()=>{_?_=!1:P()});const t=q(null);X(async()=>{P()}),u.versions||(s.currentVersion=1);async function P(){try{t.value=null;var a=await De(v,s.currentVersion,D);a.timeline=await re(a),t.value=le(a),a&&!s.currentVersion&&(s.currentVersion=a.versions[a.versions.length-1])}catch(e){console.error("Failed to fetch user profile data:",e)}}async function K(a){try{return await Pe(a)}catch(e){console.error("Failed to fetch arcade data:",e)}}var Q=[{label:"Register Date",type:String,span:"md:col-span-2",key:"first_play_timestamp"},{label:"Last Play",type:String,span:"md:col-span-2",key:"last_play_timestamp"},{label:"First Arcade",type:String,span:"md:col-span-2",key:"first_play_arcade"},{label:"Last Arcade",type:String,span:"md:col-span-2",key:"last_play_arcade"},{label:"Total Plays",type:Number,key:"total_plays"},{label:"EXP",type:Number,key:"exp"},{label:"SP Plays",type:Number,key:"single_plays"},{label:"DP Plays",type:Number,key:"double_plays"},{label:"SP DJPOINT",type:Number,key:"single_dj_points"},{label:"DP DJPOINT",type:Number,key:"double_dj_points"}];function W(){return s.currentVersion?`${E}/games/${u.id}/card/${s.currentVersion}.webp`:u.cardBG}function Y(){var a;return s.currentVersion&&((a=u.videoTable)==null?void 0:a.includes(s.currentVersion))?`https://cdn.phaseii.network/file/PhaseII/game-assets/video/${u.id}/${s.currentVersion}.mp4`:null}function Z(){var a;return(a=u.videoTable)!=null&&a.includes(s.currentVersion)?null:`
      background-image: url('${W()}');
      background-size: cover;
      background-repeat: no-repeat;
    `}function ee(a,e){if(e){if(a.isSkill&&e.jubility)return z(e.jubility);if(a.isJubility&&e.records.skill)return L(e.records.skill)}return""}function te(a){var e=[];for(const b of u.versions)a.includes(b.id)&&e.push(b);return e}function ae(a,e){return a.isSkill?e.stats[a.key]/100:a.isJubility?e.stats[a.key]/10:e.stats[a.key]}function le(a){if(a.stats){if(a.stats.first_play_timestamp){const e=new Date(a.stats.first_play_timestamp*1e3);a.stats.first_play_timestamp=e.toLocaleString()}if(a.stats.last_play_timestamp){const e=new Date(a.stats.last_play_timestamp*1e3);a.stats.last_play_timestamp=e.toLocaleString()}a.dp&&a.dp.dan!==void 0&&(a.dp.dan=R(a.dp.dan).short)}return a}function se(a){var b;const e=(b=a.stats)==null?void 0:b.count;return e?[e.mfc!=null?{label:"MFCs",value:e.mfc}:0,e.pfc!=null?{label:"PFCs",value:e.pfc}:0,e.fc!=null?{label:"GFCs",value:e.fc}:0,e.gfc!=null?{label:"FCs",value:e.gfc}:0,e.life4!=null?{label:"Life-4 Clears",value:e.life4}:0]:[]}async function re(a){const e=a==null?void 0:a.stats,b=e==null?void 0:e.first_play_timestamp,S=e==null?void 0:e.last_play_timestamp,j=e==null?void 0:e.arcade_history,h=[];if(b&&h.push({timestamp:new Date(b*1e3).toLocaleString(),arcade:e==null?void 0:e.first_play_arcade,first_play:!0}),j)for(const[x,V]of Object.entries(j)){const I=await K(x);for(const[C,J]of Object.entries(V))for(const A of J){const F=new Date(A*1e3);[b,S].includes(A)||h.push({timestamp:F.toLocaleString(),arcade:I.name,machineId:C,first_play:!1})}}return S&&h.push({timestamp:new Date(S*1e3).toLocaleString(),arcade:e==null?void 0:e.last_play_arcade,first_play:!1}),h.sort((x,V)=>new Date(x.timestamp).getTime()-new Date(V.timestamp).getTime())}return(a,e)=>(l(),d(Se,null,{default:m(()=>[t.value?(l(),d(me,{key:0},{default:m(()=>{var b,S,j,h,x,V,I,C,J,A,F;return[r("div",Fe,[c(M,{icon:i(_e),href:`/#/games/${i(v)}`,class:"w-full md:w-auto",color:"info",label:`${i(u).shortName?i(u).shortName:i(u).name} Home`},null,8,["icon","href","label"]),i(u).versions&&t.value?(l(),f("div",Le,[e[1]||(e[1]=r("h2",{class:"text-md sm:text-lg md:text-xl font-bold p-2"}," Select Version ",-1)),c(Ve,{modelValue:s.currentVersion,"onUpdate:modelValue":e[0]||(e[0]=o=>s.currentVersion=o),options:te(t.value.versions)},null,8,["modelValue","options"])])):n("",!0)]),c(T,{icon:i(fe),title:"View Profile",main:""},null,8,["icon"]),s.currentVersion&&t.value?(l(),f("div",{key:0,style:ye(Z()),class:"rounded-2xl mb-6 card-container"},[r("video",{autoplay:"",muted:"",loop:"",playsinline:"",src:Y(),class:"background-video"},null,8,Be),r("div",Oe,[r("div",Ee,[c(xe,{"use-small":"",game:i(v),version:s.currentVersion,profile:t.value},{default:m(()=>[r("div",Ge,[c(M,{href:`/#/games/${i(v)}/scores/${t.value.userId}`,icon:i(pe),class:"w-full md:w-auto",color:"info",label:"View Scores"},null,8,["href","icon"]),c(M,{href:`/#/games/${i(v)}/records/${t.value.userId}`,icon:i(be),class:"w-full md:w-auto",color:"info",label:"View Records"},null,8,["href","icon"])])]),_:1},8,["game","version","profile"])])])],4)):n("",!0),r("div",Me,[(l(!0),f(g,null,B(i(Q),o=>(l(),f(g,{key:o},[t.value.stats[o.key]?(l(),d(y,{key:0,class:ve(o.span),label:o.label,number:o.type==Number?ae(o,t.value):null,"num-color":ee(o)},{default:m(()=>[w(p(o.type==String?t.value.stats[o.key]:null),1)]),_:2},1032,["class","label","number","num-color"])):n("",!0)],64))),128)),(S=(b=t.value.stats)==null?void 0:b.count)!=null&&S.records?(l(),d(y,{key:0,label:"Records",number:(h=(j=t.value.stats)==null?void 0:j.count)==null?void 0:h.records},null,8,["number"])):n("",!0),(V=(x=t.value.stats)==null?void 0:x.count)!=null&&V.attempts?(l(),d(y,{key:1,label:"Attempts",number:(C=(I=t.value.stats)==null?void 0:I.count)==null?void 0:C.attempts},null,8,["number"])):n("",!0),t.value.skill?(l(),d(y,{key:2,label:"Skill Points",number:t.value.skill/100,"num-color":i(z)(t.value.skill)},null,8,["number","num-color"])):n("",!0),t.value.profile_skill?(l(),d(y,{key:3,label:"Skill Level"},{default:m(()=>[w(p(t.value.profile_skill/100),1)]),_:1})):n("",!0),t.value.jubility?(l(),d(y,{key:4,label:"Jubility","num-color":i(L)(t.value.jubility)},{default:m(()=>[w(p(t.value.jubility/10),1)]),_:1},8,["num-color"])):n("",!0),t.value.pick_up_jubility?(l(),d(y,{key:5,label:"Pick-Up Jubility","num-color":i(L)(t.value.pick_up_jubility)},{default:m(()=>[w(p(t.value.pick_up_jubility/10),1)]),_:1},8,["num-color"])):n("",!0),t.value.common_jubility?(l(),d(y,{key:6,label:"Common Jubility","num-color":i(L)(t.value.common_jubility)},{default:m(()=>[w(p(t.value.common_jubility/10),1)]),_:1},8,["num-color"])):n("",!0),t.value.deller?(l(),d(y,{key:7,label:"Deller",number:t.value.deller},null,8,["number"])):n("",!0),t.value.sgrade?(l(),d(y,{key:8,label:"SP DAN"},{default:m(()=>[w(p(i(R)(t.value.sgrade).label),1)]),_:1})):n("",!0),t.value.dgrade?(l(),d(y,{key:9,label:"DP DAN"},{default:m(()=>[w(p(i(R)(t.value.dgrade).label),1)]),_:1})):n("",!0)]),(J=t.value.stats)!=null&&J.count?(l(),f(g,{key:1},[c(T,{icon:i(ge),title:"Stats",main:""},null,8,["icon"]),r("div",Re,[(l(!0),f(g,null,B(se(t.value),o=>(l(),f(g,{key:o},[o?(l(),d(y,{key:0,label:o.label,number:o},null,8,["label","number"])):n("",!0)],64))),128))])],64)):n("",!0),t.value.jubility?(l(),f(g,{key:2},[c(T,{icon:i(ke),title:"Jubility Breakdown",main:""},null,8,["icon"]),r("div",Ue,[t.value.pick_up_breakdown?(l(),d(N,{key:0},{default:m(()=>[c(O,{label:"Pick-Up",color:"info"}),c(H,{"jubility-data":t.value.pick_up_breakdown,",":"",version:s.currentVersion},null,8,["jubility-data","version"])]),_:1})):n("",!0),t.value.other_breakdown?(l(),d(N,{key:1},{default:m(()=>[c(O,{label:"Common",color:"info"}),c(H,{"jubility-data":t.value.other_breakdown,",":"",version:s.currentVersion},null,8,["jubility-data","version"])]),_:1})):n("",!0)])],64)):n("",!0),(A=t.value)!=null&&A.trbitem?(l(),f(g,{key:3},[c(T,{icon:i(he),title:"Sticker Board",main:""},null,8,["icon"]),r("div",ze,[c(N,{class:"w-full grid place-content-center"},{default:m(()=>[c($e,{version:s.currentVersion,profile:t.value,size:290},null,8,["version","profile"])]),_:1})])],64)):n("",!0),(F=t.value)!=null&&F.timeline?(l(),f(g,{key:4},[c(T,{icon:i(we),title:"Timeline",main:""},null,8,["icon"]),r("div",He,[c(N,null,{default:m(()=>{var o;return[r("ol",qe,[(l(!0),f(g,null,B(JSON.parse(JSON.stringify((o=t.value)==null?void 0:o.timeline)).reverse(),G=>(l(),f("li",{key:G.timestamp,class:"md:inline-block flex-shrink-0"},[r("div",Xe,[e[2]||(e[2]=r("div",{class:"-ms-[6px] me-3 h-[12px] w-[12px] md:w-0.5 md:h-4 rounded-full md:rounded-none bg-gray-300 md:-mt-6 md:me-0 md:ms-0"},null,-1)),r("p",Ke,p(G.timestamp),1)]),r("div",Qe,[r("h4",We,p(G.arcade),1)])]))),128))])]}),_:1})])],64)):n("",!0)]}),_:1})):n("",!0)]),_:1}))}};export{it as default};
