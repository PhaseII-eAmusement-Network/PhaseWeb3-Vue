import{R as W,S as H,U as B,j as f,d as r,V as K,f as A,i,W as Q,u as z,a as X,b as Y,r as E,n as O,c as g,w as s,e as n,_ as ee,J as ae,g as w,h as M,K as k,l as I,v as j,ao as te,s as ne,F as le,k as oe,t as $,m as ie,a4 as se}from"./index-Dk9pwBdW.js";import{H as re}from"./PhCheckCircle.vue-DeCxgRCL.js";import{F as de}from"./PhGear.vue-DnXNk9Uc.js";import{H as R}from"./PhInfo.vue-D6BD9LTn.js";import{_ as d}from"./FormField-Cvxm0MqE.js";import{_ as m}from"./FormCheckRadio-ZJiFBCoe.js";import{_ as D}from"./FormControl-B19TdIcj.js";import{c as ue,d as ce,e as me}from"./admin-CtcYpd4i.js";import{g as q}from"./pcbid-CIkJuo1f.js";const pe=["width","height","fill","transform"],fe={key:0},be=i("path",{d:"M250.82,170.8A12,12,0,0,0,240,164H148V148h68a12,12,0,0,0,8.88-20.07L148,43.36V12a12,12,0,0,0-21.19-7.71l-104,124A12,12,0,0,0,32,148h92v16H16a12,12,0,0,0-9.37,19.5l29.6,37A19.9,19.9,0,0,0,51.84,228H204.16a19.9,19.9,0,0,0,15.61-7.51l29.6-37A12,12,0,0,0,250.82,170.8ZM188.87,124H148V79ZM57.73,124,124,45v79Zm144.5,80H53.77L41,188H215Z"},null,-1),ge=[be],he={key:1},ve=i("path",{d:"M240,176l-29.6,37a8,8,0,0,1-6.24,3H51.84a8,8,0,0,1-6.24-3L16,176ZM136,8,32,136H136Z",opacity:"0.2"},null,-1),Ve=i("path",{d:"M247.21,172.53A8,8,0,0,0,240,168H144V144h72a8,8,0,0,0,5.92-13.38L144,44.91V8a8,8,0,0,0-14.21-5l-104,128A8,8,0,0,0,32,144h96v24H16a8,8,0,0,0-6.25,13l29.6,37a15.93,15.93,0,0,0,12.49,6H204.16a15.93,15.93,0,0,0,12.49-6l29.6-37A8,8,0,0,0,247.21,172.53ZM197.92,128H144V68.69ZM48.81,128,128,30.53V128Zm155.35,80H51.84l-19.2-24H223.36Z"},null,-1),we=[ve,Ve],ye={key:2},Ie=i("path",{d:"M160,140V72.85a4,4,0,0,1,7-2.69l55,60.46a8,8,0,0,1,.43,10.26,8.24,8.24,0,0,1-6.58,3.12H164A4,4,0,0,1,160,140Zm87.21,32.53A8,8,0,0,0,240,168H144V8a8,8,0,0,0-14.21-5l-104,128A8,8,0,0,0,32,144h96v24H16a8,8,0,0,0-6.25,13l29.6,37a15.93,15.93,0,0,0,12.49,6H204.16a15.93,15.93,0,0,0,12.49-6l29.6-37A8,8,0,0,0,247.21,172.53Z"},null,-1),De=[Ie],Ae={key:3},Ce=i("path",{d:"M245.41,173.4A6,6,0,0,0,240,170H142V142h74a6,6,0,0,0,4.44-10L142,45.68V8a6,6,0,0,0-10.66-3.78l-104,128A6,6,0,0,0,32,142h98v28H16a6,6,0,0,0-4.69,9.75l29.6,37A14,14,0,0,0,51.84,222H204.16a14,14,0,0,0,10.93-5.25l29.6-37A6,6,0,0,0,245.41,173.4Zm-43-43.4H142V63.52ZM44.61,130,130,24.9V130Zm161.11,79.25a2,2,0,0,1-1.56.75H51.84a2,2,0,0,1-1.56-.75L28.48,182h199Z"},null,-1),Pe=[Ce],_e={key:4},He=i("path",{d:"M247.21,172.53A8,8,0,0,0,240,168H144V144h72a8,8,0,0,0,5.92-13.38L144,44.91V8a8,8,0,0,0-14.21-5l-104,128A8,8,0,0,0,32,144h96v24H16a8,8,0,0,0-6.25,13l29.6,37a15.93,15.93,0,0,0,12.49,6H204.16a15.93,15.93,0,0,0,12.49-6l29.6-37A8,8,0,0,0,247.21,172.53ZM197.92,128H144V68.69ZM48.81,128,128,30.53V128Zm155.35,80H51.84l-19.2-24H223.36Z"},null,-1),Be=[He],Me={key:5},ke=i("path",{d:"M243.61,174.27A4,4,0,0,0,240,172H140V140h76a4,4,0,0,0,3-6.69L140,46.45V8a4,4,0,0,0-7.1-2.52l-104,128A4,4,0,0,0,32,140H132v32H16a4,4,0,0,0-3.12,6.5l29.59,37a12,12,0,0,0,9.37,4.5H204.16a12,12,0,0,0,9.37-4.5l29.59-37A4,4,0,0,0,243.61,174.27ZM207,132H140V58.35ZM40.4,132,132,19.27V132Zm166.88,78.5a4,4,0,0,1-3.12,1.5H51.84a4,4,0,0,1-3.12-1.5L24.32,180H231.68Z"},null,-1),$e=[ke],Ne={name:"PhSailboat"},Le=W({...Ne,props:{weight:{type:String},size:{type:[String,Number]},color:{type:String},mirrored:{type:Boolean}},setup(h){const u=h,c=H("weight","regular"),N=H("size","1em"),C=H("color","currentColor"),P=H("mirrored",!1),p=B(()=>u.weight??c),_=B(()=>u.size??N),L=B(()=>u.color??C),v=B(()=>u.mirrored!==void 0?u.mirrored?"scale(-1, 1)":void 0:P?"scale(-1, 1)":void 0);return(y,t)=>(r(),f("svg",Q({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 256 256",width:_.value,height:_.value,fill:L.value,transform:v.value},y.$attrs),[K(y.$slots,"default"),p.value==="bold"?(r(),f("g",fe,ge)):p.value==="duotone"?(r(),f("g",he,we)):p.value==="fill"?(r(),f("g",ye,De)):p.value==="light"?(r(),f("g",Ae,Pe)):p.value==="regular"?(r(),f("g",_e,Be)):p.value==="thin"?(r(),f("g",Me,$e)):A("",!0)],16,pe))}}),F=z();async function Se(h,u){try{return await F.callApi(`/discord/exportVPN/${h}?discordId=${u}`)}catch(c){throw console.log("Error exporting vpn:",c),c}}async function Ue(h,u){try{return await F.callApi(`/discord/onboardArcade/${h}?discordId=${u}`)}catch(c){throw console.log("Error onboarding arcade:",c),c}}const Ze={class:"grid grid-cols-1 gap-6"},xe={class:"mb-4 flex gap-2 items-stretch"},Ee={class:"grid grid-cols-1 w-full gap-2 md:gap-6 md:flex md:place-content-stretch"},Oe={class:"grid md:grid-cols-2 gap-6"},je={class:"grid grid-cols-1 w-full gap-2 md:gap-6 md:flex md:place-content-stretch pb-4 md:pb-0"},Re={class:"grid gap-4"},qe={class:"flex justify-between items-center"},ze={class:"m-[-5px]"},Fe={class:"text-md font-bold"},Ge={class:"text-sm"},Je={class:"text-sm font-mono"},Te={class:"grid md:flex gap-4"},la={__name:"OnboardingView",setup(h){const u=X(),c=Y(),N=z(),C=u.params.data,P=E(null);function p(l){try{const e=Uint8Array.from(atob(l),b=>b.charCodeAt(0)),a=new TextDecoder().decode(e);return JSON.parse(a)}catch(e){return console.error("Invalid base64 input or JSON parse error:",e),null}}function _(l){const e=[];return typeof l!="object"||l===null?["data is not an object"]:(typeof l.userId!="string"&&e.push("userId must be a string"),typeof l.type!="string"&&e.push("type must be a string"),typeof l.arcadeName!="string"&&e.push("arcadeName must be a string"),typeof l.cabinetCount!="number"&&e.push("cabinetCount must be a number"),Array.isArray(l.games)?l.games.every(a=>typeof a=="string")||e.push("games must be an array of strings"):e.push("games must be an array"),e)}async function L(){const l=P.value;t.useDiscord=!0,t.discordId=l.userId,t.name=l.arcadeName,await Z();for(const e of l.games){if(e==="main")o.name=`${t.name} Main`;else{const a=se(e);a&&(o.name=`${t.name} ${a.shortName?a.shortName:a.name}`)}await U()}}const v={name:"",useDiscord:!0,discordId:"",description:"",paseli:!0,infinitePaseli:!0,maintenance:!1,betas:!1,incognito:!1,machineList:[]},y={name:"",cabinet:!1,ota:!1,generatePCBID:!0,PCBID:""},t=O({...v}),o=O({...y}),S=E(void 0);if(C)try{const l=p(C),e=_(l);e.length?console.error(e):(P.value=JSON.parse(JSON.stringify(l)),L())}catch(l){console.error(l)}async function U(){for(o.generatePCBID&&(o.PCBID=q());!await ce(o.PCBID);)if(o.generatePCBID)o.PCBID=q();else{window.alert("PCBID already in use!");return}t.machineList.push({name:o.name,cabinet:o.cabinet,ota:o.ota,PCBID:o.PCBID.toUpperCase()}),Object.assign(o,y)}function G(l){t.machineList=t.machineList.filter(e=>e.PCBID!==l)}async function Z(){if(t.name){const l=await ue(t.name);l.unused!=null&&(S.value=l.unused)}}function J(l,e="NA_"){var a=[...l].map(b=>b.charCodeAt(0)<128?b:e).join("");return a=a.replace(/[!"#$%&'()*+,-./:;<=>?@[\\\]^_`{|}~]/g,""),a=a.replace(/\s+/g,"_"),a}async function T(l,e){try{const a=await N.getArcadeVPN(l),b=new Blob([a],{type:"application/ovpn"}),V=document.createElement("a");V.href=URL.createObjectURL(b),V.download=`gradius-${J(e.name)}-phaseii-config.ovpn`,document.body.appendChild(V),V.click(),URL.revokeObjectURL(V.href),document.body.removeChild(V)}catch(a){console.log("Failed to fetch arcade data:",a)}}async function x(l){if(t.name==v.name){window.alert("Please input a name.");return}if(t.discordId==v.discordId&&t.useDiscord&&l){window.alert("Please input a Discord ID.");return}if(t.description==v.description&&!t.useDiscord){window.alert("Please input a description.");return}const e=await me(t);l&&e.arcadeId&&(t.useDiscord?(await Ue(e.arcadeId,t.discordId),await Se(e.arcadeId,t.discordId)):await T(e.arcadeId,t)),e.arcadeId?(window.alert("Onboarding complete!"),c.push({name:"arcade",params:{id:e.arcadeId}})):window.alert("Failed to onboard!")}return(l,e)=>(r(),g(ie,null,{default:s(()=>[n(ee,null,{default:s(()=>[n(ae,{icon:w(Le),title:"Arcade Onboarding",color:"text-green-400",main:""},null,8,["icon"]),i("div",Ze,[n(M,{"is-form":"",class:"row-span-1"},{default:s(()=>[n(k,{color:"info",label:"General Information",icon:w(R),class:"mb-2"},null,8,["icon"]),n(d,{label:"Arcade Name"},{default:s(()=>[n(D,{modelValue:t.name,"onUpdate:modelValue":e[0]||(e[0]=a=>t.name=a),"input-value":t.name,name:"arcadeName",required:""},null,8,["modelValue","input-value"])]),_:1}),i("div",xe,[n(I,{color:"info",label:"Check Name",onClick:e[1]||(e[1]=a=>Z())}),S.value==!0?(r(),g(j,{key:0,icon:w(re),color:"text-green-400",size:"25"},null,8,["icon"])):S.value==!1?(r(),g(j,{key:1,icon:w(te),color:"text-red-400",size:"25"},null,8,["icon"])):A("",!0)]),n(d,{label:"Use Discord",help:"Automated provisioning rather than manual. BadManiac will DM the user via Discord."},{default:s(()=>[n(m,{modelValue:t.useDiscord,"onUpdate:modelValue":e[2]||(e[2]=a=>t.useDiscord=a),"input-value":t.useDiscord,name:"useDiscord",type:"switch"},null,8,["modelValue","input-value"])]),_:1}),t.useDiscord?(r(),g(d,{key:0,label:"Discord ID",help:"Owner's Discord User ID."},{default:s(()=>[n(D,{modelValue:t.discordId,"onUpdate:modelValue":e[3]||(e[3]=a=>t.discordId=a),"input-value":t.discordId,name:"discordId",required:""},null,8,["modelValue","input-value"])]),_:1})):A("",!0),t.useDiscord?A("",!0):(r(),g(d,{key:1,label:"Description",help:"Manual description rather than automated."},{default:s(()=>[n(D,{modelValue:t.description,"onUpdate:modelValue":e[4]||(e[4]=a=>t.description=a),name:"description",required:""},null,8,["modelValue"])]),_:1}))]),_:1}),n(M,{"is-form":"",class:"row-span-1"},{default:s(()=>[n(k,{color:"info",label:"Settings",icon:w(de),class:"mb-2"},null,8,["icon"]),i("div",Ee,[n(d,{label:"PASELI Enabled",help:"Enable or disable PASELI services."},{default:s(()=>[n(m,{modelValue:t.paseli,"onUpdate:modelValue":e[5]||(e[5]=a=>t.paseli=a),"input-value":t.paseli,name:"paseli",type:"switch"},null,8,["modelValue","input-value"])]),_:1}),n(d,{label:"Infinite PASELI",help:"Enable or disable infinite PASELI."},{default:s(()=>[n(m,{modelValue:t.infinitePaseli,"onUpdate:modelValue":e[6]||(e[6]=a=>t.infinitePaseli=a),"input-value":t.infinitePaseli,name:"infinitePaseli",type:"switch"},null,8,["modelValue","input-value"])]),_:1}),n(d,{label:"Maintenance Mode",help:"Place this arcade under Maintenance."},{default:s(()=>[n(m,{modelValue:t.maintenance,"onUpdate:modelValue":e[7]||(e[7]=a=>t.maintenance=a),"input-value":t.maintenance,name:"maintenance",type:"switch"},null,8,["modelValue","input-value"])]),_:1}),n(d,{label:"Incognito Mode",help:"Hide the eAmusement network and ranking data."},{default:s(()=>[n(m,{modelValue:t.incognito,"onUpdate:modelValue":e[8]||(e[8]=a=>t.incognito=a),"input-value":t.incognito,name:"incognito",type:"switch"},null,8,["modelValue","input-value"])]),_:1}),n(d,{label:"Beta Testing",help:"Enable or disable beta testing."},{default:s(()=>[n(m,{modelValue:t.betas,"onUpdate:modelValue":e[9]||(e[9]=a=>t.betas=a),"input-value":t.betas,name:"betas",type:"switch"},null,8,["modelValue","input-value"])]),_:1})])]),_:1}),n(M,{class:"row-span-1"},{default:s(()=>[n(k,{color:"info",label:"Machines",icon:w(R),class:"mb-2"},null,8,["icon"]),i("div",Oe,[i("form",{class:"h-full",onSubmit:e[15]||(e[15]=ne(a=>U(),["prevent"]))},[n(d,{label:"Generate PCBID",help:"Generate a PCBID rather than supply one."},{default:s(()=>[n(m,{modelValue:o.generatePCBID,"onUpdate:modelValue":e[10]||(e[10]=a=>o.generatePCBID=a),"input-value":o.generatePCBID,name:"generatePCBID",type:"switch"},null,8,["modelValue","input-value"])]),_:1}),o.generatePCBID?A("",!0):(r(),g(d,{key:0,label:"PCBID"},{default:s(()=>[n(D,{modelValue:o.PCBID,"onUpdate:modelValue":e[11]||(e[11]=a=>o.PCBID=a),name:"pcbid",required:"",minlength:"20",maxlength:"20"},null,8,["modelValue"])]),_:1})),n(d,{label:"Name"},{default:s(()=>[n(D,{modelValue:o.name,"onUpdate:modelValue":e[12]||(e[12]=a=>o.name=a),name:"name",required:""},null,8,["modelValue"])]),_:1}),i("div",je,[n(d,{label:"Arcade Cabinet",help:"If this is a real cabinet, enable this."},{default:s(()=>[n(m,{modelValue:o.cabinet,"onUpdate:modelValue":e[13]||(e[13]=a=>o.cabinet=a),"input-value":o.cabinet,name:"cabinet",type:"switch"},null,8,["modelValue","input-value"])]),_:1}),n(d,{label:"Enable Updates",help:"Enables or disables OTA updates."},{default:s(()=>[n(m,{modelValue:o.ota,"onUpdate:modelValue":e[14]||(e[14]=a=>o.ota=a),"input-value":o.ota,name:"ota",type:"switch"},null,8,["modelValue","input-value"])]),_:1})]),n(I,{color:"success",type:"submit",label:"Add Machine"})],32),i("div",null,[n(k,{color:"warning",label:"Queue",class:"mb-4"}),i("div",Re,[(r(!0),f(le,null,oe(t.machineList,a=>(r(),g(M,{key:a.name,"color-prop":"bg-slate-800 dark:bg-slate-800"},{default:s(()=>[i("div",qe,[i("div",ze,[i("h1",Fe,$(a.name),1),i("h2",Ge,$(a.cabinet?"Cabinet":"Setup")+$(a.ota?" - OTA Enabled":null),1),i("h2",Je,$(a.PCBID!=""?a.PCBID:"not generated"),1)]),n(I,{color:"danger",label:"Remove",onClick:b=>G(a.PCBID)},null,8,["onClick"])])]),_:2},1024))),128))])])])]),_:1}),i("div",Te,[n(I,{type:"submit",color:"success",label:t.useDiscord?"Create Arcade with Discord":"Create Arcade and VPN",small:!1,onClick:e[16]||(e[16]=a=>x(!0))},null,8,["label"]),n(I,{type:"submit",color:"info",label:"Create Arcade",small:!1,onClick:e[17]||(e[17]=a=>x(!1))})])])]),_:1})]),_:1}))}};export{la as default};
