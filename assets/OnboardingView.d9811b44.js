import{u as B,s as $,r as j,a as p,c as f,w as i,b as t,Q as q,e as g,a8 as F,g as s,_ as C,R as P,a9 as U,f as v,I as x,aa as T,ab as G,k as V,ac as z,v as Q,i as H,j as J,t as _,F as K,l as W,n as X,q as Y}from"./index.864ffe72.js";import{_ as d}from"./FormField.deb94f78.js";import{_ as m}from"./FormCheckRadio.a6fd72c5.js";import{_ as D}from"./FormControl.0779fc7b.js";const A=B();async function Z(r){try{return await A.callApi(`/arcade/checkName?name=${r}`)}catch(o){throw console.log("Error testing arcade:",o),o}}async function ee(r){try{return(await A.callApi(`/arcade/checkPCBID?PCBID=${r}`)).unused}catch(o){throw console.log("Error testing machine:",o),o}}async function ae(r){try{return await A.callApi("/admin/onboardArcade","POST",r)}catch(o){throw console.log("Error onboarding arcade:",o),o}}const M=B();async function ne(r,o){try{return await M.callApi(`/discord/exportVPN/${r}?discordId=${o}`)}catch(u){throw console.log("Error exporting vpn:",u),u}}async function te(r,o){try{return await M.callApi(`/discord/onboardArcade/${r}?discordId=${o}`)}catch(u){throw console.log("Error onboarding arcade:",u),u}}function E(){const r="01201000000000",o="0123456789ABCDEF";let u="";for(let I=0;I<6;I++)u+=o[Math.floor(Math.random()*o.length)];return r+u}const le={class:"grid grid-cols-1 gap-6"},oe={class:"mb-4 flex gap-2 items-stretch"},ie={class:"grid grid-cols-1 w-full gap-2 md:gap-6 md:flex md:place-content-stretch"},se={class:"grid md:grid-cols-2 gap-6"},de={class:"grid grid-cols-1 w-full gap-2 md:gap-6 md:flex md:place-content-stretch pb-4 md:pb-0"},re={class:"grid gap-4"},ue={class:"flex justify-between items-center"},ce={class:"m-[-5px]"},me={class:"text-md font-bold"},pe={class:"text-sm"},fe={class:"text-sm font-mono"},be={class:"grid md:flex gap-4"},ve={__name:"OnboardingView",setup(r){const o=Y(),u=B(),h={name:"",useDiscord:!0,discordId:"",description:"",paseli:!0,infinitePaseli:!0,maintenance:!1,betas:!1,incognito:!1,machineList:[]},I={name:"",cabinet:!1,ota:!1,generatePCBID:!0,PCBID:""},n=$({...h}),l=$({...I}),y=j(void 0);async function N(){for(l.generatePCBID&&(l.PCBID=E());!await ee(l.PCBID);)if(l.generatePCBID)l.PCBID=E();else{window.alert("PCBID already in use!");return}n.machineList.push({name:l.name,cabinet:l.cabinet,ota:l.ota,PCBID:l.PCBID.toUpperCase()}),Object.assign(l,I)}function O(c){n.machineList=n.machineList.filter(e=>e.PCBID!==c)}async function L(){if(n.name){const c=await Z(n.name);c.unused!=null&&(y.value=c.unused)}}function S(c,e="NA_"){var a=[...c].map(w=>w.charCodeAt(0)<128?w:e).join("");return a=a.replace(/[!"#$%&'()*+,-./:;<=>?@[\\\]^_`{|}~]/g,""),a=a.replace(/\s+/g,"_"),a}async function R(c,e){try{const a=await u.getArcadeVPN(c),w=new Blob([a],{type:"application/ovpn"}),b=document.createElement("a");b.href=URL.createObjectURL(w),b.download=`gradius-${S(e.name)}-phaseii-config.ovpn`,document.body.appendChild(b),b.click(),URL.revokeObjectURL(b.href),document.body.removeChild(b)}catch(a){console.log("Failed to fetch arcade data:",a)}}async function k(c){if(n.name==h.name){window.alert("Please input a name.");return}if(n.discordId==h.discordId&&n.useDiscord&&c){window.alert("Please input a Discord ID.");return}if(n.description==h.description&&!n.useDiscord){window.alert("Please input a description.");return}const e=await ae(n);c&&e.arcadeId&&(n.useDiscord?(await te(e.arcadeId,n.discordId),await ne(e.arcadeId,n.discordId)):await R(e.arcadeId,n)),e.arcadeId?(window.alert("Onboarding complete!"),o.push({name:"arcade",params:{id:e.arcadeId}})):window.alert("Failed to onboard!")}return(c,e)=>(p(),f(X,null,{default:i(()=>[t(W,null,{default:i(()=>[t(q,{icon:g(F),title:"Arcade Onboarding",color:"text-green-400",main:""},null,8,["icon"]),s("div",le,[t(C,{"is-form":"",class:"row-span-1"},{default:i(()=>[t(P,{color:"info",label:"General Information",icon:g(U),class:"mb-2"},null,8,["icon"]),t(d,{label:"Arcade Name"},{default:i(()=>[t(D,{modelValue:n.name,"onUpdate:modelValue":e[0]||(e[0]=a=>n.name=a),"input-value":n.name,name:"arcadeName",required:""},null,8,["modelValue","input-value"])]),_:1}),s("div",oe,[t(v,{color:"info",label:"Check Name",onClick:e[1]||(e[1]=a=>L())}),y.value==!0?(p(),f(x,{key:0,path:g(T),color:"text-green-400",size:"25"},null,8,["path"])):y.value==!1?(p(),f(x,{key:1,path:g(G),color:"text-red-400",size:"25"},null,8,["path"])):V("",!0)]),t(d,{label:"Use Discord",help:"Automated provisioning rather than manual. BadManiac will DM the user via Discord."},{default:i(()=>[t(m,{modelValue:n.useDiscord,"onUpdate:modelValue":e[2]||(e[2]=a=>n.useDiscord=a),"input-value":n.useDiscord,name:"useDiscord",type:"switch"},null,8,["modelValue","input-value"])]),_:1}),n.useDiscord?(p(),f(d,{key:0,label:"Discord ID",help:"Owner's Discord User ID."},{default:i(()=>[t(D,{modelValue:n.discordId,"onUpdate:modelValue":e[3]||(e[3]=a=>n.discordId=a),"input-value":n.discordId,name:"discordId",required:""},null,8,["modelValue","input-value"])]),_:1})):V("",!0),n.useDiscord?V("",!0):(p(),f(d,{key:1,label:"Description",help:"Manual description rather than automated."},{default:i(()=>[t(D,{modelValue:n.description,"onUpdate:modelValue":e[4]||(e[4]=a=>n.description=a),name:"description",required:""},null,8,["modelValue"])]),_:1}))]),_:1}),t(C,{"is-form":"",class:"row-span-1"},{default:i(()=>[t(P,{color:"info",label:"Settings",icon:g(z),class:"mb-2"},null,8,["icon"]),s("div",ie,[t(d,{label:"PASELI Enabled",help:"Enable or disable PASELI services."},{default:i(()=>[t(m,{modelValue:n.paseli,"onUpdate:modelValue":e[5]||(e[5]=a=>n.paseli=a),"input-value":n.paseli,name:"paseli",type:"switch"},null,8,["modelValue","input-value"])]),_:1}),t(d,{label:"Infinite PASELI",help:"Enable or disable infinite PASELI."},{default:i(()=>[t(m,{modelValue:n.infinitePaseli,"onUpdate:modelValue":e[6]||(e[6]=a=>n.infinitePaseli=a),"input-value":n.infinitePaseli,name:"infinitePaseli",type:"switch"},null,8,["modelValue","input-value"])]),_:1}),t(d,{label:"Maintenance Mode",help:"Place this arcade under Maintenance."},{default:i(()=>[t(m,{modelValue:n.maintenance,"onUpdate:modelValue":e[7]||(e[7]=a=>n.maintenance=a),"input-value":n.maintenance,name:"maintenance",type:"switch"},null,8,["modelValue","input-value"])]),_:1}),t(d,{label:"Incognito Mode",help:"Hide the eAmusement network and ranking data."},{default:i(()=>[t(m,{modelValue:n.incognito,"onUpdate:modelValue":e[8]||(e[8]=a=>n.incognito=a),"input-value":n.incognito,name:"incognito",type:"switch"},null,8,["modelValue","input-value"])]),_:1}),t(d,{label:"Beta Testing",help:"Enable or disable beta testing."},{default:i(()=>[t(m,{modelValue:n.betas,"onUpdate:modelValue":e[9]||(e[9]=a=>n.betas=a),"input-value":n.betas,name:"betas",type:"switch"},null,8,["modelValue","input-value"])]),_:1})])]),_:1}),t(C,{class:"row-span-1"},{default:i(()=>[t(P,{color:"info",label:"Machines",icon:g(U),class:"mb-2"},null,8,["icon"]),s("div",se,[s("form",{class:"h-full",onSubmit:e[15]||(e[15]=Q(a=>N(),["prevent"]))},[t(d,{label:"Generate PCBID",help:"Generate a PCBID rather than supply one."},{default:i(()=>[t(m,{modelValue:l.generatePCBID,"onUpdate:modelValue":e[10]||(e[10]=a=>l.generatePCBID=a),"input-value":l.generatePCBID,name:"generatePCBID",type:"switch"},null,8,["modelValue","input-value"])]),_:1}),l.generatePCBID?V("",!0):(p(),f(d,{key:0,label:"PCBID"},{default:i(()=>[t(D,{modelValue:l.PCBID,"onUpdate:modelValue":e[11]||(e[11]=a=>l.PCBID=a),name:"pcbid",required:"",minlength:"20",maxlength:"20"},null,8,["modelValue"])]),_:1})),t(d,{label:"Name"},{default:i(()=>[t(D,{modelValue:l.name,"onUpdate:modelValue":e[12]||(e[12]=a=>l.name=a),name:"name",required:""},null,8,["modelValue"])]),_:1}),s("div",de,[t(d,{label:"Arcade Cabinet",help:"If this is a real cabinet, enable this."},{default:i(()=>[t(m,{modelValue:l.cabinet,"onUpdate:modelValue":e[13]||(e[13]=a=>l.cabinet=a),"input-value":l.cabinet,name:"cabinet",type:"switch"},null,8,["modelValue","input-value"])]),_:1}),t(d,{label:"Enable Updates",help:"Enables or disables OTA updates."},{default:i(()=>[t(m,{modelValue:l.ota,"onUpdate:modelValue":e[14]||(e[14]=a=>l.ota=a),"input-value":l.ota,name:"ota",type:"switch"},null,8,["modelValue","input-value"])]),_:1})]),t(v,{color:"success",type:"submit",label:"Add Machine"})],32),s("div",null,[t(P,{color:"warning",label:"Queue",class:"mb-4"}),s("div",re,[(p(!0),H(K,null,J(n.machineList,a=>(p(),f(C,{key:a.name,"color-prop":"bg-slate-800 dark:bg-slate-800"},{default:i(()=>[s("div",ue,[s("div",ce,[s("h1",me,_(a.name),1),s("h2",pe,_(a.cabinet?"Cabinet":"Setup")+_(a.ota?" - OTA Enabled":null),1),s("h2",fe,_(a.PCBID!=""?a.PCBID:"not generated"),1)]),t(v,{color:"danger",label:"Remove",onClick:w=>O(a.PCBID)},null,8,["onClick"])])]),_:2},1024))),128))])])])]),_:1}),s("div",be,[t(v,{type:"submit",color:"success",label:n.useDiscord?"Create Arcade with Discord":"Create Arcade and VPN",small:!1,onClick:e[16]||(e[16]=a=>k(!0))},null,8,["label"]),t(v,{type:"submit",color:"info",label:"Create Arcade",small:!1,onClick:e[17]||(e[17]=a=>k(!1))})])])]),_:1})]),_:1}))}};export{ve as default};
