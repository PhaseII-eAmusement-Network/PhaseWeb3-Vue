import{l as A,m as B,s as D,L as G,a8 as R,r as g,o as C,j as F,c as L,a as f,w as u,b as o,_ as N,g as d,d as y,e as x,p as c,f as j,n as E,k as H}from"./index-jHbWkO02.js";import{F as S}from"./PhUsersThree.vue-Cc_REf6F.js";import{_ as M}from"./GameHeader-bIyl3tCO.js";import{_ as T}from"./FormControl-XG0ZJ25y.js";import{_ as U}from"./ProfileCard-DuavISCD.js";import{_ as X}from"./GeneralTable-D-FKNE3P.js";import{a as q,A as z}from"./profile-CoytY5Qo.js";import{d as J}from"./userData-DZYdegtD.js";import{g as V}from"./danClass-Bg9sX7yb.js";import"./PhGear.vue-DYLiDm8m.js";import"./PhHouse.vue-DlintoIq.js";import"./contentExport-BHEc0v0f.js";const K={key:0,class:"w-full md:flex md:-mt-[75px] mb-4 place-content-end"},O={class:"md:w-1/3 md:text-right"},Q={key:1,class:"w-full"},W={class:"bg-white dark:bg-slate-900/95 rounded-2xl lg:flex lg:justify-between"},Y={class:"w-full"},me={__name:"GameView",setup(Z){const w=A(),m=B();var l=null,a=null;const r=D({currentVersion:null});G(()=>r.currentVersion,()=>{_()}),l=w.params.id,a=R(l),a==null&&m.push({name:"ErrorPage",params:{catchAll:"404"}});const n=g(null),p=g([]);C(async()=>{try{const t=await q(l);p.value=b(t)}catch(t){console.error("Failed to fetch profile data:",t)}_()}),a.versions||(r.currentVersion=1);async function _(){try{n.value=null;const t=await z(l,r.currentVersion);n.value=t,t&&!r.currentVersion&&(r.currentVersion=t.versions[t.versions.length-1])}catch(t){console.error("Failed to fetch user profile data:",t)}}const i=[];if(i.push({text:"Player",value:"username",sortable:!0,width:120}),a.noRivals||i.push({text:"Rival ID",value:"extid",sortable:!0,width:100}),i.push({text:"Last Play",value:"stats.last_play_timestamp",sortable:!0,width:150},{text:"Last Arcade",value:"stats.last_play_arcade",sortable:!0,width:150},{text:"Plays",value:"stats.total_plays",sortable:!0,width:50}),a.playerHeaders)for(var P of a.playerHeaders)i.push(P);function b(t){var s=[];for(var e of t)e.extid&&(e.extid=J(e.extid)),e.stats&&(e.stats.last_play_timestamp&&(e.stats.last_play_timestamp=F(e.stats.last_play_timestamp)),e.sgrade&&(e.sgrade=V(e.sgrade).short),e.dgrade&&(e.dgrade=V(e.dgrade).short)),s.push(e);return s.sort((v,h)=>{const k=v.stats&&v.stats.total_plays||0;return(h.stats&&h.stats.total_plays||0)-k}),s}function $(t){var s=[];for(const e of a.versions)t.includes(e.id)&&s.push(e);return s}const I=t=>{const s=t.userId;m.push(`/games/${l}/profiles/${s}`)};return(t,s)=>(f(),L(H,null,{default:u(()=>[o(N,null,{default:u(()=>[o(M,{game:d(a),version:r.currentVersion},{default:u(()=>[d(a).versions&&n.value?(f(),y("div",K,[c("div",O,[s[1]||(s[1]=c("h2",{class:"text-md sm:text-lg md:text-xl font-bold p-2"}," Select Version ",-1)),o(T,{modelValue:r.currentVersion,"onUpdate:modelValue":s[0]||(s[0]=e=>r.currentVersion=e),options:$(n.value.versions)},null,8,["modelValue","options"])])])):x("",!0),n.value?(f(),y("div",Q,[o(U,{game:d(l),version:r.currentVersion,profile:n.value},null,8,["game","version","profile"])])):x("",!0)]),_:1},8,["game","version"]),o(j,{icon:d(S),title:"All Players",main:""},null,8,["icon"]),o(E,{"has-table":""},{default:u(()=>[c("div",W,[c("div",Y,[o(X,{headers:i,items:p.value,onRowClicked:I},null,8,["items"])])])]),_:1})]),_:1})]),_:1}))}};export{me as default};
