import{u as Q,a as X,b as Y,a3 as Z,r as W,o as aa,c as j,e as ea,w as c,f as n,k as ra,W as sa,g as r,aW as ta,j as la,i as q,m as na,az as oa,_ as da,F as ca,n as ua,p as fa,q as ia}from"./index.237f805e.js";import{_ as pa}from"./GeneralTable.e94461e0.js";import{A as _a}from"./profile.6842bd8d.js";const ha={class:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 2xl:grid-cols-5 gap-3 pb-6"},va={__name:"PersonalScores",setup(ga){const u=Q(),z=X(),L=Y();var t=null,e=null,o=null;t=u.params.game,o=u.params.userId,e=Z(t),e||z.push({name:"ErrorPage",params:{catchAll:"404"}});const l=W(null),f=W([]),i=[{text:"Timestamp",value:"timestamp",width:140},{text:"New PB",value:"newRecord",width:100},{text:"Song",value:"song.name",width:180},{text:"Artist",value:"song.artist",width:180},{text:"Chart",value:"song.chart",width:100},{text:"Grade",value:"data.rank",width:80},{text:"Score",value:"points",width:120}];if(e.scoreHeaders)for(var U of e.scoreHeaders)i.push(U);aa(async()=>{try{const s=await L.getAttemptData(t,o);f.value=K(s)}catch(s){console.error("Failed to fetch score data:",s)}J()});async function J(){try{l.value=null;const s=await _a(t,null,o);l.value=s}catch(s){console.error("Failed to fetch user profile data:",s)}}function K(s){var p,_,h,g,k,b,m,v,w,$,T,x,S,B,N,P,I,y,R,A,C,F,G,H,D,V,E,M;var d=[];for(var a of s){if(a.newRecord?a.newRecord="\u2705":a.newRecord="",a.timestamp){const O=new Date(a.timestamp*1e3);a.timestamp=O.toLocaleString()}a.points!=null&&(a.points=a.points.toString().replace(new RegExp("\\B(?<!\\.\\d*)(?=(\\d{3})+(?!\\d))","g"),",")),((_=(p=a.data)==null?void 0:p.stats)==null?void 0:_.score)!=null&&(a.exscore=a.points.toString(),a.points=(g=(h=a.data)==null?void 0:h.stats)==null?void 0:g.score.toString().replace(new RegExp("\\B(?<!\\.\\d*)(?=(\\d{3})+(?!\\d))","g"),",")),((k=a.song)==null?void 0:k.chart)!=null&&e.chartTable&&(a.song.chart=e.chartTable[(b=a.song)==null?void 0:b.chart]),((m=a.data)==null?void 0:m.halo)!=null&&e.haloTable&&(a.data.halo=e.haloTable[(v=a.data)==null?void 0:v.halo]),((w=a.data)==null?void 0:w.medal)!=null&&e.medalTable&&(a.data.medal=e.medalTable[($=a.data)==null?void 0:$.medal]),((T=a.data)==null?void 0:T.clear_status)!=null&&e.medalTable&&(a.data.medal=e.medalTable[(x=a.data)==null?void 0:x.clear_status]),((S=a.data)==null?void 0:S.rank)!=null&&e.rankTable&&(a.data.rank=e.rankTable[(B=a.data)==null?void 0:B.rank]),((N=a.data)==null?void 0:N.result_rank)!=null&&e.rankTable&&(a.data.rank=e.rankTable[(P=a.data)==null?void 0:P.result_rank]),((I=a.data)==null?void 0:I.grade)!=null&&e.rankTable&&(a.data.rank=e.rankTable[(y=a.data)==null?void 0:y.grade]),((R=a.data)==null?void 0:R.skill_perc)>0?a.data.skill_perc=`${((A=a.data)==null?void 0:A.skill_perc)/100}%`:a.data.skill_perc="0%",(C=a.data)!=null&&C.skill_points&&(a.data.skill_points=((F=a.data)==null?void 0:F.skill_points)/10),((G=a.data)==null?void 0:G.perc)>0?a.data.perc=`${((H=a.data)==null?void 0:H.perc)/100}%`:a.data.perc="0%",(D=a.data)!=null&&D.new_skill&&(a.data.new_skill=((V=a.data)==null?void 0:V.new_skill)/10),(E=a.data)!=null&&E.music_rate&&(a.data.music_rate=((M=a.data)==null?void 0:M.music_rate)/10),d.push(a)}return d}return(s,d)=>(j(),ea(ia,null,{default:c(()=>[n(fa,null,{default:c(()=>[l.value?(j(),ra(ca,{key:0},[n(sa,{icon:r(ta),title:`${l.value.username}'s ${r(e).shortName?r(e).shortName:r(e).name} Scores`,main:""},null,8,["icon","title"]),la("div",ha,[n(q,{icon:r(na),href:`/#/games/${r(t)}/profiles/${l.value.userId}`,color:"info",label:`${l.value.username}'s Profile`},null,8,["icon","href","label"]),n(q,{icon:r(oa),href:`/#/games/${r(t)}`,color:"info",label:`${r(e).shortName?r(e).shortName:r(e).name} Home`},null,8,["icon","href","label"])]),n(da,{"has-table":""},{default:c(()=>[n(pa,{headers:i,items:f.value},null,8,["items"])]),_:1})],64)):ua("",!0)]),_:1})]),_:1}))}};export{va as default};
