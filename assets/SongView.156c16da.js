import{u as oa,a as ca,ag as ua,r as ma,o as fa,s as _a,B as Z,c,e as _,w as f,g as d,p as pa,f as u,bz as ha,$ as v,j as i,t as p,k as h,l as aa,F as g,a0 as ga,n as x,_ as ea,bA as ba,aB as ka,V as va,bB as xa,q as $a}from"./index.f2f2fb83.js";import{_ as Ta}from"./GeneralTable.1610f38e.js";import{_ as wa}from"./FormControl.00f220d1.js";import{_ as ya}from"./GameHeader.0f4552eb.js";import{a as Sa}from"./music.783873ee.js";import"./sources.8bef7322.js";const Ca={class:"grid gap-4 bg-slate-900/90 card-content"},Ba={class:"text-3xl font-bold"},Ia={class:"text-2xl"},Va={class:"text-xl font-light italic"},Fa={class:"grid grid-cols-3 sm:flex gap-2"},La={class:"grid grid-cols-2 lg:grid-cols-5 gap-4 mb-6"},Na={class:"flex place-content-between mb-2"},Aa={class:"md:w-1/3 md:text-right"},Ea={class:"bg-white dark:bg-slate-900/95 rounded-2xl lg:flex lg:justify-between"},Ra={class:"w-full"},Ma={__name:"SongView",setup(Da){const $=oa(),T=ca();var b=$.params.game,ta=$.params.songId;const e=ua(b);var r=ma({});e||T.push({name:"ErrorPage",params:{catchAll:"404"}}),fa(async()=>{try{const s=await Sa(b,ta);r.value=s}catch(s){console.error("Failed to fetch score data:",s)}});const w=[{text:"Player",value:"username",width:120},{text:"Timestamp",value:"timestamp",width:140},{text:"Grade",value:"data.rank",width:80},{text:"Score",value:"points",width:120}];if(e.scoreHeaders)for(var sa of e.scoreHeaders)w.push(sa);const k=_a({currentChart:0}),la=Z(()=>r.value.charts?r.value.charts.filter(s=>{var l,t;return((l=s.data)==null?void 0:l.difficulty)!==0&&((t=s.data)==null?void 0:t.difficulty)!=null}).map((s,l)=>{var n,o;const t=`${e.chartTable[s.chart]} - ${(o=(n=s.data)==null?void 0:n.difficulty)!=null?o:"?"}`;return{id:s.chart,label:t}}):[]),ra=Z(()=>{var l;if(!r.value.charts||r.value.charts.length===0)return[];const s=JSON.parse(JSON.stringify(r.value.charts[k.currentChart]));return da((l=s==null?void 0:s.records)!=null?l:[])});function da(s){var n,o,m,y,S,C,B,I,V,F,L,N,A,E,R,D,P,G,O,j,H,J,M,U,q,z,X,K,Q,W,Y;var l=[];for(var t of s){const a={...t};if(a.timestamp){const na=new Date(a.timestamp*1e3);a.timestamp=na.toLocaleString()}a.points!=null&&(a.points=a.points.toString().replace(new RegExp("\\B(?<!\\.\\d*)(?=(\\d{3})+(?!\\d))","g"),",")),((o=(n=a.data)==null?void 0:n.stats)==null?void 0:o.score)!=null&&(a.exscore=a.points.toString(),a.points=(y=(m=a.data)==null?void 0:m.stats)==null?void 0:y.score.toString().replace(new RegExp("\\B(?<!\\.\\d*)(?=(\\d{3})+(?!\\d))","g"),",")),((S=a.song)==null?void 0:S.chart)!=null&&e.chartTable&&(a.song.chart=e.chartTable[(C=a.song)==null?void 0:C.chart]),((B=a.data)==null?void 0:B.halo)!=null&&e.haloTable&&(a.data.halo=e.haloTable[(I=a.data)==null?void 0:I.halo]),((V=a.data)==null?void 0:V.medal)!=null&&e.medalTable&&(a.data.medal=e.medalTable[(F=a.data)==null?void 0:F.medal]),((L=a.data)==null?void 0:L.clear_status)!=null&&e.medalTable&&(a.data.medal=e.medalTable[(N=a.data)==null?void 0:N.clear_status]),((A=a.data)==null?void 0:A.rank)!=null&&e.rankTable&&(a.data.rank=e.rankTable[(E=a.data)==null?void 0:E.rank]),((R=a.data)==null?void 0:R.result_rank)!=null&&e.rankTable&&(a.data.rank=e.rankTable[(D=a.data)==null?void 0:D.result_rank]),((P=a.data)==null?void 0:P.grade)!=null&&e.rankTable&&(a.data.rank=e.rankTable[(G=a.data)==null?void 0:G.grade]),((O=a.data)==null?void 0:O.skill_perc)>0?a.data.skill_perc=`${((j=a.data)==null?void 0:j.skill_perc)/100}%`:a.data.skill_perc="0%",(H=a.data)!=null&&H.skill_points&&(a.data.skill_points=((J=a.data)==null?void 0:J.skill_points)/10),((M=a.data)==null?void 0:M.perc)>0?a.data.perc=`${((U=a.data)==null?void 0:U.perc)/100}%`:a.data.perc="0%",(q=a.data)!=null&&q.new_skill&&(a.data.new_skill=((z=a.data)==null?void 0:z.new_skill)/10),(X=a.data)!=null&&X.music_rate&&(a.data.music_rate=((K=a.data)==null?void 0:K.music_rate)/10),(Q=a.data)!=null&&Q.excellent?a.medal="EX FC":(W=a.data)!=null&&W.fullcombo?a.medal="FC":(Y=a.data)!=null&&Y.clear?a.medal="CLEARED":a.medal="FAILED",l.push(a)}return l}const ia=s=>{const l=s.userId;T.push(`/games/${b}/profiles/${l}`)};return(s,l)=>(c(),_($a,null,{default:f(()=>[d(r)?(c(),_(pa,{key:0},{default:f(()=>[u(ya,{game:d(e)},null,8,["game"]),u(v,{icon:d(ha),title:"Song Overview",main:""},null,8,["icon"]),u(ea,{class:"mb-6","has-table":""},{default:f(()=>[i("div",Ca,[i("div",null,[i("h1",Ba,p(d(r).name),1),i("h2",Ia,p(d(r).artist),1),i("h2",Va,p(d(r).genre),1)]),i("div",Fa,[(c(!0),h(g,null,aa(d(r).charts,t=>{var n,o;return c(),h(g,{key:t.db_id},[((n=t.data)==null?void 0:n.difficulty)!=0?(c(),_(ga,{key:0,color:"info",label:`${d(e).chartTable[t.chart]} - ${(o=t.data)==null?void 0:o.difficulty}`},null,8,["label"])):x("",!0)],64)}),128))])])]),_:1}),u(v,{icon:d(ba),title:"Top Records",main:""},null,8,["icon"]),i("div",La,[(c(!0),h(g,null,aa(d(r).charts,t=>{var n;return c(),h(g,{key:t.db_id},[((n=t.data)==null?void 0:n.difficulty)!=0?(c(),_(ka,{key:0,label:`${d(e).chartTable[t.chart]}`,"small-content":""},{default:f(()=>{var o,m;return[va(p(t.records[0]?`${(o=t.records[0])==null?void 0:o.username} - ${(m=t.records[0].points)==null?void 0:m.toLocaleString()}`:"Unclaimed"),1)]}),_:2},1032,["label"])):x("",!0)],64)}),128))]),i("div",Na,[u(v,{icon:d(xa),title:"All Scores",main:""},null,8,["icon"]),i("div",Aa,[l[1]||(l[1]=i("h2",{class:"text-md sm:text-lg md:text-xl font-bold p-2"}," Select Chart ",-1)),u(wa,{modelValue:k.currentChart,"onUpdate:modelValue":l[0]||(l[0]=t=>k.currentChart=t),options:la.value},null,8,["modelValue","options"])])]),u(ea,{"has-table":""},{default:f(()=>[i("div",Ea,[i("div",Ra,[u(Ta,{headers:w,items:ra.value,onRowClicked:ia},null,8,["items"])])])]),_:1})]),_:1})):x("",!0)]),_:1}))}};export{Ma as default};
