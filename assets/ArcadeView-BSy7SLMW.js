import{u as X,r as c,a as K,b as Y,M as Z,o as ee,c as b,d as o,w as i,e as l,_ as ae,j as _,f as g,F as w,i as s,g as r,P as C,am as le,h,v as N,Q as k,an as B,l as d,C as E,aB as ne,aC as te,R as se,k as R,aV as oe,t as ie,aW as re,aD as de,aX as ue,ap as ce,n as me}from"./index-BfIWj8y-.js";import{_ as fe}from"./ArcadeCard-CclStaR_.js";import{_ as y}from"./FormField-BRMR5tgl.js";import{_ as D}from"./FormCheckRadio-CeTtOsA0.js";import{_ as x}from"./FormControl-B6j5TJF5.js";import{s as O,g as L}from"./values-CmNcmtTU.js";import{A as pe,a as ve,b as be}from"./arcade-DoF_Ygpw.js";import{m as _e,s as ge,c as Ae,t as he,u as ye,v as we}from"./admin-BaoK9ueM.js";const ke={class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},Ve={class:"mb-4 flex gap-2 items-stretch"},$e={key:0,class:"space-x-2 mt-6 mb-4"},Se={class:"mb-4"},Ce={class:"mb-4"},Ne={class:"grid gap-4"},xe={class:"flex justify-between items-center"},Oe={class:"m-[-5px] md:flex items-center gap-2"},Pe={class:"w-8 md:w-12"},Ie={class:"text-lg lg:text-xl font-bold"},Ue={class:"grid grid-cols-1 w-full gap-2 md:gap-6 md:flex md:place-content-stretch"},Me={key:0,class:"space-x-2 mt-6"},Be={class:"grid grid-cols-1 gap-6 sm:grid-cols-2 md:grid-cols-3 mb-6"},ze={__name:"ArcadeView",setup(Ee){const V=X(),v=c(null),$=c(null),u=c(null),P=c(!0),S=c(null),t=c(null),A=c(null),I=c(null),F=K(),J=Y(),m=parseInt(F.params.id);var U=[{id:"paseli_enabled",name:"PASELI Services",help:"Enable PASELI for this arcade.",type:"Boolean"},{id:"paseli_infinite",name:"Infinite PASELI",help:"Enable infinite PASELI for this arcade.",type:"Boolean"},{id:"maint",name:"Maintenance Mode",help:"Place this arcade under maintenance.",type:"Boolean"},{id:"hide_network",name:"Incognito Mode",help:"Hide the network and all ranking data.",type:"Boolean"}];async function f(){try{u.value={},v.value={},$.value={};const n=await pe(m);u.value=n,t.value=JSON.parse(JSON.stringify(n));for(const a of U){const e=L(u.value.data,a.id);O(v.value,a.id,e),O($.value,a.id,e)}P.value=!1}catch(n){console.error("Failed to fetch arcade data:",n)}}async function M(){if(V.userAdmin)try{const n=await _e(!0),a=[];for(const e of n)e.username!=null&&a.push({id:e.id,label:e.username});a.sort((e,p)=>e.label.localeCompare(p.label)),I.value=a}catch(n){console.error("Failed to fetch admin user data:",n)}}Z(()=>V.userAdmin,()=>{M()});async function j(){(await ve(m,v.value)).status!="error"&&await f()}ee(()=>{f(),M()});function q(n,a="NA_"){var e=[...n].map(p=>p.charCodeAt(0)<128?p:a).join("");return e=e.replace(/[!"#$%&'()*+,-./:;<=>?@[\\\]^_`{|}~]/g,""),e=e.replace(/\s+/g,"_"),e}async function G(){try{const n=await be(m),a=new Blob([n],{type:"application/ovpn"}),e=document.createElement("a");e.href=URL.createObjectURL(a),e.download=`gradius-${q(u.value.name)}-phaseii-config.ovpn`,document.body.appendChild(e),e.click(),URL.revokeObjectURL(e.href),document.body.removeChild(e)}catch(n){console.log("Failed to fetch arcade data:",n)}}async function z(){if(t.value.name){const n=await Ae(t.value.name);n.unused!=null&&(S.value=n.unused)}}async function H(){(await ge(m,{name:t.value.name,description:t.value.description,beta:t.value.data.is_beta})).status!="error"&&await f()}async function Q(){if(A.value==null)return;(await ye(m,A.value)).status!="error"&&(A.value=null,f())}async function T(n){if(!n)return;(await we(m,n)).status!="error"&&f()}async function W(){window.confirm(`Are you really?
This will remove all owners, machines, and arcade data.`)&&(await he(m)).status!="error"&&await J.push({name:"admin_arcades"})}return(n,a)=>(o(),b(me,null,{default:i(()=>[l(ae,null,{default:i(()=>[P.value?g("",!0):(o(),_(w,{key:0},[l(fe,{class:"mb-6",arcade:u.value},null,8,["arcade"]),r(V).userAdmin?(o(),_(w,{key:0},[l(C,{icon:r(le),title:"Arcade Administration",main:""},null,8,["icon"]),s("div",ke,[l(h,{"is-form":"",class:"lg:mb-6",onSubmit:N(H,["prevent"])},{default:i(()=>[l(k,{color:"info",label:"General Information",icon:r(B),class:"mb-2"},null,8,["icon"]),l(y,{label:"Arcade Name"},{default:i(()=>[l(x,{modelValue:t.value.name,"onUpdate:modelValue":a[0]||(a[0]=e=>t.value.name=e),"input-value":t.value.name,name:"arcadeName",required:""},null,8,["modelValue","input-value"])]),_:1}),s("div",Ve,[l(d,{color:"info",label:"Check Name",onClick:a[1]||(a[1]=e=>z())}),S.value==!0?(o(),b(E,{key:0,path:r(ne),color:"text-green-400",size:"25"},null,8,["path"])):S.value==!1?(o(),b(E,{key:1,path:r(te),color:"text-red-400",size:"25"},null,8,["path"])):g("",!0)]),l(y,{label:"Description"},{default:i(()=>[l(x,{modelValue:t.value.description,"onUpdate:modelValue":a[2]||(a[2]=e=>t.value.description=e),name:"description",required:""},null,8,["modelValue"])]),_:1}),l(y,{label:"Beta Enabled"},{default:i(()=>[l(D,{modelValue:t.value.data.is_beta,"onUpdate:modelValue":a[3]||(a[3]=e=>t.value.data.is_beta=e),name:"beta","model-value":t.value.data.is_beta,"input-value":t.value.data.is_beta,type:"switch"},null,8,["modelValue","model-value","input-value"])]),_:1}),JSON.stringify(u.value)!==JSON.stringify(t.value)?(o(),_("div",$e,[l(d,{color:"success",label:"Save",type:"submit"}),l(d,{color:"warning",label:"Revert",onClick:a[4]||(a[4]=e=>f())})])):g("",!0),s("div",null,[l(d,{color:"danger",label:"Delete Arcade",onClick:a[5]||(a[5]=e=>W())})])]),_:1}),l(h,{class:"mb-6"},{default:i(()=>[s("div",Se,[l(k,{color:"info",label:"Add Manager",icon:r(B),class:"mb-2"},null,8,["icon"]),s("form",{class:"h-full",onSubmit:N(Q,["prevent"])},[l(y,{label:"Username"},{default:i(()=>[l(x,{modelValue:A.value,"onUpdate:modelValue":a[6]||(a[6]=e=>A.value=e),name:"username",options:I.value,required:""},null,8,["modelValue","options"])]),_:1}),l(d,{color:"success",type:"submit",label:"Add Manager"})],32)]),l(se),s("div",Ce,[l(k,{color:"warning",label:"Managers",class:"mb-4"}),s("div",Ne,[(o(!0),_(w,null,R(u.value.owners,e=>(o(),b(h,{key:e,"color-prop":"bg-slate-800 dark:bg-slate-800"},{default:i(()=>[s("div",xe,[s("div",Oe,[s("div",Pe,[l(oe,{username:e.username,avatar:e.avatar},null,8,["username","avatar"])]),s("h1",Ie,ie(e.username),1)]),l(d,{color:"danger",label:"Remove",onClick:p=>T(e.id)},null,8,["onClick"])])]),_:2},1024))),128))])])]),_:1})])],64)):g("",!0),l(C,{icon:r(re),title:"Arcade Management",main:""},null,8,["icon"]),l(h,{"is-form":"",class:"mb-6",onSubmit:N(j,["prevent"])},{default:i(()=>[l(k,{color:"info",label:"Settings",icon:r(de),class:"mb-2"},null,8,["icon"]),s("div",Ue,[(o(!0),_(w,null,R(r(U),e=>(o(),b(y,{key:e.id,label:e.name,help:e.help},{default:i(()=>[e.type=="Boolean"?(o(),b(D,{key:0,name:e.id,"model-value":!!(r(L)(v.value,e.id)??!1),"input-value":!0,type:"switch","onUpdate:modelValue":p=>r(O)(v.value,e.id,p??!1)},null,8,["name","model-value","onUpdate:modelValue"])):g("",!0)]),_:2},1032,["label","help"]))),128))]),JSON.stringify(v.value)!==JSON.stringify($.value)?(o(),_("div",Me,[l(d,{color:"success",label:"Save",type:"submit"}),l(d,{color:"danger",label:"Revert",onClick:a[7]||(a[7]=e=>f())})])):g("",!0)]),_:1}),l(h,{class:"w-full md:w-1/2 mb-6"},{default:i(()=>[a[9]||(a[9]=s("h1",{class:"text-lg md:text-xl"},"OpenVPN Configuration",-1)),a[10]||(a[10]=s("p",{class:"pb-1 dark:text-white/50"}," Use this to download your VPN config. ",-1)),l(d,{small:!1,color:"success",class:"my-2",label:"Export",onClick:a[8]||(a[8]=e=>G())})]),_:1,__:[9,10]}),l(C,{icon:r(ue),title:"Arcade Overview",main:""},null,8,["icon"]),s("div",Be,[l(ce,{number:u.value?.machines?.length,label:"Active Machines"},null,8,["number"])])],64))]),_:1})]),_:1}))}};export{ze as default};
