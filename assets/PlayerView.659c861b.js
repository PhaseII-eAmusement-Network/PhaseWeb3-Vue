import{b as re,r as z,o as X,c as l,k as y,l as J,e as c,w as _,j as r,f as d,X as B,n,t as p,_ as L,F as g,u as ie,a as ne,a3 as oe,s as ue,M as ce,p as de,g as i,m as me,i as G,aK as _e,W as I,aE as pe,aF as fe,aB as be,ai as b,A as ye,U as w,aL as ve,aM as ge,aN as ke,q as he}from"./index.c2012168.js";import{_ as we,g as U,a as F}from"./ProfileCard.7f9483e1.js";import{_ as xe}from"./FormControl.aafaeb46.js";import{A as Se}from"./profile.935c729b.js";import{A as Ve}from"./arcade.df7204fc.js";import{g as E}from"./danClass.233b0381.js";import"./userData.bcc92478.js";const $e={class:"flex space-x-2 mb-2"},De={class:"flex justify-between items-center"},Pe={class:"grid"},je={class:"text-lg font-bold"},Ne={class:"text-md"},Ae={class:"text-lg"},Ce={class:"text-lg"},q={__name:"JubilityTable",props:{jubilityData:{type:Array,required:!0},version:{type:Number,required:!0}},setup(R){const M=re(),k=z(null),$=R,v={0:{label:"Basic",color:"info"},1:{label:"Advanced",color:"warning"},2:{label:"Extreme",color:"danger"}};return X(async()=>{try{k.value=null;const u=$.jubilityData.map(s=>s.song_id),D=await M.getMusicData("jubeat",$.version,u),m=$.jubilityData.map(s=>{const a=D.find(P=>P.id===s.song_id&&P.chart===s.chart);return{...s,...a?{songData:a}:{}}});m.sort((s,a)=>a.rate-s.rate),k.value=m}catch(u){console.error("Failed to fetch music data:",u)}}),(u,D)=>k.value?(l(!0),y(g,{key:0},J(k.value,m=>(l(),c(L,{key:m.id,"color-prop":"bg-slate-800 dark:bg-slate-800",class:"my-3 p-5","has-table":""},{default:_(()=>[r("div",$e,[d(B,{label:v[m.chart].label,color:v[m.chart].color},null,8,["label","color"]),m.hard?(l(),c(B,{key:0,label:"Hard Mode",color:"danger"})):n("",!0)]),r("div",De,[r("div",Pe,[r("h1",je,p(m.songData.name),1),r("h2",Ne,p(m.songData.artist),1)]),r("div",null,[r("h2",Ae,"Jubility: "+p(m.value/10),1),r("h2",Ce,"Rate: "+p(m.rate/10),1)])])]),_:2},1024))),128)):n("",!0)}},Te={class:"md:flex pb-6 md:justify-between md:items-center"},Ie={key:0,class:"mt-2 md:mt-0 md:w-1/3 md:text-right"},Fe=["src"],Je={class:"bg-white dark:bg-slate-900/90 rounded-2xl pt-6 p-3 card-content"},Le={class:"w-full"},Be={class:"md:w-1/3 grid grid-cols-1 md:grid-cols-2 gap-3"},Me={class:"my-6 grid grid-cols-1 md:grid-cols-4 gap-6"},Oe={class:"my-6 grid grid-cols-2 md:grid-cols-5 xl:grid-cols-6 gap-6"},Ge={class:"my-6 grid grid-cols-1 md:grid-cols-2 gap-6"},Ee={class:"my-6"},Re={class:"border-s border-neutral-300 md:flex md:justify-start md:gap-10 md:border-s-0 md:border-t md:overflow-x-auto overflow-y-visible md:whitespace-nowrap scrollbar"},Ue={class:"flex-start flex items-center pt-2 md:block md:pt-4"},qe={class:"mt-2 text-sm font-light"},ze={class:"ms-4 pb-6 md:ms-0"},Xe={class:"text-lg font-semibold"},aa={__name:"PlayerView",setup(R){const M="https://cdn.phaseii.network/file/PhaseII/web-assets",k=ie(),$=ne();var v=null,u=null,D=null,m=!0;v=k.params.game,D=k.params.userId,u=oe(v),u||$.push({name:"ErrorPage",params:{catchAll:"404"}});const s=ue({currentVersion:null});ce(()=>s.currentVersion,()=>{m?m=!1:P()});const a=z(null);X(async()=>{P()}),u.versions||(s.currentVersion=1);async function P(){try{a.value=null;var t=await Se(v,s.currentVersion,D);t.timeline=await se(t),a.value=te(t),t&&!s.currentVersion&&(s.currentVersion=t.versions[t.versions.length-1])}catch(e){console.error("Failed to fetch user profile data:",e)}}async function H(t){try{return await Ve(t)}catch(e){console.error("Failed to fetch arcade data:",e)}}var K=[{label:"Register Date",type:String,span:"md:col-span-2",key:"first_play_timestamp"},{label:"Last Play",type:String,span:"md:col-span-2",key:"last_play_timestamp"},{label:"First Arcade",type:String,span:"md:col-span-2",key:"first_play_arcade"},{label:"Last Arcade",type:String,span:"md:col-span-2",key:"last_play_arcade"},{label:"Total Plays",type:Number,key:"total_plays"},{label:"EXP",type:Number,key:"exp"},{label:"SP Plays",type:Number,key:"single_plays"},{label:"DP Plays",type:Number,key:"double_plays"},{label:"SP DJPOINT",type:Number,key:"single_dj_points"},{label:"DP DJPOINT",type:Number,key:"double_dj_points"}];function W(){return s.currentVersion?`${M}/games/${u.id}/card/${s.currentVersion}.webp`:u.cardBG}function Q(){var t;return s.currentVersion&&((t=u.videoTable)==null?void 0:t.includes(s.currentVersion))?`https://web3.phaseii.network/gameassets/video/${u.id}/${s.currentVersion}.mp4`:null}function Y(){var t;return(t=u.videoTable)!=null&&t.includes(s.currentVersion)?null:`
      background-image: url('${W()}');
      background-size: cover;
      background-repeat: no-repeat;
    `}function Z(t,e){if(e){if(t.isSkill&&e.jubility)return U(e.jubility);if(t.isJubility&&e.records.skill)return F(e.records.skill)}return""}function ee(t){var e=[];for(const f of u.versions)t.includes(f.id)&&e.push(f);return e}function ae(t,e){return t.isSkill?e.stats[t.key]/100:t.isJubility?e.stats[t.key]/10:e.stats[t.key]}function te(t){if(t.stats){if(t.stats.first_play_timestamp){const e=new Date(t.stats.first_play_timestamp*1e3);t.stats.first_play_timestamp=e.toLocaleString()}if(t.stats.last_play_timestamp){const e=new Date(t.stats.last_play_timestamp*1e3);t.stats.last_play_timestamp=e.toLocaleString()}t.dp&&t.dp.dan!==void 0&&(t.dp.dan=E(t.dp.dan).short)}return t}function le(t){var f;const e=(f=t.stats)==null?void 0:f.count;return e?[e.mfc!=null?{label:"MFCs",value:e.mfc}:0,e.pfc!=null?{label:"PFCs",value:e.pfc}:0,e.fc!=null?{label:"GFCs",value:e.fc}:0,e.gfc!=null?{label:"FCs",value:e.gfc}:0,e.life4!=null?{label:"Life-4 Clears",value:e.life4}:0]:[]}async function se(t){const e=t==null?void 0:t.stats,f=e==null?void 0:e.first_play_timestamp,x=e==null?void 0:e.last_play_timestamp,j=e==null?void 0:e.arcade_history,h=[];if(f&&h.push({timestamp:new Date(f*1e3).toLocaleString(),arcade:e==null?void 0:e.first_play_arcade,first_play:!0}),j)for(const[S,V]of Object.entries(j)){const A=await H(S);for(const[C,T]of Object.entries(V))for(const N of T){const o=new Date(N*1e3);[f,x].includes(N)||h.push({timestamp:o.toLocaleString(),arcade:A.name,machineId:C,first_play:!1})}}return x&&h.push({timestamp:new Date(x*1e3).toLocaleString(),arcade:e==null?void 0:e.last_play_arcade,first_play:!1}),h.sort((S,V)=>new Date(S.timestamp).getTime()-new Date(V.timestamp).getTime())}return(t,e)=>(l(),c(he,null,{default:_(()=>[a.value?(l(),c(de,{key:0},{default:_(()=>{var f,x,j,h,S,V,A,C,T,N;return[r("div",Te,[d(G,{icon:i(me),href:`/#/games/${i(v)}`,class:"w-full md:w-auto",color:"info",label:`${i(u).shortName?i(u).shortName:i(u).name} Home`},null,8,["icon","href","label"]),i(u).versions&&a.value?(l(),y("div",Ie,[e[1]||(e[1]=r("h2",{class:"text-md sm:text-lg md:text-xl font-bold p-2"}," Select Version ",-1)),d(xe,{modelValue:s.currentVersion,"onUpdate:modelValue":e[0]||(e[0]=o=>s.currentVersion=o),options:ee(a.value.versions)},null,8,["modelValue","options"])])):n("",!0)]),d(I,{icon:i(_e),title:"View Profile",main:""},null,8,["icon"]),s.currentVersion&&a.value?(l(),y("div",{key:0,style:be(Y()),class:"rounded-2xl mb-6 card-container"},[r("video",{autoplay:"",muted:"",loop:"",playsinline:"",src:Q(),class:"background-video"},null,8,Fe),r("div",Je,[r("div",Le,[d(we,{"use-small":"",game:i(v),version:s.currentVersion,profile:a.value},{default:_(()=>[r("div",Be,[d(G,{href:`/#/games/${i(v)}/scores/${a.value.userId}`,icon:i(pe),class:"w-full md:w-auto",color:"info",label:"View Scores"},null,8,["href","icon"]),d(G,{href:`/#/games/${i(v)}/records/${a.value.userId}`,icon:i(fe),class:"w-full md:w-auto",color:"info",label:"View Records"},null,8,["href","icon"])])]),_:1},8,["game","version","profile"])])])],4)):n("",!0),r("div",Me,[(l(!0),y(g,null,J(i(K),o=>(l(),y(g,{key:o},[a.value.stats[o.key]?(l(),c(b,{key:0,class:ye(o.span),label:o.label,number:o.type==Number?ae(o,a.value):null,"num-color":Z(o)},{default:_(()=>[w(p(o.type==String?a.value.stats[o.key]:null),1)]),_:2},1032,["class","label","number","num-color"])):n("",!0)],64))),128)),(x=(f=a.value.stats)==null?void 0:f.count)!=null&&x.records?(l(),c(b,{key:0,label:"Records",number:(h=(j=a.value.stats)==null?void 0:j.count)==null?void 0:h.records},null,8,["number"])):n("",!0),(V=(S=a.value.stats)==null?void 0:S.count)!=null&&V.attempts?(l(),c(b,{key:1,label:"Attempts",number:(C=(A=a.value.stats)==null?void 0:A.count)==null?void 0:C.attempts},null,8,["number"])):n("",!0),a.value.skill?(l(),c(b,{key:2,label:"Skill Points",number:a.value.skill/100,"num-color":i(U)(a.value.skill)},null,8,["number","num-color"])):n("",!0),a.value.profile_skill?(l(),c(b,{key:3,label:"Skill Level"},{default:_(()=>[w(p(a.value.profile_skill/100),1)]),_:1})):n("",!0),a.value.jubility?(l(),c(b,{key:4,label:"Jubility","num-color":i(F)(a.value.jubility)},{default:_(()=>[w(p(a.value.jubility/10),1)]),_:1},8,["num-color"])):n("",!0),a.value.pick_up_jubility?(l(),c(b,{key:5,label:"Pick-Up Jubility","num-color":i(F)(a.value.pick_up_jubility)},{default:_(()=>[w(p(a.value.pick_up_jubility/10),1)]),_:1},8,["num-color"])):n("",!0),a.value.common_jubility?(l(),c(b,{key:6,label:"Common Jubility","num-color":i(F)(a.value.common_jubility)},{default:_(()=>[w(p(a.value.common_jubility/10),1)]),_:1},8,["num-color"])):n("",!0),a.value.deller?(l(),c(b,{key:7,label:"Deller",number:a.value.deller},null,8,["number"])):n("",!0),a.value.sgrade?(l(),c(b,{key:8,label:"SP DAN"},{default:_(()=>[w(p(i(E)(a.value.sgrade).label),1)]),_:1})):n("",!0),a.value.dgrade?(l(),c(b,{key:9,label:"DP DAN"},{default:_(()=>[w(p(i(E)(a.value.dgrade).label),1)]),_:1})):n("",!0)]),(T=a.value.stats)!=null&&T.count?(l(),y(g,{key:1},[d(I,{icon:i(ve),title:"Stats",main:""},null,8,["icon"]),r("div",Oe,[(l(!0),y(g,null,J(le(a.value),o=>(l(),y(g,{key:o},[o.value?(l(),c(b,{key:0,label:o.label,number:o.value},null,8,["label","number"])):n("",!0)],64))),128))])],64)):n("",!0),a.value.jubility?(l(),y(g,{key:2},[d(I,{icon:i(ge),title:"Jubility Breakdown",main:""},null,8,["icon"]),r("div",Ge,[a.value.pick_up_breakdown?(l(),c(L,{key:0},{default:_(()=>[d(B,{label:"Pick-Up",color:"info"}),d(q,{"jubility-data":a.value.pick_up_breakdown,",":"",version:s.currentVersion},null,8,["jubility-data","version"])]),_:1})):n("",!0),a.value.other_breakdown?(l(),c(L,{key:1},{default:_(()=>[d(B,{label:"Common",color:"info"}),d(q,{"jubility-data":a.value.other_breakdown,",":"",version:s.currentVersion},null,8,["jubility-data","version"])]),_:1})):n("",!0)])],64)):n("",!0),(N=a.value)!=null&&N.timeline?(l(),y(g,{key:3},[d(I,{icon:i(ke),title:"Timeline",main:""},null,8,["icon"]),r("div",Ee,[d(L,null,{default:_(()=>{var o;return[r("ol",Re,[(l(!0),y(g,null,J(JSON.parse(JSON.stringify((o=a.value)==null?void 0:o.timeline)).reverse(),O=>(l(),y("li",{key:O.timestamp,class:"md:inline-block flex-shrink-0"},[r("div",Ue,[e[2]||(e[2]=r("div",{class:"-ms-[6px] me-3 h-[12px] w-[12px] md:w-0.5 md:h-4 rounded-full md:rounded-none bg-gray-300 md:-mt-6 md:me-0 md:ms-0"},null,-1)),r("p",qe,p(O.timestamp),1)]),r("div",ze,[r("h4",Xe,p(O.arcade),1)])]))),128))])]}),_:1})])],64)):n("",!0)]}),_:1})):n("",!0)]),_:1}))}};export{aa as default};
