import{A as j,E as C,a as n,i as f,g as i,b as u,ai as L,t as T,e as r,G as M,k as d,u as E,s as q,N as z,ad as H,r as $,o as U,c as h,w as v,aj as V,F as O,f as P,ak as X,al as J,ac as K,P as Q,am as W,_ as Y,l as Z,n as ee,p as te,q as se}from"./index.5a8eb10d.js";import{_ as ae}from"./FormControl.d00df61e.js";import{_ as re}from"./ProfileCard.98a175d5.js";import{_ as oe}from"./GeneralTable.d5898e62.js";import{d as le}from"./userData.bcc92478.js";import{g as S}from"./danClass.233b0381.js";const ne={class:"pt-6 mb-6 flex items-center justify-between"},ie={class:"flex items-center justify-start space-x-2"},ce={class:"text-2xl md:text-3xl leading-tight"},ue={__name:"GameTitleLine",props:{path:{type:String,default:null},title:{type:String,required:!0}},setup(g){const y=j(()=>C().default);return(p,x)=>(n(),f("section",ne,[i("div",ie,[u(L,{path:g.path,class:"w-12 h-12 p-1 drop-shadow-md"},null,8,["path"]),i("h1",ce,T(g.title),1)]),r(y)?M(p.$slots,"default",{key:0}):d("",!0)]))}},de=["src"],fe={class:"bg-white dark:bg-slate-900/90 rounded-2xl pt-6 p-3 card-content"},me={class:"w-full"},pe={class:"md:flex md:px-5 md:space-x-10 md:justify-between md:items-center"},_e={key:0,class:"md:w-1/3 md:text-right"},he=i("h2",{class:"text-md sm:text-lg md:text-xl font-bold p-2"}," Select Version ",-1),ve={key:0,class:"w-full pt-6"},ge={class:"grid grid-cols-2 gap-6 pt-6"},ye={key:1,class:"md:w-1/2 grid grid-cols-1 md:grid-cols-2 gap-3"},xe={class:"bg-white dark:bg-slate-900/95 rounded-2xl lg:flex lg:justify-between"},be={class:"w-full"},Be={__name:"GameView",setup(g){const y=te(),p=se(),x=E();var c=null,s=null;const a=q({currentVersion:null});z(()=>a.currentVersion,()=>{w()}),c=y.params.id,s=H(c),s==null&&p.push({name:"ErrorPage",params:{catchAll:"404"}});const o=$(null),b=$([]);U(async()=>{try{const e=await x.getGameProfiles(c);b.value=R(e)}catch(e){console.error("Failed to fetch profile data:",e)}w()}),s.versions||(a.currentVersion=1);async function w(){try{o.value=null;const e=await x.getUserProfile(c,a.currentVersion);o.value=e,e&&!a.currentVersion&&(a.currentVersion=e.versions[e.versions.length-1])}catch(e){console.error("Failed to fetch user profile data:",e)}}function I(){return a.currentVersion?`/assets/games/${s.id}/card/${a.currentVersion}.webp`:s.cardBG}function B(){var e;return a.currentVersion&&((e=s.videoTable)==null?void 0:e.includes(a.currentVersion))?`https://web3.phaseii.network/gameassets/video/${s.id}/${a.currentVersion}.mp4`:null}function D(){var e;return(e=s.videoTable)!=null&&e.includes(a.currentVersion)?null:`
      background-image: url('${I()}');
      background-size: cover;
      background-repeat: no-repeat;
    `}const m=[];if(m.push({text:"Player",value:"username",sortable:!0,width:120}),s.noRivals||m.push({text:"Rival ID",value:"extid",width:100}),m.push({text:"Last Play",value:"stats.last_play_timestamp",width:150},{text:"Last Arcade",value:"stats.last_play_arcade",width:150},{text:"Plays",value:"stats.total_plays",sortable:!0,width:50}),s.playerHeaders)for(var G of s.playerHeaders)m.push(G);function R(e){var l=[];for(var t of e){if(t.extid&&(t.extid=le(t.extid)),t.stats){if(t.stats.last_play_timestamp){const _=new Date(t.stats.last_play_timestamp*1e3);t.stats.last_play_timestamp=_.toLocaleString()}t.sgrade&&(t.sgrade=S(t.sgrade).short),t.dgrade&&(t.dgrade=S(t.dgrade).short)}l.push(t)}return l.sort((_,k)=>{const N=_.stats&&_.stats.total_plays||0;return(k.stats&&k.stats.total_plays||0)-N}),l}function A(e){var l=[];for(const t of s.versions)e.includes(t.id)&&l.push(t);return l}const F=e=>{const l=e.userId;p.push(`/games/${c}/profiles/${l}`)};return(e,l)=>(n(),h(ee,null,{default:v(()=>[u(Z,null,{default:v(()=>[a.currentVersion&&o.value?(n(),f("div",{key:0,style:K(D()),class:"rounded-2xl mb-6 card-container"},[i("video",{autoplay:"",muted:"",loop:"",playsinline:"",src:B(),class:"background-video"},null,8,de),i("div",fe,[i("div",me,[i("div",pe,[u(ue,{path:r(s).icon,title:r(s).name},null,8,["path","title"]),r(s).versions&&o.value?(n(),f("div",_e,[he,u(ae,{modelValue:a.currentVersion,"onUpdate:modelValue":l[0]||(l[0]=t=>a.currentVersion=t),options:A(o.value.versions)},null,8,["modelValue","options"])])):d("",!0)])]),o.value?(n(),f("div",ve,[u(re,{game:r(c),version:a.currentVersion,profile:o.value},{default:v(()=>[i("div",ge,[u(V,{number:o.value.stats.total_plays,label:"Plays"},null,8,["number"]),o.value.records?(n(),f(O,{key:0},[o.value.records.skill?(n(),h(V,{key:0,number:o.value.records.skill/100,label:"Skill Points"},null,8,["number"])):d("",!0)],64)):d("",!0)])]),_:1},8,["game","version","profile"])])):(n(),f("div",ye,[r(s).noScores?d("",!0):(n(),h(P,{key:0,href:`/#/games/${r(c)}/scores`,icon:r(X),outline:!1,color:"info",label:"Network Scores"},null,8,["href","icon"])),r(s).noRecords?d("",!0):(n(),h(P,{key:1,href:`/#/games/${r(c)}/records`,icon:r(J),outline:!1,color:"info",label:"Network Records"},null,8,["href","icon"]))]))])],4)):d("",!0),u(Q,{icon:r(W),title:"All Players",main:""},null,8,["icon"]),u(Y,{"has-table":""},{default:v(()=>[i("div",xe,[i("div",be,[u(oe,{headers:m,items:b.value,path:`/#/${r(c)}/profiles/`,onRowClicked:F},null,8,["items","path"])])])]),_:1})]),_:1})]),_:1}))}};export{Be as default};
