import{u as Y,a as Z,b as aa,ag as ea,r as X,o as ra,c as j,e as la,w as o,f as t,k as sa,g as s,$ as ta,bC as na,i as oa,b3 as da,_ as ca,F as ua,n as fa,p as ia,q as pa}from"./index.e616e197.js";import{_ as _a}from"./GeneralTable.c5a562b0.js";import{_ as ha}from"./GameHeader.fd207853.js";import{A as ka}from"./profile.4a8a1d8b.js";import"./sources.326053a6.js";const Ta={__name:"PersonalScores",setup(ga){const u=Y(),z=Z(),J=aa();var n=null,e=null,d=null;n=u.params.game,d=u.params.userId,e=ea(n),e||z.push({name:"ErrorPage",params:{catchAll:"404"}});const l=X(null),f=X([]),i=[{text:"Timestamp",value:"timestamp",width:140},{text:"New PB",value:"newRecord",width:100},{text:"Song",value:"song.name",width:180},{text:"Artist",value:"song.artist",width:180},{text:"Chart",value:"song.chart",width:100},{text:"Grade",value:"data.rank",width:80},{text:"Score",value:"points",width:120}];if(e.scoreHeaders)for(var K of e.scoreHeaders)i.push(K);ra(async()=>{try{const r=await J.getAttemptData(n,d);f.value=Q(r)}catch(r){console.error("Failed to fetch score data:",r)}O()});async function O(){try{l.value=null;const r=await ka(n,null,d);l.value=r}catch(r){console.error("Failed to fetch user profile data:",r)}}function Q(r){var p,_,h,k,g,v,b,w,m,$,T,x,S,A,C,I,P,F,R,y,B,D,E,N,G,L,H,M,V,q,U;var c=[];for(var a of r){if(a.newRecord?a.newRecord="\u2705":a.newRecord="",a.timestamp){const W=new Date(a.timestamp*1e3);a.timestamp=W.toLocaleString()}a.points!=null&&(a.points=a.points.toString().replace(new RegExp("\\B(?<!\\.\\d*)(?=(\\d{3})+(?!\\d))","g"),",")),((_=(p=a.data)==null?void 0:p.stats)==null?void 0:_.score)!=null&&(a.exscore=a.points.toString(),a.points=(k=(h=a.data)==null?void 0:h.stats)==null?void 0:k.score.toString().replace(new RegExp("\\B(?<!\\.\\d*)(?=(\\d{3})+(?!\\d))","g"),",")),((g=a.song)==null?void 0:g.chart)!=null&&e.chartTable&&(a.song.chart=e.chartTable[(v=a.song)==null?void 0:v.chart]),((b=a.data)==null?void 0:b.halo)!=null&&e.haloTable&&(a.data.halo=e.haloTable[(w=a.data)==null?void 0:w.halo]),((m=a.data)==null?void 0:m.medal)!=null&&e.medalTable&&(a.data.medal=e.medalTable[($=a.data)==null?void 0:$.medal]),((T=a.data)==null?void 0:T.clear_status)!=null&&e.medalTable&&(a.data.medal=e.medalTable[(x=a.data)==null?void 0:x.clear_status]),((S=a.data)==null?void 0:S.rank)!=null&&e.rankTable&&(a.data.rank=e.rankTable[(A=a.data)==null?void 0:A.rank]),((C=a.data)==null?void 0:C.result_rank)!=null&&e.rankTable&&(a.data.rank=e.rankTable[(I=a.data)==null?void 0:I.result_rank]),((P=a.data)==null?void 0:P.grade)!=null&&e.rankTable&&(a.data.rank=e.rankTable[(F=a.data)==null?void 0:F.grade]),((R=a.data)==null?void 0:R.skill_perc)>0?a.data.skill_perc=`${((y=a.data)==null?void 0:y.skill_perc)/100}%`:a.data.skill_perc="0%",(B=a.data)!=null&&B.skill_points&&(a.data.skill_points=((D=a.data)==null?void 0:D.skill_points)/10),((E=a.data)==null?void 0:E.perc)>0?a.data.perc=`${((N=a.data)==null?void 0:N.perc)/100}%`:a.data.perc="0%",(G=a.data)!=null&&G.new_skill&&(a.data.new_skill=((L=a.data)==null?void 0:L.new_skill)/10),(H=a.data)!=null&&H.music_rate&&(a.data.music_rate=((M=a.data)==null?void 0:M.music_rate)/10),(V=a.data)!=null&&V.excellent?a.medal="EX FC":(q=a.data)!=null&&q.fullcombo?a.medal="FC":(U=a.data)!=null&&U.clear?a.medal="CLEARED":a.medal="FAILED",c.push(a)}return c}return(r,c)=>(j(),la(pa,null,{default:o(()=>[t(ia,null,{default:o(()=>[l.value?(j(),sa(ua,{key:0},[t(ha,{game:s(e),profile:l.value},null,8,["game","profile"]),t(ta,{icon:s(na),title:`${l.value.username}'s ${s(e).shortName?s(e).shortName:s(e).name} Scores`,main:""},{default:o(()=>[t(oa,{icon:s(da),href:`/#/games/${s(e).id}/profiles/${l.value.userId}`,outline:!1,color:"info",label:`${l.value.username}'s Profile`},null,8,["icon","href","label"])]),_:1},8,["icon","title"]),t(ca,{"has-table":""},{default:o(()=>[t(_a,{headers:i,items:f.value},null,8,["items"])]),_:1})],64)):fa("",!0)]),_:1})]),_:1}))}};export{Ta as default};
