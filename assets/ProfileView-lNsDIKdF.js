import{b as A,a as E,s as _,r as y,N as S,c as d,e as p,w as o,f as e,_ as B,k as I,O as L,P as h,i,z as b,j as V,y as O,Q as J,B as F,A as f,g as P,n as U,D as v,E as $,R as M,q as D,S as R}from"./index-Bc45stE5.js";import{_ as u}from"./FormField-yHTVSteI.js";import{_ as m}from"./FormControl-DHk9sN2D.js";const j={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},K={__name:"ProfileView",setup(z){const n=A(),N=E(),c=_({username:JSON.parse(JSON.stringify(n.userName)),email:JSON.parse(JSON.stringify(n.userEmail)),pin:null}),l=_({username:JSON.parse(JSON.stringify(n.userName)),email:JSON.parse(JSON.stringify(n.userEmail)),pin:null}),t=_({currentPassword:"",newPassword:"",confirmPassword:""}),w=y(!1),g=y(!1);S(()=>n.userName,s=>{l.username=JSON.parse(JSON.stringify(s)),c.username=JSON.parse(JSON.stringify(s))}),S(()=>n.userEmail,s=>{l.email=JSON.parse(JSON.stringify(s)),c.email=JSON.parse(JSON.stringify(s))});async function k(){w.value=!0,(await n.putUser(l)).status=="success"&&(w.value=!1,n.userLoaded=!1,await n.loadUser(),N.go())}async function q(){g.value=!0,(await R(t.currentPassword,t.newPassword,t.confirmPassword)).status=="success"&&(alert("Password changed."),g.value=!1,await n.loadUser(),N.go())}function x(s){s.target.value=s.target.value.replace(/\D/g,"")}function C(s,a){return JSON.stringify(s)!==JSON.stringify(a)}return(s,a)=>(p(),d(D,null,{default:o(()=>[e(B,null,{default:o(()=>[e(L,{class:"mb-6","use-small":"","even-smaller":""}),e(h,{icon:i(b),title:"Profile Settings",main:""},null,8,["icon"]),I("div",j,[e(V,{"is-form":"",class:"row-span-1",onSubmit:O(k,["prevent"])},{footer:o(()=>[C(c,l)?(p(),d(U,{key:0,color:"success",type:"submit",label:"Update"})):P("",!0),w.value?(p(),d(v,{key:1,path:i($),color:"text-yellow-500",class:"animate animate-spin"},null,8,["path"])):P("",!0)]),default:o(()=>[e(J,{color:"info",label:"General",class:"mb-2"}),e(u,{label:"Username"},{default:o(()=>[e(m,{modelValue:l.username,"onUpdate:modelValue":a[0]||(a[0]=r=>l.username=r),icon:i(b),name:"username",required:"",autocomplete:"username"},null,8,["modelValue","icon"])]),_:1}),e(u,{label:"E-mail",help:"Used for password resetting and 2FA"},{default:o(()=>[e(m,{modelValue:l.email,"onUpdate:modelValue":a[1]||(a[1]=r=>l.email=r),icon:i(F),type:"email",name:"email",required:"",autocomplete:"email"},null,8,["modelValue","icon"])]),_:1}),e(u,{label:"PIN",help:"Used when logging into a game"},{default:o(()=>[e(m,{modelValue:l.pin,"onUpdate:modelValue":a[2]||(a[2]=r=>l.pin=r),icon:i(f),type:"password",name:"pin",minlength:4,maxlength:4,inputmode:"numeric",pattern:"\\d{4}",autocomplete:"pin",onInput:x},null,8,["modelValue","icon"])]),_:1})]),_:1}),e(V,{"is-form":"",class:"row-span-2",onSubmit:a[6]||(a[6]=O(r=>q(),["prevent"]))},{footer:o(()=>[e(U,{type:"submit",color:"success",label:"Update"}),g.value?(p(),d(v,{key:0,path:i($),color:"text-yellow-500",class:"animate animate-spin"},null,8,["path"])):P("",!0)]),default:o(()=>[e(J,{color:"info",label:"Change Password",class:"mb-2"}),e(u,{label:"Current Password"},{default:o(()=>[e(m,{modelValue:t.currentPassword,"onUpdate:modelValue":a[3]||(a[3]=r=>t.currentPassword=r),icon:i(f),name:"currentPassword",type:"password",required:""},null,8,["modelValue","icon"])]),_:1}),e(M),e(u,{label:"New Password"},{default:o(()=>[e(m,{modelValue:t.newPassword,"onUpdate:modelValue":a[4]||(a[4]=r=>t.newPassword=r),icon:i(f),name:"newPassword",type:"password",required:""},null,8,["modelValue","icon"])]),_:1}),e(u,{label:"Confirm Password"},{default:o(()=>[e(m,{modelValue:t.confirmPassword,"onUpdate:modelValue":a[5]||(a[5]=r=>t.confirmPassword=r),icon:i(f),name:"confirmPassword",type:"password",required:""},null,8,["modelValue","icon"])]),_:1})]),_:1})])]),_:1})]),_:1}))}};export{K as default};
