import{m as _,B as k,c as u,a as l,w as i,p as t,b as a,n as v,E as S,d,e as n,G as w,g as r,s as c,K as y,M as $,t as I,N as K,O as A,P as C}from"./index-BbEl7F8w.js";import{I as N}from"./PhAt.vue-C3v-okdr.js";import{F as R}from"./PhKey.vue-Bl6-bsZC.js";import{G as b}from"./PhPassword.vue-Bh7AlhuM.js";import{I as x}from"./PhSpinnerBall.vue-CmGAKxwQ.js";import{_ as f}from"./FormField-B9DH-KpM.js";import{_ as p}from"./FormControl-C6hCQuvp.js";import{_ as B}from"./LayoutGuest-BCmbRonL.js";const E={class:"flex md:min-h-screen md:items-center md:justify-center"},U={class:"p-4 flex flex-col md:flex-row w-full space-y-2 md:space-y-0 md:space-x-4"},q={class:"grid grid-cols-1 gap-2"},G={class:"mb-4"},L={class:"text-xl"},M={class:"font-bold"},j={key:3,class:"border-t border mt-3 w-full"},D={key:4,class:"flex flex-col gap-2 my-1"},Y={__name:"ResetView",setup(F){const g=_(),e=k({email:"",loading:!1,emailSent:!1,authKey:null,authValid:!1,username:null,newPassword:"",confirmPassword:""});async function h(){e.loading=!0,(await K(e.email)).status=="success"&&(e.emailSent=!0,e.loading=!1)}async function P(){e.loading=!0;const m=await A(e.authKey);m.status=="success"&&(e.authValid=!0,e.loading=!1,e.username=m.username)}async function V(){if(e.newPassword!=e.confirmPassword){alert("Passwords don't match!");return}e.loading=!0,(await C(e.authKey,e.newPassword,e.confirmPassword)).status=="success"&&(alert("Password changed!"),g.push("/auth/login"))}return(m,s)=>(l(),u(B,null,{default:i(()=>[t("div",E,[a(v,{class:"w-full md:w-auto rounded-none md:rounded-xl md:drop-shadow-xl","has-table":"","is-auth":""},{default:i(()=>[t("div",U,[s[10]||(s[10]=t("div",{class:"flex flex-col items-center text-wrap h-full md:mt-5"},[t("img",{src:S,class:"rounded-full shadow-lg mb-2"}),t("h1",{class:"text-xl"},[t("samp",null,"PhaseII")]),t("p",{class:"text-sm text-gray-700 dark:text-white/75"}," Spinnin' since 2021 "),t("hr",{class:"border-t border my-1 w-full"}),t("p",{class:"text-lg relative bottom-0"},"Password Reset")],-1)),s[11]||(s[11]=t("div",{class:"md:border-r md:border"},null,-1)),t("div",q,[e.emailSent?n("",!0):(l(),d("form",{key:0,onSubmit:s[1]||(s[1]=w(o=>h(),["prevent"]))},[a(f,{label:"Email Address"},{default:i(()=>[a(p,{modelValue:e.email,"onUpdate:modelValue":s[0]||(s[0]=o=>e.email=o),icon:r(N),type:"email",autocomplete:"email",required:""},null,8,["modelValue","icon"])]),_:1}),a(c,{label:"Check",type:"submit",color:"info"}),e.loading?(l(),u(y,{key:0,icon:r(x),color:"text-yellow-500",class:"animate animate-spin"},null,8,["icon"])):n("",!0)],32)),e.emailSent&&!e.authValid?(l(),d("form",{key:1,onSubmit:s[3]||(s[3]=w(o=>P(),["prevent"]))},[a(f,{label:"Auth Key"},{default:i(()=>[a(p,{modelValue:e.authKey,"onUpdate:modelValue":s[2]||(s[2]=o=>e.authKey=o),icon:r(R),type:"text",name:"token",inputmode:"numeric",pattern:"[0-9]*",autocomplete:"one-time-code",maxlength:6},null,8,["modelValue","icon"])]),_:1}),a(c,{label:"Unlock",type:"submit",color:"info"}),e.loading?(l(),u(y,{key:0,icon:r(x),color:"text-yellow-500",class:"animate animate-spin"},null,8,["icon"])):n("",!0)],32)):n("",!0),e.emailSent&&e.authValid?(l(),d("form",{key:2,onSubmit:s[6]||(s[6]=w(o=>V(),["prevent"]))},[t("div",G,[t("h1",L,[s[7]||(s[7]=$(" Welcome, ",-1)),t("span",M,I(e.username),1)]),s[8]||(s[8]=t("p",{class:"text-sm text-gray-400"}," Look who forgot their password ",-1))]),a(f,{label:"New Password"},{default:i(()=>[a(p,{modelValue:e.newPassword,"onUpdate:modelValue":s[4]||(s[4]=o=>e.newPassword=o),icon:r(b),type:"password",required:"",minlength:"8"},null,8,["modelValue","icon"])]),_:1}),a(f,{label:"Confirm Password"},{default:i(()=>[a(p,{modelValue:e.confirmPassword,"onUpdate:modelValue":s[5]||(s[5]=o=>e.confirmPassword=o),icon:r(b),type:"password",required:"",minlength:"8"},null,8,["modelValue","icon"])]),_:1}),a(c,{label:"Reset Password",type:"submit",color:"success"}),e.loading?(l(),u(y,{key:0,icon:r(x),color:"text-yellow-500",class:"animate animate-spin"},null,8,["icon"])):n("",!0)],32)):n("",!0),e.authValid?n("",!0):(l(),d("hr",j)),e.authValid?n("",!0):(l(),d("div",D,[s[9]||(s[9]=t("h2",null,"Remember it?",-1)),a(c,{label:"Log In",color:"success",to:"/auth/login"})]))])])]),_:1})])]),_:1}))}};export{Y as default};
