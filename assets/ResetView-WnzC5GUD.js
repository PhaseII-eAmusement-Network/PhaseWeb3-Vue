import{b as P,n as k,c as u,d as o,w as i,i as t,e as a,h as v,q as S,j as d,f as n,s as w,g as r,l as c,v as y,y as $,t as I,z as C,B as K,C as A}from"./index-0qLJ2-KK.js";import{I as R}from"./PhAt.vue-CNHrC6tk.js";import{F as B}from"./PhKey.vue-BekLIV6e.js";import{G as b}from"./PhPassword.vue-D_EMrZ1G.js";import{I as x}from"./PhSpinnerBall.vue-BdJjyNUu.js";import{_ as f}from"./FormField-C2hIlabr.js";import{_ as p}from"./FormControl-n-2BZaUK.js";import{_ as N}from"./LayoutGuest-C_V8BIzT.js";const U={class:"flex md:min-h-screen md:items-center md:justify-center"},q={class:"p-4 flex flex-col md:flex-row w-full space-y-2 md:space-y-0 md:space-x-4"},E={class:"grid grid-cols-1 gap-2"},j={class:"mb-4"},L={class:"text-xl"},z={class:"font-bold"},D={key:3,class:"border-t border mt-3 w-full"},F={key:4,class:"flex flex-col gap-2 my-1"},Y={__name:"ResetView",setup(G){const g=P(),e=k({email:"",loading:!1,emailSent:!1,authKey:null,authValid:!1,username:null,newPassword:"",confirmPassword:""});async function h(){e.loading=!0,(await C(e.email)).status=="success"&&(e.emailSent=!0,e.loading=!1)}async function V(){e.loading=!0;const m=await K(e.authKey);m.status=="success"&&(e.authValid=!0,e.loading=!1,e.username=m.username)}async function _(){if(e.newPassword!=e.confirmPassword){alert("Passwords don't match!");return}e.loading=!0,(await A(e.authKey,e.newPassword,e.confirmPassword)).status=="success"&&(alert("Password changed!"),g.push("/auth/login"))}return(m,s)=>(o(),u(N,null,{default:i(()=>[t("div",U,[a(v,{class:"w-full md:w-auto rounded-none md:rounded-xl md:drop-shadow-xl","has-table":"","is-auth":""},{default:i(()=>[t("div",q,[s[10]||(s[10]=t("div",{class:"flex flex-col items-center text-wrap h-full md:mt-5"},[t("img",{src:S,class:"rounded-full shadow-lg mb-2"}),t("h1",{class:"text-xl"},[t("samp",null,"PhaseII")]),t("p",{class:"text-sm text-gray-700 dark:text-white/75"}," Spinnin' since 2021 "),t("hr",{class:"border-t border my-1 w-full"}),t("p",{class:"text-lg relative bottom-0"},"Password Reset")],-1)),s[11]||(s[11]=t("div",{class:"md:border-r md:border"},null,-1)),t("div",E,[e.emailSent?n("",!0):(o(),d("form",{key:0,onSubmit:s[1]||(s[1]=w(l=>h(),["prevent"]))},[a(f,{label:"Email Address"},{default:i(()=>[a(p,{modelValue:e.email,"onUpdate:modelValue":s[0]||(s[0]=l=>e.email=l),icon:r(R),type:"email",autocomplete:"email",required:""},null,8,["modelValue","icon"])]),_:1}),a(c,{label:"Check",type:"submit",color:"info"}),e.loading?(o(),u(y,{key:0,icon:r(x),color:"text-yellow-500",class:"animate animate-spin"},null,8,["icon"])):n("",!0)],32)),e.emailSent&&!e.authValid?(o(),d("form",{key:1,onSubmit:s[3]||(s[3]=w(l=>V(),["prevent"]))},[a(f,{label:"Auth Key"},{default:i(()=>[a(p,{modelValue:e.authKey,"onUpdate:modelValue":s[2]||(s[2]=l=>e.authKey=l),icon:r(B),type:"text",name:"token",inputmode:"numeric",pattern:"[0-9]*",autocomplete:"one-time-code",maxlength:6},null,8,["modelValue","icon"])]),_:1}),a(c,{label:"Unlock",type:"submit",color:"info"}),e.loading?(o(),u(y,{key:0,icon:r(x),color:"text-yellow-500",class:"animate animate-spin"},null,8,["icon"])):n("",!0)],32)):n("",!0),e.emailSent&&e.authValid?(o(),d("form",{key:2,onSubmit:s[6]||(s[6]=w(l=>_(),["prevent"]))},[t("div",j,[t("h1",L,[s[7]||(s[7]=$(" Welcome, ",-1)),t("span",z,I(e.username),1)]),s[8]||(s[8]=t("p",{class:"text-sm text-gray-400"}," Look who forgot their password ",-1))]),a(f,{label:"New Password"},{default:i(()=>[a(p,{modelValue:e.newPassword,"onUpdate:modelValue":s[4]||(s[4]=l=>e.newPassword=l),icon:r(b),type:"password",required:"",minlength:"8"},null,8,["modelValue","icon"])]),_:1}),a(f,{label:"Confirm Password"},{default:i(()=>[a(p,{modelValue:e.confirmPassword,"onUpdate:modelValue":s[5]||(s[5]=l=>e.confirmPassword=l),icon:r(b),type:"password",required:"",minlength:"8"},null,8,["modelValue","icon"])]),_:1}),a(c,{label:"Reset Password",type:"submit",color:"success"}),e.loading?(o(),u(y,{key:0,icon:r(x),color:"text-yellow-500",class:"animate animate-spin"},null,8,["icon"])):n("",!0)],32)):n("",!0),e.authValid?n("",!0):(o(),d("hr",D)),e.authValid?n("",!0):(o(),d("div",F,[s[9]||(s[9]=t("h2",null,"Remember it?",-1)),a(c,{label:"Log In",color:"success",href:"/#/auth/login"})]))])])]),_:1})])]),_:1}))}};export{Y as default};
