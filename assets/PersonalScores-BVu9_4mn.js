import{a as Z,b as aa,u as ea,a7 as sa,r as q,o as ra,c as la,d as z,w as d,e as t,_ as ta,j as na,f as oa,F as da,g as l,P as ca,as as ua,l as fa,bF as ia,h as pa,n as _a}from"./index-CHivKhhP.js";import{_ as ha}from"./GeneralTable-Dm8yzA2j.js";import{_ as ga}from"./GameHeader-CbS6z4E_.js";import{A as ka}from"./profile-LMvWxmH8.js";import"./sources-0lyug9Pk.js";const xa={__name:"PersonalScores",setup(va){const u=Z(),f=aa(),J=ea();var n=null,e=null,c=null;n=u.params.game,c=u.params.userId,e=sa(n),e||f.push({name:"ErrorPage",params:{catchAll:"404"}});const r=q(null),i=q([]),p=[{text:"Timestamp",value:"timestamp",width:140},{text:"New PB",value:"newRecord",width:100},{text:"Song",value:"song.name",width:180},{text:"Artist",value:"song.artist",width:180},{text:"Chart",value:"song.chart",width:100},{text:"Grade",value:"data.rank",width:80},{text:"Score",value:"points",width:120}];if(e.scoreHeaders)for(var K of e.scoreHeaders)p.push(K);ra(async()=>{try{const s=await J.getAttemptData(n,c);i.value=Q(s)}catch(s){console.error("Failed to fetch score data:",s)}O()});async function O(){try{r.value=null;const s=await ka(n,null,c);r.value=s}catch(s){console.error("Failed to fetch user profile data:",s)}}function Q(s){var _,h,g,k,v,w,b,m,$,T,x,S,I,P,A,C,F,R,y,B,D,E,N,G,L,H,M,V,j,U,X;var o=[];for(var a of s){if(a.newRecord?a.newRecord="âœ…":a.newRecord="",a.timestamp){const Y=new Date(a.timestamp*1e3);a.timestamp=Y.toLocaleString()}a.points!=null&&(a.points=a.points.toString().replace(new RegExp("\\B(?<!\\.\\d*)(?=(\\d{3})+(?!\\d))","g"),",")),((h=(_=a.data)==null?void 0:_.stats)==null?void 0:h.score)!=null&&(a.exscore=a.points.toString(),a.points=(k=(g=a.data)==null?void 0:g.stats)==null?void 0:k.score.toString().replace(new RegExp("\\B(?<!\\.\\d*)(?=(\\d{3})+(?!\\d))","g"),",")),((v=a.song)==null?void 0:v.chart)!=null&&e.chartTable&&(a.song.chart=e.chartTable[(w=a.song)==null?void 0:w.chart]),((b=a.data)==null?void 0:b.halo)!=null&&e.haloTable&&(a.data.halo=e.haloTable[(m=a.data)==null?void 0:m.halo]),(($=a.data)==null?void 0:$.medal)!=null&&e.medalTable&&(a.data.medal=e.medalTable[(T=a.data)==null?void 0:T.medal]),((x=a.data)==null?void 0:x.clear_status)!=null&&e.medalTable&&(a.data.medal=e.medalTable[(S=a.data)==null?void 0:S.clear_status]),((I=a.data)==null?void 0:I.rank)!=null&&e.rankTable&&(a.data.rank=e.rankTable[(P=a.data)==null?void 0:P.rank]),((A=a.data)==null?void 0:A.result_rank)!=null&&e.rankTable&&(a.data.rank=e.rankTable[(C=a.data)==null?void 0:C.result_rank]),((F=a.data)==null?void 0:F.grade)!=null&&e.rankTable&&(a.data.rank=e.rankTable[(R=a.data)==null?void 0:R.grade]),((y=a.data)==null?void 0:y.skill_perc)>0?a.data.skill_perc=`${((B=a.data)==null?void 0:B.skill_perc)/100}%`:a.data.skill_perc="0%",(D=a.data)!=null&&D.skill_points&&(a.data.skill_points=((E=a.data)==null?void 0:E.skill_points)/10),((N=a.data)==null?void 0:N.perc)>0?a.data.perc=`${((G=a.data)==null?void 0:G.perc)/100}%`:a.data.perc="0%",(L=a.data)!=null&&L.new_skill&&(a.data.new_skill=((H=a.data)==null?void 0:H.new_skill)/10),(M=a.data)!=null&&M.music_rate&&(a.data.music_rate=((V=a.data)==null?void 0:V.music_rate)/10),(j=a.data)!=null&&j.excellent?a.medal="EX FC":(U=a.data)!=null&&U.fullcombo?a.medal="FC":(X=a.data)!=null&&X.clear?a.medal="CLEARED":a.medal="FAILED",o.push(a)}return o}const W=s=>{const o=s.song.id;f.push(`/games/${n}/song/${o}`)};return(s,o)=>(z(),la(_a,null,{default:d(()=>[t(ta,null,{default:d(()=>[r.value?(z(),na(da,{key:0},[t(ga,{game:l(e),profile:r.value},null,8,["game","profile"]),t(ca,{icon:l(ua),title:`${r.value.username}'s ${l(e).shortName?l(e).shortName:l(e).name} Scores`,main:""},{default:d(()=>[t(fa,{icon:l(ia),href:`/#/games/${l(e).id}/profiles/${r.value.userId}`,outline:!1,color:"info",label:`${r.value.username}'s Profile`},null,8,["icon","href","label"])]),_:1},8,["icon","title"]),t(pa,{"has-table":""},{default:d(()=>[t(ha,{headers:p,items:i.value,onRowClicked:W},null,8,["items"])]),_:1})],64)):oa("",!0)]),_:1})]),_:1}))}};export{xa as default};
