import{u as S,s as v,a as n,c as h,w as u,g as t,b as s,i as f,e as i,Q as A,f as p,I as _,R as g,k as r,v as x,S as K,U as $,t as E,y as P,_ as I,A as R,q as C}from"./index.5dababdb.js";import{_ as w}from"./FormField.1980ca4c.js";import{_ as y}from"./FormControl.225981c0.js";import{_ as U}from"./LayoutGuest.cd46593f.js";const b=S();async function N(d){try{return await b.callApi("/auth/emailAuth","POST",{email:d})}catch(o){throw console.log("Error checking email:",o),o}}async function O(d){try{return await b.callApi("/auth/check2FAKey","POST",{key:d})}catch(o){throw console.log("Error checking key:",o),o}}async function q(d,o,e){try{return await b.callApi("/auth/changePassword","POST",{key:d,newPassword:o,confirmPassword:e})}catch(m){throw console.log("Error resetting password:",m),m}}const B={class:"flex md:min-h-screen md:items-center md:justify-center"},T={class:"p-4 flex flex-col md:flex-row w-full space-y-2 md:space-y-0 md:space-x-4"},L=t("div",{class:"flex flex-col items-center text-wrap h-full md:mt-5"},[t("img",{src:R,class:"rounded-full shadow-lg mb-2"}),t("h1",{class:"text-xl"},[t("samp",null,"PhaseII")]),t("p",{class:"text-sm text-gray-700 dark:text-white/75"}," Spinnin' since 2021 "),t("hr",{class:"border-t border-1 my-1 w-full"}),t("p",{class:"text-lg relative bottom-0"},"Password Reset")],-1),M=t("div",{class:"md:border-r md:border-1"},null,-1),j={class:"grid grid-cols-1 gap-2"},D={class:"mb-4"},F={class:"text-xl"},Q={class:"font-bold"},W=t("p",{class:"text-sm text-gray-400"}," Look who forgot their password ",-1),z={key:3,class:"border-t border-1 mt-3 w-full"},G={key:4,class:"flex flex-col gap-2 my-1"},H=t("h2",null,"Remember it?",-1),ee={__name:"ResetView",setup(d){const o=C(),e=v({email:"",loading:!1,emailSent:!1,authKey:null,authValid:!1,username:null,newPassword:"",confirmPassword:""});async function m(){e.loading=!0,(await N(e.email)).status=="success"&&(e.emailSent=!0,e.loading=!1)}async function k(){e.loading=!0;const c=await O(e.authKey);c.status=="success"&&(e.authValid=!0,e.loading=!1,e.username=c.username)}async function V(){if(e.newPassword!=e.confirmPassword){alert("Passwords don't match!");return}e.loading=!0,(await q(e.authKey,e.newPassword,e.confirmPassword)).status=="success"&&(alert("Password changed!"),o.push("/auth/login"))}return(c,a)=>(n(),h(U,null,{default:u(()=>[t("div",B,[s(I,{class:"w-full md:w-auto rounded-none md:rounded-xl md:drop-shadow-xl","has-table":"","is-auth":""},{default:u(()=>[t("div",T,[L,M,t("div",j,[e.emailSent?r("",!0):(n(),f("form",{key:0,onSubmit:a[1]||(a[1]=x(l=>m(),["prevent"]))},[s(w,{label:"Email Address"},{default:u(()=>[s(y,{modelValue:e.email,"onUpdate:modelValue":a[0]||(a[0]=l=>e.email=l),icon:i(A),type:"email",autocomplete:"email",required:""},null,8,["modelValue","icon"])]),_:1}),s(p,{label:"Check",type:"submit",color:"info"}),e.loading?(n(),h(_,{key:0,path:i(g),color:"text-yellow-500",class:"animate animate-spin"},null,8,["path"])):r("",!0)],32)),e.emailSent&&!e.authValid?(n(),f("form",{key:1,onSubmit:a[3]||(a[3]=x(l=>k(),["prevent"]))},[s(w,{label:"Auth Key"},{default:u(()=>[s(y,{modelValue:e.authKey,"onUpdate:modelValue":a[2]||(a[2]=l=>e.authKey=l),icon:i(K),type:"text",name:"token",inputmode:"numeric",pattern:"[0-9]*",autocomplete:"one-time-code",maxlength:6},null,8,["modelValue","icon"])]),_:1}),s(p,{label:"Unlock",type:"submit",color:"info"}),e.loading?(n(),h(_,{key:0,path:i(g),color:"text-yellow-500",class:"animate animate-spin"},null,8,["path"])):r("",!0)],32)):r("",!0),e.emailSent&&e.authValid?(n(),f("form",{key:2,onSubmit:a[6]||(a[6]=x(l=>V(),["prevent"]))},[t("div",D,[t("h1",F,[$(" Welcome, "),t("span",Q,E(e.username),1)]),W]),s(w,{label:"New Password"},{default:u(()=>[s(y,{modelValue:e.newPassword,"onUpdate:modelValue":a[4]||(a[4]=l=>e.newPassword=l),icon:i(P),type:"password",required:"",minlength:"8"},null,8,["modelValue","icon"])]),_:1}),s(w,{label:"Confirm Password"},{default:u(()=>[s(y,{modelValue:e.confirmPassword,"onUpdate:modelValue":a[5]||(a[5]=l=>e.confirmPassword=l),icon:i(P),type:"password",required:"",minlength:"8"},null,8,["modelValue","icon"])]),_:1}),s(p,{label:"Reset Password",type:"submit",color:"success"}),e.loading?(n(),h(_,{key:0,path:i(g),color:"text-yellow-500",class:"animate animate-spin"},null,8,["path"])):r("",!0)],32)):r("",!0),e.authValid?r("",!0):(n(),f("hr",z)),e.authValid?r("",!0):(n(),f("div",G,[H,s(p,{label:"Log In",color:"success",href:"/#/auth/login"})]))])])]),_:1})])]),_:1}))}};export{ee as default};
