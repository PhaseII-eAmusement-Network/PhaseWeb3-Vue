import{W as D,X as v,Y as m,d,a as i,Z as I,e as V,p as s,$ as N,l as L,m as E,a8 as F,r as P,o as R,s as j,j as G,c as k,w as _,g as o,_ as O,b as u,f as $,n as M,t as A,F as y,h as Z,O as z,a2 as H,aj as J,D as U,ap as W,k as X}from"./index-B8PF5fsn.js";import{_ as q}from"./GeneralTable-BHrFQQ9_.js";import{_ as Y}from"./FormControl-BtNKEqsc.js";import{_ as K}from"./GameHeader-BFbHBmgM.js";import{b as Q}from"./music-qXM57SCO.js";import"./contentExport-DZW8_llL.js";import"./PhGear.vue-CAIbbLcP.js";import"./PhHouse.vue-CmhfH9kZ.js";const aa=["width","height","fill","transform"],ea={key:0},ta=s("path",{d:"M211.45,52.51l-80-24A12,12,0,0,0,116,40V140.22A52,52,0,1,0,140,184V104.13l64.55,19.36A12,12,0,0,0,220,112V64A12,12,0,0,0,211.45,52.51ZM88,212a28,28,0,1,1,28-28A28,28,0,0,1,88,212ZM196,95.87l-56-16.8V56.13l56,16.8Z"},null,-1),la=[ta],sa={key:1},ra=s("path",{d:"M128,184a40,40,0,1,1-40-40A40,40,0,0,1,128,184Z",opacity:"0.2"},null,-1),oa=s("path",{d:"M210.3,56.34l-80-24A8,8,0,0,0,120,40V148.26A48,48,0,1,0,136,184V98.75l69.7,20.91A8,8,0,0,0,216,112V64A8,8,0,0,0,210.3,56.34ZM88,216a32,32,0,1,1,32-32A32,32,0,0,1,88,216ZM200,101.25l-64-19.2V50.75L200,70Z"},null,-1),ia=[ra,oa],da={key:2},na=s("path",{d:"M210.3,56.34l-80-24A8,8,0,0,0,120,40V148.26A48,48,0,1,0,136,184V98.75l69.7,20.91A8,8,0,0,0,216,112V64A8,8,0,0,0,210.3,56.34Z"},null,-1),ca=[na],ua={key:3},ma=s("path",{d:"M209.72,58.25l-80-24A6,6,0,0,0,122,40V153.05A46,46,0,1,0,134,184V96.06l72.28,21.69A6,6,0,0,0,214,112V64A6,6,0,0,0,209.72,58.25ZM88,218a34,34,0,1,1,34-34A34,34,0,0,1,88,218ZM202,103.94l-68-20.4V48.06l68,20.4Z"},null,-1),fa=[ma],pa={key:4},ha=s("path",{d:"M210.3,56.34l-80-24A8,8,0,0,0,120,40V148.26A48,48,0,1,0,136,184V98.75l69.7,20.91A8,8,0,0,0,216,112V64A8,8,0,0,0,210.3,56.34ZM88,216a32,32,0,1,1,32-32A32,32,0,0,1,88,216ZM200,101.25l-64-19.2V50.75L200,70Z"},null,-1),_a=[ha],ga={key:5},ba=s("path",{d:"M209.15,60.17l-80-24A4,4,0,0,0,124,40V158.75A44,44,0,1,0,132,184V93.38l74.85,22.45A4,4,0,0,0,212,112V64A4,4,0,0,0,209.15,60.17ZM88,220a36,36,0,1,1,36-36A36,36,0,0,1,88,220ZM204,106.62,132,85V45.38L204,67Z"},null,-1),va=[ba],ka={name:"PhMusicNote"},Aa=D({...ka,props:{weight:{type:String},size:{type:[String,Number]},color:{type:String},mirrored:{type:Boolean}},setup(T){const c=T,g=v("weight","regular"),f=v("size","1em"),w=v("color","currentColor"),e=v("mirrored",!1),t=m(()=>c.weight??g),p=m(()=>c.size??f),x=m(()=>c.color??w),h=m(()=>c.mirrored!==void 0?c.mirrored?"scale(-1, 1)":void 0:e?"scale(-1, 1)":void 0);return(b,S)=>(i(),d("svg",N({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 256 256",width:p.value,height:p.value,fill:x.value,transform:h.value},b.$attrs),[I(b.$slots,"default"),t.value==="bold"?(i(),d("g",ea,la)):t.value==="duotone"?(i(),d("g",sa,ia)):t.value==="fill"?(i(),d("g",da,ca)):t.value==="light"?(i(),d("g",ua,fa)):t.value==="regular"?(i(),d("g",pa,_a)):t.value==="thin"?(i(),d("g",ga,va)):V("",!0)],16,aa))}}),ya={class:"grid gap-4 bg-slate-900/90 card-content"},Va={class:"text-3xl font-bold"},wa={class:"text-2xl"},xa={class:"text-xl font-light italic"},$a={class:"grid grid-cols-3 sm:flex gap-2"},Ta={class:"grid grid-cols-2 lg:grid-cols-5 gap-4 mb-6"},Sa={class:"flex place-content-between mb-2"},Ma={class:"md:w-1/3 md:text-right"},Za={class:"bg-white dark:bg-slate-900/95 rounded-2xl lg:flex lg:justify-between"},Ca={class:"w-full"},Ra={__name:"SongView",setup(T){const c=L(),g=E();var f=c.params.game,w=c.params.songId;const e=F(f);var t=P({});e||g.push({name:"ErrorPage",params:{catchAll:"404"}}),R(async()=>{try{const r=await Q(f,w);t.value=r}catch(r){console.error("Failed to fetch score data:",r)}});const p=[{text:"Player",value:"username",width:120,sortable:!0},{text:"Timestamp",value:"timestamp",width:140,sortable:!0},{text:"Grade",value:"data.rank",width:80,sortable:!0},{text:"Score",value:"points",width:120,sortable:!0}];if(e.scoreHeaders)for(var x of e.scoreHeaders)p.push(x);const h=j({currentChart:0}),b=m(()=>t.value.charts?t.value.charts.filter(r=>r.data?.difficulty!==0&&r.data?.difficulty!=null&&e.chartTable[r.chart]).map((r,n)=>{const l=`${e.chartTable[r.chart]} - ${r.data?.difficulty/(e.difficultyDenom??1)}`;return{id:r.chart,label:l}}):[]),S=m(()=>{if(!t.value.charts||t.value.charts.length===0)return[];const r=JSON.parse(JSON.stringify(t.value.charts[h.currentChart]));return C(r?.records??[])});function C(r){var n=[];for(var l of r){const a={...l};a.timestamp&&(a.timestamp=G(a.timestamp)),a.points!=null&&(a.points=a.points.toString().replace(new RegExp("\\B(?<!\\.\\d*)(?=(\\d{3})+(?!\\d))","g"),",")),a.data?.stats?.score!=null&&(a.exscore=a.points.toString(),a.points=a.data?.stats?.score.toString().replace(new RegExp("\\B(?<!\\.\\d*)(?=(\\d{3})+(?!\\d))","g"),",")),a.song?.chart!=null&&e.chartTable&&(a.song.chart=e.chartTable[a.song?.chart]),a.data?.halo!=null&&e.haloTable&&(a.data.halo=e.haloTable[a.data?.halo]),a.data?.medal!=null&&e.medalTable&&(a.data.medal=e.medalTable[a.data?.medal]),a.data?.clear_status!=null&&e.medalTable&&(a.data.medal=e.medalTable[a.data?.clear_status]),a.data?.rank!=null&&e.rankTable&&(a.data.rank=e.rankTable[a.data?.rank]),a.data?.result_rank!=null&&e.rankTable&&(a.data.rank=e.rankTable[a.data?.result_rank]),a.data?.grade!=null&&e.rankTable&&(a.data.rank=e.rankTable[a.data?.grade]),a.data?.skill_perc>0?a.data.skill_perc=`${a.data?.skill_perc/100}%`:a.data.skill_perc="0%",a.data?.skill_points&&(a.data.skill_points=a.data?.skill_points/10),a.data?.perc>0?a.data.perc=`${a.data?.perc/100}%`:a.data.perc="0%",a.data?.new_skill&&(a.data.new_skill=a.data?.new_skill/10),a.data?.music_rate&&(a.data.music_rate=a.data?.music_rate/10),a.data?.excellent?a.medal="EX FC":a.data?.fullcombo?a.medal="FC":a.data?.clear?a.medal="CLEARED":a.medal="FAILED",n.push(a)}return n}const B=r=>{const n=r.userId;g.push(`/games/${f}/profiles/${n}`)};return(r,n)=>(i(),k(X,null,{default:_(()=>[o(t)?(i(),k(O,{key:0},{default:_(()=>[u(K,{game:o(e)},null,8,["game"]),u($,{icon:o(Aa),title:"Song Overview",main:""},null,8,["icon"]),u(M,{class:"mb-6","has-table":""},{default:_(()=>[s("div",ya,[s("div",null,[s("h1",Va,A(o(t).name),1),s("h2",wa,A(o(t).artist),1),s("h2",xa,A(o(t).genre),1)]),s("div",$a,[(i(!0),d(y,null,Z(o(t).charts,l=>(i(),d(y,{key:l.db_id},[l.data?.difficulty!=0&&o(e).chartTable[l.chart]?(i(),k(z,{key:0,color:"info",label:`${o(e).chartTable[l.chart]} - ${l.data?.difficulty/(o(e).difficultyDenom??1)}`},null,8,["label"])):V("",!0)],64))),128))])])]),_:1}),u($,{icon:o(H),title:"Top Records",main:""},null,8,["icon"]),s("div",Ta,[(i(!0),d(y,null,Z(o(t).charts,l=>(i(),d(y,{key:l.db_id},[l.data?.difficulty!=0&&o(e).chartTable[l.chart]?(i(),k(J,{key:0,label:`${o(e).chartTable[l.chart]}`,"small-content":""},{default:_(()=>[U(A(l.records[0]?`${l.records[0]?.username} - ${l.records[0].points?.toLocaleString()}`:"Unclaimed"),1)]),_:2},1032,["label"])):V("",!0)],64))),128))]),s("div",Sa,[u($,{icon:o(W),title:"All Scores",main:""},null,8,["icon"]),s("div",Ma,[n[1]||(n[1]=s("h2",{class:"text-md sm:text-lg md:text-xl font-bold p-2"}," Select Chart ",-1)),u(Y,{modelValue:h.currentChart,"onUpdate:modelValue":n[0]||(n[0]=l=>h.currentChart=l),options:b.value},null,8,["modelValue","options"])])]),u(M,{"has-table":""},{default:_(()=>[s("div",Za,[s("div",Ca,[u(q,{headers:p,items:S.value,onRowClicked:B},null,8,["items"])])])]),_:1})]),_:1})):V("",!0)]),_:1}))}};export{Ra as default};
