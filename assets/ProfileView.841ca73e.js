import{b as A,a as E,s as _,r as y,M as S,c as d,e as p,w as o,f as e,V as I,W as L,g as i,y as b,j as M,_ as V,x as O,i as J,n as P,H as U,Q as v,X as $,O as h,z as f,Y as B,p as F,q as j}from"./index.da95f725.js";import{d as z}from"./account.c1a42644.js";import{_ as u}from"./FormField.5c716bff.js";import{_ as m}from"./FormControl.7e60f6ed.js";const D={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},X={__name:"ProfileView",setup(G){const n=A(),N=E(),c=_({username:JSON.parse(JSON.stringify(n.userName)),email:JSON.parse(JSON.stringify(n.userEmail)),pin:null}),l=_({username:JSON.parse(JSON.stringify(n.userName)),email:JSON.parse(JSON.stringify(n.userEmail)),pin:null}),t=_({currentPassword:"",newPassword:"",confirmPassword:""}),w=y(!1),g=y(!1);S(()=>n.userName,s=>{l.username=JSON.parse(JSON.stringify(s)),c.username=JSON.parse(JSON.stringify(s))}),S(()=>n.userEmail,s=>{l.email=JSON.parse(JSON.stringify(s)),c.email=JSON.parse(JSON.stringify(s))});async function x(){w.value=!0,(await n.putUser(l)).status=="success"&&(w.value=!1,n.userLoaded=!1,await n.loadUser(),N.go())}async function k(){g.value=!0,(await z(t.currentPassword,t.newPassword,t.confirmPassword)).status=="success"&&(alert("Password changed."),g.value=!1,await n.loadUser(),N.go())}function q(s){s.target.value=s.target.value.replace(/\D/g,"")}function C(s,a){return JSON.stringify(s)!==JSON.stringify(a)}return(s,a)=>(d(),p(j,null,{default:o(()=>[e(F,null,{default:o(()=>[e(I,{class:"mb-6","use-small":"","even-smaller":""}),e(L,{icon:i(b),title:"Profile Settings",main:""},null,8,["icon"]),M("div",D,[e(V,{"is-form":"",class:"row-span-1",onSubmit:O(x,["prevent"])},{footer:o(()=>[C(c,l)?(d(),p(J,{key:0,color:"success",type:"submit",label:"Update"})):P("",!0),w.value?(d(),p(U,{key:1,path:i(v),color:"text-yellow-500",class:"animate animate-spin"},null,8,["path"])):P("",!0)]),default:o(()=>[e($,{color:"info",label:"General",class:"mb-2"}),e(u,{label:"Username"},{default:o(()=>[e(m,{modelValue:l.username,"onUpdate:modelValue":a[0]||(a[0]=r=>l.username=r),icon:i(b),name:"username",required:"",autocomplete:"username"},null,8,["modelValue","icon"])]),_:1}),e(u,{label:"E-mail",help:"Used for password resetting and 2FA"},{default:o(()=>[e(m,{modelValue:l.email,"onUpdate:modelValue":a[1]||(a[1]=r=>l.email=r),icon:i(h),type:"email",name:"email",required:"",autocomplete:"email"},null,8,["modelValue","icon"])]),_:1}),e(u,{label:"PIN",help:"Used when logging into a game"},{default:o(()=>[e(m,{modelValue:l.pin,"onUpdate:modelValue":a[2]||(a[2]=r=>l.pin=r),icon:i(f),type:"password",name:"pin",minlength:4,maxlength:4,inputmode:"numeric",pattern:"\\d{4}",autocomplete:"pin",onInput:q},null,8,["modelValue","icon"])]),_:1})]),_:1}),e(V,{"is-form":"",class:"row-span-2",onSubmit:a[6]||(a[6]=O(r=>k(),["prevent"]))},{footer:o(()=>[e(J,{type:"submit",color:"success",label:"Update"}),g.value?(d(),p(U,{key:0,path:i(v),color:"text-yellow-500",class:"animate animate-spin"},null,8,["path"])):P("",!0)]),default:o(()=>[e($,{color:"info",label:"Change Password",class:"mb-2"}),e(u,{label:"Current Password"},{default:o(()=>[e(m,{modelValue:t.currentPassword,"onUpdate:modelValue":a[3]||(a[3]=r=>t.currentPassword=r),icon:i(f),name:"currentPassword",type:"password",required:""},null,8,["modelValue","icon"])]),_:1}),e(B),e(u,{label:"New Password"},{default:o(()=>[e(m,{modelValue:t.newPassword,"onUpdate:modelValue":a[4]||(a[4]=r=>t.newPassword=r),icon:i(f),name:"newPassword",type:"password",required:""},null,8,["modelValue","icon"])]),_:1}),e(u,{label:"Confirm Password"},{default:o(()=>[e(m,{modelValue:t.confirmPassword,"onUpdate:modelValue":a[5]||(a[5]=r=>t.confirmPassword=r),icon:i(f),name:"confirmPassword",type:"password",required:""},null,8,["modelValue","icon"])]),_:1})]),_:1})])]),_:1})]),_:1}))}};export{X as default};
