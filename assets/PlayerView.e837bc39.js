import{u as q,r as X,o as H,a as l,i as y,j as L,c as u,w as m,g as r,b as d,X as O,k as n,t as _,_ as B,F as h,as as re,s as se,N as ne,l as ie,e as s,m as oe,f as M,aC as ue,W as J,aw as ce,ax as de,ar as me,ac as f,z as _e,U as x,aD as pe,aE as be,aF as fe,n as ye,p as ve,q as ge}from"./index.7738aec6.js";import{_ as he,g as U,a as T}from"./ProfileCard.6c58f1a5.js";import{_ as ke}from"./FormControl.32d4ada5.js";import{a as we}from"./profile.7618aa04.js";import{g as R}from"./danClass.233b0381.js";import"./userData.bcc92478.js";const xe={class:"flex space-x-2 mb-2"},Se={class:"flex justify-between items-center"},Ve={class:"grid"},$e={class:"text-lg font-bold"},De={class:"text-md"},je={class:"text-lg"},Pe={class:"text-lg"},z={__name:"JubilityTable",props:{jubilityData:{type:Array,required:!0},version:{type:Number,required:!0}},setup(N){const v=N,G=q(),p=X(null),c={0:{label:"Basic",color:"info"},1:{label:"Advanced",color:"warning"},2:{label:"Extreme",color:"danger"}};return H(async()=>{try{p.value=null;const k=v.jubilityData.map(g=>g.song_id),o=await G.getMusicData("jubeat",v.version,k),e=v.jubilityData.map(g=>{const S=o.find(C=>C.id===g.song_id&&C.chart===g.chart);return{...g,...S?{songData:S}:{}}});e.sort((g,S)=>S.rate-g.rate),p.value=e}catch(k){console.error("Failed to fetch music data:",k)}}),(k,o)=>p.value?(l(!0),y(h,{key:0},L(p.value,e=>(l(),u(B,{key:e.id,"color-prop":"bg-slate-800 dark:bg-slate-800",class:"my-3 p-5","has-table":""},{default:m(()=>[r("div",xe,[d(O,{label:c[e.chart].label,color:c[e.chart].color},null,8,["label","color"]),e.hard?(l(),u(O,{key:0,label:"Hard Mode",color:"danger"})):n("",!0)]),r("div",Se,[r("div",Ve,[r("h1",$e,_(e.songData.name),1),r("h2",De,_(e.songData.artist),1)]),r("div",null,[r("h2",je,"Jubility: "+_(e.value/10),1),r("h2",Pe,"Rate: "+_(e.rate/10),1)])])]),_:2},1024))),128)):n("",!0)}},Ne=q();async function Ce(N){try{return(await Ne.callApi(`/arcade/${N}`)).arcade}catch(v){throw console.log("Error fetching arcade:",v),v}}const Ae={class:"md:flex pb-6 md:justify-between md:items-center"},Ie={key:0,class:"mt-2 md:mt-0 md:w-1/3 md:text-right"},Fe=r("h2",{class:"text-md sm:text-lg md:text-xl font-bold p-2"}," Select Version ",-1),Je=["src"],Te={class:"bg-white dark:bg-slate-900/90 rounded-2xl pt-6 p-3 card-content"},Le={class:"w-full"},Be={class:"md:w-1/3 grid grid-cols-1 md:grid-cols-2 gap-3"},Oe={class:"my-6 grid grid-cols-1 md:grid-cols-4 gap-6"},Ge={class:"my-6 grid grid-cols-2 md:grid-cols-5 xl:grid-cols-6 gap-6"},Ee={class:"my-6 grid grid-cols-1 md:grid-cols-2 gap-6"},Me={class:"my-6"},Re={class:"border-s border-neutral-300 md:flex md:justify-start md:gap-10 md:border-s-0 md:border-t md:overflow-x-auto overflow-y-visible md:whitespace-nowrap scrollbar"},Ue={class:"flex-start flex items-center pt-2 md:block md:pt-4"},ze=r("div",{class:"-ms-[6px] me-3 h-[12px] w-[12px] md:w-0.5 md:h-4 rounded-full md:rounded-none bg-gray-300 md:-mt-6 md:me-0 md:ms-0"},null,-1),qe={class:"mt-2 text-sm font-light"},Xe={class:"ms-4 pb-6 md:ms-0"},He={class:"text-lg font-semibold"},aa={__name:"PlayerView",setup(N){const v=ve(),G=ge();var p=null,c=null,k=null;p=v.params.game,k=v.params.userId,c=re(p),c||G.push({name:"ErrorPage",params:{catchAll:"404"}});const o=se({currentVersion:null});ne(()=>o.currentVersion,()=>{g()});const e=X(null);H(async()=>{g()}),c.versions||(o.currentVersion=1);async function g(){try{e.value=null;var t=await we(p,o.currentVersion,k);t.timeline=await le(t),e.value=ae(t),t&&!o.currentVersion&&(o.currentVersion=t.versions[t.versions.length-1])}catch(a){console.error("Failed to fetch user profile data:",a)}}async function S(t){try{const a=await Ce(t);return console.log(a),a}catch(a){console.error("Failed to fetch arcade data:",a)}}var C=[{label:"Register Date",type:String,span:"md:col-span-2",key:"first_play_timestamp"},{label:"Last Play",type:String,span:"md:col-span-2",key:"last_play_timestamp"},{label:"First Arcade",type:String,span:"md:col-span-2",key:"first_play_arcade"},{label:"Last Arcade",type:String,span:"md:col-span-2",key:"last_play_arcade"},{label:"Total Plays",type:Number,key:"total_plays"},{label:"EXP",type:Number,key:"exp"},{label:"SP Plays",type:Number,key:"single_plays"},{label:"DP Plays",type:Number,key:"double_plays"},{label:"SP DJPOINT",type:Number,key:"single_dj_points"},{label:"DP DJPOINT",type:Number,key:"double_dj_points"}];function W(){return o.currentVersion?`/assets/games/${c.id}/card/${o.currentVersion}.webp`:c.cardBG}function K(){var t;return o.currentVersion&&((t=c.videoTable)==null?void 0:t.includes(o.currentVersion))?`https://web3.phaseii.network/gameassets/video/${c.id}/${o.currentVersion}.mp4`:null}function Q(){var t;return(t=c.videoTable)!=null&&t.includes(o.currentVersion)?null:`
      background-image: url('${W()}');
      background-size: cover;
      background-repeat: no-repeat;
    `}function Y(t,a){if(a){if(t.isSkill&&a.jubility)return U(a.jubility);if(t.isJubility&&a.records.skill)return T(a.records.skill)}return""}function Z(t){var a=[];for(const b of c.versions)t.includes(b.id)&&a.push(b);return a}function ee(t,a){return t.isSkill?a.stats[t.key]/100:t.isJubility?a.stats[t.key]/10:a.stats[t.key]}function ae(t){if(t.stats){if(t.stats.first_play_timestamp){const a=new Date(t.stats.first_play_timestamp*1e3);t.stats.first_play_timestamp=a.toLocaleString()}if(t.stats.last_play_timestamp){const a=new Date(t.stats.last_play_timestamp*1e3);t.stats.last_play_timestamp=a.toLocaleString()}t.dp&&t.dp.dan!==void 0&&(t.dp.dan=R(t.dp.dan).short)}return t}function te(t){var b;const a=(b=t.stats)==null?void 0:b.count;return a?[a.mfc!=null?{label:"MFCs",value:a.mfc}:0,a.pfc!=null?{label:"PFCs",value:a.pfc}:0,a.fc!=null?{label:"GFCs",value:a.fc}:0,a.gfc!=null?{label:"FCs",value:a.gfc}:0,a.life4!=null?{label:"Life-4 Clears",value:a.life4}:0]:[]}async function le(t){const a=t==null?void 0:t.stats,b=a==null?void 0:a.first_play_timestamp,V=a==null?void 0:a.last_play_timestamp,j=a==null?void 0:a.arcade_history,w=[];if(b&&w.push({timestamp:new Date(b*1e3).toLocaleString(),arcade:a==null?void 0:a.first_play_arcade,first_play:!0}),j)for(const[$,D]of Object.entries(j)){const A=await S($);for(const[I,F]of Object.entries(D))for(const P of F){const i=new Date(P*1e3);[b,V].includes(P)||w.push({timestamp:i.toLocaleString(),arcade:A.name,machineId:I,first_play:!1})}}return V&&w.push({timestamp:new Date(V*1e3).toLocaleString(),arcade:a==null?void 0:a.last_play_arcade,first_play:!1}),w.sort(($,D)=>$.timestamp-D.timestamp)}return(t,a)=>(l(),u(ye,null,{default:m(()=>[e.value?(l(),u(ie,{key:0},{default:m(()=>{var b,V,j,w,$,D,A,I,F,P;return[r("div",Ae,[d(M,{icon:s(oe),href:`/#/games/${s(p)}`,class:"w-full md:w-auto",color:"info",label:`${s(c).shortName?s(c).shortName:s(c).name} Home`},null,8,["icon","href","label"]),s(c).versions&&e.value?(l(),y("div",Ie,[Fe,d(ke,{modelValue:o.currentVersion,"onUpdate:modelValue":a[0]||(a[0]=i=>o.currentVersion=i),options:Z(e.value.versions)},null,8,["modelValue","options"])])):n("",!0)]),d(J,{icon:s(ue),title:"View Profile",main:""},null,8,["icon"]),o.currentVersion&&e.value?(l(),y("div",{key:0,style:me(Q()),class:"rounded-2xl mb-6 card-container"},[r("video",{autoplay:"",muted:"",loop:"",playsinline:"",src:K(),class:"background-video"},null,8,Je),r("div",Te,[r("div",Le,[d(he,{"use-small":"",game:s(p),version:o.currentVersion,profile:e.value},{default:m(()=>[r("div",Be,[d(M,{href:`/#/games/${s(p)}/scores/${e.value.userId}`,icon:s(ce),class:"w-full md:w-auto",color:"info",label:"View Scores"},null,8,["href","icon"]),d(M,{href:`/#/games/${s(p)}/records/${e.value.userId}`,icon:s(de),class:"w-full md:w-auto",color:"info",label:"View Records"},null,8,["href","icon"])])]),_:1},8,["game","version","profile"])])])],4)):n("",!0),r("div",Oe,[(l(!0),y(h,null,L(s(C),i=>(l(),y(h,{key:i},[e.value.stats[i.key]?(l(),u(f,{key:0,class:_e(i.span),label:i.label,number:i.type==Number?ee(i,e.value):null,"num-color":Y(i)},{default:m(()=>[x(_(i.type==String?e.value.stats[i.key]:null)+" ",1)]),_:2},1032,["class","label","number","num-color"])):n("",!0)],64))),128)),(V=(b=e.value.stats)==null?void 0:b.count)!=null&&V.records?(l(),u(f,{key:0,label:"Records",number:(w=(j=e.value.stats)==null?void 0:j.count)==null?void 0:w.records},null,8,["number"])):n("",!0),(D=($=e.value.stats)==null?void 0:$.count)!=null&&D.attempts?(l(),u(f,{key:1,label:"Attempts",number:(I=(A=e.value.stats)==null?void 0:A.count)==null?void 0:I.attempts},null,8,["number"])):n("",!0),e.value.skill?(l(),u(f,{key:2,label:"Skill Points",number:e.value.skill/100,"num-color":s(U)(e.value.skill)},null,8,["number","num-color"])):n("",!0),e.value.profile_skill?(l(),u(f,{key:3,label:"Skill Level"},{default:m(()=>[x(_(e.value.profile_skill/100),1)]),_:1})):n("",!0),e.value.jubility?(l(),u(f,{key:4,label:"Jubility","num-color":s(T)(e.value.jubility)},{default:m(()=>[x(_(e.value.jubility/10),1)]),_:1},8,["num-color"])):n("",!0),e.value.pick_up_jubility?(l(),u(f,{key:5,label:"Pick-Up Jubility","num-color":s(T)(e.value.pick_up_jubility)},{default:m(()=>[x(_(e.value.pick_up_jubility/10),1)]),_:1},8,["num-color"])):n("",!0),e.value.common_jubility?(l(),u(f,{key:6,label:"Common Jubility","num-color":s(T)(e.value.common_jubility)},{default:m(()=>[x(_(e.value.common_jubility/10),1)]),_:1},8,["num-color"])):n("",!0),e.value.deller?(l(),u(f,{key:7,label:"Deller",number:e.value.deller},null,8,["number"])):n("",!0),e.value.sgrade?(l(),u(f,{key:8,label:"SP DAN"},{default:m(()=>[x(_(s(R)(e.value.sgrade).label),1)]),_:1})):n("",!0),e.value.dgrade?(l(),u(f,{key:9,label:"DP DAN"},{default:m(()=>[x(_(s(R)(e.value.dgrade).label),1)]),_:1})):n("",!0)]),(F=e.value.stats)!=null&&F.count?(l(),y(h,{key:1},[d(J,{icon:s(pe),title:"Stats",main:""},null,8,["icon"]),r("div",Ge,[(l(!0),y(h,null,L(te(e.value),i=>(l(),y(h,{key:i},[i.value?(l(),u(f,{key:0,label:i.label,number:i.value},null,8,["label","number"])):n("",!0)],64))),128))])],64)):n("",!0),e.value.jubility?(l(),y(h,{key:2},[d(J,{icon:s(be),title:"Jubility Breakdown",main:""},null,8,["icon"]),r("div",Ee,[e.value.pick_up_breakdown?(l(),u(B,{key:0},{default:m(()=>[d(O,{label:"Pick-Up",color:"info"}),d(z,{"jubility-data":e.value.pick_up_breakdown,",":"",version:o.currentVersion},null,8,["jubility-data","version"])]),_:1})):n("",!0),e.value.other_breakdown?(l(),u(B,{key:1},{default:m(()=>[d(O,{label:"Common",color:"info"}),d(z,{"jubility-data":e.value.other_breakdown,",":"",version:o.currentVersion},null,8,["jubility-data","version"])]),_:1})):n("",!0)])],64)):n("",!0),(P=e.value)!=null&&P.timeline?(l(),y(h,{key:3},[d(J,{icon:s(fe),title:"Timeline",main:""},null,8,["icon"]),r("div",Me,[d(B,null,{default:m(()=>{var i;return[r("ol",Re,[(l(!0),y(h,null,L(JSON.parse(JSON.stringify((i=e.value)==null?void 0:i.timeline)).reverse(),E=>(l(),y("li",{key:E.timestamp,class:"md:inline-block flex-shrink-0"},[r("div",Ue,[ze,r("p",qe,_(E.timestamp),1)]),r("div",Xe,[r("h4",He,_(E.arcade),1)])]))),128))])]}),_:1})])],64)):n("",!0)]}),_:1})):n("",!0)]),_:1}))}};export{aa as default};
