import{a as P,p as k,c as u,d as o,w as r,i as t,e as a,h as v,s as S,j as m,f as n,v as w,g as i,E as K,l as c,B as y,C as h,G as $,H as A,t as C,y as x,I,J as E,K as R}from"./index-DxCfvdTP.js";import{_ as f}from"./FormField-6QLSYEs8.js";import{_ as p}from"./FormControl-Duix1c6v.js";import{_ as B}from"./LayoutGuest-DLfWk-7P.js";const N={class:"flex md:min-h-screen md:items-center md:justify-center"},U={class:"p-4 flex flex-col md:flex-row w-full space-y-2 md:space-y-0 md:space-x-4"},q={class:"grid grid-cols-1 gap-2"},L={class:"mb-4"},j={class:"text-xl"},O={class:"font-bold"},D={key:3,class:"border-t border-1 mt-3 w-full"},G={key:4,class:"flex flex-col gap-2 my-1"},z={__name:"ResetView",setup(H){const g=P(),e=k({email:"",loading:!1,emailSent:!1,authKey:null,authValid:!1,username:null,newPassword:"",confirmPassword:""});async function b(){e.loading=!0,(await I(e.email)).status=="success"&&(e.emailSent=!0,e.loading=!1)}async function V(){e.loading=!0;const d=await E(e.authKey);d.status=="success"&&(e.authValid=!0,e.loading=!1,e.username=d.username)}async function _(){if(e.newPassword!=e.confirmPassword){alert("Passwords don't match!");return}e.loading=!0,(await R(e.authKey,e.newPassword,e.confirmPassword)).status=="success"&&(alert("Password changed!"),g.push("/auth/login"))}return(d,s)=>(o(),u(B,null,{default:r(()=>[t("div",N,[a(v,{class:"w-full md:w-auto rounded-none md:rounded-xl md:drop-shadow-xl","has-table":"","is-auth":""},{default:r(()=>[t("div",U,[s[10]||(s[10]=t("div",{class:"flex flex-col items-center text-wrap h-full md:mt-5"},[t("img",{src:S,class:"rounded-full shadow-lg mb-2"}),t("h1",{class:"text-xl"},[t("samp",null,"PhaseII")]),t("p",{class:"text-sm text-gray-700 dark:text-white/75"}," Spinnin' since 2021 "),t("hr",{class:"border-t border-1 my-1 w-full"}),t("p",{class:"text-lg relative bottom-0"},"Password Reset")],-1)),s[11]||(s[11]=t("div",{class:"md:border-r md:border-1"},null,-1)),t("div",q,[e.emailSent?n("",!0):(o(),m("form",{key:0,onSubmit:s[1]||(s[1]=w(l=>b(),["prevent"]))},[a(f,{label:"Email Address"},{default:r(()=>[a(p,{modelValue:e.email,"onUpdate:modelValue":s[0]||(s[0]=l=>e.email=l),icon:i(K),type:"email",autocomplete:"email",required:""},null,8,["modelValue","icon"])]),_:1}),a(c,{label:"Check",type:"submit",color:"info"}),e.loading?(o(),u(y,{key:0,path:i(h),color:"text-yellow-500",class:"animate animate-spin"},null,8,["path"])):n("",!0)],32)),e.emailSent&&!e.authValid?(o(),m("form",{key:1,onSubmit:s[3]||(s[3]=w(l=>V(),["prevent"]))},[a(f,{label:"Auth Key"},{default:r(()=>[a(p,{modelValue:e.authKey,"onUpdate:modelValue":s[2]||(s[2]=l=>e.authKey=l),icon:i($),type:"text",name:"token",inputmode:"numeric",pattern:"[0-9]*",autocomplete:"one-time-code",maxlength:6},null,8,["modelValue","icon"])]),_:1}),a(c,{label:"Unlock",type:"submit",color:"info"}),e.loading?(o(),u(y,{key:0,path:i(h),color:"text-yellow-500",class:"animate animate-spin"},null,8,["path"])):n("",!0)],32)):n("",!0),e.emailSent&&e.authValid?(o(),m("form",{key:2,onSubmit:s[6]||(s[6]=w(l=>_(),["prevent"]))},[t("div",L,[t("h1",j,[s[7]||(s[7]=A(" Welcome, ")),t("span",O,C(e.username),1)]),s[8]||(s[8]=t("p",{class:"text-sm text-gray-400"}," Look who forgot their password ",-1))]),a(f,{label:"New Password"},{default:r(()=>[a(p,{modelValue:e.newPassword,"onUpdate:modelValue":s[4]||(s[4]=l=>e.newPassword=l),icon:i(x),type:"password",required:"",minlength:"8"},null,8,["modelValue","icon"])]),_:1}),a(f,{label:"Confirm Password"},{default:r(()=>[a(p,{modelValue:e.confirmPassword,"onUpdate:modelValue":s[5]||(s[5]=l=>e.confirmPassword=l),icon:i(x),type:"password",required:"",minlength:"8"},null,8,["modelValue","icon"])]),_:1}),a(c,{label:"Reset Password",type:"submit",color:"success"}),e.loading?(o(),u(y,{key:0,path:i(h),color:"text-yellow-500",class:"animate animate-spin"},null,8,["path"])):n("",!0)],32)):n("",!0),e.authValid?n("",!0):(o(),m("hr",D)),e.authValid?n("",!0):(o(),m("div",G,[s[9]||(s[9]=t("h2",null,"Remember it?",-1)),a(c,{label:"Log In",color:"success",href:"/#/auth/login"})]))])])]),_:1})])]),_:1}))}};export{z as default};
