import{u as U,r as E,o as q,a as r,i as p,j as C,c as o,w as d,g as u,b as m,R as x,k as n,t as b,_ as F,F as k,al as le,s as ae,O as te,l as re,e as s,m as se,f as P,ax as ne,Q as j,ar as ie,as as oe,ak as ue,a6 as _,z as ce,Y as g,ay as de,az as me,n as _e,p as be,q as ye}from"./index.9f7c925e.js";import{_ as pe,g as G,a as S}from"./ProfileCard.24bd0d43.js";import{_ as fe}from"./FormControl.cd7b00b0.js";import{g as N}from"./danClass.233b0381.js";import"./userData.bcc92478.js";const ve={class:"flex space-x-2 mb-2"},ge={class:"flex justify-between items-center"},ke={class:"grid"},he={class:"text-lg font-bold"},Ve={class:"text-md"},we={class:"text-lg"},$e={class:"text-lg"},O={__name:"JubilityTable",props:{jubilityData:{type:Array,required:!0},version:{type:Number,required:!0}},setup(J){const h=J,D=U(),V=E(null),y={0:{label:"Basic",color:"info"},1:{label:"Advanced",color:"warning"},2:{label:"Extreme",color:"danger"}};return q(async()=>{try{V.value=null;const i=h.jubilityData.map(e=>e.song_id),w=await D.getMusicData("jubeat",h.version,i),t=h.jubilityData.map(e=>{const v=w.find($=>$.id===e.song_id&&$.chart===e.chart);return{...e,...v?{songData:v}:{}}});t.sort((e,v)=>v.rate-e.rate),V.value=t}catch(i){console.error("Failed to fetch music data:",i)}}),(i,w)=>V.value?(r(!0),p(k,{key:0},C(V.value,t=>(r(),o(F,{key:t.id,"color-prop":"bg-slate-800 dark:bg-slate-800",class:"my-3 p-5","has-table":""},{default:d(()=>[u("div",ve,[m(x,{label:y[t.chart].label,color:y[t.chart].color},null,8,["label","color"]),t.hard?(r(),o(x,{key:0,label:"Hard Mode",color:"danger"})):n("",!0)]),u("div",ge,[u("div",ke,[u("h1",he,b(t.songData.name),1),u("h2",Ve,b(t.songData.artist),1)]),u("div",null,[u("h2",we,"Jubility: "+b(t.value/10),1),u("h2",$e,"Rate: "+b(t.rate/10),1)])])]),_:2},1024))),128)):n("",!0)}},Se={class:"md:flex pb-6 md:justify-between md:items-center"},xe={key:0,class:"mt-2 md:mt-0 md:w-1/3 md:text-right"},De=u("h2",{class:"text-md sm:text-lg md:text-xl font-bold p-2"}," Select Version ",-1),Pe=["src"],je={class:"bg-white dark:bg-slate-900/90 rounded-2xl pt-6 p-3 card-content"},Ne={class:"w-full"},Ce={class:"md:w-1/3 grid grid-cols-1 md:grid-cols-2 gap-3"},Fe={class:"my-6 grid grid-cols-1 md:grid-cols-4 gap-6"},Je={class:"my-6 grid grid-cols-2 md:grid-cols-5 xl:grid-cols-6 gap-6"},Ae={class:"my-6 grid grid-cols-1 md:grid-cols-2 gap-6"},Me={__name:"PlayerView",setup(J){const h=be(),D=ye(),V=U();var y=null,i=null,w=null;y=h.params.game,w=h.params.userId,i=le(y),i||D.push({name:"ErrorPage",params:{catchAll:"404"}});const t=ae({currentVersion:null});te(()=>t.currentVersion,()=>{v()});const e=E(null);q(async()=>{v()}),i.versions||(t.currentVersion=1);async function v(){try{e.value=null;const l=await V.getUserProfile(y,t.currentVersion,w);e.value=Z(l),l&&!t.currentVersion&&(t.currentVersion=l.versions[l.versions.length-1])}catch(l){console.error("Failed to fetch user profile data:",l)}}var $=[{label:"Register Date",type:String,span:"md:col-span-2",key:"first_play_timestamp"},{label:"Last Play",type:String,span:"md:col-span-2",key:"last_play_timestamp"},{label:"First Arcade",type:String,span:"md:col-span-2",key:"first_play_arcade"},{label:"Last Arcade",type:String,span:"md:col-span-2",key:"last_play_arcade"},{label:"Total Plays",type:Number,key:"total_plays"},{label:"EXP",type:Number,key:"exp"},{label:"SP Plays",type:Number,key:"single_plays"},{label:"DP Plays",type:Number,key:"double_plays"},{label:"SP DJPOINT",type:Number,key:"single_dj_points"},{label:"DP DJPOINT",type:Number,key:"double_dj_points"}];function H(){return t.currentVersion?`/assets/games/${i.id}/card/${t.currentVersion}.webp`:i.cardBG}function X(){var l;return t.currentVersion&&((l=i.videoTable)==null?void 0:l.includes(t.currentVersion))?`https://web3.phaseii.network/gameassets/video/${i.id}/${t.currentVersion}.mp4`:null}function Q(){var l;return(l=i.videoTable)!=null&&l.includes(t.currentVersion)?null:`
      background-image: url('${H()}');
      background-size: cover;
      background-repeat: no-repeat;
    `}function Y(l,a){if(a){if(l.isSkill&&a.jubility)return G(a.jubility);if(l.isJubility&&a.records.skill)return S(a.records.skill)}return""}function K(l){var a=[];for(const f of i.versions)l.includes(f.id)&&a.push(f);return a}function W(l,a){return l.isSkill?a.stats[l.key]/100:l.isJubility?a.stats[l.key]/10:a.stats[l.key]}function Z(l){if(l.stats){if(l.stats.first_play_timestamp){const a=new Date(l.stats.first_play_timestamp*1e3);l.stats.first_play_timestamp=a.toLocaleString()}if(l.stats.last_play_timestamp){const a=new Date(l.stats.last_play_timestamp*1e3);l.stats.last_play_timestamp=a.toLocaleString()}l.dp&&l.dp.dan!==void 0&&(l.dp.dan=N(l.dp.dan).short)}return l}function ee(l){var f;const a=(f=l.stats)==null?void 0:f.count;return a?[a.mfc!=null?{label:"MFCs",value:a.mfc}:0,a.pfc!=null?{label:"PFCs",value:a.pfc}:0,a.fc!=null?{label:"GFCs",value:a.fc}:0,a.gfc!=null?{label:"FCs",value:a.gfc}:0,a.life4!=null?{label:"Life-4 Clears",value:a.life4}:0]:[]}return(l,a)=>(r(),o(_e,null,{default:d(()=>[e.value?(r(),o(re,{key:0},{default:d(()=>{var f,A,T,B,I,L,R,M,z;return[u("div",Se,[m(P,{icon:s(se),href:`/#/games/${s(y)}`,class:"w-full md:w-auto",color:"info",label:`${s(i).shortName?s(i).shortName:s(i).name} Home`},null,8,["icon","href","label"]),s(i).versions&&e.value?(r(),p("div",xe,[De,m(fe,{modelValue:t.currentVersion,"onUpdate:modelValue":a[0]||(a[0]=c=>t.currentVersion=c),options:K(e.value.versions)},null,8,["modelValue","options"])])):n("",!0)]),m(j,{icon:s(ne),title:"View Profile",main:""},null,8,["icon"]),t.currentVersion&&e.value?(r(),p("div",{key:0,style:ue(Q()),class:"rounded-2xl mb-6 card-container"},[u("video",{autoplay:"",muted:"",loop:"",playsinline:"",src:X(),class:"background-video"},null,8,Pe),u("div",je,[u("div",Ne,[m(pe,{"use-small":"",game:s(y),version:t.currentVersion,profile:e.value},{default:d(()=>[u("div",Ce,[m(P,{href:`/#/games/${s(y)}/scores/${e.value.userId}`,icon:s(ie),class:"w-full md:w-auto",color:"info",label:"View Scores"},null,8,["href","icon"]),m(P,{href:`/#/games/${s(y)}/records/${e.value.userId}`,icon:s(oe),class:"w-full md:w-auto",color:"info",label:"View Records"},null,8,["href","icon"])])]),_:1},8,["game","version","profile"])])])],4)):n("",!0),u("div",Fe,[(r(!0),p(k,null,C(s($),c=>(r(),p(k,{key:c},[e.value.stats[c.key]?(r(),o(_,{key:0,class:ce(c.span),label:c.label,number:c.type==Number?W(c,e.value):null,"num-color":Y(c)},{default:d(()=>[g(b(c.type==String?e.value.stats[c.key]:null)+" ",1)]),_:2},1032,["class","label","number","num-color"])):n("",!0)],64))),128)),(A=(f=e.value.stats)==null?void 0:f.count)!=null&&A.records?(r(),o(_,{key:0,label:"Records",number:(B=(T=e.value.stats)==null?void 0:T.count)==null?void 0:B.records},null,8,["number"])):n("",!0),(L=(I=e.value.stats)==null?void 0:I.count)!=null&&L.attempts?(r(),o(_,{key:1,label:"Attempts",number:(M=(R=e.value.stats)==null?void 0:R.count)==null?void 0:M.attempts},null,8,["number"])):n("",!0),e.value.skill?(r(),o(_,{key:2,label:"Skill Points",number:e.value.skill/100,"num-color":s(G)(e.value.skill)},null,8,["number","num-color"])):n("",!0),e.value.profile_skill?(r(),o(_,{key:3,label:"Skill Level"},{default:d(()=>[g(b(e.value.profile_skill/100),1)]),_:1})):n("",!0),e.value.jubility?(r(),o(_,{key:4,label:"Jubility","num-color":s(S)(e.value.jubility)},{default:d(()=>[g(b(e.value.jubility/10),1)]),_:1},8,["num-color"])):n("",!0),e.value.pick_up_jubility?(r(),o(_,{key:5,label:"Pick-Up Jubility","num-color":s(S)(e.value.pick_up_jubility)},{default:d(()=>[g(b(e.value.pick_up_jubility/10),1)]),_:1},8,["num-color"])):n("",!0),e.value.common_jubility?(r(),o(_,{key:6,label:"Common Jubility","num-color":s(S)(e.value.common_jubility)},{default:d(()=>[g(b(e.value.common_jubility/10),1)]),_:1},8,["num-color"])):n("",!0),e.value.deller?(r(),o(_,{key:7,label:"Deller",number:e.value.deller},null,8,["number"])):n("",!0),e.value.sgrade?(r(),o(_,{key:8,label:"SP DAN"},{default:d(()=>[g(b(s(N)(e.value.sgrade).label),1)]),_:1})):n("",!0),e.value.dgrade?(r(),o(_,{key:9,label:"DP DAN"},{default:d(()=>[g(b(s(N)(e.value.dgrade).label),1)]),_:1})):n("",!0)]),(z=e.value.stats)!=null&&z.count?(r(),p(k,{key:1},[m(j,{icon:s(de),title:"Stats",main:""},null,8,["icon"]),u("div",Je,[(r(!0),p(k,null,C(ee(e.value),c=>(r(),p(k,{key:c},[c.value?(r(),o(_,{key:0,label:c.label,number:c.value},null,8,["label","number"])):n("",!0)],64))),128))])],64)):n("",!0),e.value.jubility?(r(),p(k,{key:2},[m(j,{icon:s(me),title:"Jubility Breakdown",main:""},null,8,["icon"]),u("div",Ae,[e.value.pick_up_breakdown?(r(),o(F,{key:0},{default:d(()=>[m(x,{label:"Pick-Up",color:"info"}),m(O,{"jubility-data":e.value.pick_up_breakdown,",":"",version:t.currentVersion},null,8,["jubility-data","version"])]),_:1})):n("",!0),e.value.other_breakdown?(r(),o(F,{key:1},{default:d(()=>[m(x,{label:"Common",color:"info"}),m(O,{"jubility-data":e.value.other_breakdown,",":"",version:t.currentVersion},null,8,["jubility-data","version"])]),_:1})):n("",!0)])],64)):n("",!0)]}),_:1})):n("",!0)]),_:1}))}};export{Me as default};
