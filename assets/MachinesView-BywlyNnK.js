import{u as T,r as b,a as q,o as O,n as S,c as P,d as m,w as i,e,_ as j,j as _,f as v,F as I,g as c,i as r,J as B,h as g,K as D,s as R,l as C,ah as J,m as K}from"./index-Dk9pwBdW.js";import{F as z}from"./PhGear.vue-DnXNk9Uc.js";import{G as H}from"./PhPencilCircle.vue-C0L7AYbo.js";import{I as L}from"./PhPlusCircle.vue-DkBJXA31.js";import{_ as u}from"./FormField-Cvxm0MqE.js";import{_ as h}from"./FormControl-B19TdIcj.js";import{_ as p}from"./FormCheckRadio-ZJiFBCoe.js";import{_ as Q}from"./ArcadeCard-BYI0dfm2.js";import{_ as W}from"./GeneralTable-Bs5K7jSx.js";import{g as M}from"./pcbid-CIkJuo1f.js";import{A as X}from"./arcade-C-pFBpgY.js";import{d as Y,w as Z,x as ee,y as ae}from"./admin-CtcYpd4i.js";import{_ as le}from"./BaseButtons-Bcs1LbRe.js";import"./PhCashRegister.vue-D2dAmHfl.js";import"./PhHouse.vue-BMje50R0.js";import"./contentExport-f1OZccaW.js";const te={class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},ne={class:"grid grid-cols-1 w-full gap-2 md:gap-6 md:flex md:place-content-stretch pb-4 md:pb-0"},ie={class:"grid grid-cols-1 w-full gap-2 md:gap-6 md:flex md:place-content-stretch pb-4 md:pb-0"},oe={class:"bg-white dark:bg-slate-900/95 rounded-2xl lg:flex lg:justify-between"},se={class:"w-full"},Be={__name:"MachinesView",setup(ue){const y=T(),s=b({}),w=b(!0),A=q(),$=parseInt(A.params.id);async function f(){try{const o=await X($);s.value=o,w.value=!1}catch(o){console.error("Failed to fetch arcade data:",o)}}O(()=>{f()});const x=[{text:"PCBID",value:"pcbId",sortable:!0,width:200},{text:"Name",value:"description",sortable:!0,width:200},{text:"Port",value:"port",sortable:!0,width:120},{text:"Arcade Machine",value:"data.cabinet",sortable:!0,width:120},{text:"OTA",value:"ota",sortable:!0,width:120}],U=o=>{navigator.clipboard.writeText(o.pcbId).then(()=>{alert("Copied to clipboard!")}).catch(()=>{alert("Failed to copy to clipboard!")})},V={name:"",cabinet:!1,ota:!1,generatePCBID:!0,PCBID:""},l=S({...V}),d=b(null),n=b(null);function k(o){var a=[];for(const t of o)a.push({id:t.pcbId,label:t.description});return a}function E(o){return!o||!s.value.machines?null:(n.value=s.value?.machines?.find(a=>a.pcbId===o),n.value.cabinet=n.value.data.cabinet??!1,!0)}async function N(){for(l.generatePCBID&&(l.PCBID=M());!await Y(l.PCBID);)if(l.generatePCBID)l.PCBID=M();else{window.alert("PCBID already in use!");return}Z(s.value.id,{name:l.name,cabinet:l.cabinet,ota:l.ota,PCBID:l.PCBID.toUpperCase()}),Object.assign(l,V),f()}async function F(){n.value&&(await ee(s.value.id,{name:n.value.name,cabinet:n.value.cabinet,ota:n.value.ota,PCBID:n.value.pcbId.toUpperCase()}),n.value=null,d.value=null,f())}async function G(){n.value&&(await ae(s.value.id,n.value?.pcbId??""),n.value=null,d.value=null,f())}return(o,a)=>(m(),P(K,null,{default:i(()=>[e(j,null,{default:i(()=>[w.value?v("",!0):(m(),_(I,{key:0},[e(Q,{class:"mb-6",arcade:s.value,"use-small":!0},null,8,["arcade"]),c(y).userAdmin?(m(),_(I,{key:0},[e(B,{icon:c(z),title:"Machine Administration",main:""},null,8,["icon"]),r("div",te,[e(g,{"is-form":"",class:"lg:mb-6"},{default:i(()=>[e(D,{color:"success",label:"Add Machine",icon:c(L),class:"mb-2"},null,8,["icon"]),r("form",{class:"h-full",onSubmit:a[5]||(a[5]=R(t=>N(),["prevent"]))},[e(u,{label:"Generate PCBID",help:"Generate a PCBID rather than supply one."},{default:i(()=>[e(p,{modelValue:l.generatePCBID,"onUpdate:modelValue":a[0]||(a[0]=t=>l.generatePCBID=t),"input-value":l.generatePCBID,name:"generatePCBID",type:"switch"},null,8,["modelValue","input-value"])]),_:1}),l.generatePCBID?v("",!0):(m(),P(u,{key:0,label:"PCBID"},{default:i(()=>[e(h,{modelValue:l.PCBID,"onUpdate:modelValue":a[1]||(a[1]=t=>l.PCBID=t),name:"pcbid",required:"",minlength:"20",maxlength:"20"},null,8,["modelValue"])]),_:1})),e(u,{label:"Name"},{default:i(()=>[e(h,{modelValue:l.name,"onUpdate:modelValue":a[2]||(a[2]=t=>l.name=t),name:"name",required:""},null,8,["modelValue"])]),_:1}),r("div",ne,[e(u,{label:"Arcade Cabinet",help:"If this is a real cabinet, enable this."},{default:i(()=>[e(p,{modelValue:l.cabinet,"onUpdate:modelValue":a[3]||(a[3]=t=>l.cabinet=t),"input-value":l.cabinet,name:"cabinet",type:"switch"},null,8,["modelValue","input-value"])]),_:1}),e(u,{label:"Enable Updates",help:"Enables or disables OTA updates."},{default:i(()=>[e(p,{modelValue:l.ota,"onUpdate:modelValue":a[4]||(a[4]=t=>l.ota=t),"input-value":l.ota,name:"ota",type:"switch"},null,8,["modelValue","input-value"])]),_:1})]),e(C,{color:"success",type:"submit",label:"Add Machine"})],32)]),_:1}),e(g,{"is-form":"",class:"mb-6"},{default:i(()=>[e(D,{color:"warning",label:"Edit Machine",icon:c(H),class:"mb-2"},null,8,["icon"]),e(u,{label:"Machine"},{default:i(()=>[e(h,{modelValue:d.value,"onUpdate:modelValue":a[6]||(a[6]=t=>d.value=t),name:"machine",options:k(s.value.machines),required:""},null,8,["modelValue","options"])]),_:1}),E(d.value)?(m(),_(I,{key:0},[e(u,{label:"Name"},{default:i(()=>[e(h,{modelValue:n.value.name,"onUpdate:modelValue":a[7]||(a[7]=t=>n.value.name=t),name:"name",required:""},null,8,["modelValue"])]),_:1}),r("div",ie,[e(u,{label:"Arcade Cabinet",help:"If this is a real cabinet, enable this."},{default:i(()=>[e(p,{modelValue:n.value.cabinet,"onUpdate:modelValue":a[8]||(a[8]=t=>n.value.cabinet=t),"input-value":n.value.cabinet,name:"cabinet",type:"switch"},null,8,["modelValue","input-value"])]),_:1}),e(u,{label:"Enable Updates",help:"Enables or disables OTA updates."},{default:i(()=>[e(p,{modelValue:n.value.ota,"onUpdate:modelValue":a[9]||(a[9]=t=>n.value.ota=t),"input-value":n.value.ota,name:"ota",type:"switch"},null,8,["modelValue","input-value"])]),_:1})]),e(le,null,{default:i(()=>[e(C,{color:"success",label:"Update Machine",onClick:a[10]||(a[10]=t=>F())}),e(C,{color:"danger",label:"Delete Machine",onClick:a[11]||(a[11]=t=>G())})]),_:1})],64)):v("",!0)]),_:1})])],64)):v("",!0),e(B,{icon:c(J),title:"Machines",main:""},null,8,["icon"]),e(g,{"has-table":""},{default:i(()=>[r("div",oe,[r("div",se,[e(W,{headers:x,items:s.value.machines,onRowClicked:U},null,8,["items"])])])]),_:1})],64))]),_:1})]),_:1}))}};export{Be as default};
