import{u as Y,r as m,a as Z,b as ee,M as ae,o as le,c as _,d as i,w as r,e as a,_ as ne,j as g,f as A,F as k,i as o,g as d,P as x,aQ as te,h,v as C,Q as S,ay as E,l as u,C as L,az as se,aA as oe,R as ie,k as D,aR as re,t as de,aS as ue,aB as ce,aT as me,an as fe,n as pe}from"./index-CHivKhhP.js";import{_ as ve}from"./ArcadeCard-B-wORdMu.js";import{_ as w}from"./FormField-vtioLqMT.js";import{_ as F}from"./FormCheckRadio-DdZBsrII.js";import{_ as O}from"./FormControl-BLuW9GWW.js";import{s as P,g as J}from"./values-CmNcmtTU.js";import{A as be,a as _e,b as ge}from"./arcade-C_iviJ_9.js";import{i as Ae,l as ye,c as he,m as we,n as ke,o as Se}from"./admin-YL_-tKB5.js";const Ve={class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},$e={class:"mb-4 flex gap-2 items-stretch"},Ne={key:0,class:"space-x-2 mt-6 mb-4"},xe={class:"mb-4"},Ce={class:"mb-4"},Oe={class:"grid gap-4"},Pe={class:"flex justify-between items-center"},Ie={class:"m-[-5px] md:flex items-center gap-2"},Ue={class:"w-8 md:w-12"},Me={class:"text-lg lg:text-xl font-bold"},Be={class:"grid grid-cols-1 w-full gap-2 md:gap-6 md:flex md:place-content-stretch"},Re={key:0,class:"space-x-2 mt-6"},Ee={class:"grid grid-cols-1 gap-6 sm:grid-cols-2 md:grid-cols-3 mb-6"},Te={__name:"ArcadeView",setup(Le){const V=Y(),b=m(null),$=m(null),c=m(null),I=m(!0),N=m(null),s=m(null),y=m(null),U=m(null),j=Z(),q=ee(),f=parseInt(j.params.id);var M=[{id:"paseli_enabled",name:"PASELI Services",help:"Enable PASELI for this arcade.",type:"Boolean"},{id:"paseli_infinite",name:"Infinite PASELI",help:"Enable infinite PASELI for this arcade.",type:"Boolean"},{id:"maint",name:"Maintenance Mode",help:"Place this arcade under maintenance.",type:"Boolean"},{id:"hide_network",name:"Incognito Mode",help:"Hide the network and all ranking data.",type:"Boolean"}];async function p(){try{c.value={},b.value={},$.value={};const n=await be(f);c.value=n,s.value=JSON.parse(JSON.stringify(n));for(const e of M){const t=J(c.value.data,e.id);P(b.value,e.id,t),P($.value,e.id,t)}I.value=!1}catch(n){console.error("Failed to fetch arcade data:",n)}}async function B(){if(V.userAdmin)try{const n=await Ae(!0),e=[];for(const t of n)t.username!=null&&e.push({id:t.id,label:t.username});e.sort((t,v)=>t.label.localeCompare(v.label)),U.value=e}catch(n){console.error("Failed to fetch admin user data:",n)}}ae(()=>V.userAdmin,()=>{B()});async function z(){(await _e(f,b.value)).status!="error"&&await p()}le(()=>{p(),B()});function G(n,e="NA_"){var t=[...n].map(v=>v.charCodeAt(0)<128?v:e).join("");return t=t.replace(/[!"#$%&'()*+,-./:;<=>?@[\\\]^_`{|}~]/g,""),t=t.replace(/\s+/g,"_"),t}async function Q(){try{const n=await ge(f),e=new Blob([n],{type:"application/ovpn"}),t=document.createElement("a");t.href=URL.createObjectURL(e),t.download=`gradius-${G(c.value.name)}-phaseii-config.ovpn`,document.body.appendChild(t),t.click(),URL.revokeObjectURL(t.href),document.body.removeChild(t)}catch(n){console.log("Failed to fetch arcade data:",n)}}async function T(){if(s.value.name){const n=await he(s.value.name);n.unused!=null&&(N.value=n.unused)}}async function H(){(await ye(f,{name:s.value.name,description:s.value.description,beta:s.value.data.is_beta})).status!="error"&&await p()}async function K(){if(y.value==null)return;(await ke(f,y.value)).status!="error"&&(y.value=null,p())}async function W(n){if(!n)return;(await Se(f,n)).status!="error"&&p()}async function X(){window.confirm(`Are you really?
This will remove all owners, machines, and arcade data.`)&&(await we(f)).status!="error"&&await q.push({name:"admin_arcades"})}return(n,e)=>(i(),_(pe,null,{default:r(()=>[a(ne,null,{default:r(()=>{var t,v;return[I.value?A("",!0):(i(),g(k,{key:0},[a(ve,{class:"mb-6",arcade:c.value},null,8,["arcade"]),d(V).userAdmin?(i(),g(k,{key:0},[a(x,{icon:d(te),title:"Arcade Administration",main:""},null,8,["icon"]),o("div",Ve,[a(h,{"is-form":"",class:"lg:mb-6",onSubmit:C(H,["prevent"])},{default:r(()=>[a(S,{color:"info",label:"General Information",icon:d(E),class:"mb-2"},null,8,["icon"]),a(w,{label:"Arcade Name"},{default:r(()=>[a(O,{modelValue:s.value.name,"onUpdate:modelValue":e[0]||(e[0]=l=>s.value.name=l),"input-value":s.value.name,name:"arcadeName",required:""},null,8,["modelValue","input-value"])]),_:1}),o("div",$e,[a(u,{color:"info",label:"Check Name",onClick:e[1]||(e[1]=l=>T())}),N.value==!0?(i(),_(L,{key:0,path:d(se),color:"text-green-400",size:"25"},null,8,["path"])):N.value==!1?(i(),_(L,{key:1,path:d(oe),color:"text-red-400",size:"25"},null,8,["path"])):A("",!0)]),a(w,{label:"Description"},{default:r(()=>[a(O,{modelValue:s.value.description,"onUpdate:modelValue":e[2]||(e[2]=l=>s.value.description=l),name:"description",required:""},null,8,["modelValue"])]),_:1}),a(w,{label:"Beta Enabled"},{default:r(()=>[a(F,{modelValue:s.value.data.is_beta,"onUpdate:modelValue":e[3]||(e[3]=l=>s.value.data.is_beta=l),name:"beta","model-value":s.value.data.is_beta,"input-value":s.value.data.is_beta,type:"switch"},null,8,["modelValue","model-value","input-value"])]),_:1}),JSON.stringify(c.value)!==JSON.stringify(s.value)?(i(),g("div",Ne,[a(u,{color:"success",label:"Save",type:"submit"}),a(u,{color:"warning",label:"Revert",onClick:e[4]||(e[4]=l=>p())})])):A("",!0),o("div",null,[a(u,{color:"danger",label:"Delete Arcade",onClick:e[5]||(e[5]=l=>X())})])]),_:1}),a(h,{class:"mb-6"},{default:r(()=>[o("div",xe,[a(S,{color:"info",label:"Add Manager",icon:d(E),class:"mb-2"},null,8,["icon"]),o("form",{class:"h-full",onSubmit:C(K,["prevent"])},[a(w,{label:"Username"},{default:r(()=>[a(O,{modelValue:y.value,"onUpdate:modelValue":e[6]||(e[6]=l=>y.value=l),name:"username",options:U.value,required:""},null,8,["modelValue","options"])]),_:1}),a(u,{color:"success",type:"submit",label:"Add Manager"})],32)]),a(ie),o("div",Ce,[a(S,{color:"warning",label:"Managers",class:"mb-4"}),o("div",Oe,[(i(!0),g(k,null,D(c.value.owners,l=>(i(),_(h,{key:l,"color-prop":"bg-slate-800 dark:bg-slate-800"},{default:r(()=>[o("div",Pe,[o("div",Ie,[o("div",Ue,[a(re,{username:l.username,avatar:l.avatar},null,8,["username","avatar"])]),o("h1",Me,de(l.username),1)]),a(u,{color:"danger",label:"Remove",onClick:R=>W(l.id)},null,8,["onClick"])])]),_:2},1024))),128))])])]),_:1})])],64)):A("",!0),a(x,{icon:d(ue),title:"Arcade Management",main:""},null,8,["icon"]),a(h,{"is-form":"",class:"mb-6",onSubmit:C(z,["prevent"])},{default:r(()=>[a(S,{color:"info",label:"Settings",icon:d(ce),class:"mb-2"},null,8,["icon"]),o("div",Be,[(i(!0),g(k,null,D(d(M),l=>(i(),_(w,{key:l.id,label:l.name,help:l.help},{default:r(()=>[l.type=="Boolean"?(i(),_(F,{key:0,name:l.id,"model-value":!!(d(J)(b.value,l.id)??!1),"input-value":!0,type:"switch","onUpdate:modelValue":R=>d(P)(b.value,l.id,R??!1)},null,8,["name","model-value","onUpdate:modelValue"])):A("",!0)]),_:2},1032,["label","help"]))),128))]),JSON.stringify(b.value)!==JSON.stringify($.value)?(i(),g("div",Re,[a(u,{color:"success",label:"Save",type:"submit"}),a(u,{color:"danger",label:"Revert",onClick:e[7]||(e[7]=l=>p())})])):A("",!0)]),_:1}),a(h,{class:"w-full md:w-1/2 mb-6"},{default:r(()=>[e[9]||(e[9]=o("h1",{class:"text-lg md:text-xl"},"OpenVPN Configuration",-1)),e[10]||(e[10]=o("p",{class:"pb-1 dark:text-white/50"}," Use this to download your VPN config. ",-1)),a(u,{small:!1,color:"success",class:"my-2",label:"Export",onClick:e[8]||(e[8]=l=>Q())})]),_:1}),a(x,{icon:d(me),title:"Arcade Overview",main:""},null,8,["icon"]),o("div",Ee,[a(fe,{number:(v=(t=c.value)==null?void 0:t.machines)==null?void 0:v.length,label:"Active Machines"},null,8,["number"])])],64))]}),_:1})]),_:1}))}};export{Te as default};
