import{a as k,b as D,n as B,D as G,a4 as R,r as g,o as C,c as F,d as m,w as d,e as o,_ as L,g as c,j as y,f as x,i as f,J as N,h as j,m as E}from"./index-D5js98pV.js";import{F as H}from"./PhUsersThree.vue-DlKmmcXj.js";import{_ as S}from"./GameHeader-JVOj8wEA.js";import{_ as J}from"./FormControl-DfNoBpfO.js";import{_ as M}from"./ProfileCard-Dva1KUME.js";import{_ as T}from"./GeneralTable-CgZ3N5Ab.js";import{a as U,A as X}from"./profile-D-GZxDy7.js";import{d as q}from"./userData-DZYdegtD.js";import{g as w}from"./danClass-Bg9sX7yb.js";import"./PhGear.vue-DqQZLxjy.js";import"./PhHouse.vue-CIC86uz2.js";const z={key:0,class:"w-full md:flex md:-mt-[75px] mb-4 place-content-end"},K={class:"md:w-1/3 md:text-right"},O={key:1,class:"w-full"},Q={class:"bg-white dark:bg-slate-900/95 rounded-2xl lg:flex lg:justify-between"},W={class:"w-full"},ce={__name:"GameView",setup(Y){const V=k(),p=D();var l=null,a=null;const r=B({currentVersion:null});G(()=>r.currentVersion,()=>{v()}),l=V.params.id,a=R(l),a==null&&p.push({name:"ErrorPage",params:{catchAll:"404"}});const n=g(null),_=g([]);C(async()=>{try{const t=await U(l);_.value=$(t)}catch(t){console.error("Failed to fetch profile data:",t)}v()}),a.versions||(r.currentVersion=1);async function v(){try{n.value=null;const t=await X(l,r.currentVersion);n.value=t,t&&!r.currentVersion&&(r.currentVersion=t.versions[t.versions.length-1])}catch(t){console.error("Failed to fetch user profile data:",t)}}const i=[];if(i.push({text:"Player",value:"username",sortable:!0,width:120}),a.noRivals||i.push({text:"Rival ID",value:"extid",width:100}),i.push({text:"Last Play",value:"stats.last_play_timestamp",width:150},{text:"Last Arcade",value:"stats.last_play_arcade",width:150},{text:"Plays",value:"stats.total_plays",sortable:!0,width:50}),a.playerHeaders)for(var P of a.playerHeaders)i.push(P);function $(t){var s=[];for(var e of t){if(e.extid&&(e.extid=q(e.extid)),e.stats){if(e.stats.last_play_timestamp){const u=new Date(e.stats.last_play_timestamp*1e3);e.stats.last_play_timestamp=u.toLocaleString()}e.sgrade&&(e.sgrade=w(e.sgrade).short),e.dgrade&&(e.dgrade=w(e.dgrade).short)}s.push(e)}return s.sort((u,h)=>{const A=u.stats&&u.stats.total_plays||0;return(h.stats&&h.stats.total_plays||0)-A}),s}function I(t){var s=[];for(const e of a.versions)t.includes(e.id)&&s.push(e);return s}const b=t=>{const s=t.userId;p.push(`/games/${l}/profiles/${s}`)};return(t,s)=>(m(),F(E,null,{default:d(()=>[o(L,null,{default:d(()=>[o(S,{game:c(a),version:r.currentVersion},{default:d(()=>[c(a).versions&&n.value?(m(),y("div",z,[f("div",K,[s[1]||(s[1]=f("h2",{class:"text-md sm:text-lg md:text-xl font-bold p-2"}," Select Version ",-1)),o(J,{modelValue:r.currentVersion,"onUpdate:modelValue":s[0]||(s[0]=e=>r.currentVersion=e),options:I(n.value.versions)},null,8,["modelValue","options"])])])):x("",!0),n.value?(m(),y("div",O,[o(M,{game:c(l),version:r.currentVersion,profile:n.value},null,8,["game","version","profile"])])):x("",!0)]),_:1},8,["game","version"]),o(N,{icon:c(H),title:"All Players",main:""},null,8,["icon"]),o(j,{"has-table":""},{default:d(()=>[f("div",Q,[f("div",W,[o(T,{headers:i,items:_.value,onRowClicked:b},null,8,["items"])])])]),_:1})]),_:1})]),_:1}))}};export{ce as default};
