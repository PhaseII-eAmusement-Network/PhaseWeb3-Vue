import{a7 as V,r as g,o as J,c as x,f as v,g as c,d as r,w as i,e as a,h as w,i as t,a8 as U,t as b,l as $,a9 as E,j as _,F as X,k as F,p as O,_ as Y,O as Z,P as S,aa as P,v as H,a3 as K,y as Q,C as W,D as ee,I as D,ab as ae,q as te,ac as le,ad as T,n as se,ae as ne,af as oe}from"./index-DuDIkw19.js";import{_ as I}from"./FormField-BM6meo4p.js";import{_ as N}from"./FormControl-Hea20ohr.js";import{_ as R}from"./FormCheckRadio-DDXWYqT2.js";import{A as re}from"./profile-Dru2pZHV.js";const ie={class:"grid grid-cols-1 gap-3"},ue={class:"flex gap-4 items-center"},ce={class:"text-2xl"},de={class:"font-light text-xl"},me={class:"space-x-2 mt-6"},fe={__name:"MergeModal",props:{userId:{type:Number,default:null},game:{type:String,default:null},settings:{type:Object,default:null}},emits:["saveMerge","closeModal"],setup(C,{emit:y}){const u=C,m=y,f=V(u.game),l=g({}),n=g(u.settings?.scores??!1);J(async()=>{const p=await re(u.game,null,u.userId);l.value=p});function d(){m("saveMerge",{game:u.game,scores:n.value})}return(p,h)=>c(f)&&l.value?(r(),x(E,{key:0,transparent:"",onOverlayClick:h[1]||(h[1]=M=>m("closeModal"))},{default:i(()=>[a(w,{class:"shadow-lg max-h-modal w-11/12 md:w-3/5 lg:w-2/5 xl:w-4/12 z-50 text-white/90"},{default:i(()=>[t("div",ie,[t("div",ue,[a(U,{path:c(f).icon},null,8,["path"]),t("h1",ce,b(c(f).name),1)]),t("div",null,[t("h2",de,b(l.value.name)+" - "+b(l.value.stats?.total_plays??0)+" Plays ",1)]),a(I,{label:"Scores",help:"Transfer all scores from this account to yours. This will not erase your current scores."},{default:i(()=>[a(R,{modelValue:n.value,"onUpdate:modelValue":h[0]||(h[0]=M=>n.value=M),name:"scores","input-value":n.value,type:"switch"},null,8,["modelValue","input-value"])]),_:1}),t("div",me,[a($,{color:"success",label:"Save",onClick:d})])])]),_:1})]),_:1})):v("",!0)}},ge={class:"grid grid-cols-1 gap-3"},ve={key:0,class:"flex gap-4 items-center"},pe={class:"text-2xl"},_e={class:"text-lg"},ye={class:"space-x-2 mt-6"},he={__name:"ConfirmMergeModal",props:{settings:{type:Object,default:null}},emits:["saveMerge","closeModal"],setup(C,{emit:y}){const u=y;function m(){u("saveMerge")}return(f,l)=>(r(),x(E,{transparent:"",onOverlayClick:l[0]||(l[0]=n=>u("closeModal"))},{default:i(()=>[a(w,{class:"shadow-lg max-h-modal w-11/12 md:w-3/5 lg:w-2/5 xl:w-4/12 z-50 text-white/90"},{default:i(()=>[t("div",ge,[l[1]||(l[1]=t("h1",{class:"text-2xl font-bold"},"Merge Overview",-1)),(r(!0),_(X,null,F(Object.keys(C.settings),n=>(r(),_(X,{key:n},[n!=="card"?(r(),_("div",ve,[a(U,{path:c(V)(n)?.icon},null,8,["path"]),t("div",null,[t("h1",pe,b(c(V)(n)?.name),1),t("h2",_e,b(C.settings[n]?.scores?"✅":"❌")+" Transfer Scores ",1)])])):v("",!0)],64))),128)),t("div",null,[t("span",null,b(C.settings?.card?"✅":"❌")+" Transfer Card",1)]),t("div",ye,[a($,{color:"success",label:"Save",onClick:m})])])]),_:1})]),_:1}))}},xe={key:1},be={class:"grid grid-cols-1 md:grid-cols-2 2xl:grid-cols-4 gap-4 mb-6"},Ce={class:"mt-4"},we={key:2},$e={class:"text-xl mb-6"},ke={class:"mt-4"},Me={key:3},Se={class:"mt-4"},Pe={__name:"ClaimView",setup(C){const y=g(!1),u=g(null),m=g(!1),f=g(!1),l=O({cardId:null,pin:null}),n=g({game:null,scores:!1}),d=O({card:!0}),p=g(null),h=g(0);function M(o){var e=o.target.value;e=e.replace(/[^A-Za-z0-9]/g,""),e=e.toUpperCase().replace(/(.{4})/g,"$1-").replace(/-$/,""),l.cardId=e}function j(o){o.target.value=o.target.value.replace(/\D/g,"")}async function z(){y.value=!0,u.value=await ne(l.cardId,l.pin),y.value=!1}function B(o){m.value=!1,n.value.game=o,m.value=!0}function A(){f.value=!0}function L(o){var e=[];for(const s of o){const k=V(s.game);k&&!k.skip&&e.push(s)}return e.sort(function(s,k){return k.data.last_play_timestamp-s.data.last_play_timestamp}),e}function G({game:o,scores:e}){d[o]={scores:e},m.value=!1,n.value={game:null,scores:!1,data:!1}}async function q(){const o=await oe(l.cardId,l.pin,d);f.value=!1,o||window.alert("Failed to merge!"),o.status==="success"?(p.value=!0,h.value=o.count??0):p.value=!1}return(o,e)=>(r(),x(se,null,{default:i(()=>[a(Y,null,{default:i(()=>[a(Z,{class:"mb-6","use-small":"","even-smaller":""}),u.value?v("",!0):(r(),_(X,{key:0},[a(S,{icon:c(P),title:"Claim a Profile",main:""},null,8,["icon"]),a(w,{"is-form":"",class:"row-span-2 mb-6",onSubmit:e[2]||(e[2]=H(s=>z(),["prevent"]))},{footer:i(()=>[a($,{type:"submit",color:"success",label:"Start Claim"}),y.value?(r(),x(W,{key:0,path:c(ee),color:"text-yellow-500",class:"animate animate-spin"},null,8,["path"])):v("",!0)]),default:i(()=>[e[6]||(e[6]=t("h2",{class:"text-xl mb-6 lg:w-1/2"}," If you registered a card in game and need to claim it, you may do so here. Please note that the account cannot already be claimed! ",-1)),a(I,{label:"Card ID",help:"The 16 character ACCESS CODE. If your card is dated after 2016, you'll need to get the ACCESS CODE from a game."},{default:i(()=>[a(N,{modelValue:l.cardId,"onUpdate:modelValue":e[0]||(e[0]=s=>l.cardId=s),icon:c(K),name:"cardId",type:"card",placeholder:"XXXX-XXXX-XXXX-XXXX",minlength:19,maxlength:19,required:"",onInput:M},null,8,["modelValue","icon"])]),_:1}),a(I,{label:"PIN",help:"Used when logging into a game"},{default:i(()=>[a(N,{modelValue:l.pin,"onUpdate:modelValue":e[1]||(e[1]=s=>l.pin=s),icon:c(Q),type:"password",name:"pin",minlength:4,maxlength:4,inputmode:"numeric",pattern:"\\d{4}",autocomplete:"pin",onInput:j},null,8,["modelValue","icon"])]),_:1})]),_:1,__:[6]})],64)),u.value&&p.value==null?(r(),_("div",xe,[a(S,{icon:c(P),title:"Select Profiles to Merge",main:""},null,8,["icon"]),a(w,null,{default:i(()=>[e[7]||(e[7]=t("h2",{class:"text-xl mb-6"},[D(" Click a game to view merge options. "),t("br"),D(" Please note that this cannot be undone once complete. ")],-1)),t("div",be,[(r(!0),_(X,null,F(L(u.value.profiles),s=>(r(),x(ae,{key:s.game,game:s.game,value:s.data.total_plays,"profile-name":"",type:"plays",class:te(d[s.game]?"border-green-800 border-[3px]":null),"disable-local-click":"",onClick:k=>B(s.game)},null,8,["game","value","class","onClick"]))),128))]),a(I,{label:"Transfer Card",help:"Moves the card to your account."},{default:i(()=>[a(R,{modelValue:d.card,"onUpdate:modelValue":e[3]||(e[3]=s=>d.card=s),"input-value":d.card,icon:c(le),type:"switch",name:"card"},null,8,["modelValue","input-value","icon"])]),_:1}),t("div",Ce,[a($,{color:"success",label:"Start Merge",disabled:JSON.stringify(d)==JSON.stringify({}),onClick:A},null,8,["disabled"])])]),_:1,__:[7]})])):v("",!0),p.value==!0?(r(),_("div",we,[a(S,{icon:c(T),title:"Merge Results",main:""},null,8,["icon"]),a(w,null,{default:i(()=>[t("h2",$e," ✅ Successfully merged "+b(h.value)+" records. Yippie! ",1),t("div",ke,[a($,{color:"success",label:"Return to Dashboard",href:"#/"})])]),_:1})])):v("",!0),p.value==!1?(r(),_("div",Me,[a(S,{icon:c(T),title:"Merge Results",main:""},null,8,["icon"]),a(w,null,{default:i(()=>[e[8]||(e[8]=t("h2",{class:"text-xl mb-6"},"❌ Failed to merge. Please try again.",-1)),t("div",Se,[a($,{color:"warning",label:"Retry",onClick:A})])]),_:1,__:[8]})])):v("",!0),m.value?(r(),x(fe,{key:4,game:n.value.game,"user-id":u.value.userId,settings:d[n.value.game],onSaveMerge:G,onCloseModal:e[4]||(e[4]=s=>m.value=!1)},null,8,["game","user-id","settings"])):v("",!0),f.value?(r(),x(he,{key:5,game:n.value.game,settings:d,onSaveMerge:q,onCloseModal:e[5]||(e[5]=s=>f.value=!1)},null,8,["game","settings"])):v("",!0)]),_:1})]),_:1}))}};export{Pe as default};
