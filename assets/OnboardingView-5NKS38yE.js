import{b as E,u as z,a as H,r as U,p as x,c as p,d as c,w as i,e as t,_ as Q,i as s,N as K,g as b,au as W,h as w,f as y,O as V,av as O,l as h,B as S,aw as X,ax as Y,ay as Z,v as ee,j as ae,F as ne,k as te,t as C,n as le,a4 as oe}from"./index-vA9N45XP.js";import{_ as r}from"./FormField-BJ53twuK.js";import{_ as u}from"./FormCheckRadio-Roj-HW28.js";import{_ as I}from"./FormControl-CbA50xCq.js";import{c as ie,a as se,b as re}from"./admin-DLWnlEF3.js";import{g as M}from"./pcbid-CIkJuo1f.js";const L=E();async function de(v,g){try{return await L.callApi(`/discord/exportVPN/${v}?discordId=${g}`)}catch(d){throw console.log("Error exporting vpn:",d),d}}async function ue(v,g){try{return await L.callApi(`/discord/onboardArcade/${v}?discordId=${g}`)}catch(d){throw console.log("Error onboarding arcade:",d),d}}const ce={class:"grid grid-cols-1 gap-6"},me={class:"mb-4 flex gap-2 items-stretch"},pe={class:"grid grid-cols-1 w-full gap-2 md:gap-6 md:flex md:place-content-stretch"},fe={class:"grid md:grid-cols-2 gap-6"},be={class:"grid grid-cols-1 w-full gap-2 md:gap-6 md:flex md:place-content-stretch pb-4 md:pb-0"},ge={class:"grid gap-4"},he={class:"flex justify-between items-center"},Ie={class:"m-[-5px]"},ve={class:"text-md font-bold"},De={class:"text-sm"},we={class:"text-sm font-mono"},ye={class:"grid md:flex gap-4"},ke={__name:"OnboardingView",setup(v){const g=z(),d=H(),j=E(),_=g.params.data,B=U(null);function R(l){try{const e=Uint8Array.from(atob(l),m=>m.charCodeAt(0)),a=new TextDecoder().decode(e);return JSON.parse(a)}catch(e){return console.error("Invalid base64 input or JSON parse error:",e),null}}function q(l){const e=[];return typeof l!="object"||l===null?["data is not an object"]:(typeof l.userId!="string"&&e.push("userId must be a string"),typeof l.type!="string"&&e.push("type must be a string"),typeof l.arcadeName!="string"&&e.push("arcadeName must be a string"),typeof l.cabinetCount!="number"&&e.push("cabinetCount must be a number"),Array.isArray(l.games)?l.games.every(a=>typeof a=="string")||e.push("games must be an array of strings"):e.push("games must be an array"),e)}async function F(){const l=B.value;n.useDiscord=!0,n.discordId=l.userId,n.name=l.arcadeName,await N();for(const e of l.games){if(e==="main")o.name=`${n.name} Main`;else{const a=oe(e);a&&(o.name=`${n.name} ${a.shortName?a.shortName:a.name}`)}await k()}}const D={name:"",useDiscord:!0,discordId:"",description:"",paseli:!0,infinitePaseli:!0,maintenance:!1,betas:!1,incognito:!1,machineList:[]},A={name:"",cabinet:!1,ota:!1,generatePCBID:!0,PCBID:""},n=x({...D}),o=x({...A}),P=U(void 0);if(_)try{const l=R(_),e=q(l);e.length?console.error(e):(B.value=JSON.parse(JSON.stringify(l)),F())}catch(l){console.error(l)}async function k(){for(o.generatePCBID&&(o.PCBID=M());!await se(o.PCBID);)if(o.generatePCBID)o.PCBID=M();else{window.alert("PCBID already in use!");return}n.machineList.push({name:o.name,cabinet:o.cabinet,ota:o.ota,PCBID:o.PCBID.toUpperCase()}),Object.assign(o,A)}function J(l){n.machineList=n.machineList.filter(e=>e.PCBID!==l)}async function N(){if(n.name){const l=await ie(n.name);l.unused!=null&&(P.value=l.unused)}}function T(l,e="NA_"){var a=[...l].map(m=>m.charCodeAt(0)<128?m:e).join("");return a=a.replace(/[!"#$%&'()*+,-./:;<=>?@[\\\]^_`{|}~]/g,""),a=a.replace(/\s+/g,"_"),a}async function G(l,e){try{const a=await j.getArcadeVPN(l),m=new Blob([a],{type:"application/ovpn"}),f=document.createElement("a");f.href=URL.createObjectURL(m),f.download=`gradius-${T(e.name)}-phaseii-config.ovpn`,document.body.appendChild(f),f.click(),URL.revokeObjectURL(f.href),document.body.removeChild(f)}catch(a){console.log("Failed to fetch arcade data:",a)}}async function $(l){if(n.name==D.name){window.alert("Please input a name.");return}if(n.discordId==D.discordId&&n.useDiscord&&l){window.alert("Please input a Discord ID.");return}if(n.description==D.description&&!n.useDiscord){window.alert("Please input a description.");return}const e=await re(n);l&&e.arcadeId&&(n.useDiscord?(await ue(e.arcadeId,n.discordId),await de(e.arcadeId,n.discordId)):await G(e.arcadeId,n)),e.arcadeId?(window.alert("Onboarding complete!"),d.push({name:"arcade",params:{id:e.arcadeId}})):window.alert("Failed to onboard!")}return(l,e)=>(c(),p(le,null,{default:i(()=>[t(Q,null,{default:i(()=>[t(K,{icon:b(W),title:"Arcade Onboarding",color:"text-green-400",main:""},null,8,["icon"]),s("div",ce,[t(w,{"is-form":"",class:"row-span-1"},{default:i(()=>[t(V,{color:"info",label:"General Information",icon:b(O),class:"mb-2"},null,8,["icon"]),t(r,{label:"Arcade Name"},{default:i(()=>[t(I,{modelValue:n.name,"onUpdate:modelValue":e[0]||(e[0]=a=>n.name=a),"input-value":n.name,name:"arcadeName",required:""},null,8,["modelValue","input-value"])]),_:1}),s("div",me,[t(h,{color:"info",label:"Check Name",onClick:e[1]||(e[1]=a=>N())}),P.value==!0?(c(),p(S,{key:0,path:b(X),color:"text-green-400",size:"25"},null,8,["path"])):P.value==!1?(c(),p(S,{key:1,path:b(Y),color:"text-red-400",size:"25"},null,8,["path"])):y("",!0)]),t(r,{label:"Use Discord",help:"Automated provisioning rather than manual. BadManiac will DM the user via Discord."},{default:i(()=>[t(u,{modelValue:n.useDiscord,"onUpdate:modelValue":e[2]||(e[2]=a=>n.useDiscord=a),"input-value":n.useDiscord,name:"useDiscord",type:"switch"},null,8,["modelValue","input-value"])]),_:1}),n.useDiscord?(c(),p(r,{key:0,label:"Discord ID",help:"Owner's Discord User ID."},{default:i(()=>[t(I,{modelValue:n.discordId,"onUpdate:modelValue":e[3]||(e[3]=a=>n.discordId=a),"input-value":n.discordId,name:"discordId",required:""},null,8,["modelValue","input-value"])]),_:1})):y("",!0),n.useDiscord?y("",!0):(c(),p(r,{key:1,label:"Description",help:"Manual description rather than automated."},{default:i(()=>[t(I,{modelValue:n.description,"onUpdate:modelValue":e[4]||(e[4]=a=>n.description=a),name:"description",required:""},null,8,["modelValue"])]),_:1}))]),_:1}),t(w,{"is-form":"",class:"row-span-1"},{default:i(()=>[t(V,{color:"info",label:"Settings",icon:b(Z),class:"mb-2"},null,8,["icon"]),s("div",pe,[t(r,{label:"PASELI Enabled",help:"Enable or disable PASELI services."},{default:i(()=>[t(u,{modelValue:n.paseli,"onUpdate:modelValue":e[5]||(e[5]=a=>n.paseli=a),"input-value":n.paseli,name:"paseli",type:"switch"},null,8,["modelValue","input-value"])]),_:1}),t(r,{label:"Infinite PASELI",help:"Enable or disable infinite PASELI."},{default:i(()=>[t(u,{modelValue:n.infinitePaseli,"onUpdate:modelValue":e[6]||(e[6]=a=>n.infinitePaseli=a),"input-value":n.infinitePaseli,name:"infinitePaseli",type:"switch"},null,8,["modelValue","input-value"])]),_:1}),t(r,{label:"Maintenance Mode",help:"Place this arcade under Maintenance."},{default:i(()=>[t(u,{modelValue:n.maintenance,"onUpdate:modelValue":e[7]||(e[7]=a=>n.maintenance=a),"input-value":n.maintenance,name:"maintenance",type:"switch"},null,8,["modelValue","input-value"])]),_:1}),t(r,{label:"Incognito Mode",help:"Hide the eAmusement network and ranking data."},{default:i(()=>[t(u,{modelValue:n.incognito,"onUpdate:modelValue":e[8]||(e[8]=a=>n.incognito=a),"input-value":n.incognito,name:"incognito",type:"switch"},null,8,["modelValue","input-value"])]),_:1}),t(r,{label:"Beta Testing",help:"Enable or disable beta testing."},{default:i(()=>[t(u,{modelValue:n.betas,"onUpdate:modelValue":e[9]||(e[9]=a=>n.betas=a),"input-value":n.betas,name:"betas",type:"switch"},null,8,["modelValue","input-value"])]),_:1})])]),_:1}),t(w,{class:"row-span-1"},{default:i(()=>[t(V,{color:"info",label:"Machines",icon:b(O),class:"mb-2"},null,8,["icon"]),s("div",fe,[s("form",{class:"h-full",onSubmit:e[15]||(e[15]=ee(a=>k(),["prevent"]))},[t(r,{label:"Generate PCBID",help:"Generate a PCBID rather than supply one."},{default:i(()=>[t(u,{modelValue:o.generatePCBID,"onUpdate:modelValue":e[10]||(e[10]=a=>o.generatePCBID=a),"input-value":o.generatePCBID,name:"generatePCBID",type:"switch"},null,8,["modelValue","input-value"])]),_:1}),o.generatePCBID?y("",!0):(c(),p(r,{key:0,label:"PCBID"},{default:i(()=>[t(I,{modelValue:o.PCBID,"onUpdate:modelValue":e[11]||(e[11]=a=>o.PCBID=a),name:"pcbid",required:"",minlength:"20",maxlength:"20"},null,8,["modelValue"])]),_:1})),t(r,{label:"Name"},{default:i(()=>[t(I,{modelValue:o.name,"onUpdate:modelValue":e[12]||(e[12]=a=>o.name=a),name:"name",required:""},null,8,["modelValue"])]),_:1}),s("div",be,[t(r,{label:"Arcade Cabinet",help:"If this is a real cabinet, enable this."},{default:i(()=>[t(u,{modelValue:o.cabinet,"onUpdate:modelValue":e[13]||(e[13]=a=>o.cabinet=a),"input-value":o.cabinet,name:"cabinet",type:"switch"},null,8,["modelValue","input-value"])]),_:1}),t(r,{label:"Enable Updates",help:"Enables or disables OTA updates."},{default:i(()=>[t(u,{modelValue:o.ota,"onUpdate:modelValue":e[14]||(e[14]=a=>o.ota=a),"input-value":o.ota,name:"ota",type:"switch"},null,8,["modelValue","input-value"])]),_:1})]),t(h,{color:"success",type:"submit",label:"Add Machine"})],32),s("div",null,[t(V,{color:"warning",label:"Queue",class:"mb-4"}),s("div",ge,[(c(!0),ae(ne,null,te(n.machineList,a=>(c(),p(w,{key:a.name,"color-prop":"bg-slate-800 dark:bg-slate-800"},{default:i(()=>[s("div",he,[s("div",Ie,[s("h1",ve,C(a.name),1),s("h2",De,C(a.cabinet?"Cabinet":"Setup")+C(a.ota?" - OTA Enabled":null),1),s("h2",we,C(a.PCBID!=""?a.PCBID:"not generated"),1)]),t(h,{color:"danger",label:"Remove",onClick:m=>J(a.PCBID)},null,8,["onClick"])])]),_:2},1024))),128))])])])]),_:1}),s("div",ye,[t(h,{type:"submit",color:"success",label:n.useDiscord?"Create Arcade with Discord":"Create Arcade and VPN",small:!1,onClick:e[16]||(e[16]=a=>$(!0))},null,8,["label"]),t(h,{type:"submit",color:"info",label:"Create Arcade",small:!1,onClick:e[17]||(e[17]=a=>$(!1))})])])]),_:1})]),_:1}))}};export{ke as default};
